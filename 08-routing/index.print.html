<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.148.1"><meta name=generator content="Relearn 8.0.0"><meta name=description content="Are we there yet?"><meta name=author content="Nathan Bean & Russell Feldhausen"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta name=twitter:title content="Routing :: CIS 526 Textbook"><meta name=twitter:description content="Are we there yet?"><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/08-routing/index.html"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Routing :: CIS 526 Textbook"><meta property="og:description" content="Are we there yet?"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta property="og:image" content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta itemprop=name content="Routing :: CIS 526 Textbook"><meta itemprop=description content="Are we there yet?"><meta itemprop=datePublished content="2018-08-24T10:53:05-05:00"><meta itemprop=dateModified content="2023-08-10T16:48:12-05:00"><meta itemprop=wordCount content="4"><meta itemprop=image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><title>Routing :: CIS 526 Textbook</title><link href=https://textbooks.cs.ksu.edu/cis526/08-routing/index.html rel=canonical type=text/html title="Routing :: CIS 526 Textbook"><link href=/cis526/08-routing/index.xml rel=alternate type=application/rss+xml title="Routing :: CIS 526 Textbook"><link href=/cis526/08-routing/tele.html rel=alternate type=text/html title="Routing :: CIS 526 Textbook"><link href=/cis526/08-routing/embed.html rel=alternate type=text/html title="Routing :: CIS 526 Textbook"><link href=/cis526/css/auto-complete/auto-complete.min.css?1753540871 rel=stylesheet><script src=/cis526/js/auto-complete/auto-complete.min.js?1753540871 defer></script><script src=/cis526/js/search-lunr.min.js?1753540871 defer></script><script src=/cis526/js/search.min.js?1753540871 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/cis526/searchindex.en.js?1753540871"</script><script src=/cis526/js/lunr/lunr.min.js?1753540871 defer></script><script src=/cis526/js/lunr/lunr.stemmer.support.min.js?1753540871 defer></script><script src=/cis526/js/lunr/lunr.multi.min.js?1753540871 defer></script><script src=/cis526/js/lunr/lunr.en.min.js?1753540871 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1753540871 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1753540871 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar/perfect-scrollbar.min.css?1753540871 rel=stylesheet><link href=/cis526/css/theme.min.css?1753540871 rel=stylesheet><link href=/cis526/css/format-print.min.css?1753540871 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/08-routing/index.html",window.relearn.relBasePath="..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!1,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["light-theme"],window.relearn.customvariantname="my-custom-variant",window.relearn.writeVariant=!1,window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.writeVariant&&window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><link href=/cis526/css/custom.css?1753540871 rel=stylesheet></head><body class="mobile-support print" data-url=/cis526/08-routing/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement class=a11y-only><a itemprop=item href=/cis526/index.html><span itemprop=name>Web Application Development</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Routing</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-edit" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=https://github.com/ksu-cs-textbooks/cis526/edit/main/content/08-routing/_index.md rel=external target=_blank title="Edit (CTRL+ALT+w)"><i class="fa-fw fas fa-pen"></i></a></div><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/08-routing/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/07-persistent-storage/06-orm/index.html title="Object-Relational Mapping (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/08-routing/01-introduction/index.html title="Introduction (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more><div class="topbar-button topbar-button-embed" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/08-routing/embed.html title="Embeddable Version"><i class="fa-fw fas fa-expand-arrows-alt"></i></a></div><div class="topbar-button topbar-button-tele" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/08-routing/tele.html title="Teleprompter View"><i class="fa-fw fas fa-tv"></i></a></div></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable 08-routing" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=routing>Routing</h1><p>Are we there yet?</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Routing</h1><article class=default><header class=headline></header><h1 id=introduction>Introduction</h1><p>Once again, we&rsquo;ll return to the request-response pattern diagram.</p><p><a href=#R-image-167a7a87245b47894075818872528400 class=lightbox-link><img alt="The Request-Response Pattern" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/8.0.1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-167a7a87245b47894075818872528400><img alt="The Request-Response Pattern" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/8.0.1.png></a></p><p>We revisit this diagram because it is so central to how HTTP servers work. At the heart, a server&rsquo;s primary responsibility is to respond to an incoming request. Thus, in <em>writing</em> a web server, our primary task is to determine what to respond with. With static web servers, the answer is pretty simple - we map the virtual path supplied by the URL to a file path on the file server. But the URL supplied in a request <em>doesn&rsquo;t</em> have to correspond to any real object on the server - we can create any object we want, and send it back.</p><p>In our examples, we&rsquo;ve built several functions that build specific kinds of responses. Our <code>serveFile()</code> function serves a response representing a static file. Our <code>listDirectory()</code> function generates an index for a directory, or if the directory contained a <code>index.html</code> file, served it instead. And our dynamic <code>servePost()</code> from our blog served a dynamically generated HTML page that drew data from a database.</p><p>Each of these functions created a <em>response</em>. But how do we know which of them to use? That is the question that we will be grappling with in this chapter - and the technical term for it is <em>routing</em>.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=request-routing>Request Routing</h1><p>In web development, routing refers to the process of matching an incoming request with generating the appropriate response. For most web servers (and definitely for Node-based ones), we abstract the process of generating the response into a function. We often call these functions <em>endpoints</em> as their purpose is to serve the response, effectively ending the processing of an incoming request with an appropriate response.</p><p>With a Node webserver, endpoint functions typically take in a <code>req</code> (an instance of http.IncomingMessage) and <code>res</code> (an instance of http.ServerResponse) objects. These objects form an abstraction around the HTTP request and response.</p><p>Routing in a Node webserver therefore consists of examining the properties of the <code>req</code> object and determining which endpoint function to invoke. Up to this point, we&rsquo;ve done this logic in a <code>handleRequest()</code> function, in a fairly ad-hoc way. Consider what we might need to do for a dynamically generated blog - we&rsquo;d need to serve static files (like CSS and JS files), as well as dynamically generated pages for blog posts and the home page. What might our <code>handleRequest()</code> look like in that case?</p><p>Let&rsquo;s assume we have a <code>serveHome()</code> function to serve the home page, a <code>serveFile()</code> function to serve static files, and a <code>servePost()</code> function to serve dynamically generated posts. Determining if the request is for the homepage is easy, as we know the path should just be a forward slash:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>    <span style=color:#75715e>// Determine if the request is for the index page
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>url</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;/&#39;</span>) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>serveHome</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>);</span></span></code></pre></div><p>But what about determining if a request is for a post or a static file? We could use <code>fs.stat</code> to determine if a file exists:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>    <span style=color:#75715e>// Determine if a corresponding file exists 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>stat</span>(<span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#34;public&#34;</span>, <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>url</span>), (<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>stat</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>err</span>) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Error reading file, might be a post?
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>servePost</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// File exists, serve it 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>serveFile</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    });</span></span></code></pre></div><p>This would work, but it&rsquo;s a bit ugly. Also, using a filesystem method like <code>fs.stat</code> is potential bottleneck in our application; we&rsquo;d like to avoid it if at all possible.</p><p>If we make all our posts use the url <code>/posts</code>, we could use the query string to determine which post we want to display. This approach is a bit cleaner, though it does mean we need to separate the pathname from our URL:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>handleRequest</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Separate the pathname from the url 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pathname</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>url</span>, <span style=color:#e6db74>&#34;http://localhost&#34;</span>).<span style=color:#a6e22e>pathname</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Determine if the request is for the index page
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>pathname</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;/&#39;</span>) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>serveHome</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Determine if the request is for a post 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>pathname</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;/post&#39;</span>) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>servePost</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Treat all other requests as a file 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>serveFile</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>);
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>This is a bit cleaner of an approach, but it still has a very ad-hoc feel and requires us to incorporate query strings into some of our URLs.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=resources>Resources</h1><p>As the web transitioned to dynamic pages, the concept of the URL path evolved. With a static server, the path indicates an actual file that exists on the fileserver. But with dynamic pages, the url doesn&rsquo;t have to correspond to anything real. Consider the case of <a href=https://placeholder.com/ rel=external target=_blank>Placeholder.com</a>, a service that offers image URLs you can use in a site layout to simulate images. For example, the image below is generated by the site by using the URL By using the URL <code>//via.placeholder.com/350x150</code>:</p><p><a href=#R-image-2170619ad3f493fa4faae1032f428092 class=lightbox-link><img alt="350 x 150 pixel placeholder image" class="border lazy lightbox figure-image" loading=lazy src=https://via.placeholder.com/350x150 style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2170619ad3f493fa4faae1032f428092><img alt="350 x 150 pixel placeholder image" class="border lazy lightbox lightbox-image" loading=lazy src=https://via.placeholder.com/350x150></a></p><p>Does Placeholder.com have thousands of images of varying sizes stored on a disk somewhere? No! It generates the image data <em>dynamically</em> based on the request - here it reads the <code>350x150</code> and uses it to determine the size of the image needed. It also reads other aspects of the URL and uses those to set other aspects, i.e. the url <code>//via.placeholder.com/350x150/C497FF/FFFFFF?text=Hello</code> generates the image:</p><p><a href=#R-image-7917af5f06be53652394d0e6fef7b924 class=lightbox-link><img alt="Another placeholder image with custom color and text" class="border lazy lightbox figure-image" loading=lazy src="https://via.placeholder.com/350x150/C497FF/FFFFFF?text=Hello" style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7917af5f06be53652394d0e6fef7b924><img alt="Another placeholder image with custom color and text" class="border lazy lightbox lightbox-image" loading=lazy src="https://via.placeholder.com/350x150/C497FF/FFFFFF?text=Hello"></a></p><p>Clearly, we&rsquo;re conveying information to the Placeholder.com server <em>through the url</em>. This is much like passing parameters to a function - it is how we communicate what we want the server to do with our request!</p><p>Let&rsquo;s revisit our blog server. What if we adopted a similar approach there? Our URLs might then look like:</p><ul><li><a href=http://my-blog.com/posts/0-hello-web rel=external target=_blank>http://my-blog.com/posts/0-hello-web</a></li><li><a href=http://my-blog.com/posts/1-a-rose-by-any-other-name rel=external target=_blank>http://my-blog.com/posts/1-a-rose-by-any-other-name</a></li><li><a href=http://my-blog.com/posts/40-another-day rel=external target=_blank>http://my-blog.com/posts/40-another-day</a></li></ul><p>Where we use the <em>entire title</em> as part of the URL! This makes it more human-readable, especially helpful when searching your browser history or scanning bookmarks. But how would we handle this approach in our <code>handleRequest()</code>? You might recognize that we have a reoccurring <em>pattern</em>, which of course suggests we try a <code>RegExp</code>:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>handleRequest</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) {
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Separate the pathname from the url 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pathname</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>url</span>, <span style=color:#e6db74>&#34;http://localhost&#34;</span>).<span style=color:#a6e22e>pathname</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Determine if the request is for the index page
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>pathname</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;/&#39;</span>) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>serveHome</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Determine if the request is for a post 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span>(<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#a6e22e>$</span><span style=color:#f92672>/</span><span style=color:#a6e22e>post</span><span style=color:#f92672>/</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#a6e22e>w</span><span style=color:#f92672>+^</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>test</span>(<span style=color:#a6e22e>pathname</span>)) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>servePost</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Treat all other requests as a file 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>serveFile</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>);
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>With this regular expression, we&rsquo;ve effectively built a wildcard into our URL. Any URL with a pattern <code>/posts/[postname]</code> will be treated as a post!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=request-revisted>Request Revisted</h1><p>We&rsquo;ve seen then how the request conveys information useful to selecting the appropriate endpoint with the path, and also the query string. But there is more information available in our request than just those two tidbits. And we have <em>all</em> of that information available to us for determining the correct response to send. With that in mind, let&rsquo;s revisit the parts of the request in terms of what kinds of information they can convey.</p><h2 id=the-url-revisited>The URL, Revisited</h2><p>Now that we&rsquo;re thinking of the URL as a tool for passing information to the server, let&rsquo;s reexamine its parts:</p><p><a href=#R-image-43319e81f6db0354f6d73731d2f9c7bb class=lightbox-link><img alt="A diagram of a URL" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/6.3.1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-43319e81f6db0354f6d73731d2f9c7bb><img alt="A diagram of a URL" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/6.3.1.png></a></p><p>The <strong>protocol</strong> is the protocol used for communication, and the <strong>host</strong> is the domain or IP address of the server. Note that these are <em>not</em> included in Node&rsquo;s <code>req.url</code> parameter, as these are used to find the right server and talk to it using the right protocol - by the time your Node server is generating the <code>req</code> object, the request has already found your server and is communicating with the protocol.</p><p>This is also why when we&rsquo;ve been parsing <code>req.url</code> with the <a href=https://nodejs.org/api/url.html rel=external target=_blank>URL</a> object, we&rsquo;ve supplied a host and protocol of <code>http://localhost</code>:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>url</span>, <span style=color:#e6db74>&#34;http://localhost&#34;</span>);</span></span></code></pre></div><p>This gives the URL object a placeholder for the missing protocol and host, so that it can parse the supplied URL without error. Just keep in mind that by doing so the <code>url.protocol</code> and <code>url.host</code> properties of <code>url</code> equal this &ldquo;fake&rdquo; host and protocol.</p><p>The <strong>path</strong> is the path to the virtual resource requested, accessible in our parsed URL as <code>url.pathname</code>. Traditionally, this corresponded to a file path, which is how we used it in our fileserver examples. But as we have seen with Placeholder.com, it can also be used to convey other information - in that case, the size of the image, its background color, and foreground color.</p><p>The <strong>query</strong> or <strong>querystring</strong> is a list of key-value pairs, preceded by the <code>?</code>. Traditionally this would be used to modify some aspect of the request, such as requesting a particular data format or portion of a dataset. It is also how forms are submitted with a GET request - the form data is encoded into the query string.</p><p>The <strong>hash</strong> or <strong>fragment</strong> is preceded by a <code>#</code>, and traditionally indicates an element on the page that the browser should auto-scroll to. This element should have an <code>id</code> attribute that matches the one supplied by the hash. For example, clicking this link: <a href=/cis526/08-routing/04-request-revisited/index.html#the-url-revisited>#the-url-revisited</a> will scroll back to the header for this section (note we left the path blank, so the browser assumes we want to stay on this page).</p><p>Clearly our URL can clearly convey a lot of data to our server. But that&rsquo;s not the only information that we can use in deciding how to respond to a request.</p><h2 id=request-method-revisited>Request Method, Revisited</h2><p>In addition, we also receive the HTTP Method used for the request, i.e. GET, POST, PATCH, PUT, or DELETE. These again map back to the traditional role of a web server as a file server - GET retrieves a resource, POST uploads one, PATCH and PUT modify one, and DELETE removes it. But we can also create, read, update, and destroy <em>virtual</em> resources, i.e. resources generated and stored on the server that are <em>not</em> files. These play an especially important role in RESTful routes, which we&rsquo;ll discuss soon.</p><h2 id=headers-revisited>Headers, Revisited</h2><p>We can also convey additional information for the server to consider as part of the request headers. This is usually used to convey information tangential to the request, like authentication and cookies. We&rsquo;ll also discuss this a bit further on.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=rest>REST</h1><p>We&rsquo;ve already seen that with our blog, we could convey which post to display with different URL strategies, i.e.:</p><ul><li><a href="http://my-blog.com/posts?id=5" rel=external target=_blank>http://my-blog.com/posts?id=5</a></li><li><a href=http://my-blog.com/posts/5 rel=external target=_blank>http://my-blog.com/posts/5</a></li><li><a href=http://my-blog.com/posts/5-a-night-that-was-dark rel=external target=_blank>http://my-blog.com/posts/5-a-night-that-was-dark</a></li></ul><p>And that is just to <em>display</em> posts. What about when we want our blog software to allow the writer to <em>submit</em> new posts? Or <em>edit</em> existing ones? That&rsquo;s a lot of different URLS we&rsquo;ll need to keep track of.</p><h2 id=representational-state-transfer-rest>Representational State Transfer (REST)</h2><p>Roy Fielding tackled this issue in <a href=https://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm rel=external target=_blank>Chapter 5</a> of his Ph.D. dissertation &ldquo;Architectural Styles and the Design of Network-based Software Architectures.&rdquo; He recognized that increasingly dynamic web servers were dealing with <em>resources</em> that could be created, updated, read, and destroyed, much like the resources in database systems (not surprisingly, many of these resources were persistently stored in such a database system). These operations are so pervasive in database systems that we have an acronym for them: CRUD.</p><p>Roy mapped these CRUD methods to a HTTP URL + Method pattern he called <strong>Re</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer (or REST). This pattern provided a well-defined way to express CRUD operations as HTTP requests.</p><p>Take our blog posts example. The RESTful routes associated with posts would be:</p><table><tr><th>URL</th><th>HTTP Method</th><th>CRUD Operation</th></tr><tr><td>posts/</td><td>GET</td><td>Read (all)</td></tr><tr><td>posts/:id</td><td>GET</td><td>Read (one)</td></tr><tr><td>posts/</td><td>POST</td><td>Create</td></tr><tr><td>posts/:id</td><td>POST</td><td>Update</td></td><tr><td>posts/:id</td><td>DELETE</td><td>Delete</td></tr></table><p>The <code>:id</code> corresponds to an actual identifier of a specific resource - most often the <code>id</code> column in the database. REST also accounts for nesting relationships. Consider if we added <em>comments</em> to our <em>posts</em>. Comments would need to correspond to a specific post, so we&rsquo;d nest the routes:</p><table><tr><th>URL</th><th>HTTP Method</th><th>CRUD Operation</th></tr><tr><td>posts/:post_id/comments</td><td>GET</td><td>Read (all)</td></tr><tr><td>posts/:post_id/comments/:comment_id</td><td>GET</td><td>Read (one)</td></tr><tr><td>posts/:post_id/comments</td><td>POST</td><td>Create</td></tr><tr><td>posts/:post_id/comments/:comments_id</td><td>POST</td><td>Update</td></td><tr><td>posts/:post_id/comments/:comments_id</td><td>DELETE</td><td>Delete</td></tr></table><p>Notice that we now have <em>two</em> wildcards for most routes, one corresponding to the <code>post</code> and one to the <code>comment</code>.</p><p>If we didn&rsquo;t want to support an operation, for example, <em>updating</em> comments, we could just omit that route.</p><p>REST was so straightforward and corresponded so well to how many web servers were operating, that it quickly became a widely adopted technique in the web world. When you hear of a RESTful API or RESTful routes, we are referring to using this pattern in the URLs of a site.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=routers>Routers</h1><p>Many web development frameworks built upon this concept of routes by supplying a <em>router</em>, and object that would store route patterns and perform the routing operation. One popular Node library <a href=https://expressjs.com/ rel=external target=_blank>express</a>, is at its heart a router. If we were to write our Node blog using Express, the syntax to create our routes would be:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>express</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;express&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Home page 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/&#39;</span>, <span style=color:#a6e22e>serveHome</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Posts 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;posts/&#39;</span>, <span style=color:#a6e22e>servePosts</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;posts/:id&#39;</span>, <span style=color:#a6e22e>servePost</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#39;posts/&#39;</span>, <span style=color:#a6e22e>createPost</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#39;posts/:id&#39;</span>, <span style=color:#a6e22e>updatePost</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#66d9ef>delete</span>(<span style=color:#e6db74>&#39;posts/:id&#39;</span>, <span style=color:#a6e22e>deletePost</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Comments
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;posts/:post_id/comments&#39;</span>, <span style=color:#a6e22e>servePosts</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;posts/:post_id/comments/:id&#39;</span>, <span style=color:#a6e22e>servePost</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#39;posts/:post_id/comments&#39;</span>, <span style=color:#a6e22e>createPost</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#39;posts/:post_id/comments/:id&#39;</span>, <span style=color:#a6e22e>updatePost</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#66d9ef>delete</span>(<span style=color:#e6db74>&#39;posts/:post_id/comments/:id&#39;</span>, <span style=color:#a6e22e>deletePost</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>app</span>;</span></span></code></pre></div><p>The <code>app</code> variable is an instance of the express <a href=https://expressjs.com/en/4x/api.html#app rel=external target=_blank>Application</a> class, which itself is a wrapper around Node&rsquo;s <a href=https://nodejs.org/api/http.html#http_class_http_server rel=external target=_blank>http.Server</a> class. The Express <code>Application</code> adds (among other features), routing using the route methods <code>app.get()</code>, <code>app.post()</code>, <code>app.put()</code>, and <code>app.delete()</code>. These take routes either in string or regular expression form, and the wildcard values are assigned to an object in <code>req.params</code>. For example, we might write our <code>servePost()</code> method as:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>servePost</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>id</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>post</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>prepare</span>(<span style=color:#e6db74>&#34;SELECT * FROM posts WHERE ID = ?&#34;</span>, <span style=color:#a6e22e>id</span>);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// TODO: Render the post HTML
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}</span></span></code></pre></div><p>The parameter name in params is the same as the token after the <code>:</code> in the wildcard.</p><p>Routers can greatly simplify the creation of web applications, and provide a clear and concise way to specify routes. For this reason, they form the heart of most dynamic web development frameworks.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=apis>APIs</h1><p>Before we step away from routing, we should take the time to discuss a specific style of web application that goes hand-in-hand with routing - an Application Programming Interface (API). An API is simply a interface for two programs to communicate, to allow one to act as a service for the other. Web APIs are APIs that use hyper-text transfer protocol (http) as the mechanism for this communication. Thus, the client program makes HTTP requests against the API server and receives responses. The <a href=https://placeholder.com/ rel=external target=_blank>Placeholder.com</a> we discussed earlier in this chapter is an example of a web API - one that generates and serves placeholder images.</p><p>In fact, an API can serve <em>any</em> kind of resource - binary files, image files, text files, etc. But most serve data in one of a few forms:</p><ul><li><strong>HTML that is intended to be embedded in a web page</strong>, common to advertisement revenue services, embeddable social media feeds, YouTube and other video embedding sites.</li><li><strong>Data structured as JSON</strong>, a <em>very</em> common format for submitting or retrieving any kind of data across the web. For data that will be used by JavaScript running in the browser, it has the advantage of being the native format.</li><li><strong>Data structured as XML</strong>, another common format, XML tends to be slightly larger than the equivalent JSON, but it can have a published and enforced structure.</li></ul><h2 id=some-example-web-apis>Some Example Web APIs</h2><p>There are thousands of Web APIs available for you to work with. Some you might be interested in investigating include:</p><ul><li><a href=https://www.weather.gov/documentation/services-web-api rel=external target=_blank>The National Weather Service API</a> - we used this API early in the course to retrieve weather forecast data. As the NWS is supported by tax dollars, this resource is free to use.</li><li><a href=https://www.census.gov/data/developers/data-sets.html rel=external target=_blank>Census APIs</a> similarly, the U.S. Census Bureau makes much of their data sets available through APIs</li><li><a href=https://api.nasa.gov/ rel=external target=_blank>NASA APIs</a> as does NASA.</li><li><a href=https://developers.google.com/maps/documentation rel=external target=_blank>Google Maps</a> has extensive APIs for maps and geolocation, with a fee structure.</li><li><a href=https://wiki.openstreetmap.org/wiki/API rel=external target=_blank>Open Street Maps</a> offers an open-source alternative.</li><li><a href=https://developers.facebook.com/docs/apis-and-sdks/ rel=external target=_blank>Facebook</a> has a large collection of APIs for working with their data and navigating social network relationships.</li><li><a href=https://developer.github.com/v3/ rel=external target=_blank>GitHub</a> provides an API for developing tools to work with their site.</li></ul><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=web-hooks>Web Hooks</h1><p>A lighter-weight alternative to a full-fledged API is a <a href=https://en.wikipedia.org/wiki/Webhook rel=external target=_blank>webhook</a>. A webhook is simply an address a web application is instructed to make a HTTP request against when a specific event happens. For example, you can set your GitHub repository to trigger a webhook when a new commit is made to it. You simply provide the URL it should send a request to, and it will send a request with a payload (based on the event).</p><p>For example, the Discord chat platform allows users to create <a href=https://support.discord.com/hc/en-us/articles/228383668-Intro-to-Webhooks rel=external target=_blank>webhook endpoint</a> that will post messages into a channel. The webhook will be the in the form lf a URL that specifies the Discord server and channel that the message should be sent to, as well as some authentication parameters to identify the source of the webhook. You can then configure a webhook in GitHub which sends a message to the URL when a commit is made to GitHub. Now, each time a user pushes new data to GitHub, you&rsquo;ll be able to see a message in Discord.</p><p>A more advanced webhook endpoint can be used to trigger various actions, such as a continuous deployment routine. In that way, you can have a repository automatically deploy each time it is updated, simply through the use of webhooks!</p><p>In other words, a webhook is a technique for implementing event listeners using HTTP. One web service (GitHub in the example) provides a way for you to specify an event listener defined in another web application by the route used to communicate with it. This represents a looser coupling than a traditional API; if the request fails for any reason, it will not cause problems for the service that triggered it. It also has the benefit of being event-driven, whereas to check for new data with an API, you would need to <em>poll</em> (make a request to query) the API at regular intervals.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=summary>Summary</h1><p>In this chapter, we exported the idea of <em>routes</em>, a mechanism for mapping a request to the appropriate <em>endpoint</em> function to generate a response. Routes typically consist of both the request URL <em>and</em> the request method. RESTful routes provide a common strategy for implementing CRUD methods for a server-generated resource; any programmer familiar with REST will quickly be able to suss out the appropriate route.</p><p>We also explored <em>routers</em> are objects that make routing more manageable to implement. These allow you to define a route and tie it to an endpoint function used to generate the result. Most will also capture wildcards in the route, and supply those to the endpoint function in some form. We briefly looked at the <a href=http://expressjs.com/ rel=external target=_blank>Express</a> framework, a Node framework that adds a router to the vanilla Node <a href=https://nodejs.org/api/http.html#http_class_http_server rel=external target=_blank>http.Server</a> class.</p><p>Finally, we discussed using routes to serve other <em>programs</em> instead of users with APIs and WebHooks.</p><footer class=footline></footer></article></section></div></main><div class=git-footer><p class=theme-version-footer>8.0.0</p><p>Last modified by:
<i class='fa-fw fas fa-user'></i> Russell Feldhausen
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cis526/commit/41163dc548a00400a9f1d4962b4227b9a8ee4d20>Aug 10, 2023</a></p></div></div><script src=/cis526/js/clipboard/clipboard.min.js?1753540871 defer></script><script src=/cis526/js/perfect-scrollbar/perfect-scrollbar.min.js?1753540871 defer></script><script src=/cis526/js/theme.min.js?1753540871 defer></script></body></html>