




	
	
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		
		
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.101.0">
    <meta name="generator" content="Relearn 5.2.0+tip">
    <meta name="description" content="CIS 526 Textbook">
    <meta name="author" content="Nathan Bean">
    <title>Sessions :: CIS 526 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis526/06-dynamic-web-servers/09-sessions/" rel="canonical" type="text/html" title="CIS 526 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis526/06-dynamic-web-servers/09-sessions/index.xml" rel="alternate" type="application/rss+xml" title="CIS 526 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis526/06-dynamic-web-servers/09-sessions/index.print.html" rel="alternate" type="text/html" title="CIS 526 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis526/06-dynamic-web-servers/09-sessions/tele.html" rel="alternate" type="text/html" title="CIS 526 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/fontawesome-all.min.css?1675182292" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/fontawesome-all.min.css?1675182292" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/featherlight.min.css?1675182292" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/featherlight.min.css?1675182292" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/auto-complete.css?1675182292" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/auto-complete.css?1675182292" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/perfect-scrollbar.min.css?1675182292" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/nucleus.css?1675182292" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/fonts.css?1675182292" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/fonts.css?1675182292" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/theme.css?1675182292" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/theme-light-theme.css?1675182292" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/ie.css?1675182292" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/variant.css?1675182292" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/print.css?1675182292" rel="stylesheet" media="print">
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/variant.js?1675182292"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      var index_url="https://ksu-cs-textbooks.github.io/cis526/index.json";
      var root_url="https://ksu-cs-textbooks.github.io/cis526/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis526/';
      window.variants && variants.init( [ 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/custom.css?1675182292" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/jquery.min.js?1675182292" defer></script>

  </head>
  <body class="mobile-support embed disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis526/06-dynamic-web-servers/09-sessions/embed.html">
    <div id="body" class="default-animation">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
          </div>
          <article class="default">
    
    
    
<p>If HTTP is stateless, how do e-commerce websites manage to keep track of the contents of your shopping cart as you navigate from page to page? The answer is the use of a <em>session</em> - a technique by which state is added to a web application.</p>

  
  
<div class="box notices cstyle info">
    <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
    <div class="box-content">
<p>The term <strong>session</strong> appears a <em>lot</em> in web development, and can mean different things in different contexts.  But there is a common thread in each - a session is a form of connection between the client and server.</p>
<p>For example, when your web client make a request from a web server, it opens a Transmission Control Protocol (TCP) session to the server, and sends the HTTP request across this connection.  The session stays open until all the packets of the request are sent, and those of the response are received.  In HTTP 1.1, the session can stay open for more than a single request-response pair, as it is anticipated a HTML page request will be followed by requests for resources (CSS, JavaScript, images, etc.) embedded in the page.  HTTP 2.0 takes this farther, allowing the server to <em>push</em> these additional resources to the client.</p>
<p>The sessions we are discussing here are implemented at a higher level than TCP sessions (though they are hosted by the TCP session), and represent a single website visitor interacting with the server.</p>
    </div>
</div>
<p>A session therefore provides a mechanism for storing information between requests, and must be unique to a specific user.  All session techniques begin with a cookie, so you should be familiar with that concept.</p>
<p>There are three basic session techniques you will likely encounter in web development.  Let&rsquo;s take a look at each.</p>
<h2 id="cookie-session">Cookie Session</h2>
<p>In a cookie session, the session information is completely stored within the cookie.  This has the benefit that no state information needs to be stored on the server, and it is easy to implement.</p>
<p>There are several downsides to the cookie session.  The first is that it comes with a limited amount of reliable storage (the standard suggests that browsers support a minimum cookie size of 4096 bytes per cookie, but there is no hard requirement).  Second, cookies are somewhat vulnerable, as they can be intercepted in-transit, and they can also be recovered from a browser&rsquo;s cookie storage by a knowledgeable adversary.</p>
<h2 id="in-memory-cookies">In-Memory Cookies</h2>
<p>A second approach is to store the session data on the server using some form of memory cache.  A straightforward implementation for a Node server would be to use an object, i.e.:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sessions</span> <span style="color:#f92672">=</span> {}
</span></span></code></pre></div><p>Each time a new visitor comes to the website, a unique ID is generated, and used as the the key for their session, and sent to the client as a cookie, i.e.:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sessionID</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">some</span> <span style="color:#a6e22e">unique</span> <span style="color:#a6e22e">id</span>];
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">setHeader</span>(<span style="color:#e6db74">&#34;Set-Cookie&#34;</span>, <span style="color:#e6db74">`session-id=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">sessionID</span><span style="color:#e6db74">}</span><span style="color:#e6db74">; lang=en-US`</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sessions</span>[<span style="color:#a6e22e">sessionID</span>] <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// session data here
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>On subsequent requests, the cookie can be retrieved from the request and used to retrieve the session data:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cookie</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">headers</span>[<span style="color:#e6db74">&#34;cookie&#34;</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sessionID</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">/session-id=([^;])/</span>.<span style="color:#a6e22e">match</span>(<span style="color:#a6e22e">cookie</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">session</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sessions</span>[<span style="color:#a6e22e">sessionID</span>];
</span></span></code></pre></div><p>Because the session data is never sent in its raw form to the client, it is more secure.  However, the session can still be hijacked by a malicious user who copies the cookie or guesses a valid session id.  To counter this, all requests should be updated to use secure protocol (https) and the cookie should be encrypted.</p>
<p>Also, in-memory sessions are lost when the server reboots (as they are held in volatile memory).  They should also be cleaned out periodically, as each session consumes working memory, and if a session is more than an hour old it probably will not be used again.</p>
<h2 id="database-sessions">Database Sessions</h2>
<p>When a website is backed by a database (as we&rsquo;ll cover 

<a href="https://ksu-cs-textbooks.github.io/cis526/07-persistent-storage/03-databases/">soon</a>), storing the session in that database becomes an option.  Functionally, it is similar to an In-Memory session, except that the database becomes the storage mechanism.  Because the database offers persistent storage, the session also could be persistent (i.e. you remain &ldquo;logged on&rdquo; every time you visit from the same computer).  Still, database sessions typically are cleaned out periodically to keep the sessions table from growing overlarge.</p>
<p>Database sessions are a good choice if your website is already using a database.  For a website with registered users, the session id can be the user&rsquo;s id, as defined in the database schema.</p>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/clipboard.min.js?1675182292" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/perfect-scrollbar.min.js?1675182292" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/featherlight.min.js?1675182292" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/theme.js?1675182292" defer></script>
    
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/embed-iframe.js?1675182292 defer"></script>
    
  </body>
</html>
