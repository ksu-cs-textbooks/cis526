<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.148.1"><meta name=generator content="Relearn 8.0.0"><meta name=description content="While many HTTP libraries will process the entire incoming request before passing control to the program, Node’s http module takes a different approach. It constructs and passes the http.IncomingMessage and http.ServerResponse objects as soon as it has received the header portion of the request. This means the body may still be being transmitted to the server as you start to process the request.
This is fine for GET requests, as they don’t have a body. But for requests that do have a body, it means you have to process the incoming data yourself."><meta name=author content="Nathan Bean & Russell Feldhausen"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta name=twitter:title content="Request Body :: CIS 526 Textbook"><meta name=twitter:description content="While many HTTP libraries will process the entire incoming request before passing control to the program, Node’s http module takes a different approach. It constructs and passes the http.IncomingMessage and http.ServerResponse objects as soon as it has received the header portion of the request. This means the body may still be being transmitted to the server as you start to process the request.
This is fine for GET requests, as they don’t have a body. But for requests that do have a body, it means you have to process the incoming data yourself."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/06-dynamic-web-servers/07-req-body/index.html"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Request Body :: CIS 526 Textbook"><meta property="og:description" content="While many HTTP libraries will process the entire incoming request before passing control to the program, Node’s http module takes a different approach. It constructs and passes the http.IncomingMessage and http.ServerResponse objects as soon as it has received the header portion of the request. This means the body may still be being transmitted to the server as you start to process the request.
This is fine for GET requests, as they don’t have a body. But for requests that do have a body, it means you have to process the incoming data yourself."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="Dynamic Web Servers"><meta property="article:published_time" content="2018-08-24T10:53:26-05:00"><meta property="article:modified_time" content="2021-06-25T22:27:31-05:00"><meta property="og:image" content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta itemprop=name content="Request Body :: CIS 526 Textbook"><meta itemprop=description content="While many HTTP libraries will process the entire incoming request before passing control to the program, Node’s http module takes a different approach. It constructs and passes the http.IncomingMessage and http.ServerResponse objects as soon as it has received the header portion of the request. This means the body may still be being transmitted to the server as you start to process the request.
This is fine for GET requests, as they don’t have a body. But for requests that do have a body, it means you have to process the incoming data yourself."><meta itemprop=datePublished content="2018-08-24T10:53:26-05:00"><meta itemprop=dateModified content="2021-06-25T22:27:31-05:00"><meta itemprop=wordCount content="421"><meta itemprop=image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><title>Request Body :: CIS 526 Textbook</title><link href=https://textbooks.cs.ksu.edu/cis526/06-dynamic-web-servers/07-req-body/index.html rel=canonical type=text/html title="Request Body :: CIS 526 Textbook"><link href=/cis526/06-dynamic-web-servers/07-req-body/index.xml rel=alternate type=application/rss+xml title="Request Body :: CIS 526 Textbook"><link href=/cis526/06-dynamic-web-servers/07-req-body/index.print.html rel=alternate type=text/html title="Request Body :: CIS 526 Textbook"><link href=/cis526/06-dynamic-web-servers/07-req-body/tele.html rel=alternate type=text/html title="Request Body :: CIS 526 Textbook"><link href=/cis526/css/auto-complete/auto-complete.min.css?1755561291 rel=stylesheet><script src=/cis526/js/auto-complete/auto-complete.min.js?1755561291 defer></script><script src=/cis526/js/search-lunr.min.js?1755561291 defer></script><script src=/cis526/js/search.min.js?1755561291 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/cis526/searchindex.en.js?1755561291"</script><script src=/cis526/js/lunr/lunr.min.js?1755561291 defer></script><script src=/cis526/js/lunr/lunr.stemmer.support.min.js?1755561291 defer></script><script src=/cis526/js/lunr/lunr.multi.min.js?1755561291 defer></script><script src=/cis526/js/lunr/lunr.en.min.js?1755561291 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1755561291 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1755561291 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar/perfect-scrollbar.min.css?1755561291 rel=stylesheet><link href=/cis526/css/theme.min.css?1755561291 rel=stylesheet><link href=/cis526/css/format-html.min.css?1755561291 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/06-dynamic-web-servers/07-req-body/index.html",window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!1,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["light-theme"],window.relearn.customvariantname="my-custom-variant",window.relearn.writeVariant=!1,window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.writeVariant&&window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><link href=/cis526/css/custom.css?1755561291 rel=stylesheet></head><body class="mobile-support embed html" data-url=/cis526/06-dynamic-web-servers/07-req-body/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable 06-dynamic-web-servers" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=request-body>Request Body</h1><p>While many HTTP libraries will process the entire incoming request before passing control to the program, Node&rsquo;s <code>http</code> module takes a different approach. It constructs and passes the <code>http.IncomingMessage</code> and <code>http.ServerResponse</code> objects as soon as it has received the header portion of the request. This means the body may still be being transmitted to the server as you start to process the request.</p><p>This is fine for GET requests, as they don&rsquo;t have a body. But for requests that <em>do</em> have a body, it means you have to process the incoming data yourself.</p><p>To do so, there are three events made available in the <a href=https://nodejs.org/api/http.html#http_class_http_incomingmessage rel=external target=_blank>http.IncomingMessage</a> object: <code>data</code>, <code>end</code>, and <code>error</code>.</p><p>The <code>data</code> event occurs whenever a new chunk of the body is available, and that chunk is passed to the event listener. The <code>end</code> event occurs once all the chunks have been received. And the <code>error</code> event occurs when something goes wrong. The chunks are <a href=https://nodejs.org/api/buffer.html rel=external target=_blank>Buffer</a> objects, and are always received in order.</p><p>Thus, we need to collect each chunk from each <code>data</code> event, and join them together into a single buffer at the <code>end</code> event. Thus, the basic scaffold for doing so is:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>loadBody</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>chunks</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// listen for data events
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;data&#39;</span>, (<span style=color:#a6e22e>chunk</span>) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>chunks</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>chunk</span>);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// listen for the end event 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;end&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Combine the chunks 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Buffer</span>.<span style=color:#a6e22e>concat</span>(<span style=color:#a6e22e>chunks</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// DO SOMETHING WITH DATA
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// listen for error events 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;error&#39;</span>, (<span style=color:#a6e22e>err</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// RESPOND APPROPRIATELY TO ERROR
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    });
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Note that these events occur asynchronously, so this scaffold needs to be integrated into an appropriate asynchronous processing strategy.</p><p>You might wonder why the developers of Node chose to handle request bodies in this fashion. Most likely, it was for the degree of control it offers the programmer. Consider the case where you decide your program needs to be able to stop an upload - you can do so with <a href=https://nodejs.org/api/http.html#http_class_http_incomingmessage rel=external target=_blank>http.IncomingMessage.destroy()</a>, which immediately closes the socket connecting the client to the server, effectively terminating the upload.</p><p>This can prevent the server from doing unneeded work and consuming unnecessary bandwidth. Of course, the decision to stop an upload is highly situationally dependent - thus they leave it in your hands as the programmer.</p><p>In fact, a common Denial of Service attack known as an HTTP flood often takes advantage of POST requests to submit requests with large bodies to consume server resources. By giving the programmer the ability to stop uploads this way helps counter this kind of attack.</p><footer class=footline></footer></article></div></main></div><script src=/cis526/js/clipboard/clipboard.min.js?1755561291 defer></script><script src=/cis526/js/perfect-scrollbar/perfect-scrollbar.min.js?1755561291 defer></script><script src=/cis526/js/theme.min.js?1755561291 defer></script><script src=/cis526/js/embed-iframe.min.js?1755561291 defer></script></body></html>