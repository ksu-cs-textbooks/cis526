<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="While many HTTP libraries will process the entire incoming request before passing control to the program, Node’s http module takes a different approach. It constructs and passes the http.IncomingMessage and http.ServerResponse objects as soon as it has received the header portion of the request. This means the body may still be being transmitted to the server as you start to process the request.
This is fine for GET requests, as they don’t have a body."><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Request Body :: CIS 526 Textbook"><meta name=twitter:description content="While many HTTP libraries will process the entire incoming request before passing control to the program, Node’s http module takes a different approach. It constructs and passes the http.IncomingMessage and http.ServerResponse objects as soon as it has received the header portion of the request. This means the body may still be being transmitted to the server as you start to process the request.
This is fine for GET requests, as they don’t have a body."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/06-dynamic-web-servers/07-req-body/"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Request Body :: CIS 526 Textbook"><meta property="og:description" content="While many HTTP libraries will process the entire incoming request before passing control to the program, Node’s http module takes a different approach. It constructs and passes the http.IncomingMessage and http.ServerResponse objects as soon as it has received the header portion of the request. This means the body may still be being transmitted to the server as you start to process the request.
This is fine for GET requests, as they don’t have a body."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Dynamic Web Servers"><meta property="article:published_time" content="2018-08-24T10:53:26-05:00"><meta property="article:modified_time" content="2021-06-25T22:27:31-05:00"><meta itemprop=name content="Request Body :: CIS 526 Textbook"><meta itemprop=description content="While many HTTP libraries will process the entire incoming request before passing control to the program, Node’s http module takes a different approach. It constructs and passes the http.IncomingMessage and http.ServerResponse objects as soon as it has received the header portion of the request. This means the body may still be being transmitted to the server as you start to process the request.
This is fine for GET requests, as they don’t have a body."><meta itemprop=datePublished content="2018-08-24T10:53:26-05:00"><meta itemprop=dateModified content="2021-06-25T22:27:31-05:00"><meta itemprop=wordCount content="420"><title>Request Body :: CIS 526 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis526/06-dynamic-web-servers/07-req-body/ rel=canonical type=text/html title="Request Body :: CIS 526 Textbook"><link href=/cis526/06-dynamic-web-servers/07-req-body/index.xml rel=alternate type=application/rss+xml title="Request Body :: CIS 526 Textbook"><link href=/cis526/06-dynamic-web-servers/07-req-body/tele.html rel=alternate type=text/html title="Request Body :: CIS 526 Textbook"><link href=/cis526/06-dynamic-web-servers/07-req-body/embed.html rel=alternate type=text/html title="Request Body :: CIS 526 Textbook"><link href=/cis526/css/fontawesome-all.min.css?1737995213 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fontawesome-all.min.css?1737995213 rel=stylesheet></noscript><link href=/cis526/css/nucleus.css?1737995213 rel=stylesheet><link href=/cis526/css/auto-complete.css?1737995213 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/auto-complete.css?1737995213 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar.min.css?1737995213 rel=stylesheet><link href=/cis526/css/fonts.css?1737995213 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fonts.css?1737995213 rel=stylesheet></noscript><link href=/cis526/css/theme.css?1737995213 rel=stylesheet><link href=/cis526/css/theme-auto.css?1737995213 rel=stylesheet id=R-variant-style><link href=/cis526/css/chroma-auto.css?1737995213 rel=stylesheet id=R-variant-chroma-style><link href=/cis526/css/variant.css?1737995213 rel=stylesheet><link href=/cis526/css/print.css?1737995213 rel=stylesheet media=print><link href=/cis526/css/format-print.css?1737995213 rel=stylesheet><script src=/cis526/js/variant.js?1737995213></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.index_js_url="/cis526/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis526/css/custom.css?1737995213 rel=stylesheet></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/cis526/06-dynamic-web-servers/07-req-body/><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cis526/06-dynamic-web-servers/><span itemprop=name>Dynamic Web Servers</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Request Body</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/06-dynamic-web-servers/06-form-encoding/ title="Form Encoding (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/06-dynamic-web-servers/08-cookies/ title="Cookies (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=request-body>Request Body</h1><p>While many HTTP libraries will process the entire incoming request before passing control to the program, Node&rsquo;s <code>http</code> module takes a different approach. It constructs and passes the <code>http.IncomingMessage</code> and <code>http.ServerResponse</code> objects as soon as it has received the header portion of the request. This means the body may still be being transmitted to the server as you start to process the request.</p><p>This is fine for GET requests, as they don&rsquo;t have a body. But for requests that <em>do</em> have a body, it means you have to process the incoming data yourself.</p><p>To do so, there are three events made available in the <a href=https://nodejs.org/api/http.html#http_class_http_incomingmessage rel=external target=_blank>http.IncomingMessage</a> object: <code>data</code>, <code>end</code>, and <code>error</code>.</p><p>The <code>data</code> event occurs whenever a new chunk of the body is available, and that chunk is passed to the event listener. The <code>end</code> event occurs once all the chunks have been received. And the <code>error</code> event occurs when something goes wrong. The chunks are <a href=https://nodejs.org/api/buffer.html rel=external target=_blank>Buffer</a> objects, and are always received in order.</p><p>Thus, we need to collect each chunk from each <code>data</code> event, and join them together into a single buffer at the <code>end</code> event. Thus, the basic scaffold for doing so is:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>loadBody</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>chunks</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// listen for data events
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>req</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>chunk</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>chunks</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>chunk</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// listen for the end event 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>req</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;end&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Combine the chunks 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=nx>data</span> <span class=o>=</span> <span class=nx>Buffer</span><span class=p>.</span><span class=nx>concat</span><span class=p>(</span><span class=nx>chunks</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// DO SOMETHING WITH DATA
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// listen for error events 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>req</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// RESPOND APPROPRIATELY TO ERROR
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Note that these events occur asynchronously, so this scaffold needs to be integrated into an appropriate asynchronous processing strategy.</p><p>You might wonder why the developers of Node chose to handle request bodies in this fashion. Most likely, it was for the degree of control it offers the programmer. Consider the case where you decide your program needs to be able to stop an upload - you can do so with <a href=https://nodejs.org/api/http.html#http_class_http_incomingmessage rel=external target=_blank>http.IncomingMessage.destroy()</a>, which immediately closes the socket connecting the client to the server, effectively terminating the upload.</p><p>This can prevent the server from doing unneeded work and consuming unnecessary bandwidth. Of course, the decision to stop an upload is highly situationally dependent - thus they leave it in your hands as the programmer.</p><p>In fact, a common Denial of Service attack known as an HTTP flood often takes advantage of POST requests to submit requests with large bodies to consume server resources. By giving the programmer the ability to stop uploads this way helps counter this kind of attack.</p><footer class=footline></footer></article></div></main><div class=git-footer><p class=theme-version-footer>6.0.0</p><p>Last modified by:
<i class='fas fa-user'></i> Nathan Bean
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cis526/commit/eb2b9acc4de93b6fb62eaeef73ae0c0b1daa884c>Jun 25, 2021</a></p></div></div><script src=/cis526/js/clipboard.min.js?1737995213 defer></script><script src=/cis526/js/perfect-scrollbar.min.js?1737995213 defer></script><script src=/cis526/js/theme.js?1737995213 defer></script></body></html>