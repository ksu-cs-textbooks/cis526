<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="An important aspect to recognize about how Node’s http library operates is that all requests to the server are passed to the request handler function. Thus, you need to determine what to do with the incoming request as part of that function.
Working with the Request Object You will most likely use the information contained within the http.IncomingMessage object supplied as the first parameter to your request handler. We often use the name req for this parameter, short for request, as it represents the incoming HTTP request."><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Request Handling :: CIS 526 Textbook"><meta name=twitter:description content="An important aspect to recognize about how Node’s http library operates is that all requests to the server are passed to the request handler function. Thus, you need to determine what to do with the incoming request as part of that function.
Working with the Request Object You will most likely use the information contained within the http.IncomingMessage object supplied as the first parameter to your request handler. We often use the name req for this parameter, short for request, as it represents the incoming HTTP request."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/05-web-servers/03-request-handling/"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Request Handling :: CIS 526 Textbook"><meta property="og:description" content="An important aspect to recognize about how Node’s http library operates is that all requests to the server are passed to the request handler function. Thus, you need to determine what to do with the incoming request as part of that function.
Working with the Request Object You will most likely use the information contained within the http.IncomingMessage object supplied as the first parameter to your request handler. We often use the name req for this parameter, short for request, as it represents the incoming HTTP request."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Basic Web Servers"><meta property="article:published_time" content="2018-08-24T10:53:26-05:00"><meta property="article:modified_time" content="2024-06-27T14:51:29-05:00"><meta itemprop=name content="Request Handling :: CIS 526 Textbook"><meta itemprop=description content="An important aspect to recognize about how Node’s http library operates is that all requests to the server are passed to the request handler function. Thus, you need to determine what to do with the incoming request as part of that function.
Working with the Request Object You will most likely use the information contained within the http.IncomingMessage object supplied as the first parameter to your request handler. We often use the name req for this parameter, short for request, as it represents the incoming HTTP request."><meta itemprop=datePublished content="2018-08-24T10:53:26-05:00"><meta itemprop=dateModified content="2024-06-27T14:51:29-05:00"><meta itemprop=wordCount content="1113"><title>Request Handling :: CIS 526 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis526/05-web-servers/03-request-handling/ rel=canonical type=text/html title="Request Handling :: CIS 526 Textbook"><link href=/cis526/05-web-servers/03-request-handling/index.xml rel=alternate type=application/rss+xml title="Request Handling :: CIS 526 Textbook"><link href=/cis526/05-web-servers/03-request-handling/index.print.html rel=alternate type=text/html title="Request Handling :: CIS 526 Textbook"><link href=/cis526/05-web-servers/03-request-handling/embed.html rel=alternate type=text/html title="Request Handling :: CIS 526 Textbook"><link href=/cis526/css/fontawesome-all.min.css?1743528749 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fontawesome-all.min.css?1743528749 rel=stylesheet></noscript><link href=/cis526/css/nucleus.css?1743528749 rel=stylesheet><link href=/cis526/css/auto-complete.css?1743528749 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/auto-complete.css?1743528749 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar.min.css?1743528749 rel=stylesheet><link href=/cis526/css/fonts.css?1743528749 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fonts.css?1743528749 rel=stylesheet></noscript><link href=/cis526/css/theme.css?1743528749 rel=stylesheet><link href=/cis526/css/theme-auto.css?1743528749 rel=stylesheet id=R-variant-style><link href=/cis526/css/chroma-auto.css?1743528749 rel=stylesheet id=R-variant-chroma-style><link href=/cis526/css/variant.css?1743528749 rel=stylesheet><link href=/cis526/css/print.css?1743528749 rel=stylesheet media=print><script src=/cis526/js/variant.js?1743528749></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.index_js_url="/cis526/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis526/css/custom.css?1743528749 rel=stylesheet></head><body class="mobile-support tele disableInlineCopyToClipboard" data-url=/cis526/05-web-servers/03-request-handling/><div id=tele class="tele mirror"><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=request-handling>Request Handling</h1><p>An important aspect to recognize about how Node&rsquo;s http library operates is that <em>all</em> requests to the server are passed to the request handler function. Thus, you need to determine what to do with the incoming request as part of that function.</p><h2 id=working-with-the-request-object>Working with the Request Object</h2><p>You will most likely use the information contained within the <code>http.IncomingMessage</code> object supplied as the first parameter to your request handler. We often use the name <code>req</code> for this parameter, short for <em>request</em>, as it represents the incoming HTTP request.</p><p>Some of its properties we might use:</p><ul><li><p>The <code>req.method</code> parameter indicates what <a href=https://textbooks.cs.ksu.edu/cis526/02-http/04-request-methods/ rel=external target=_blank>HTTP method</a> the request is using. For example, if the method is <code>"GET"</code>, we would expect that the client is requesting a resource like an HTML page or image file. If it were a <code>"POST"</code> request, we would think they are submitting something.</p></li><li><p>The <code>req.url</code> parameter indicates the specific resource path the client is requesting, i.e. <code>"/about.html"</code> suggests they are looking for the &ldquo;about&rdquo; page. The url can have more parts than just the path. It also can contain a query string and a hash string. We&rsquo;ll talk more about these soon.</p></li><li><p>The <code>req.headers</code> parameter contains all the headers that were set on this particular request. Of specific interest are <em>authentication</em> headers (which help say who is behind the request and determine if the server should allow the request), and <em>cookie</em> headers. We&rsquo;ll talk more about this a bit further into the course, when we introduce the associated concepts.</p></li></ul><p>Generally, we use properties in combination to determine what the correct response is. As a programmer, you probably already realize that this decision-making process must involve some sort of <a href=https://en.wikipedia.org/wiki/Control_flow rel=external target=_blank>control flow</a> structure, like an <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/if...else rel=external target=_blank>if statement</a> or <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/switch rel=external target=_blank>switch case statement</a>.</p><p>Let&rsquo;s say we only want to handle <code>"GET"</code> requests for the files <em>index.html</em>, <em>site.css</em>, and <em>site.js</em>. We could write our request handler using both an <code>if else</code> statement and a <code>switch</code> statement:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>handleRequest</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>method</span> <span class=o>===</span> <span class=s2>&#34;GET&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>url</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s2>&#34;/index.html&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=c1>// TODO: Serve the index page 
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s2>&#34;/site.css&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=c1>// TODO: Serve the css file 
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s2>&#34;/site.js&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=c1>// TODO: Serve the js file
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=c1>// TODO: Serve a 404 Not Found response
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Serve a 501 Not Implemented response
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Notice that at each branching point of our control flow, we serve some kind of response to the requesting web client. <em>Every</em> request should be sent a response - even unsuccessful ones. If we do not, then the browser will <em>timeout</em>, and report a timeout error to the user.</p><p><a href=#R-image-d482f416a6e2f24d2b785fd53258eee5 class=lightbox-link><img alt="handleRequest() flowchart" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/5.3.1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d482f416a6e2f24d2b785fd53258eee5><img alt="handleRequest() flowchart" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/5.3.1.png></a></p><h2 id=working-with-the-response-object>Working with the Response Object</h2><p>The second half of responding to requests is putting together the response. You will use the <code>http.ServerResponse</code> object to assemble and send the response. This response consists of a <a href=https://textbooks.cs.ksu.edu/cis526/02-http/09-status-codes/ rel=external target=_blank>status code and message</a>, <a href=https://textbooks.cs.ksu.edu/cis526/02-http/10-response-headers/ rel=external target=_blank>response headers</a>, and a <a href=https://textbooks.cs.ksu.edu/cis526/02-http/11-response-body/ rel=external target=_blank>body</a> which could be text, binary data, or nothing.</p><p>There are a number of properties and methods defined in the <code>http.ServerResponse</code> to help with this, including:</p><ul><li><a href=https://nodejs.org/api/http.html#http_response_statuscode rel=external target=_blank>ServerResponse.statusCode</a> can be used to manually set the status code</li><li><a href=https://nodejs.org/api/http.html#http_response_statusmessage rel=external target=_blank>ServerResponse.statusMessage</a> can be used to manually set the status message. If the code is set but not the message, the default message for the code is used.</li><li><a href=https://nodejs.org/api/http.html#http_response_setheader_name_value rel=external target=_blank>ServerResponse.setHeader()</a> adds a header with the supplied name and value (the first and second parameters)</li><li><a href=https://nodejs.org/api/http.html#http_response_end_data_encoding_callback rel=external target=_blank>ServerResponse.end()</a> sends the request using the currently set status and headers. Takes an optional parameter which is the response body; if this parameter is supplied, an optional second parameter specifying the encoding can also be used. A final optional callback can be supplied that is called when sending the stream is complete.</li></ul><p>Consider the <strong>501 Not Implemented</strong> response in our example above. We need to send the 501 status code, but there is no need for a body or additional headers. We could use the <code>req.statusCode</code> property to set the property, and the <code>req.end()</code> method to send it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl>    <span class=c1>// TODO: Serve a 501 Not Implemented response
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=mi>501</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>();</span></span></span></code></pre></div><p>The sending of a response with a body is a bit more involved. For example, to send the <em>index.html</em> file, we would need to retrieve it from the hard drive and send it as the body of a request. But as the default status code is 200, we don&rsquo;t need to specify it. However, it is a good idea to specify the <code>Content-Type</code> header with the appropriate mime-type, and then we can use the <code>res.end()</code> method with the file body once we&rsquo;ve loaded it, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl>    <span class=c1>// TODO: Serve the index page 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fs</span><span class=p>.</span><span class=nx>readFile</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>body</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=mi>500</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>setHeader</span><span class=p>(</span><span class=s2>&#34;Content-Type&#34;</span><span class=p>,</span> <span class=s2>&#34;text/html&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>setHeader</span><span class=p>(</span><span class=s2>&#34;Content-Length&#34;</span><span class=p>,</span> <span class=nx>body</span><span class=p>.</span><span class=nx>length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=nx>body</span><span class=p>,</span> <span class=s2>&#34;utf8&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span></span></span></code></pre></div><p>Notice too, that we need to account for the possibility of an error while loading the file <em>index.html</em>. If this happens, we send a <strong>500 Server Error</strong> status code indicating that something went wrong, and it happened on <em>our</em> end, not because of a problem in the way the client formatted the request. Notice too that we use a <code>return</code> to prevent executing the rest of our code.</p><p>We also supply the length of the response body, which will be the same as the buffer length or the length of a string sent as the body. Binary data for the web is counted in octets (eight bits) which conveniently is also how Node buffers are sized and the size of a JavaScript character.</p><h2 id=chaining-writehead-and-end>Chaining writeHead() and end()</h2><p>The <code>http.ServerResponse</code> object also has a method <code>writeHead()</code> which combines the writing of status code, message, and headers into a single step, and returns the modified object so its <code>end()</code> method can be chained. In this way, you can write the entire sending of a response on a single line. The parameters to <code>response.writeHead()</code> are the status code, an optional status message, and an optional JavaScript object representing the headers, using the keys as the header names and values as values.</p><p>Serving the css file using this approach would look like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl>    <span class=c1>// TODO: Serve the site css file 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>fs</span><span class=p>.</span><span class=nx>readFile</span><span class=p>(</span><span class=s1>&#39;site.css&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>body</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>writeHead</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>end</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>writeHead</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Content-Type&#34;</span><span class=o>:</span> <span class=s2>&#34;text/html&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Content-Length&#34;</span><span class=o>:</span> <span class=nx>body</span><span class=p>.</span><span class=nx>length</span>
</span></span><span class=line><span class=cl>        <span class=p>}).</span><span class=nx>end</span><span class=p>(</span><span class=nx>body</span><span class=p>,</span> <span class=s2>&#34;utf8&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span></span></span></code></pre></div><p>You can use any combination of these approaches to send responses.<div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div><div class=box-content><p>Some important considerations:</p><ul><li>Be aware that you can only send <em>one</em> response per request. Once a response is sent, the connection to the client is effectively closed. Thus, once <code>response.end()</code> has been invoked, it will log an error if it is attempted again.</li><li>The <code>response.writeHead()</code> method actually streams the head to the client. Thus, you cannot run <code>response.setHeader()</code> or set <code>response.statusCode</code> or <code>response.statusMessage</code> after it has been set.</li><li>Similarly, any change to the response object after <code>response.end()</code> has been invoked will log an error, as you cannot change the response once it&rsquo;s sent.</li></ul></div></div></p><footer class=footline></footer></article></div></main></div></div><script src=/cis526/js/clipboard.min.js?1743528749 defer></script><script src=/cis526/js/perfect-scrollbar.min.js?1743528749 defer></script><script src=/cis526/js/theme.js?1743528749 defer></script><script src=/cis526/js/tele-scroll.js?1743528749 defer></script></body></html>