




	
	
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		
		
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.101.0">
    <meta name="generator" content="Relearn 5.2.0+tip">
    <meta name="description" content="CIS 526 Textbook">
    <meta name="author" content="Nathan Bean">
    <title>The Importance of Being Async :: CIS 526 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis526/05-web-servers/04-importance-of-async/" rel="canonical" type="text/html" title="CIS 526 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis526/05-web-servers/04-importance-of-async/index.xml" rel="alternate" type="application/rss+xml" title="CIS 526 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis526/05-web-servers/04-importance-of-async/index.print.html" rel="alternate" type="text/html" title="CIS 526 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis526/05-web-servers/04-importance-of-async/tele.html" rel="alternate" type="text/html" title="CIS 526 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/fontawesome-all.min.css?1676392793" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/fontawesome-all.min.css?1676392793" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/featherlight.min.css?1676392793" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/featherlight.min.css?1676392793" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/auto-complete.css?1676392793" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/auto-complete.css?1676392793" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/perfect-scrollbar.min.css?1676392793" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/nucleus.css?1676392793" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/fonts.css?1676392793" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/fonts.css?1676392793" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/theme.css?1676392793" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/theme-light-theme.css?1676392793" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/ie.css?1676392793" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/variant.css?1676392793" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/print.css?1676392793" rel="stylesheet" media="print">
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/variant.js?1676392793"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      var index_url="https://ksu-cs-textbooks.github.io/cis526/index.json";
      var root_url="https://ksu-cs-textbooks.github.io/cis526/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis526/';
      window.variants && variants.init( [ 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/custom.css?1676392793" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/jquery.min.js?1676392793" defer></script>

  </head>
  <body class="mobile-support embed disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis526/05-web-servers/04-importance-of-async/embed.html">
    <div id="body" class="default-animation">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
          </div>
          <article class="default">
    
    
    
<p>You may have noticed that we used the asynchronous version of <code>fs.readFile()</code> in our response handler.  This is critical to good performance with a Node-based webserver - any potentially blocking action taken in the request handler should be asynchronous, because <em>all incoming requests</em> must be processed on the same thread.  If our event loop gets bogged down handling a blocked process, then <em>nobody gets a response</em>!</p>
<p>Consider if we implemented one of the file serving options using the synchronous <code>fs.readFileSync()</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>    <span style="color:#75715e">// TODO: Serve the site js file 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">body</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">readFileSync</span>(<span style="color:#e6db74">&#39;site.js&#39;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">writeHead</span>(<span style="color:#ae81ff">200</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Content-Type&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;application/javascript&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Content-Length&#34;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">length</span>
</span></span><span style="display:flex;"><span>      }).<span style="color:#a6e22e">end</span>(<span style="color:#a6e22e">body</span>, <span style="color:#e6db74">&#34;utf8&#34;</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">writeHead</span>(<span style="color:#ae81ff">500</span>).<span style="color:#a6e22e">end</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>It does not look that different from the asynchronous version, but consider what happens if <em>site.js</em> cannot be opened immediately (perhaps it is locked by a system process that is modifying it).  With the synchronous version, we wait for the file to become available.  While we wait, incoming requests are added to our event queue&hellip; and none are processed, as the event loop is paused while we are waiting for <code>fs.readFileSync('site.js')</code> to resolve.  If it takes more than three seconds, the clients that are waiting will start seeing timeouts in their browsers, and will probably assume our site is down.</p>
<p><img src="https://ksu-cs-textbooks.github.io/cis526/images/5.4.1.png" alt="Async vs Sync operations in the Event Loop"></p>
<p>In contrast, if we used the asynchronous version, the reading of the file is handed off to another thread when <code>fs.readFile()</code> is invoked.  Any additional processing to do within the event loop for this request is finished, and the next task is pulled from the event queue.  Even if our request for the original file never completes, we still are serving requests as quickly as we get them.</p>
<p>This asynchronous approach is key to making a Node-based website perform and scale well.  But it is vitally important that you, as a web developer, <em>understand</em> both why using asynchronous processes is important, and <em>how</em> to use them correctly.  Because if you don&rsquo;t, your application performance can be much, much worse than with other approaches.</p>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/clipboard.min.js?1676392793" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/perfect-scrollbar.min.js?1676392793" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/featherlight.min.js?1676392793" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/theme.js?1676392793" defer></script>
    
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/embed-iframe.js?1676392793 defer"></script>
    
  </body>
</html>
