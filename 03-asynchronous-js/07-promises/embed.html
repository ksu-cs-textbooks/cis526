<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="CONSOLE Promises replace the callback mechanism with a JavaScript object, a Promise. In many ways, this is similar to the XMLHttpRequest object that is at the heart of AJAX. You can think of it as a state machine that is in one of three states: pending, fulfilled, or rejected.
A promise can be created by wrapping an asynchronous call within a new Promise object. For example, we can turn a setTimeout() into a promise with:"><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Promises :: CIS 526 Textbook"><meta name=twitter:description content="CONSOLE Promises replace the callback mechanism with a JavaScript object, a Promise. In many ways, this is similar to the XMLHttpRequest object that is at the heart of AJAX. You can think of it as a state machine that is in one of three states: pending, fulfilled, or rejected.
A promise can be created by wrapping an asynchronous call within a new Promise object. For example, we can turn a setTimeout() into a promise with:"><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/03-asynchronous-js/07-promises/embed.html"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Promises :: CIS 526 Textbook"><meta property="og:description" content="CONSOLE Promises replace the callback mechanism with a JavaScript object, a Promise. In many ways, this is similar to the XMLHttpRequest object that is at the heart of AJAX. You can think of it as a state machine that is in one of three states: pending, fulfilled, or rejected.
A promise can be created by wrapping an asynchronous call within a new Promise object. For example, we can turn a setTimeout() into a promise with:"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Asynchronous JavaScript"><meta property="article:published_time" content="2018-08-24T10:53:26-05:00"><meta property="article:modified_time" content="2024-06-27T14:51:29-05:00"><meta itemprop=name content="Promises :: CIS 526 Textbook"><meta itemprop=description content="CONSOLE Promises replace the callback mechanism with a JavaScript object, a Promise. In many ways, this is similar to the XMLHttpRequest object that is at the heart of AJAX. You can think of it as a state machine that is in one of three states: pending, fulfilled, or rejected.
A promise can be created by wrapping an asynchronous call within a new Promise object. For example, we can turn a setTimeout() into a promise with:"><meta itemprop=datePublished content="2018-08-24T10:53:26-05:00"><meta itemprop=dateModified content="2024-06-27T14:51:29-05:00"><meta itemprop=wordCount content="1145"><title>Promises :: CIS 526 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis526/03-asynchronous-js/07-promises/ rel=canonical type=text/html title="Promises :: CIS 526 Textbook"><link href=/cis526/03-asynchronous-js/07-promises/index.xml rel=alternate type=application/rss+xml title="Promises :: CIS 526 Textbook"><link href=/cis526/03-asynchronous-js/07-promises/index.print.html rel=alternate type=text/html title="Promises :: CIS 526 Textbook"><link href=/cis526/03-asynchronous-js/07-promises/tele.html rel=alternate type=text/html title="Promises :: CIS 526 Textbook"><link href=/cis526/css/fontawesome-all.min.css?1743727386 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fontawesome-all.min.css?1743727386 rel=stylesheet></noscript><link href=/cis526/css/nucleus.css?1743727386 rel=stylesheet><link href=/cis526/css/auto-complete.css?1743727386 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/auto-complete.css?1743727386 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar.min.css?1743727386 rel=stylesheet><link href=/cis526/css/fonts.css?1743727386 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fonts.css?1743727386 rel=stylesheet></noscript><link href=/cis526/css/theme.css?1743727386 rel=stylesheet><link href=/cis526/css/theme-light-theme.css?1743727386 rel=stylesheet id=R-variant-style><link href=/cis526/css/chroma-relearn-light.css?1743727386 rel=stylesheet id=R-variant-chroma-style><link href=/cis526/css/variant.css?1743727386 rel=stylesheet><link href=/cis526/css/print.css?1743727386 rel=stylesheet media=print><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.index_js_url="/cis526/index.search.js",window.variants&&variants.init(["light-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis526/css/custom.css?1743727386 rel=stylesheet></head><body class="mobile-support embed disableInlineCopyToClipboard" data-url=/cis526/03-asynchronous-js/07-promises/embed.html><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><style>.console{position:fixed;bottom:0;left:300px;box-sizing:border-box;z-index:1000;width:calc(100% - 300px);height:30vh;background-color:#8451a1;padding:1rem;transform:translateY(calc(30vh - 5px));transition:transform 1s}.console iframe{width:100%;height:100%;background-color:#fff}.console>.console-tab{position:absolute;top:-1.2rem;right:0;color:#fff;background-color:#8451a1;padding:0 2rem;border-radius:5px;cursor:pointer}.console.active{transform:none}</style><div class=console><div class=console-tab>CONSOLE</div><iframe src=https://jsconsole.com/></iframe></div><script>document.querySelector(".console-tab").addEventListener("click",e=>{console.log(e),e.target.parentElement.classList.toggle("active")})</script><p>Promises replace the callback mechanism with a JavaScript object, a <code>Promise</code>. In many ways, this is similar to the <code>XMLHttpRequest</code> object that is at the heart of <a href=https://textbooks.cs.ksu.edu/cis526/c-js/11-ajax/ rel=external target=_blank>AJAX</a>. You can think of it as a state machine that is in one of three states: <em>pending</em>, <em>fulfilled</em>, or <em>rejected</em>.</p><p>A promise can be created by wrapping an asynchronous call within a new <code>Promise</code> object. For example, we can turn a <code>setTimeout()</code> into a promise with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>threeSecondPromise</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>resolve</span><span class=p>(</span><span class=s2>&#34;Timer elapsed&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>300</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>We can also create a promise that immediately resolves using <code>Promise.resolve()</code>, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>fifteenPromise</span> <span class=o>=</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=mi>15</span><span class=p>);</span></span></span></code></pre></div><p>This promise is never in the <em>pending</em> state - it starts as <em>resolved</em>. Similarly, you can create a promise that starts in the <em>rejected</em> state with <code>Promise.reject()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>failedPromise</span> <span class=o>=</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>reject</span><span class=p>(</span><span class=s2>&#34;I am a failure...&#34;</span><span class=p>);</span></span></span></code></pre></div><p>You can also pass an error object to <code>Promise.reject()</code>.</p><h4 id=using-promiseprototypethen>Using Promise.prototype.then()</h4><p>What makes promises especially useful is their <code>then()</code> method. This method is invoked when the promise finishes, and is passed whatever the promise resolved to, i.e. the string <code>"Timer elapsed"</code> in the example above. Say we want to log that result to the console:</p><div class=highlight><pre tabindex=0><code>threeSecondPromise.then(result =&gt; {console.log(result)});</code></pre></div><p>This is a rather trivial example, but we can use the same approach to define a <em>new</em> method for creating timers that might seem more comfortable for object-oriented programmers:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createTimer</span><span class=p>(</span><span class=nx>milliseconds</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>resolve</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=nx>milliseconds</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>With this method, we can create a timer to do any arbitrary action, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// Say &#34;Hello Delayed World&#34; after five seconds
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>createTimer</span><span class=p>(</span><span class=mi>5000</span><span class=p>).</span><span class=nx>then</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Hello delayed World!&#34;</span><span class=p>));</span></span></span></code></pre></div><h4 id=using-promiseprototypecatch>Using Promise.prototype.catch()</h4><p>In addition to the <code>then()</code> method, promises also provide a <code>catch()</code> method. This method handles any errors that were thrown by the promise. Consider this function that returns a promise to compute an average:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>computeAverage</span><span class=p>(</span><span class=nx>numbers</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Sum the numbers
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=nx>sum</span> <span class=o>=</span> <span class=nx>numbers</span><span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>acc</span><span class=p>,</span> <span class=nx>value</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>acc</span> <span class=o>+</span> <span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Compute the average 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=nx>average</span> <span class=o>=</span> <span class=nx>sum</span> <span class=o>/</span> <span class=nx>numbers</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>resolve</span><span class=p>(</span><span class=nx>average</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Try copying this code into the console, and then run some examples, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>computeAverage</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>]).</span><span class=nx>then</span><span class=p>(</span><span class=nx>average</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;The average is&#34;</span><span class=p>,</span> <span class=nx>average</span><span class=p>));</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>computeAverage</span><span class=p>([</span><span class=mf>0.3</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mf>20.5</span><span class=p>]).</span><span class=nx>then</span><span class=p>(</span><span class=nx>average</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;The average is&#34;</span><span class=p>,</span> <span class=nx>average</span><span class=p>));</span></span></span></code></pre></div><p>But what if we use the <em>empty array</em>?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>computeAverage</span><span class=p>([]).</span><span class=nx>then</span><span class=p>(</span><span class=nx>average</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;The average is&#34;</span><span class=p>,</span> <span class=nx>average</span><span class=p>));</span></span></span></code></pre></div><p>Because the length of the empty array is 0, we are dividing by 0, and an error will be thrown. Notice the error message reads &ldquo;Uncaught (in promise)&rdquo;&mldr; we can use the <code>catch()</code> method to capture this error, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>computeAverage</span><span class=p>([])</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>average</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;The average is&#34;</span><span class=p>,</span> <span class=nx>average</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s2>&#34;Encountered an error:&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>));</span></span></span></code></pre></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>Note when chaining JavaScript method calls, our dot <code>.</code> can be separated from the object it belongs to by whitespace. This can help keep our code readable by putting it on multiple lines.</p></div></div><p>Now when we run this code, the error is handled by our <code>catch()</code>. We&rsquo;re still printing it to the console as an error - but notice the message now reads <code>"Encountered an error" ...</code>, i.e. it&rsquo;s <em>our</em> error message!</p><p>Let&rsquo;s try one more - an array that <em>cannot</em> be averaged, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>computeAverage</span><span class=p>([</span><span class=s1>&#39;A&#39;</span><span class=p>,</span> <span class=s1>&#39;banana&#39;</span><span class=p>,</span> <span class=kc>true</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>average</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;The average is&#34;</span><span class=p>,</span> <span class=nx>average</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s2>&#34;Encountered an error:&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>));</span></span></span></code></pre></div><p>Here we see the promise resolves successfully, but the result is <code>NaN</code> (not a number). This is because that is the normal result of this operation in JavaScript. But what if we want that to be treated as an error? That&rsquo;s where the <code>reject()</code> callback provided to the promise comes in - it is used to indicate the promise should fail. We&rsquo;ll need to rewrite our <code>computeAverage()</code> method to use this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>computeAverage</span><span class=p>(</span><span class=nx>numbers</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Sum the numbers
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=nx>sum</span> <span class=o>=</span> <span class=nx>numbers</span><span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>acc</span><span class=p>,</span> <span class=nx>value</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>acc</span> <span class=o>+</span> <span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Compute the average 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=nx>average</span> <span class=o>=</span> <span class=nx>sum</span> <span class=o>/</span> <span class=nx>numbers</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nb>isNaN</span><span class=p>(</span><span class=nx>average</span><span class=p>))</span> <span class=nx>reject</span><span class=p>(</span><span class=s2>&#34;Average cannot be computed.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=nx>resolve</span><span class=p>(</span><span class=nx>average</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Rejected promises are also handled by the <code>catch()</code> method, so if we rerun the last example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>computeAverage</span><span class=p>([</span><span class=s1>&#39;A&#39;</span><span class=p>,</span> <span class=s1>&#39;bannana&#39;</span><span class=p>,</span> <span class=kc>true</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>average</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;The average is&#34;</span><span class=p>,</span> <span class=nx>average</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s2>&#34;Encountered an error:&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>));</span></span></span></code></pre></div><p>Notice we now see our error message!</p><h4 id=chaining-promiseprototypethen-and-promiseprototypecatch>Chaining Promise.prototype.then() and Promise.prototype.catch()</h4><p>Where <code>Promise.prototype.then()</code> and <code>Promise.prototype.catch()</code> really shine is when we <em>chain</em> a series of promises together. Remember our callback hell example?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>webapp</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/login&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>parseFormData</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=p>(</span><span class=nx>form</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>username</span> <span class=o>=</span> <span class=nx>form</span><span class=p>.</span><span class=nx>username</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>password</span> <span class=o>=</span> <span class=nx>form</span><span class=p>.</span><span class=nx>password</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>findUserInDatabase</span><span class=p>(</span><span class=nx>username</span><span class=p>,</span> <span class=p>(</span><span class=nx>user</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>encryptPassword</span><span class=p>(</span><span class=nx>password</span><span class=p>,</span> <span class=nx>user</span><span class=p>.</span><span class=nx>salt</span><span class=p>,</span> <span class=p>(</span><span class=nx>hash</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=nx>hash</span> <span class=o>===</span> <span class=nx>user</span><span class=p>.</span><span class=nx>passwordHash</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>                    <span class=nx>res</span><span class=p>.</span><span class=nx>setCookie</span><span class=p>({</span><span class=nx>user</span><span class=o>:</span> <span class=nx>user</span><span class=p>});</span>
</span></span><span class=line><span class=cl>                    <span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=s2>&#34;Logged in successfully!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span>
</span></span><span class=line><span class=cl>                    <span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=mi>403</span><span class=p>,</span> <span class=s2>&#34;Unknown username/password combo&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>If each of our methods returned a promise, we could re-write this as:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>webapp</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/login&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>parseFormData</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>formData</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>username</span> <span class=o>=</span> <span class=nx>formData</span><span class=p>.</span><span class=nx>username</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>password</span> <span class=o>=</span> <span class=nx>formData</span><span class=p>.</span><span class=nx>password</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>username</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>findUserInDatabase</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>user</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>encryptPassword</span><span class=p>(</span><span class=nx>password</span><span class=p>,</span> <span class=nx>user</span><span class=p>.</span><span class=nx>salt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>hash</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>hash</span> <span class=o>===</span> <span class=nx>user</span><span class=p>.</span><span class=nx>passwordHash</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>setCookie</span><span class=p>({</span><span class=nx>user</span><span class=o>:</span> <span class=nx>user</span><span class=p>});</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=s2>&#34;Logged in successfully&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> 
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=mi>403</span><span class=p>,</span> <span class=s2>&#34;Unknown username/password combo&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=mi>500</span><span class=p>,</span> <span class=s2>&#34;A server error occurred&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span></span></span></code></pre></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>The <code>Promise.prototype.catch()</code> method catches any error or promise rejection that occurs before it in the chain - basically as soon as an error or rejection occurs, further <code>.then()</code> calls are skipped until a <code>.catch()</code> is encountered. You can also chain additional <code>.then()</code> calls after a <code>.catch()</code>, and they will be processed until another error or rejection occurs!</p></div></div><h4 id=promiseall>Promise.All()</h4><p>In addition to processing promises in serial (one after another) by chaining <code>.then()</code> methods, sometimes we want to do them in <em>parallel</em> (all at the same time). For example, say we have several independent processes (perhaps each running on a webworker or separate Node thread) that when finished, we want to average together.</p><p>The <code>Promise.All()</code> method is the answer; it returns a promise to execute an arbitrary number of promises, and when all have finished, it itself resolves to an array of their results.</p><p>Let&rsquo;s do a quick example using this method. We&rsquo;ll start by declaring a function to wrap a fake asynchronous process - basically creating a random number (between 1 and 100) after a random number of seconds (between 0 and 3):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>mockTask</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>value</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>ceil</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span><span class=o>*</span><span class=mi>100</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Computed value&#34;</span><span class=p>,</span> <span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>resolve</span><span class=p>(</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=mi>3000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Now let&rsquo;s say we want to compute an average of the results once they&rsquo;ve finished. As <code>Promise.All()</code> returns a <code>Promise</code> that resolves to a an array of the results, we can invoke our <code>computeAverage()</code> (which we declared previously) in a chained <code>.then()</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>([</span>
</span></span><span class=line><span class=cl>    <span class=nx>mockTask</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>mockTask</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>mockTask</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>mockTask</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>computeAverage</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>);</span></span></span></code></pre></div><p>Note that because <code>computeAverage</code> takes as a parameter an array, and <code>console.log</code> takes as its parameter a value, and those are what the previous promises resolve to, we don&rsquo;t have to define anonymous functions to pass into <code>.then()</code> - we can pass the function name instead.</p><p>Many JavaScript programmers found this format more comfortable to write and read than a series of nested callbacks. However, the <code>async</code> and <code>await</code> syntax offers a <em>third</em> option, which we&rsquo;ll look at next.</p><footer class=footline></footer></article></div></main></div><script src=/cis526/js/clipboard.min.js?1743727386 defer></script><script src=/cis526/js/perfect-scrollbar.min.js?1743727386 defer></script><script src=/cis526/js/theme.js?1743727386 defer></script><script src=/cis526/js/embed-iframe.js?1743727386 defer></script></body></html>