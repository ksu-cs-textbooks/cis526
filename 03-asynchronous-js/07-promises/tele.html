<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.148.1"><meta name=generator content="Relearn 8.0.0"><meta name=description content="CONSOLE Promises replace the callback mechanism with a JavaScript object, a Promise. In many ways, this is similar to the XMLHttpRequest object that is at the heart of AJAX. You can think of it as a state machine that is in one of three states: pending, fulfilled, or rejected."><meta name=author content="Nathan Bean & Russell Feldhausen"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta name=twitter:title content="Promises :: CIS 526 Textbook"><meta name=twitter:description content="CONSOLE Promises replace the callback mechanism with a JavaScript object, a Promise. In many ways, this is similar to the XMLHttpRequest object that is at the heart of AJAX. You can think of it as a state machine that is in one of three states: pending, fulfilled, or rejected."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/03-asynchronous-js/07-promises/index.html"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Promises :: CIS 526 Textbook"><meta property="og:description" content="CONSOLE Promises replace the callback mechanism with a JavaScript object, a Promise. In many ways, this is similar to the XMLHttpRequest object that is at the heart of AJAX. You can think of it as a state machine that is in one of three states: pending, fulfilled, or rejected."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="Asynchronous JavaScript"><meta property="article:published_time" content="2018-08-24T10:53:26-05:00"><meta property="article:modified_time" content="2024-06-27T14:51:29-05:00"><meta property="og:image" content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta itemprop=name content="Promises :: CIS 526 Textbook"><meta itemprop=description content="CONSOLE Promises replace the callback mechanism with a JavaScript object, a Promise. In many ways, this is similar to the XMLHttpRequest object that is at the heart of AJAX. You can think of it as a state machine that is in one of three states: pending, fulfilled, or rejected."><meta itemprop=datePublished content="2018-08-24T10:53:26-05:00"><meta itemprop=dateModified content="2024-06-27T14:51:29-05:00"><meta itemprop=wordCount content="1161"><meta itemprop=image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><title>Promises :: CIS 526 Textbook</title><link href=https://textbooks.cs.ksu.edu/cis526/03-asynchronous-js/07-promises/index.html rel=canonical type=text/html title="Promises :: CIS 526 Textbook"><link href=/cis526/03-asynchronous-js/07-promises/index.xml rel=alternate type=application/rss+xml title="Promises :: CIS 526 Textbook"><link href=/cis526/03-asynchronous-js/07-promises/index.print.html rel=alternate type=text/html title="Promises :: CIS 526 Textbook"><link href=/cis526/03-asynchronous-js/07-promises/embed.html rel=alternate type=text/html title="Promises :: CIS 526 Textbook"><link href=/cis526/css/auto-complete/auto-complete.min.css?1755561291 rel=stylesheet><script src=/cis526/js/auto-complete/auto-complete.min.js?1755561291 defer></script><script src=/cis526/js/search-lunr.min.js?1755561291 defer></script><script src=/cis526/js/search.min.js?1755561291 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/cis526/searchindex.en.js?1755561291"</script><script src=/cis526/js/lunr/lunr.min.js?1755561291 defer></script><script src=/cis526/js/lunr/lunr.stemmer.support.min.js?1755561291 defer></script><script src=/cis526/js/lunr/lunr.multi.min.js?1755561291 defer></script><script src=/cis526/js/lunr/lunr.en.min.js?1755561291 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1755561291 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1755561291 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar/perfect-scrollbar.min.css?1755561291 rel=stylesheet><link href=/cis526/css/theme.min.css?1755561291 rel=stylesheet><link href=/cis526/css/format-html.min.css?1755561291 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/03-asynchronous-js/07-promises/index.html",window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!1,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["light-theme"],window.relearn.customvariantname="my-custom-variant",window.relearn.writeVariant=!1,window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.writeVariant&&window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><link href=/cis526/css/custom.css?1755561291 rel=stylesheet></head><body class="mobile-support html" data-url=/cis526/03-asynchronous-js/07-promises/index.html><div id=tele class="tele mirror"><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable 03-asynchronous-js" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=promises>Promises</h1><style>.console{position:fixed;bottom:0;left:300px;box-sizing:border-box;z-index:1000;width:calc(100% - 300px);height:30vh;background-color:#8451a1;padding:1rem;transform:translateY(calc(30vh - 5px));transition:transform 1s}.console iframe{width:100%;height:100%;background-color:#fff}.console>.console-tab{position:absolute;top:-1.2rem;right:0;color:#fff;background-color:#8451a1;padding:0 2rem;border-radius:5px;cursor:pointer}.console.active{transform:none}</style><div class=console><div class=console-tab>CONSOLE</div><iframe src=https://jsconsole.com/></iframe></div><script>document.querySelector(".console-tab").addEventListener("click",e=>{console.log(e),e.target.parentElement.classList.toggle("active")})</script><p>Promises replace the callback mechanism with a JavaScript object, a <code>Promise</code>. In many ways, this is similar to the <code>XMLHttpRequest</code> object that is at the heart of <a href=https://textbooks.cs.ksu.edu/cis526/c-js/11-ajax/ rel=external target=_blank>AJAX</a>. You can think of it as a state machine that is in one of three states: <em>pending</em>, <em>fulfilled</em>, or <em>rejected</em>.</p><p>A promise can be created by wrapping an asynchronous call within a new <code>Promise</code> object. For example, we can turn a <code>setTimeout()</code> into a promise with:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>threeSecondPromise</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setTimeout</span>(() =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>resolve</span>(<span style=color:#e6db74>&#34;Timer elapsed&#34;</span>);
</span></span><span style=display:flex><span>    }, <span style=color:#ae81ff>300</span>);
</span></span><span style=display:flex><span>});</span></span></code></pre></div><p>We can also create a promise that immediately resolves using <code>Promise.resolve()</code>, i.e.:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>fifteenPromise</span> <span style=color:#f92672>=</span> Promise.<span style=color:#a6e22e>resolve</span>(<span style=color:#ae81ff>15</span>);</span></span></code></pre></div><p>This promise is never in the <em>pending</em> state - it starts as <em>resolved</em>. Similarly, you can create a promise that starts in the <em>rejected</em> state with <code>Promise.reject()</code>:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>failedPromise</span> <span style=color:#f92672>=</span> Promise.<span style=color:#a6e22e>reject</span>(<span style=color:#e6db74>&#34;I am a failure...&#34;</span>);</span></span></code></pre></div><p>You can also pass an error object to <code>Promise.reject()</code>.</p><h4 id=using-promiseprototypethen>Using Promise.prototype.then()</h4><p>What makes promises especially useful is their <code>then()</code> method. This method is invoked when the promise finishes, and is passed whatever the promise resolved to, i.e. the string <code>"Timer elapsed"</code> in the example above. Say we want to log that result to the console:</p><div class=highlight dir=auto><pre tabindex=0><code>threeSecondPromise.then(result =&gt; {console.log(result)});</code></pre></div><p>This is a rather trivial example, but we can use the same approach to define a <em>new</em> method for creating timers that might seem more comfortable for object-oriented programmers:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>createTimer</span>(<span style=color:#a6e22e>milliseconds</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>setTimeout</span>(() =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>resolve</span>();
</span></span><span style=display:flex><span>        }, <span style=color:#a6e22e>milliseconds</span>);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>With this method, we can create a timer to do any arbitrary action, i.e.:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// Say &#34;Hello Delayed World&#34; after five seconds
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>createTimer</span>(<span style=color:#ae81ff>5000</span>).<span style=color:#a6e22e>then</span>(() =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Hello delayed World!&#34;</span>));</span></span></code></pre></div><h4 id=using-promiseprototypecatch>Using Promise.prototype.catch()</h4><p>In addition to the <code>then()</code> method, promises also provide a <code>catch()</code> method. This method handles any errors that were thrown by the promise. Consider this function that returns a promise to compute an average:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>computeAverage</span>(<span style=color:#a6e22e>numbers</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Sum the numbers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>sum</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>numbers</span>.<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>acc</span>, <span style=color:#a6e22e>value</span>) =&gt; <span style=color:#a6e22e>acc</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Compute the average 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>average</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>numbers</span>.<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>resolve</span>(<span style=color:#a6e22e>average</span>);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Try copying this code into the console, and then run some examples, i.e.:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>computeAverage</span>([<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>5</span>]).<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>average</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;The average is&#34;</span>, <span style=color:#a6e22e>average</span>));</span></span></code></pre></div><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>computeAverage</span>([<span style=color:#ae81ff>0.3</span>, <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>20.5</span>]).<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>average</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;The average is&#34;</span>, <span style=color:#a6e22e>average</span>));</span></span></code></pre></div><p>But what if we use the <em>empty array</em>?</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>computeAverage</span>([]).<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>average</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;The average is&#34;</span>, <span style=color:#a6e22e>average</span>));</span></span></code></pre></div><p>Because the length of the empty array is 0, we are dividing by 0, and an error will be thrown. Notice the error message reads &ldquo;Uncaught (in promise)&rdquo;&mldr; we can use the <code>catch()</code> method to capture this error, i.e.:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>computeAverage</span>([])
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>average</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;The average is&#34;</span>, <span style=color:#a6e22e>average</span>))
</span></span><span style=display:flex><span>    .<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>err</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Encountered an error:&#34;</span>, <span style=color:#a6e22e>err</span>));</span></span></code></pre></div><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Info</summary><div class=box-content><p>Note when chaining JavaScript method calls, our dot <code>.</code> can be separated from the object it belongs to by whitespace. This can help keep our code readable by putting it on multiple lines.</p></div></details><p>Now when we run this code, the error is handled by our <code>catch()</code>. We&rsquo;re still printing it to the console as an error - but notice the message now reads <code>"Encountered an error" ...</code>, i.e. it&rsquo;s <em>our</em> error message!</p><p>Let&rsquo;s try one more - an array that <em>cannot</em> be averaged, i.e.:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>computeAverage</span>([<span style=color:#e6db74>&#39;A&#39;</span>, <span style=color:#e6db74>&#39;banana&#39;</span>, <span style=color:#66d9ef>true</span>])
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>average</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;The average is&#34;</span>, <span style=color:#a6e22e>average</span>))
</span></span><span style=display:flex><span>    .<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>err</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Encountered an error:&#34;</span>, <span style=color:#a6e22e>err</span>));</span></span></code></pre></div><p>Here we see the promise resolves successfully, but the result is <code>NaN</code> (not a number). This is because that is the normal result of this operation in JavaScript. But what if we want that to be treated as an error? That&rsquo;s where the <code>reject()</code> callback provided to the promise comes in - it is used to indicate the promise should fail. We&rsquo;ll need to rewrite our <code>computeAverage()</code> method to use this:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>computeAverage</span>(<span style=color:#a6e22e>numbers</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Sum the numbers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>sum</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>numbers</span>.<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>acc</span>, <span style=color:#a6e22e>value</span>) =&gt; <span style=color:#a6e22e>acc</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Compute the average 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>average</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>numbers</span>.<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(isNaN(<span style=color:#a6e22e>average</span>)) <span style=color:#a6e22e>reject</span>(<span style=color:#e6db74>&#34;Average cannot be computed.&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>resolve</span>(<span style=color:#a6e22e>average</span>);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Rejected promises are also handled by the <code>catch()</code> method, so if we rerun the last example:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>computeAverage</span>([<span style=color:#e6db74>&#39;A&#39;</span>, <span style=color:#e6db74>&#39;bannana&#39;</span>, <span style=color:#66d9ef>true</span>])
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>average</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;The average is&#34;</span>, <span style=color:#a6e22e>average</span>))
</span></span><span style=display:flex><span>    .<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>err</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Encountered an error:&#34;</span>, <span style=color:#a6e22e>err</span>));</span></span></code></pre></div><p>Notice we now see our error message!</p><h4 id=chaining-promiseprototypethen-and-promiseprototypecatch>Chaining Promise.prototype.then() and Promise.prototype.catch()</h4><p>Where <code>Promise.prototype.then()</code> and <code>Promise.prototype.catch()</code> really shine is when we <em>chain</em> a series of promises together. Remember our callback hell example?</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>webapp</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/login&#39;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>parseFormData</span>(<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>, (<span style=color:#a6e22e>form</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>username</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>username</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>password</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>form</span>.<span style=color:#a6e22e>password</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>findUserInDatabase</span>(<span style=color:#a6e22e>username</span>, (<span style=color:#a6e22e>user</span>) =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>encryptPassword</span>(<span style=color:#a6e22e>password</span>, <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>salt</span>, (<span style=color:#a6e22e>hash</span>) =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>hash</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>passwordHash</span>) 
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>setCookie</span>({<span style=color:#a6e22e>user</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>user</span>});
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>end</span>(<span style=color:#ae81ff>200</span>, <span style=color:#e6db74>&#34;Logged in successfully!&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>end</span>(<span style=color:#ae81ff>403</span>, <span style=color:#e6db74>&#34;Unknown username/password combo&#34;</span>);
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>});</span></span></code></pre></div><p>If each of our methods returned a promise, we could re-write this as:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>webapp</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/login&#39;</span>, (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>))
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>parseFormData</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>formData</span> =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>username</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>formData</span>.<span style=color:#a6e22e>username</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>password</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>formData</span>.<span style=color:#a6e22e>password</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>username</span>;
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>findUserInDatabase</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>user</span> =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>encryptPassword</span>(<span style=color:#a6e22e>password</span>, <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>salt</span>);
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>hash</span> =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>hash</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>passwordHash</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>setCookie</span>({<span style=color:#a6e22e>user</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>user</span>});
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>end</span>(<span style=color:#ae81ff>200</span>, <span style=color:#e6db74>&#34;Logged in successfully&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> 
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>end</span>(<span style=color:#ae81ff>403</span>, <span style=color:#e6db74>&#34;Unknown username/password combo&#34;</span>);
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    .<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>err</span> =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>end</span>(<span style=color:#ae81ff>500</span>, <span style=color:#e6db74>&#34;A server error occurred&#34;</span>);
</span></span><span style=display:flex><span>    });</span></span></code></pre></div><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Info</summary><div class=box-content><p>The <code>Promise.prototype.catch()</code> method catches any error or promise rejection that occurs before it in the chain - basically as soon as an error or rejection occurs, further <code>.then()</code> calls are skipped until a <code>.catch()</code> is encountered. You can also chain additional <code>.then()</code> calls after a <code>.catch()</code>, and they will be processed until another error or rejection occurs!</p></div></details><h4 id=promiseall>Promise.All()</h4><p>In addition to processing promises in serial (one after another) by chaining <code>.then()</code> methods, sometimes we want to do them in <em>parallel</em> (all at the same time). For example, say we have several independent processes (perhaps each running on a webworker or separate Node thread) that when finished, we want to average together.</p><p>The <code>Promise.All()</code> method is the answer; it returns a promise to execute an arbitrary number of promises, and when all have finished, it itself resolves to an array of their results.</p><p>Let&rsquo;s do a quick example using this method. We&rsquo;ll start by declaring a function to wrap a fake asynchronous process - basically creating a random number (between 1 and 100) after a random number of seconds (between 0 and 3):</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>mockTask</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>setTimeout</span>(() =&gt; {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>ceil</span>(Math.<span style=color:#a6e22e>random</span>()<span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Computed value&#34;</span>, <span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>resolve</span>(<span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>        }, Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>3000</span>)
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Now let&rsquo;s say we want to compute an average of the results once they&rsquo;ve finished. As <code>Promise.All()</code> returns a <code>Promise</code> that resolves to a an array of the results, we can invoke our <code>computeAverage()</code> (which we declared previously) in a chained <code>.then()</code>:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>Promise.<span style=color:#a6e22e>all</span>([
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mockTask</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mockTask</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mockTask</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mockTask</span>()
</span></span><span style=display:flex><span>])
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>computeAverage</span>)
</span></span><span style=display:flex><span>.<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>);</span></span></code></pre></div><p>Note that because <code>computeAverage</code> takes as a parameter an array, and <code>console.log</code> takes as its parameter a value, and those are what the previous promises resolve to, we don&rsquo;t have to define anonymous functions to pass into <code>.then()</code> - we can pass the function name instead.</p><p>Many JavaScript programmers found this format more comfortable to write and read than a series of nested callbacks. However, the <code>async</code> and <code>await</code> syntax offers a <em>third</em> option, which we&rsquo;ll look at next.</p><footer class=footline></footer></article></div></main></div><script src=/cis526/js/clipboard/clipboard.min.js?1755561291 defer></script><script src=/cis526/js/perfect-scrollbar/perfect-scrollbar.min.js?1755561291 defer></script><script src=/cis526/js/theme.min.js?1755561291 defer></script></div><script src=/cis526/js/tele-scroll.min.js?1755561291 defer></script></body></html>