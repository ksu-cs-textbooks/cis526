




	
	
		

	
	
		

	
	
		

	
	
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		
		
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.117.0">
    <meta name="generator" content="Relearn 5.18.0">
    <meta name="description" content="CIS 526 Textbook">
    <meta name="author" content="Nathan Bean">
    <title>Web Workers :: CIS 526 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis526/03-asynchronous-js/05-web-workers/index.html" rel="canonical" type="text/html" title="Web Workers :: CIS 526 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis526/03-asynchronous-js/05-web-workers/index.xml" rel="alternate" type="application/rss+xml" title="Web Workers :: CIS 526 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis526/03-asynchronous-js/05-web-workers/tele.html" rel="alternate" type="text/html" title="Web Workers :: CIS 526 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis526/03-asynchronous-js/05-web-workers/embed.html" rel="alternate" type="text/html" title="Web Workers :: CIS 526 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/fontawesome-all.min.css?1705957977" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/fontawesome-all.min.css?1705957977" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/nucleus.css?1705957977" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/auto-complete.css?1705957977" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/auto-complete.css?1705957977" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/perfect-scrollbar.min.css?1705957977" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/fonts.css?1705957977" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/fonts.css?1705957977" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/theme.css?1705957977" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/theme-auto.css?1705957977" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/variant.css?1705957977" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/print.css?1705957977" rel="stylesheet" media="print">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/format-print.css?1705957977" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/ie.css?1705957977" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/url.js?1705957977"></script>
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/variant.js?1705957977"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="https://ksu-cs-textbooks.github.io/cis526/index.search.js";
      var root_url="https://ksu-cs-textbooks.github.io/cis526/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis526/';
      window.variants && variants.init( [ 'auto', 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/custom.css?1705957977" rel="stylesheet">

  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis526/03-asynchronous-js/05-web-workers/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="top-tele-link">
            <a class="print-link" title='Teleprompter View' href="https://ksu-cs-textbooks.github.io/cis526/03-asynchronous-js/05-web-workers/tele.html">
              <i class="fas fa-tv fa-fw"></i>
            </a>
          </div>
          <div id="top-embed-link">
            <a class="print-link" title='Embeddable Version' href="https://ksu-cs-textbooks.github.io/cis526/03-asynchronous-js/05-web-workers/embed.html">
              <i class="fas fa-expand-arrows-alt fa-fw"></i>
            </a>
          </div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis526/index.html"><span itemprop="name">Web Application Development</span></a><meta itemprop="position" content="1"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="https://ksu-cs-textbooks.github.io/cis526/03-asynchronous-js/index.html"><span itemprop="name">Asynchronous JavaScript</span></a><meta itemprop="position" content="2"> &gt; </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Web Workers</span><meta itemprop="position" content="3"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="web-workers">Web Workers</h1>

<p>As JavaScript began to be used to add more and more functionality to web applications, an important limitation began to appear.  When the JavaScript interpreter is working on a big task, it stays in the event loop a long time, and does not pull events from the event queue.  The result is the browser stops responding to user events&hellip; and seems to be frozen.  On the other hand - some programs will <em>never</em> end.  Consider this one:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">while</span>(<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#34;thinking...&#34;</span>);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>This loop has no possible exit condition, so if you ran it in the browser, it would run infinitely long&hellip; and the page would never respond to user input, because you&rsquo;d never pull any events of the event queue.  One of the important discoveries in computer science, the <a href="https://en.wikipedia.org/wiki/Halting_problem" target="_blank">Halting Problem</a>
 tackles exactly this issue - and Alan Turing&rsquo;s proof shows that a program to determine if another program will halt for all possible programs <em>cannot</em> be written.</p>
<p>Thus, browsers instead post warning messages after execution has run for a significant amount of time, like this one:</p>
<p>
<a href="#image-362a354207ea1117b42f170419945e5e" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis526/images/3.5.1.jpg" alt="The Chrome not responding dialog" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-362a354207ea1117b42f170419945e5e">
<img src="https://ksu-cs-textbooks.github.io/cis526/images/3.5.1.jpg" alt="The Chrome not responding dialog" class="lightbox-image" loading="lazy">
</a></p>
<p>So, if we want to do a long-running computation, and <em>not</em> have the browser freeze up, we needed to be able to run it separately from the thread our event loop is running on.  The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank">web worker</a>
 provides just this functionality.</p>
<p>A web worker is essentially another JavaScript interpreter, running a script separate from the main thread.  As an interpreter, it has its own event loop and its own memory space.  Workers and the main thread can communicate by passing messages, which are copied onto their respective event queues. Thus, communication between the threads is <em>asynchronous</em>.</p>
<p>
<a href="#image-a347477aa13a4fc355d9e2896fa96a75" class="lightbox-link">
<img src="https://ksu-cs-textbooks.github.io/cis526/images/3.5.2.png" alt="The web worker and main thread interpreters passing messages" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-a347477aa13a4fc355d9e2896fa96a75">
<img src="https://ksu-cs-textbooks.github.io/cis526/images/3.5.2.png" alt="The web worker and main thread interpreters passing messages" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="an-example">An Example</h2>
<p>You can see an example of such a web worker by using <a href='https://ksu-cs-textbooks.github.io/cis526/examples/3.5.1/index.html' target='_blank'>this link</a> to open another tab in your browser.  This example simulates a long-running process of <strong>n</strong> seconds either in the browser&rsquo;s main thread or in a web worker.  On the page is also three colored squares that when clicked, shift colors.  Try changing the colors of the squares while simulating a several-second process in both ways.  See how running the process on the main thread freezes the user interface?</p>
<h2 id="using-web-workers">Using Web Workers</h2>
<p>Web workers are actually very easy to use.  A web worker is created by constructing a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker" target="_blank">Worker</a>
 object.  It takes a single argument - the JavaScript file it will execute (which should be hosted on the same server).  In the example, this is done with:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// Set up the web worker
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">worker</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Worker</span>(<span style="color:#e6db74">&#39;stall.js&#39;</span>);</span></span></code></pre></div><p>The <em>stall.js</em> file contains the script the worker will execute - we&rsquo;ll take a look at it in a minute.</p>
<p>Once created, you can attach a listener to the <code>Worker</code>.  It has two events:</p>
<ul>
<li><code>message</code> - a deserialized message sent from the web worker</li>
<li><code>mesageerror</code> - a message sent from the web worker that was not serializable</li>
</ul>
<p>You can use <code>worker.addEventListener()</code> to add these, or you can assign your event listener to the event handler properties.  Those properties are:</p>
<ul>
<li><code>Worker.onmessage</code> - triggered when the <code>message</code> event happens</li>
<li><code>Worker.onmessageerror</code> - triggered when the <code>messageerror</code> event happens</li>
</ul>
<p>Additionally, there is an error handler property:</p>
<ul>
<li><code>Worker.onerror</code></li>
</ul>
<p>Which triggers when an uncaught error occurs on the web worker.</p>
<p>In our example, we listen for messages using the <code>Worker.onmessage</code> property:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// Set up message listener
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">worker</span>.<span style="color:#a6e22e">onmessage</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">event</span>){
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Signal completion
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;#calculation-message&#39;</span>).<span style="color:#a6e22e">textContent</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`Calculation complete!`</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>If the message was successfully deserialized, it&rsquo;s <code>data</code> property contains the content of the message, which can be any valid JavaScript value (an int, string, array, object, etc). This gives us a great deal of flexibility.  If you need to send more than one type of message, a common strategy is to send a JavaScript object with a type property, and additional properties as needed, i.e.:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">messageData1</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;greeting&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">body</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Hello!  It&#39;s good to see you.&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">messageData2</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;set-color&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">color</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;#ffaacc&#34;</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>We can send messages <em>to</em> the web worker with <a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker/postMessage" target="_blank">Worker.postMessage()</a>
.  Again, these messages can be any valid JavaScript value:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">worker</span>.<span style="color:#a6e22e">postMessage</span>(<span style="color:#e6db74">&#34;Foo&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">worker</span>.<span style="color:#a6e22e">postMessage</span>(<span style="color:#ae81ff">5</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">worker</span>.<span style="color:#a6e22e">postMessage</span>({<span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;greetings&#34;</span>, <span style="color:#a6e22e">body</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Take me to your leader!&#34;</span>});</span></span></code></pre></div><p>In our example, we send the number of seconds to wait as an integer parsed from the <code>&lt;input&gt;</code> element:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// Get the number to calculate the Fibonacci number for and convert it from a string to a base 10 integer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">n</span> <span style="color:#f92672">=</span> parseInt(document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;#n&#39;</span>).<span style="color:#a6e22e">value</span>, <span style="color:#ae81ff">10</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Stall for the specified amount of time
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">worker</span>.<span style="color:#a6e22e">postMessage</span>(<span style="color:#a6e22e">n</span>);</span></span></code></pre></div><p>Whatever data we send as the message is <em>copied</em> into the web worker&rsquo;s memory using the <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/DOM/The_structured_clone_algorithm" target="_blank">structured clone</a>
 algorithm.  We can also optionally <em>transfer</em> objects to the web worker instead of copying them by providing them as a second argument. This transfers the memory holding them from one thread to the other. This makes them unavailable on the original thread, but is much faster than copying when the object is large.  It is used for sending objects like <a href="https://developer.mozilla.org/en-US/docs/Web/API/ArrayBuffer" target="_blank">ArrayBuffer</a>
, <a href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort" target="_blank">MessagePort</a>
, or <a href="https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap" target="_blank">ImageBitmap</a>
.  Transferred objects <em>also</em> need to have a reference in the first argument.</p>
<h2 id="the-web-worker-context">The Web Worker Context</h2>
<p>For the JavaScript executing in the web worker, the context is a bit different.  First, there is no document object model, as the web worker cannot make changes to the user interface.  Likewise there is no global <code>window</code> object.  However, many of the normal global functions and properties <em>not</em> related to the user interface are available, see <a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker/Functions_and_classes_available_to_workers" target="_blank">functions and classes available to web workers</a>
 for details.</p>
<p>The web worker has its own unique global scope, so any variables declared in your main thread won&rsquo;t exist here.  Likewise, varibles declared in the worker will not exist in the main scope either.  The global scope of the worker has mirror events and properties to the <code>Worker</code> - we can listen for messages from the main thread using the <code>onmessage</code> and <code>onmessageerror</code> properties, and send messages back to the main thread with <code>postMessage()</code>.</p>
<p>The complete web worker script from the example is:</p>
<div class="wrap-code highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">/** @function stall 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Synchronously stalls for the specified amount of time 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * to simulate a long-running calculation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param {int} seconds - the number of seconds to stall
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">stall</span>(<span style="color:#a6e22e">seconds</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">startTime</span> <span style="color:#f92672">=</span> Date.<span style="color:#a6e22e">now</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">endTime</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">seconds</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">startTime</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span>(<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(Date.<span style="color:#a6e22e">now</span>() <span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">endTime</span>) <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Message handler for messages from the main thread
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">onmessage</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">event</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// stall for the specified amount of time 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">stall</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">data</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Send an answer back to the main thread
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">postMessage</span>(<span style="color:#e6db74">`Stalled for </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">data</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> seconds`</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Close the worker since we create a
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// new worker with each stall request.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// Alternatively, we could re-use the same
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// worker.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>};</span></span></code></pre></div><p>Workers can also send AJAX requests, and spawn additional web workers!  In the case of spawning additional workers, the web worker that creates the child worker is treated as the main thread.</p>
<h2 id="other-kinds-of-web-workers">Other kinds of Web Workers</h2>
<p>The web workers we&rsquo;ve discussed up to this point are basic <em>dedicated workers</em>.  There are also several other kinds of specialized web workers:</p>
<ul>
<li>Shared workers are shared between several scripts, possibly even running in different <code>&lt;iframe&gt;</code> elements.  These are more complex than a dedicated worker and communicate via ports.  See MDN&rsquo;s <a href="https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker" target="_blank">SharedWorker</a>
 article for information.</li>
<li>Service workers act as proxy servers between the server and the web app, for the purpose of allowing web apps to be used offline.  We&rsquo;ll discuss these later in the semester, but you can read up on them in hte mdn <a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker_API" target="_blank">ServiceWorker</a>
 article.</li>
<li>Audio workers allow for direct scripting of audio processing within a web worker context.  See the mdn <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API#Audio_Workers" target="_blank">AudioWorker</a>
 article for details.</li>
</ul>

            <footer class="footline">

            </footer>
          </article>


        </div>
      </main>
    
<div class="git-footer">
<p class="theme-version-footer">5.18.0</p>
<p>Last modified by: 
            <i class='fas fa-user'></i> Russell Feldhausen
            <i class='fas fa-calendar'></i> <a href="https://gitlab.cs.ksu.edu/cs-textbooks/cis526-textbook/-/commit/09823188e1f91f661da5331d9b7925505c15a589">Jul 28, 2022</a>
</p>
</div>

    
    </div>
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/clipboard.min.js?1705957978" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/perfect-scrollbar.min.js?1705957978" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/theme.js?1705957978" defer></script>
  </body>
</html>
