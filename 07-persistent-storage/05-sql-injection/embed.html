




	
	
		

	
	
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		

	
	
		
		
		

	
	
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		

	
	
		

	
	
		
		
		
		
		
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.101.0">
    <meta name="generator" content="Relearn 5.2.0+tip">
    <meta name="description" content="CIS 526 Textbook">
    <meta name="author" content="Nathan Bean">
    <title>SQL Injection :: CIS 526 Textbook</title>
    <link href="https://ksu-cs-textbooks.github.io/cis526/07-persistent-storage/05-sql-injection/" rel="canonical" type="text/html" title="CIS 526 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis526/07-persistent-storage/05-sql-injection/index.xml" rel="alternate" type="application/rss+xml" title="CIS 526 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis526/07-persistent-storage/05-sql-injection/index.print.html" rel="alternate" type="text/html" title="CIS 526 Textbook">
    <link href="https://ksu-cs-textbooks.github.io/cis526/07-persistent-storage/05-sql-injection/tele.html" rel="alternate" type="text/html" title="CIS 526 Textbook">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/fontawesome-all.min.css?1677688546" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/fontawesome-all.min.css?1677688546" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/featherlight.min.css?1677688546" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/featherlight.min.css?1677688546" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/auto-complete.css?1677688546" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/auto-complete.css?1677688546" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/perfect-scrollbar.min.css?1677688546" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/nucleus.css?1677688546" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/fonts.css?1677688546" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="https://ksu-cs-textbooks.github.io/cis526/css/fonts.css?1677688546" rel="stylesheet"></noscript>
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/theme.css?1677688546" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/theme-light-theme.css?1677688546" rel="stylesheet" id="variant-style">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/ie.css?1677688546" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/variant.css?1677688546" rel="stylesheet">
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/print.css?1677688546" rel="stylesheet" media="print">
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/variant.js?1677688546"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      var index_url="https://ksu-cs-textbooks.github.io/cis526/index.json";
      var root_url="https://ksu-cs-textbooks.github.io/cis526/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      // some further base stuff
      var baseUriFull='https:\/\/ksu-cs-textbooks.github.io\/cis526/';
      window.variants && variants.init( [ 'light-theme', 'dark-theme' ] );
    </script>
    
    <link href="https://ksu-cs-textbooks.github.io/cis526/css/custom.css?1677688546" rel="stylesheet">
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/jquery.min.js?1677688546" defer></script>

  </head>
  <body class="mobile-support embed disableInlineCopyToClipboard" data-url="https://ksu-cs-textbooks.github.io/cis526/07-persistent-storage/05-sql-injection/embed.html">
    <div id="body" class="default-animation">
      
      
      
      <main id="body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
          </div>
          <article class="default">
    
    
    
<p>Along with the use of relational databases and SQL comes one very important attack to be aware of - SQL injection.  This attack takes advantage of the way many developers write SQL queries within their programs.  Consider the simple relational database we laid out earlier.  Let&rsquo;s assume our web application lets us search for people by their last names.  To find Mary Cotts, we would then need a SQL query like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> people <span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">last</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Cotts&#39;</span>;
</span></span></code></pre></div><p>Since we want our <em>users</em> to be able to specify who to look for, we&rsquo;d probably give them a search form in our HTML, something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">label</span> <span style="color:#a6e22e">for</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;last&#34;</span>&gt;Last Name:&lt;/<span style="color:#f92672">label</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;last&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Search&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">form</span>&gt;
</span></span></code></pre></div><p>And in our code, extract the <code>name</code> value from the query string and use it to construct the SQL query using string concatenation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">querystring</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;querystring&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">URL</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">url</span>, <span style="color:#e6db74">&#34;http://localhost&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">qs</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">querystring</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">search</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">qs</span>.<span style="color:#a6e22e">name</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">query</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`SELECT * FROM people WHERE last=&#39;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">name</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;;`</span>;
</span></span></code></pre></div><p>The problem with this approach is a savvy adversary could submit a &ldquo;name&rdquo; that completes the SQL command and begins a new one, i.e.:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>bob&#39;; UPDATE users SET admin=true WHERE username=&#39;saavyhacker
</span></span></code></pre></div><p>Our naive concatenation approach then creates <em>two</em> SQL commands:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-SQL" data-lang="SQL"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> people <span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">last</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;bob&#39;</span>; <span style="color:#66d9ef">UPDATE</span> users <span style="color:#66d9ef">SET</span> <span style="color:#66d9ef">admin</span><span style="color:#f92672">=</span><span style="color:#66d9ef">true</span> <span style="color:#66d9ef">WHERE</span> username<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;saavyhacker&#39;</span>;
</span></span></code></pre></div><p>When we run this query, our savvy hacker just made themselves an admin on our site (assuming our database has a users table with an admin column we use to determine their role)!</p>
<p>This is just the tip of the iceberg for SQL injection attacks - there are many, many variations on the theme.</p>
<h2 id="preventing-sql-injection">Preventing SQL Injection</h2>
<p>Every database driver provides the ability to build parameterized queries, i.e. a preformatted query that has &ldquo;slots&rdquo; where you assign values to.  The exact mechanism to use these depends on the driver you are using to connect to the database.  For example, if we were using the 

<a href="">node-sqlite3</a> driver to connect our Node application to a SQLite database, we would use:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">querystring</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;querystring&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">URL</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">url</span>, <span style="color:#e6db74">&#34;http://localhost&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">qs</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">querystring</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">search</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">qs</span>.<span style="color:#a6e22e">name</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">query</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`SELECT * FROM people WHERE last=?;`</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// assuming a variable db is declared 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">run</span>(<span style="color:#a6e22e">query</span>, <span style="color:#a6e22e">name</span>, (<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">result</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// do something with result...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>});
</span></span></code></pre></div><p>Because the slot corresponds to a specific column, the database engine converts the supplied argument to that type before applying it  In this case, if our canny hacker uses his string, it would be interpreted as the literal last name &ldquo;bob&rsquo;; UPDATE users SET admin=true WHERE username=&lsquo;saavyhacker&rdquo;. Which probably wouldn&rsquo;t exist in our database, because what kind of parent would saddle a child with such a name?</p>

  
  
<div class="box notices cstyle note">
    <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
    <div class="box-content">
<p><img src="https://imgs.xkcd.com/comics/exploits_of_a_mom.png" alt="XKCD&amp;rsquo;s Exploits of a Mom">


<a href="https://xkcd.com/327/" target="_blank" rel="noopener">XKCD&rsquo;s Exploits of a Mom</a></p>
    </div>
</div>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    
    
    
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/clipboard.min.js?1677688546" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/perfect-scrollbar.min.js?1677688546" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/featherlight.min.js?1677688546" defer></script>
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/theme.js?1677688546" defer></script>
    
    <script src="https://ksu-cs-textbooks.github.io/cis526/js/embed-iframe.js?1677688546 defer"></script>
    
  </body>
</html>
