<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.148.1"><meta name=generator content="Relearn 8.0.0"><meta name=description content="Along with the use of relational databases and SQL comes one very important attack to be aware of - SQL injection. This attack takes advantage of the way many developers write SQL queries within their programs. Consider the simple relational database we laid out earlier. Let’s assume our web application lets us search for people by their last names. To find Mary Cotts, we would then need a SQL query like:"><meta name=author content="Nathan Bean & Russell Feldhausen"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta name=twitter:title content="SQL Injection :: CIS 526 Textbook"><meta name=twitter:description content="Along with the use of relational databases and SQL comes one very important attack to be aware of - SQL injection. This attack takes advantage of the way many developers write SQL queries within their programs. Consider the simple relational database we laid out earlier. Let’s assume our web application lets us search for people by their last names. To find Mary Cotts, we would then need a SQL query like:"><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/07-persistent-storage/05-sql-injection/index.html"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="SQL Injection :: CIS 526 Textbook"><meta property="og:description" content="Along with the use of relational databases and SQL comes one very important attack to be aware of - SQL injection. This attack takes advantage of the way many developers write SQL queries within their programs. Consider the simple relational database we laid out earlier. Let’s assume our web application lets us search for people by their last names. To find Mary Cotts, we would then need a SQL query like:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="Persistent Storage"><meta property="article:published_time" content="2018-08-24T10:53:26-05:00"><meta property="article:modified_time" content="2022-05-26T14:31:28-05:00"><meta property="og:image" content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta itemprop=name content="SQL Injection :: CIS 526 Textbook"><meta itemprop=description content="Along with the use of relational databases and SQL comes one very important attack to be aware of - SQL injection. This attack takes advantage of the way many developers write SQL queries within their programs. Consider the simple relational database we laid out earlier. Let’s assume our web application lets us search for people by their last names. To find Mary Cotts, we would then need a SQL query like:"><meta itemprop=datePublished content="2018-08-24T10:53:26-05:00"><meta itemprop=dateModified content="2022-05-26T14:31:28-05:00"><meta itemprop=wordCount content="453"><meta itemprop=image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><title>SQL Injection :: CIS 526 Textbook</title><link href=https://textbooks.cs.ksu.edu/cis526/07-persistent-storage/05-sql-injection/index.html rel=canonical type=text/html title="SQL Injection :: CIS 526 Textbook"><link href=/cis526/07-persistent-storage/05-sql-injection/index.xml rel=alternate type=application/rss+xml title="SQL Injection :: CIS 526 Textbook"><link href=/cis526/07-persistent-storage/05-sql-injection/index.print.html rel=alternate type=text/html title="SQL Injection :: CIS 526 Textbook"><link href=/cis526/07-persistent-storage/05-sql-injection/tele.html rel=alternate type=text/html title="SQL Injection :: CIS 526 Textbook"><link href=/cis526/css/auto-complete/auto-complete.min.css?1769118339 rel=stylesheet><script src=/cis526/js/auto-complete/auto-complete.min.js?1769118339 defer></script><script src=/cis526/js/search-lunr.min.js?1769118339 defer></script><script src=/cis526/js/search.min.js?1769118339 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/cis526/searchindex.en.js?1769118339"</script><script src=/cis526/js/lunr/lunr.min.js?1769118339 defer></script><script src=/cis526/js/lunr/lunr.stemmer.support.min.js?1769118339 defer></script><script src=/cis526/js/lunr/lunr.multi.min.js?1769118339 defer></script><script src=/cis526/js/lunr/lunr.en.min.js?1769118339 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1769118339 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1769118339 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar/perfect-scrollbar.min.css?1769118339 rel=stylesheet><link href=/cis526/css/theme.min.css?1769118339 rel=stylesheet><link href=/cis526/css/format-html.min.css?1769118339 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/07-persistent-storage/05-sql-injection/index.html",window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!1,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["light-theme"],window.relearn.customvariantname="my-custom-variant",window.relearn.writeVariant=!1,window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.writeVariant&&window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><link href=/cis526/css/custom.css?1769118339 rel=stylesheet></head><body class="mobile-support embed html" data-url=/cis526/07-persistent-storage/05-sql-injection/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable 07-persistent-storage" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=sql-injection>SQL Injection</h1><p>Along with the use of relational databases and SQL comes one very important attack to be aware of - SQL injection. This attack takes advantage of the way many developers write SQL queries within their programs. Consider the simple relational database we laid out earlier. Let&rsquo;s assume our web application lets us search for people by their last names. To find Mary Cotts, we would then need a SQL query like:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> people <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>last</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Cotts&#39;</span>;</span></span></code></pre></div><p>Since we want our <em>users</em> to be able to specify who to look for, we&rsquo;d probably give them a search form in our HTML, something like:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>form</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>label</span> <span style=color:#a6e22e>for</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;last&#34;</span>&gt;Last Name:&lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;last&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Search&#34;</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>form</span>&gt;</span></span></code></pre></div><p>And in our code, extract the <code>name</code> value from the query string and use it to construct the SQL query using string concatenation:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>querystring</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;querystring&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>url</span>, <span style=color:#e6db74>&#34;http://localhost&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>qs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>querystring</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>search</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>1</span>));
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>qs</span>.<span style=color:#a6e22e>name</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>query</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`SELECT * FROM people WHERE last=&#39;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;;`</span>;</span></span></code></pre></div><p>The problem with this approach is a savvy adversary could submit a &ldquo;name&rdquo; that completes the SQL command and begins a new one, i.e.:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>bob&#39;; UPDATE users SET admin=true WHERE username=&#39;saavyhacker</span></span></code></pre></div><p>Our naive concatenation approach then creates <em>two</em> SQL commands:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> people <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>last</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;bob&#39;</span>; <span style=color:#66d9ef>UPDATE</span> users <span style=color:#66d9ef>SET</span> <span style=color:#66d9ef>admin</span><span style=color:#f92672>=</span><span style=color:#66d9ef>true</span> <span style=color:#66d9ef>WHERE</span> username<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;saavyhacker&#39;</span>;</span></span></code></pre></div><p>When we run this query, our savvy hacker just made themselves an admin on our site (assuming our database has a users table with an admin column we use to determine their role)!</p><p>This is just the tip of the iceberg for SQL injection attacks - there are many, many variations on the theme.</p><h2 id=preventing-sql-injection>Preventing SQL Injection</h2><p>Every database driver provides the ability to build parameterized queries, i.e. a preformatted query that has &ldquo;slots&rdquo; where you assign values to. The exact mechanism to use these depends on the driver you are using to connect to the database. For example, if we were using the <a href=/cis526/07-persistent-storage/05-sql-injection/index.html>node-sqlite3</a> driver to connect our Node application to a SQLite database, we would use:</p><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>querystring</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;querystring&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>url</span>, <span style=color:#e6db74>&#34;http://localhost&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>qs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>querystring</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>url</span>.<span style=color:#a6e22e>search</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>1</span>));
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>qs</span>.<span style=color:#a6e22e>name</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>query</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`SELECT * FROM people WHERE last=?;`</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// assuming a variable db is declared 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>run</span>(<span style=color:#a6e22e>query</span>, <span style=color:#a6e22e>name</span>, (<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>result</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// do something with result...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>});</span></span></code></pre></div><p>Because the slot corresponds to a specific column, the database engine converts the supplied argument to that type before applying it In this case, if our canny hacker uses his string, it would be interpreted as the literal last name &ldquo;bob&rsquo;; UPDATE users SET admin=true WHERE username=&lsquo;saavyhacker&rdquo;. Which probably wouldn&rsquo;t exist in our database, because what kind of parent would saddle a child with such a name?</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Note</summary><div class=box-content><p><a href=#R-image-5ab75824aeb29a221c5e29612a513a0f class=lightbox-link><img alt="XKCD&rsquo;s Exploits of a Mom" class="border lazy lightbox figure-image" loading=lazy src=https://imgs.xkcd.com/comics/exploits_of_a_mom.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5ab75824aeb29a221c5e29612a513a0f><img alt="XKCD&rsquo;s Exploits of a Mom" class="border lazy lightbox lightbox-image" loading=lazy src=https://imgs.xkcd.com/comics/exploits_of_a_mom.png></a>
<a href=https://xkcd.com/327/ rel=external target=_blank>XKCD&rsquo;s Exploits of a Mom</a></p></div></details><footer class=footline></footer></article></div></main></div><script src=/cis526/js/clipboard/clipboard.min.js?1769118339 defer></script><script src=/cis526/js/perfect-scrollbar/perfect-scrollbar.min.js?1769118339 defer></script><script src=/cis526/js/theme.min.js?1769118339 defer></script><script src=/cis526/js/embed-iframe.min.js?1769118339 defer></script></body></html>