<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="Along with the use of relational databases and SQL comes one very important attack to be aware of - SQL injection. This attack takes advantage of the way many developers write SQL queries within their programs. Consider the simple relational database we laid out earlier. Let’s assume our web application lets us search for people by their last names. To find Mary Cotts, we would then need a SQL query like:"><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="SQL Injection :: CIS 526 Textbook"><meta name=twitter:description content="Along with the use of relational databases and SQL comes one very important attack to be aware of - SQL injection. This attack takes advantage of the way many developers write SQL queries within their programs. Consider the simple relational database we laid out earlier. Let’s assume our web application lets us search for people by their last names. To find Mary Cotts, we would then need a SQL query like:"><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/07-persistent-storage/05-sql-injection/embed.html"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="SQL Injection :: CIS 526 Textbook"><meta property="og:description" content="Along with the use of relational databases and SQL comes one very important attack to be aware of - SQL injection. This attack takes advantage of the way many developers write SQL queries within their programs. Consider the simple relational database we laid out earlier. Let’s assume our web application lets us search for people by their last names. To find Mary Cotts, we would then need a SQL query like:"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Persistent Storage"><meta property="article:published_time" content="2018-08-24T10:53:26-05:00"><meta property="article:modified_time" content="2022-05-26T14:31:28-05:00"><meta itemprop=name content="SQL Injection :: CIS 526 Textbook"><meta itemprop=description content="Along with the use of relational databases and SQL comes one very important attack to be aware of - SQL injection. This attack takes advantage of the way many developers write SQL queries within their programs. Consider the simple relational database we laid out earlier. Let’s assume our web application lets us search for people by their last names. To find Mary Cotts, we would then need a SQL query like:"><meta itemprop=datePublished content="2018-08-24T10:53:26-05:00"><meta itemprop=dateModified content="2022-05-26T14:31:28-05:00"><meta itemprop=wordCount content="447"><title>SQL Injection :: CIS 526 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis526/07-persistent-storage/05-sql-injection/ rel=canonical type=text/html title="SQL Injection :: CIS 526 Textbook"><link href=/cis526/07-persistent-storage/05-sql-injection/index.xml rel=alternate type=application/rss+xml title="SQL Injection :: CIS 526 Textbook"><link href=/cis526/07-persistent-storage/05-sql-injection/index.print.html rel=alternate type=text/html title="SQL Injection :: CIS 526 Textbook"><link href=/cis526/07-persistent-storage/05-sql-injection/tele.html rel=alternate type=text/html title="SQL Injection :: CIS 526 Textbook"><link href=/cis526/css/fontawesome-all.min.css?1741029259 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fontawesome-all.min.css?1741029259 rel=stylesheet></noscript><link href=/cis526/css/nucleus.css?1741029259 rel=stylesheet><link href=/cis526/css/auto-complete.css?1741029259 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/auto-complete.css?1741029259 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar.min.css?1741029259 rel=stylesheet><link href=/cis526/css/fonts.css?1741029259 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fonts.css?1741029259 rel=stylesheet></noscript><link href=/cis526/css/theme.css?1741029259 rel=stylesheet><link href=/cis526/css/theme-light-theme.css?1741029259 rel=stylesheet id=R-variant-style><link href=/cis526/css/chroma-relearn-light.css?1741029259 rel=stylesheet id=R-variant-chroma-style><link href=/cis526/css/variant.css?1741029259 rel=stylesheet><link href=/cis526/css/print.css?1741029259 rel=stylesheet media=print><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.index_js_url="/cis526/index.search.js",window.variants&&variants.init(["light-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis526/css/custom.css?1741029259 rel=stylesheet></head><body class="mobile-support embed disableInlineCopyToClipboard" data-url=/cis526/07-persistent-storage/05-sql-injection/embed.html><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><p>Along with the use of relational databases and SQL comes one very important attack to be aware of - SQL injection. This attack takes advantage of the way many developers write SQL queries within their programs. Consider the simple relational database we laid out earlier. Let&rsquo;s assume our web application lets us search for people by their last names. To find Mary Cotts, we would then need a SQL query like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>people</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>last</span><span class=o>=</span><span class=s1>&#39;Cotts&#39;</span><span class=p>;</span></span></span></code></pre></div><p>Since we want our <em>users</em> to be able to specify who to look for, we&rsquo;d probably give them a search form in our HTML, something like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>label</span> <span class=na>for</span><span class=o>=</span><span class=s>&#34;last&#34;</span><span class=p>&gt;</span>Last Name:<span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;last&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span> <span class=na>value</span><span class=o>=</span><span class=s>&#34;Search&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span></span></span></code></pre></div><p>And in our code, extract the <code>name</code> value from the query string and use it to construct the SQL query using string concatenation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>querystring</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;querystring&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>url</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>URL</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>url</span><span class=p>,</span> <span class=s2>&#34;http://localhost&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>qs</span> <span class=o>=</span> <span class=nx>querystring</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>url</span><span class=p>.</span><span class=nx>search</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>qs</span><span class=p>.</span><span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>query</span> <span class=o>=</span> <span class=sb>`SELECT * FROM people WHERE last=&#39;</span><span class=si>${</span><span class=nx>name</span><span class=si>}</span><span class=sb>&#39;;`</span><span class=p>;</span></span></span></code></pre></div><p>The problem with this approach is a savvy adversary could submit a &ldquo;name&rdquo; that completes the SQL command and begins a new one, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>bob&#39;; UPDATE users SET admin=true WHERE username=&#39;saavyhacker</span></span></code></pre></div><p>Our naive concatenation approach then creates <em>two</em> SQL commands:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>people</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>last</span><span class=o>=</span><span class=s1>&#39;bob&#39;</span><span class=p>;</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=k>admin</span><span class=o>=</span><span class=k>true</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>username</span><span class=o>=</span><span class=s1>&#39;saavyhacker&#39;</span><span class=p>;</span></span></span></code></pre></div><p>When we run this query, our savvy hacker just made themselves an admin on our site (assuming our database has a users table with an admin column we use to determine their role)!</p><p>This is just the tip of the iceberg for SQL injection attacks - there are many, many variations on the theme.</p><h2 id=preventing-sql-injection>Preventing SQL Injection</h2><p>Every database driver provides the ability to build parameterized queries, i.e. a preformatted query that has &ldquo;slots&rdquo; where you assign values to. The exact mechanism to use these depends on the driver you are using to connect to the database. For example, if we were using the <a href=/cis526/07-persistent-storage/05-sql-injection/>node-sqlite3</a> driver to connect our Node application to a SQLite database, we would use:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>querystring</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;querystring&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>url</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>URL</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>url</span><span class=p>,</span> <span class=s2>&#34;http://localhost&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>qs</span> <span class=o>=</span> <span class=nx>querystring</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>url</span><span class=p>.</span><span class=nx>search</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>name</span> <span class=o>=</span> <span class=nx>qs</span><span class=p>.</span><span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>query</span> <span class=o>=</span> <span class=sb>`SELECT * FROM people WHERE last=?;`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// assuming a variable db is declared 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>db</span><span class=p>.</span><span class=nx>run</span><span class=p>(</span><span class=nx>query</span><span class=p>,</span> <span class=nx>name</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>result</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// do something with result...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span></span></span></code></pre></div><p>Because the slot corresponds to a specific column, the database engine converts the supplied argument to that type before applying it In this case, if our canny hacker uses his string, it would be interpreted as the literal last name &ldquo;bob&rsquo;; UPDATE users SET admin=true WHERE username=&lsquo;saavyhacker&rdquo;. Which probably wouldn&rsquo;t exist in our database, because what kind of parent would saddle a child with such a name?</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Note</div><div class=box-content><p><a href=#R-image-916136518006077cfc9d366422138e84 class=lightbox-link><img alt="XKCD&rsquo;s Exploits of a Mom" class="border lazy lightbox noshadow figure-image" loading=lazy src=https://imgs.xkcd.com/comics/exploits_of_a_mom.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-916136518006077cfc9d366422138e84><img alt="XKCD&rsquo;s Exploits of a Mom" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=https://imgs.xkcd.com/comics/exploits_of_a_mom.png></a>
<a href=https://xkcd.com/327/ rel=external target=_blank>XKCD&rsquo;s Exploits of a Mom</a></p></div></div><footer class=footline></footer></article></div></main></div><script src=/cis526/js/clipboard.min.js?1741029259 defer></script><script src=/cis526/js/perfect-scrollbar.min.js?1741029259 defer></script><script src=/cis526/js/theme.js?1741029259 defer></script><script src=/cis526/js/embed-iframe.js?1741029259 defer></script></body></html>