<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.148.1"><meta name=generator content="Relearn 8.0.0"><meta name=description content="This example project builds on the previous Vue.js CRUD app by discussing some more advanced topics related to web application development.
Project Deliverables At the end of this example, we will have a project with the following features:
A Pinia store that handles storing users and roles, and all Vue components adapted to use that Pinia store A DynamicDialog for editing and creating users, which repurposes the UserEdit component A working Dockerfile for the project A working GitHub Action to build the Docker image and release it on GitHub A working Docker Compose file to deploy the application The application is adapted to optionally use Postgres instead of SQLite as the database engine Prior Work This project picks up right where the last one left off, so if you havenâ€™t completed that one yet, go back and do that before starting this one."><meta name=author content="Nathan Bean & Russell Feldhausen"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta name=twitter:title content="Advanced Topics :: CIS 526 Textbook"><meta name=twitter:description content="This example project builds on the previous Vue.js CRUD app by discussing some more advanced topics related to web application development.
Project Deliverables At the end of this example, we will have a project with the following features:
A Pinia store that handles storing users and roles, and all Vue components adapted to use that Pinia store A DynamicDialog for editing and creating users, which repurposes the UserEdit component A working Dockerfile for the project A working GitHub Action to build the Docker image and release it on GitHub A working Docker Compose file to deploy the application The application is adapted to optionally use Postgres instead of SQLite as the database engine Prior Work This project picks up right where the last one left off, so if you havenâ€™t completed that one yet, go back and do that before starting this one."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/x-examples/07-advanced-topics/index.html"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Advanced Topics :: CIS 526 Textbook"><meta property="og:description" content="This example project builds on the previous Vue.js CRUD app by discussing some more advanced topics related to web application development.
Project Deliverables At the end of this example, we will have a project with the following features:
A Pinia store that handles storing users and roles, and all Vue components adapted to use that Pinia store A DynamicDialog for editing and creating users, which repurposes the UserEdit component A working Dockerfile for the project A working GitHub Action to build the Docker image and release it on GitHub A working Docker Compose file to deploy the application The application is adapted to optionally use Postgres instead of SQLite as the database engine Prior Work This project picks up right where the last one left off, so if you havenâ€™t completed that one yet, go back and do that before starting this one."><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta property="og:image" content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta itemprop=name content="Advanced Topics :: CIS 526 Textbook"><meta itemprop=description content="This example project builds on the previous Vue.js CRUD app by discussing some more advanced topics related to web application development.
Project Deliverables At the end of this example, we will have a project with the following features:
A Pinia store that handles storing users and roles, and all Vue components adapted to use that Pinia store A DynamicDialog for editing and creating users, which repurposes the UserEdit component A working Dockerfile for the project A working GitHub Action to build the Docker image and release it on GitHub A working Docker Compose file to deploy the application The application is adapted to optionally use Postgres instead of SQLite as the database engine Prior Work This project picks up right where the last one left off, so if you havenâ€™t completed that one yet, go back and do that before starting this one."><meta itemprop=dateModified content="2025-04-28T09:12:19-05:00"><meta itemprop=wordCount content="146"><meta itemprop=image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><title>Advanced Topics :: CIS 526 Textbook</title><link href=https://textbooks.cs.ksu.edu/cis526/x-examples/07-advanced-topics/index.html rel=canonical type=text/html title="Advanced Topics :: CIS 526 Textbook"><link href=/cis526/x-examples/07-advanced-topics/index.xml rel=alternate type=application/rss+xml title="Advanced Topics :: CIS 526 Textbook"><link href=/cis526/x-examples/07-advanced-topics/tele.html rel=alternate type=text/html title="Advanced Topics :: CIS 526 Textbook"><link href=/cis526/x-examples/07-advanced-topics/embed.html rel=alternate type=text/html title="Advanced Topics :: CIS 526 Textbook"><link href=/cis526/css/auto-complete/auto-complete.min.css?1753540871 rel=stylesheet><script src=/cis526/js/auto-complete/auto-complete.min.js?1753540871 defer></script><script src=/cis526/js/search-lunr.min.js?1753540871 defer></script><script src=/cis526/js/search.min.js?1753540871 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/cis526/searchindex.en.js?1753540871"</script><script src=/cis526/js/lunr/lunr.min.js?1753540871 defer></script><script src=/cis526/js/lunr/lunr.stemmer.support.min.js?1753540871 defer></script><script src=/cis526/js/lunr/lunr.multi.min.js?1753540871 defer></script><script src=/cis526/js/lunr/lunr.en.min.js?1753540871 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1753540871 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1753540871 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar/perfect-scrollbar.min.css?1753540871 rel=stylesheet><link href=/cis526/css/theme.min.css?1753540871 rel=stylesheet><link href=/cis526/css/format-print.min.css?1753540871 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/x-examples/07-advanced-topics/index.html",window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!1,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["light-theme"],window.relearn.customvariantname="my-custom-variant",window.relearn.writeVariant=!1,window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.writeVariant&&window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><link href=/cis526/css/custom.css?1753540871 rel=stylesheet></head><body class="mobile-support print" data-url=/cis526/x-examples/07-advanced-topics/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#project-deliverables>Project Deliverables</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement class=a11y-only><a itemprop=item href=/cis526/index.html><span itemprop=name>Web Application Development</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cis526/x-examples/index.html><span itemprop=name>Example Projects</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Advanced Topics</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-edit" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=https://github.com/ksu-cs-textbooks/cis526/edit/main/content/x-examples/07-advanced-topics/_index.md rel=external target=_blank title="Edit (CTRL+ALT+w)"><i class="fa-fw fas fa-pen"></i></a></div><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/07-advanced-topics/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/06-vue-crud-app/06-delete-user/index.html title="Delete User (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/07-advanced-topics/01-pinia/index.html title="Pinia (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more><div class="topbar-button topbar-button-embed" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/07-advanced-topics/embed.html title="Embeddable Version"><i class="fa-fw fas fa-expand-arrows-alt"></i></a></div><div class="topbar-button topbar-button-tele" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/07-advanced-topics/tele.html title="Teleprompter View"><i class="fa-fw fas fa-tv"></i></a></div></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable x-examples" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=advanced-topics>Advanced Topics</h1><p>This example project builds on the previous Vue.js CRUD app by discussing some more advanced topics related to web application development.</p><h2 id=project-deliverables>Project Deliverables</h2><p>At the end of this example, we will have a project with the following features:</p><ol><li>A Pinia store that handles storing users and roles, and all Vue components adapted to use that Pinia store</li><li>A DynamicDialog for editing and creating users, which repurposes the UserEdit component</li><li>A working Dockerfile for the project</li><li>A working GitHub Action to build the Docker image and release it on GitHub</li><li>A working Docker Compose file to deploy the application</li><li>The application is adapted to optionally use Postgres instead of SQLite as the database engine</li></ol><details open class="box cstyle notices warning"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-triangle"></i>
Prior Work</summary><div class=box-content><p>This project picks up right where the last one left off, so if you haven&rsquo;t completed that one yet, go back and do that before starting this one.</p></div></details><p>Let&rsquo;s get started!</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Advanced Topics</h1><article class=default><header class=headline></header><h1 id=pinia>Pinia</h1><a href="https://www.youtube.com/watch?v=YioSayQjW70">YouTube Video</a><h2 id=props>Props</h2><p>So far, we&rsquo;ve mostly been dealing with data in our Vue components in one of two ways:</p><ol><li>It is requested directly from the RESTful API for the component (as in the <code>UsersList</code> and <code>UserEdit</code> components)</li><li>It is passed in from a parent component, especially if it is a small helper component (as in the <code>RoleChip</code> and <code>TextField</code> components)</li></ol><p>The only exception is the user&rsquo;s JSON Web Token (JWT), which we have stored in a Pinia store. However, we didn&rsquo;t spend much time talking about <em>why</em> we stored that token in a Pinia store instead of just making it a global reactive state component and passing that state down the component tree using props.</p><p>The concept of passing props down through components, especially between many layers of components, is known as <a href=https://vuejs.org/guide/components/provide-inject rel=external target=_blank>Prop Drilling</a></p><p><a href=#R-image-09d4bd0d83318139dc26930acb88d8d4 class=lightbox-link><img alt="Prop Drilling" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/07/prop-drilling.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-09d4bd0d83318139dc26930acb88d8d4><img alt="Prop Drilling" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/07/prop-drilling.png></a><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><p>While this method can work well, it can also make an application very complicated with the sheer number of props that must be passed through each component. For example, imagine if each page and component needed access to the user&rsquo;s JWT to determine which actions to allow (a very real example from the project we are working). In that case, each component may need to be aware of the token as an incoming prop, and may also need to pass it along to any child components that may need it, even if it is three or four layers deep.</p><h2 id=provide--inject>Provide / Inject</h2><p>The Vue framework itself does have a solution to this problem, which is the <a href=https://vuejs.org/guide/components/provide-inject rel=external target=_blank>Provide / Inject</a> interface. In effect, a component can declare a reactive state item and add it to a global dictionary of state items that are available using the <code>provide</code> method along with a unique key for that item, and any other component can receive a reference to that state item using the <code>inject</code> method with the same key.</p><p><a href=#R-image-3d934cb4ed6a306265448f1f9e2eb9e2 class=lightbox-link><img alt="Provide Inject" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/07/provide-inject.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-3d934cb4ed6a306265448f1f9e2eb9e2><img alt="Provide Inject" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/07/provide-inject.png></a><sup id=fnref1:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><p>This is a bit of an improvement, but still has many issues that are discussed in the documentation. For example, it is best to only modify the state at the top-level component that is providing the state, so an additional function may need to be provided to enable proper editing of the state. In addition, for large apps it can be very difficult to ensure that each key is unique, and having hundreds or thousands of keys to keep track of can be a huge burden for programmers.</p><h2 id=pinia>Pinia</h2><p>The <a href=https://pinia.vuejs.org/ rel=external target=_blank>Pinia</a> library tries to solve all of these issues by providing convenient <em>stores</em> for different types of information in the application. Each store is typically oriented toward a specific type of data (such as users or documents), and it contains all the methods needed to read and modify the state as needed. Then, each component that needs access to the state can simply request a reference to the stores it needs, and everything is nicely compartmentalized and easy to maintain.</p><p>To see how this can help simplify our application, let&rsquo;s look at how we can create a <code>Users</code> store to interface with our RESTful API and maintain a globally-accessible store for data about our users.</p><h2 id=creating-a-pinia-store>Creating a Pinia Store</h2><p>To create a Pinia store, we can create a new file <code>src/stores/User.js</code> with the following initial content:</p><div class=tab-panel data-tab-group=6a4cc89f4279feec9afd08f77d0d8c7a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srcstoresuserjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6a4cc89f4279feec9afd08f77d0d8c7a","srcstoresuserjs")'>
<span class=tab-nav-text>src/stores/User.js</span></button></div><div class=tab-content-container><div data-tab-item=srcstoresuserjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file User Store
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import Libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>ref</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;vue&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>defineStore</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;pinia&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>api</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@/configs/api&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Define Store
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>useUserStore</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>defineStore</span>(<span style=color:#e6db74>&#39;user&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// State Properties
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Getters
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Actions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Return all state, getters, and actions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> { }
</span></span><span style=display:flex><span>})</span></span></code></pre></div></div></div></div></div><p>This is a nice starting structure for a store. At the bare minimum, we use the <a href=https://pinia.vuejs.org/core-concepts/ rel=external target=_blank>defineStore</a> method from Pinia to create the store. Inside of that method is a lambda function that actually defines the contents of the store itself, which we&rsquo;ll iteratively build over time. We&rsquo;ve also imported a few useful library functions, including our pre-built Axios API interface to make it easy to send requests to our API.</p><h2 id=properties>Properties</h2><p>The first items we should add to our Pinia store are the state properties that we&rsquo;ll be tracking. These can be anything from simple values all the way up to entire arrays of objects full of data. In most cases, it makes sense to have each Pinia store track data in a format similar to what our application will need. For this example, we&rsquo;ll use this store to track both the <code>users</code> and <code>roles</code> that are available in our system. So, we&rsquo;ll need to create two reactive state variables using the <code>ref()</code> function from Vue to store that data as state in our Pinia store:</p><div class=tab-panel data-tab-group=14291472f0338f55c223822f225e2752><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srcstoresuserjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("14291472f0338f55c223822f225e2752","srcstoresuserjs")'>
<span class=tab-nav-text>src/stores/User.js</span></button></div><div class=tab-content-container><div data-tab-item=srcstoresuserjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Define Store
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>useUserStore</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>defineStore</span>(<span style=color:#e6db74>&#39;user&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// State Properties
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>users</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ref</span>([])
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>roles</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ref</span>([])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Getters
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Actions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Return all state, getters, and actions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>users</span>, <span style=color:#a6e22e>roles</span> }
</span></span><span style=display:flex><span>})</span></span></code></pre></div></div></div></div></div><p>Each state property in Pinia is just a reactive state variable from Vue that can be shared across our entire application. So, we&rsquo;ll just initialize each one to an empty array for now.</p><h2 id=actions---hydrate>Actions - Hydrate</h2><p>Before we tackle any getters, let&rsquo;s look at how we can actually get this data from our RESTful API. In many web development frameworks, the process of loading data from the AI is sometimes referred to as <a href=https://en.wikipedia.org/wiki/Hydration_(web_development) rel=external target=_blank>Hydration</a>. So, let&rsquo;s write a method we can use the <em>hydrate</em> these two state variables by making a request to our RESTful API. Most of this code is lifted directly from our existing <code>UsersList</code> component:</p><div class=tab-panel data-tab-group=c58b419fae62e53b5bbd7a14dc8d24c0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srcstoresuserjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c58b419fae62e53b5bbd7a14dc8d24c0","srcstoresuserjs")'>
<span class=tab-nav-text>src/stores/User.js</span></button></div><div class=tab-content-container><div data-tab-item=srcstoresuserjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Define Store
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>useUserStore</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>defineStore</span>(<span style=color:#e6db74>&#39;user&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Actions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Load users and roles from the API
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>hydrate</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>api</span>
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/api/v1/users&#39;</span>)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>then</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>data</span>
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>      .<span style=color:#66d9ef>catch</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>error</span>)
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>api</span>
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/api/v1/roles&#39;</span>)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>then</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>roles</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>data</span>
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>      .<span style=color:#66d9ef>catch</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>error</span>)
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Return all state, getters, and actions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>users</span>, <span style=color:#a6e22e>roles</span>, <span style=color:#a6e22e>hydrate</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>})</span></span></code></pre></div></div></div></div></div><p>As we can see, this function will make two asynchronous requests to the RESTful API to load both the users and roles, and when those requests are resolved it will store the data in the appropriate state variable.</p><h2 id=getters>Getters</h2><p>For this Pinia store, we won&rsquo;t need any individual getters. Instead, we&rsquo;ll just use some functions in the component as needed to extract data from the store.</p><h2 id=actions---save--delete>Actions - Save & Delete</h2><p>Finally, let&rsquo;s add two more actions to allow us to both save and delete a user through our RESTful API. The code for the <code>save</code> function is mostly taken from our <code>UserEdit</code> component, while the code to delete a user comes from the <code>UserList</code> component, both with minor changes.</p><div class=tab-panel data-tab-group=b9f6a68de93cd039d899fad8d97e428a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srcstoresuserjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("b9f6a68de93cd039d899fad8d97e428a","srcstoresuserjs")'>
<span class=tab-nav-text>src/stores/User.js</span></button></div><div class=tab-content-container><div data-tab-item=srcstoresuserjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Define Store
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>useUserStore</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>defineStore</span>(<span style=color:#e6db74>&#39;user&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Actions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Save a user
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>saveUser</span>(<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>user</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>method</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;post&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/api/v1/users&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>id</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>method</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;put&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;/&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>api</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>method</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>url</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>url</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>data</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>user</span>.<span style=color:#a6e22e>value</span>,
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>then</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// rehydrate data
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>hydrate</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>      .<span style=color:#66d9ef>catch</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Error saving user!&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>error</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>error</span>
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Delete a user
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>deleteUser</span>(<span style=color:#a6e22e>id</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>api</span>
</span></span><span style=display:flex><span>      .<span style=color:#66d9ef>delete</span>(<span style=color:#e6db74>&#39;/api/v1/users/&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>then</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// rehydrate data
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>hydrate</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>response</span>
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>      .<span style=color:#66d9ef>catch</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Error deleting user!&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>error</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>error</span>;
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Return all state, getters, and actions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>users</span>, <span style=color:#a6e22e>roles</span>, <span style=color:#a6e22e>hydrate</span>, <span style=color:#a6e22e>saveUser</span>, <span style=color:#a6e22e>deleteUser</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>})</span></span></code></pre></div></div></div></div></div><p>As we can see in the code above, after each successful API call, we immediately call the <code>hydrate</code> method to update the contents of our <code>users</code> and <code>roles</code> list before passing the response back to the calling method. This ensures that our data is always in sync with the RESTful API backend anytime we make a change. In addition, we are carefully logging any errors we receive here, but we are still throwing the errors back to the calling method so they can be handled there as well.</p><p>That is the basic contents of our <code>Users</code> store, which we can use throughout our application.</p><h2 id=using-a-store---userslist>Using a Store - UsersList</h2><p>Now, let&rsquo;s look at how we can use our store in our various components that require data from the <code>Users</code> and <code>Roles</code> APIs. First, we can take a look at our existing <code>UsersList</code> component - there are many lines that we&rsquo;ll remove or change within the component. Each change is highlighted and described below, with removed lines commented out.</p><div class=tab-panel data-tab-group=8dfae43723fdd35c9750e256d3c1756e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersuserslistvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("8dfae43723fdd35c9750e256d3c1756e","srccomponentsusersuserslistvue")'>
<span class=tab-nav-text>src/components/users/UsersList.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersuserslistvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-vue data-lang=vue><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Create Reactive State
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// const users = ref([])
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// const roles = ref([])
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Stores
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>storeToRefs</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;pinia&#39;</span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useUserStore</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@/stores/User&#39;</span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>userStore</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useUserStore</span>();
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>users</span>, <span style=color:#a6e22e>roles</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>storeToRefs</span>(<span style=color:#a6e22e>userStore</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>&lt;/<span style=color:#f92672>script</span>&gt;</span></span></code></pre></div></div></div></div></div><p>First, we replace the two reactive state variables for <code>users</code> and <code>roles</code> with the same state variables that are extracted from the Pinia store using the <code>storeToRefs()</code> function, which will <a href=https://pinia.vuejs.org/core-concepts/#Destructuring-from-a-Store rel=external target=_blank>Destructure the Store</a> and make the variables directly available to our code.</p><div class=tab-panel data-tab-group=52aa7466d55ba57a671afc1475b1a14b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersuserslistvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("52aa7466d55ba57a671afc1475b1a14b","srccomponentsusersuserslistvue")'>
<span class=tab-nav-text>src/components/users/UsersList.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersuserslistvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-vue data-lang=vue><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Load Users
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//api
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//  .get(&#39;/api/v1/users&#39;)
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//  .then(function (response) {
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//    users.value = response.data
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//  })
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//  .catch(function (error) {
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//    console.log(error)
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//  })
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Load Roles
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//api
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//  .get(&#39;/api/v1/roles&#39;)
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//  .then(function (response) {
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//    roles.value = response.data
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//  })
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//  .catch(function (error) {
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//    console.log(error)
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//  })
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Hydrate Store
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#a6e22e>userStore</span>.<span style=color:#a6e22e>hydrate</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>&lt;/<span style=color:#f92672>script</span>&gt;</span></span></code></pre></div></div></div></div></div><p>Next, we can replace all of the code used to load the users and roles on the page to a simple call to the <code>hydrate</code> method in the store itself.</p><div class=tab-panel data-tab-group=d19e9803a0e14302ab11867069499717><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersuserslistvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d19e9803a0e14302ab11867069499717","srccomponentsusersuserslistvue")'>
<span class=tab-nav-text>src/components/users/UsersList.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersuserslistvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-vue data-lang=vue><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Delete User
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>deleteUser</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>id</span>) {
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#75715e>// api
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>  <span style=color:#75715e>//   .delete(&#39;/api/v1/users/&#39; + id)
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>  <span style=color:#a6e22e>userStore</span>.<span style=color:#a6e22e>deleteUser</span>(<span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>200</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>toast</span>.<span style=color:#a6e22e>add</span>({
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>severity</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;success&#39;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>summary</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Success&#39;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>detail</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>message</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>life</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5000</span>,
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex;background-color:#3c3d38><span>        <span style=color:#75715e>// Remove that element from the reactive array
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>        <span style=color:#75715e>// users.value.splice(
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>        <span style=color:#75715e>//   users.value.findIndex((u) =&gt; u.id == id),
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>        <span style=color:#75715e>//   1,
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>        <span style=color:#75715e>// )
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    .<span style=color:#66d9ef>catch</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>toast</span>.<span style=color:#a6e22e>add</span>({ <span style=color:#a6e22e>severity</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;error&#39;</span>, <span style=color:#a6e22e>summary</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Error&#39;</span>, <span style=color:#a6e22e>detail</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>error</span>, <span style=color:#a6e22e>life</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5000</span> })
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>&lt;/<span style=color:#f92672>script</span>&gt;</span></span></code></pre></div></div></div></div></div><p>Finally, in the method to delete a user, we can replace the API call with a call to the <code>deleteUser</code> method inside of the Pinia store to handle deleting the user with the selected ID. We can also remove the code that will remove the user from the list, since we no longer need to do that here; instead, the Pinia store will query the updated data from the RESTful API, and the user should no longer be present in that data when it is received.</p><p>Those are all of the changes needed to switch the <code>UsersList</code> component to use the store. The template itself remains exactly the same.</p><h2 id=using-a-store---useredit>Using a Store - UserEdit</h2><p>We can also update our <code>UserEdit</code> component in a similar way:</p><div class=tab-panel data-tab-group=72a7b888553b3ef4558b3c1d45cbe975><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersusereditvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("72a7b888553b3ef4558b3c1d45cbe975","srccomponentsusersusereditvue")'>
<span class=tab-nav-text>src/components/users/UserEdit.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersusereditvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-vue data-lang=vue><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>// Import Libraries
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>ref</span>, <span style=color:#a6e22e>computed</span>, <span style=color:#a6e22e>inject</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;vue&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Declare State
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// const user = ref({})
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// const roles = ref([])
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>errors</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ref</span>([])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Stores
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>storeToRefs</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;pinia&#39;</span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useUserStore</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@/stores/User&#39;</span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>userStore</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useUserStore</span>();
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>users</span>, <span style=color:#a6e22e>roles</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>storeToRefs</span>(<span style=color:#a6e22e>userStore</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Find single user or a blank user
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>user</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>computed</span>(() =&gt; {
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>find</span>((<span style=color:#a6e22e>u</span>) =&gt; <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>id</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>id</span>) <span style=color:#f92672>||</span> { <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>roles</span><span style=color:#f92672>:</span> [] })
</span></span><span style=display:flex;background-color:#3c3d38><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>&lt;/<span style=color:#f92672>script</span>&gt;</span></span></code></pre></div></div></div></div></div><p>First, we can replace the reactive state variables with the same variables from the Users store. To get a single user, we can create a computed state variable that will find the user in the list that matches the incoming <code>props.id</code>. If a user can&rsquo;t be found, it will generate a blank <code>User</code> object that can be used to create a new user.</p><p>Likewise, we can remove all of the code that loads users and roles and replace that with a <code>hydrate</code> function call in our Pinia store:</p><div class=tab-panel data-tab-group=5e00c9c7e2086707e66bee873a190f9d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersusereditvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5e00c9c7e2086707e66bee873a190f9d","srccomponentsusersusereditvue")'>
<span class=tab-nav-text>src/components/users/UserEdit.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersusereditvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-vue data-lang=vue><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Load Users
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// if (props.id) {
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//   api
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//     .get(&#39;/api/v1/users/&#39; + props.id)
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//     .then(function (response) {
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//       user.value = response.data
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//     })
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//     .catch(function (error) {
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//       console.log(error)
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//     })
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// } else {
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//   // Empty Value for User Object
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//   user.value = {
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//     username: &#39;&#39;,
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//     roles: [],
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//   }
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Load Roles
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// api
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//   .get(&#39;/api/v1/roles&#39;)
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//   .then(function (response) {
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//     roles.value = response.data
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//   })
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//   .catch(function (error) {
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//     console.log(error)
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>//   })
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#a6e22e>userStore</span>.<span style=color:#a6e22e>hydrate</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>&lt;/<span style=color:#f92672>script</span>&gt;</span></span></code></pre></div></div></div></div></div><p>Finally, we can replace the call to the <code>api</code> library to save the user with a call to the <code>saveUser</code> method in the <code>UserStore</code>:</p><div class=tab-panel data-tab-group=45351ff9e5dbf08428d5aaead4114083><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersusereditvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("45351ff9e5dbf08428d5aaead4114083","srccomponentsusersusereditvue")'>
<span class=tab-nav-text>src/components/users/UserEdit.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersusereditvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-vue data-lang=vue><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Save User
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>save</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>userStore</span>.<span style=color:#a6e22e>saveUser</span>(<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>201</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>toast</span>.<span style=color:#a6e22e>add</span>({
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>severity</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;success&#39;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>summary</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Success&#39;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>detail</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>message</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>life</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5000</span>,
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>push</span>({ <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;users&#39;</span> })
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    .<span style=color:#66d9ef>catch</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>422</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>toast</span>.<span style=color:#a6e22e>add</span>({
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>severity</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;warn&#39;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>summary</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Warning&#39;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>detail</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>error</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>life</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5000</span>,
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>errors</span>
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>toast</span>.<span style=color:#a6e22e>add</span>({ <span style=color:#a6e22e>severity</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;error&#39;</span>, <span style=color:#a6e22e>summary</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Error&#39;</span>, <span style=color:#a6e22e>detail</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>error</span>, <span style=color:#a6e22e>life</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5000</span> })
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;</span></span></code></pre></div></div></div></div></div><p>With those changes in place, we can also edit our users and create new users.</p><h2 id=using-a-store---roles>Using a Store - Roles</h2><p>Finally, we can update our <code>RolesList</code> to also use the store:</p><div class=tab-panel data-tab-group=f85310b6ece8bb4c535acdb93e8be936><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsrolesroleslistvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f85310b6ece8bb4c535acdb93e8be936","srccomponentsrolesroleslistvue")'>
<span class=tab-nav-text>src/components/roles/RolesList.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsrolesroleslistvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-vue data-lang=vue><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>setup</span>&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Stores
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>storeToRefs</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;pinia&#39;</span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useUserStore</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@/stores/User&#39;</span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>userStore</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useUserStore</span>();
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>roles</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>storeToRefs</span>(<span style=color:#a6e22e>userStore</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Hydrate Store
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#a6e22e>userStore</span>.<span style=color:#a6e22e>hydrate</span>()
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;</span></span></code></pre></div></div></div></div></div><p>At this point, all API calls to the <code>users</code> and <code>roles</code> endpoints should now be routed through our <code>User</code> Pinia store.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Image Source: <a href=https://vuejs.org/guide/components/provide-inject rel=external target=_blank>Pinia Documentation</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=reusing-components>Reusing Components</h1><a href="https://www.youtube.com/watch?v=6skldOnt7Sc">YouTube Video</a><h2 id=reusing-components>Reusing Components</h2><p>One of the many amazing features of a front-end framework such as Vue is the ability to reuse components in very powerful ways. For example, right now our application uses an entirely separate view and component to handle editing and updating users, but that means that we have to constantly jump back and forth between two views when working with users. Now that those views are using a shared Pinia store, we can use a <a href=https://primevue.org/dynamicdialog/ rel=external target=_blank>PrimeVue DynamicDialog</a> component to allow us to open the <code>UserEdit</code> component in a popup dialog on our <code>UsersList</code> component.</p><h2 id=installing-dynamicdialog>Installing DynamicDialog</h2><p>To begin, we must install the service for this component in our <code>src/main.js</code> along with the other services for PrimeVue components:</p><div class=tab-panel data-tab-group=f7e859e219aabd7511b5de8a311e3906><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srcmainjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f7e859e219aabd7511b5de8a311e3906","srcmainjs")'>
<span class=tab-nav-text>src/main.js</span></button></div><div class=tab-content-container><div data-tab-item=srcmainjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Main Vue application
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import Libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createApp</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;vue&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createPinia</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;pinia&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>PrimeVue</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;primevue/config&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Aura</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@primeuix/themes/aura&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Tooltip</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;primevue/tooltip&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>ToastService</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;primevue/toastservice&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>ConfirmationService</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;primevue/confirmationservice&#39;</span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>DialogService</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;primevue/dialogservice&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create Vue App
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createApp</span>(<span style=color:#a6e22e>App</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Install Libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>createPinia</span>())
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>router</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>PrimeVue</span>, {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Theme Configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>theme</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>preset</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Aura</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>options</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>darkModeSelector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;.app-dark-mode&#39;</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>ToastService</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>ConfirmationService</span>)
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>DialogService</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>Then, we can add the single instance of the component to our top-level <code>App.vue</code> component along with the other service components:</p><div class=tab-panel data-tab-group=cd20d7090ef4ee60cda5b1ac85ad75ae><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srcappvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("cd20d7090ef4ee60cda5b1ac85ad75ae","srcappvue")'>
<span class=tab-nav-text>src/App.vue</span></button></div><div class=tab-content-container><div data-tab-item=srcappvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-vue data-lang=vue><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>setup</span>&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Main Vue Application
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import Components
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Toast</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;primevue/toast&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>ConfirmDialog</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;primevue/confirmdialog&#39;</span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>DynamicDialog</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;primevue/dynamicdialog&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>TopMenu</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./components/layout/TopMenu.vue&#39;</span>
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>template</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>header</span>&gt;&lt;/<span style=color:#f92672>header</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>nav</span>&gt;
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!--</span> <span style=color:#a6e22e>Navigation</span> <span style=color:#a6e22e>Menu</span> <span style=color:#f92672>--&gt;</span>
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>TopMenu</span> /&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>nav</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>main</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;m-2&#34;</span>&gt;
</span></span><span style=display:flex><span>      <span style=color:#75715e>&lt;!--</span> <span style=color:#a6e22e>Main</span> <span style=color:#a6e22e>Application</span> <span style=color:#a6e22e>View</span> <span style=color:#f92672>--&gt;</span>
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>RouterView</span> /&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>main</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>footer</span>&gt;&lt;/<span style=color:#f92672>footer</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>Toast</span> <span style=color:#a6e22e>position</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;bottom-right&#34;</span> /&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>ConfirmDialog</span> /&gt;
</span></span><span style=display:flex;background-color:#3c3d38><span>  &lt;<span style=color:#f92672>DynamicDialog</span> /&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>template</span>&gt;</span></span></code></pre></div></div></div></div></div><p>That&rsquo;s all it takes to make this feature available throughout our application.</p><h2 id=updating-userslist-to-use-dynamicdialog>Updating UsersList to use DynamicDialog</h2><p>Now, in our <code>UsersList</code> component, we simply have to add a few imports as well as function to load the component in a dialog box:</p><div class=tab-panel data-tab-group=f2cff4ed8e0a1ebeeebeab97edb18c7d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersuserslistvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f2cff4ed8e0a1ebeeebeab97edb18c7d","srccomponentsusersuserslistvue")'>
<span class=tab-nav-text>src/components/users/UsersList.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersuserslistvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-vue data-lang=vue><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import Libraries
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>ref</span>, <span style=color:#a6e22e>defineAsyncComponent</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;vue&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>formatDistance</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;date-fns&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>DataTable</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;primevue/datatable&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Column</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;primevue/column&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>IconField</span>, <span style=color:#a6e22e>InputIcon</span>, <span style=color:#a6e22e>InputText</span>, <span style=color:#a6e22e>MultiSelect</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;primevue&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>FilterMatchMode</span>, <span style=color:#a6e22e>FilterService</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@primevue/core/api&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>RoleChip</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../roles/RoleChip.vue&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Button</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;primevue/button&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useRouter</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;vue-router&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>router</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useRouter</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useToast</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;primevue/usetoast&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>toast</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useToast</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useConfirm</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;primevue&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>confirm</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useConfirm</span>()
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useDialog</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;primevue/usedialog&#39;</span>;
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dialog</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useDialog</span>();
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>userEditComponent</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>defineAsyncComponent</span>(() =&gt; <span style=color:#66d9ef>import</span>(<span style=color:#e6db74>&#39;./UserEdit.vue&#39;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Load Dialog
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>editDialog</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>id</span>) {
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>dialog</span>.<span style=color:#a6e22e>open</span>(<span style=color:#a6e22e>userEditComponent</span>, {
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#a6e22e>props</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#a6e22e>style</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span>          <span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;40vw&#39;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>      },
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#a6e22e>modal</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex;background-color:#3c3d38><span>    },
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#a6e22e>data</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>id</span>
</span></span><span style=display:flex;background-color:#3c3d38><span>    }
</span></span><span style=display:flex;background-color:#3c3d38><span>  });
</span></span><span style=display:flex;background-color:#3c3d38><span>}
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;</span></span></code></pre></div></div></div></div></div><p>Notice in the <code>dialog.open</code> function call, we are including the <code>userEditComponent</code> that we are loading asynchronously in the background using the <code>defineAsyncComponent</code> function in Vue. This allows us to load the main <code>UsersList</code> component fully first, and then in the background it will load the <code>UserEdit</code> component as needed. We are also passing along the <code>id</code> of the user to be edited as part of the <code>data</code> that is sent to the component.</p><p>Finally, in the template, we just replace the click handlers for the <strong>New</strong> and <strong>Edit</strong> buttons to call this new <code>editDialog</code> function:</p><div class=tab-panel data-tab-group=97b7e01cc2e15dd0dab5b0933016c53b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersuserslistvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("97b7e01cc2e15dd0dab5b0933016c53b","srccomponentsusersuserslistvue")'>
<span class=tab-nav-text>src/components/users/UsersList.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersuserslistvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-vue data-lang=vue><span style=display:flex><span>&lt;<span style=color:#f92672>template</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>DataTable</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>:value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;users&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>v</span><span style=color:#f92672>-model:filters</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;filters&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>:globalFilterFields</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;[&#39;username&#39;]&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>filterDisplay</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;menu&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sortField</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;username&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>:sortOrder</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>  &gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>template</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>header</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flex justify-between&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Button</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>label</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;New User&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>icon</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pi pi-user-plus&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>severity</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;success&#34;</span>
</span></span><span style=display:flex;background-color:#3c3d38><span>          <span style=color:#f92672>@click</span><span style=color:#e6db74>=&#34;editDialog()&#34;</span>
</span></span><span style=display:flex><span>        /&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!--</span> <span style=color:#a6e22e>other</span> <span style=color:#a6e22e>code</span> <span style=color:#a6e22e>omitted</span> <span style=color:#a6e22e>here</span> <span style=color:#f92672>--&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>template</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!--</span> <span style=color:#a6e22e>other</span> <span style=color:#a6e22e>code</span> <span style=color:#a6e22e>omitted</span> <span style=color:#a6e22e>here</span> <span style=color:#f92672>--&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>Column</span> <span style=color:#a6e22e>header</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Actions&#34;</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;min-width: 8rem&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>template</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>body</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;slotProps&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flex gap-2&#34;</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>Button</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>icon</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pi pi-pencil&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>outlined</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rounded</span>
</span></span><span style=display:flex;background-color:#3c3d38><span>            <span style=color:#f92672>@click</span><span style=color:#e6db74>=&#34;editDialog(slotProps.data.id)&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>v</span><span style=color:#f92672>-tooltip</span><span style=color:#a6e22e>.bottom</span><span style=color:#960050;background-color:#1e0010>=&#34;&#39;</span><span style=color:#a6e22e>Edit</span><span style=color:#960050;background-color:#1e0010>&#39;&#34;</span>
</span></span><span style=display:flex><span>          /&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>Button</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>icon</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;pi pi-trash&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>outlined</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>rounded</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>severity</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;danger&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>@click</span><span style=color:#e6db74>=&#34;confirmDelete(slotProps.data.id)&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>v</span><span style=color:#f92672>-tooltip</span><span style=color:#a6e22e>.bottom</span><span style=color:#960050;background-color:#1e0010>=&#34;&#39;</span><span style=color:#a6e22e>Delete</span><span style=color:#960050;background-color:#1e0010>&#39;&#34;</span>
</span></span><span style=display:flex><span>          /&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>template</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>Column</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>DataTable</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>template</span>&gt;</span></span></code></pre></div></div></div></div></div><p>Now, when we click those buttons, it will open the <code>EditUser</code> component in a modal popup dialog instead of directing users to a new route. Of course, on some pages, we may need to check that the user has specific roles before allowing the user to actually load the popup, just like we have to check for those roles before the user navigates to those routes. Since we are now bypassing the Vue Router, any logic in the router may need to be recreated here.</p><h2 id=updating-useredit-component>Updating UserEdit Component</h2><p>Finally, we must make a few minor tweaks to the <code>UserEdit</code> component so that it can run seamlessly in both a stand-alone view as well as part of a popup dialog. The major change comes in the way the incoming data is received, and what should happen when the user is successfully saved.</p><p>The PrimeVue DynamicDialog service uses Vue&rsquo;s <a href=https://vuejs.org/guide/components/provide-inject rel=external target=_blank>Provide / Inject</a> interface to send data to the component loaded in a dialog. So, in our component, we must declare a few additional state variables, as well as small piece of code to detect whether it is running in a dialog or as a standalone component in a view.</p><div class=tab-panel data-tab-group=6debb89586fc114469c8c0da7ae96f8a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersusereditvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6debb89586fc114469c8c0da7ae96f8a","srccomponentsusersusereditvue")'>
<span class=tab-nav-text>src/components/users/UserEdit.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersusereditvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-vue data-lang=vue><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>setup</span>&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>// Import Libraries
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>ref</span>, <span style=color:#a6e22e>computed</span>, <span style=color:#a6e22e>inject</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;vue&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Declare State
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>errors</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ref</span>([])
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isDialog</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ref</span>(<span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>userId</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ref</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Detect Dialog
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dialogRef</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>inject</span>(<span style=color:#e6db74>&#39;dialogRef&#39;</span>)
</span></span><span style=display:flex;background-color:#3c3d38><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>dialogRef</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>dialogRef</span>.<span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#75715e>// running in a dialog
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>  <span style=color:#a6e22e>isDialog</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>userId</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>dialogRef</span>.<span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex;background-color:#3c3d38><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#75715e>// running in a view
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>  <span style=color:#a6e22e>userId</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex;background-color:#3c3d38><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>&lt;/<span style=color:#f92672>script</span>&gt;</span></span></code></pre></div></div></div></div></div><p>For this component, we have created a new <code>isDialog</code> reactive state variable that will be set to <code>true</code> if the component detects it has been loaded in a dynamic dialog. It does this by checking for the status of the <code>dialogRef</code> injected state variable. We are also now storing the ID of the user to be edited in a new <code>userId</code> reactive state variable instead of relying on the <code>props.id</code> variable, which will not be present when the component is loaded in a dialog.</p><p>So, we simply need to replace all references to <code>props.id</code> to use <code>userId</code> instead. We can also change the action that occurs when the user is successfully saved - if the component is running in a dialog, it should simply close the dialog instead of using the router to navigate back to the previous page.</p><div class=tab-panel data-tab-group=acb5d26ef752614da42f06e7074a4705><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersusereditvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("acb5d26ef752614da42f06e7074a4705","srccomponentsusersusereditvue")'>
<span class=tab-nav-text>src/components/users/UserEdit.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersusereditvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-vue data-lang=vue><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>setup</span>&gt;
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Find Single User
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>user</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>computed</span>(() =&gt; {
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>find</span>((<span style=color:#a6e22e>u</span>) =&gt; <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>id</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>userId</span>.<span style=color:#a6e22e>value</span>) <span style=color:#f92672>||</span> { <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span>, <span style=color:#a6e22e>roles</span><span style=color:#f92672>:</span> [] }
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Save User
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>save</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>userStore</span>
</span></span><span style=display:flex;background-color:#3c3d38><span>    .<span style=color:#a6e22e>saveUser</span>(<span style=color:#a6e22e>userId</span>.<span style=color:#a6e22e>value</span>, <span style=color:#a6e22e>user</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>then</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>201</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>toast</span>.<span style=color:#a6e22e>add</span>({
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>severity</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;success&#39;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>summary</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Success&#39;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>detail</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>message</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>life</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5000</span>,
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex;background-color:#3c3d38><span>        <span style=color:#a6e22e>leave</span>()
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    .<span style=color:#66d9ef>catch</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>422</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>toast</span>.<span style=color:#a6e22e>add</span>({
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>severity</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;warn&#39;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>summary</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Warning&#39;</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>detail</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>error</span>,
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>life</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5000</span>,
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>errors</span>
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>toast</span>.<span style=color:#a6e22e>add</span>({ <span style=color:#a6e22e>severity</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;error&#39;</span>, <span style=color:#a6e22e>summary</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Error&#39;</span>, <span style=color:#a6e22e>detail</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>error</span>, <span style=color:#a6e22e>life</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5000</span> })
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Leave Component
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>leave</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>() {
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isDialog</span>.<span style=color:#a6e22e>value</span>) {
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#a6e22e>dialogRef</span>.<span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>close</span>()
</span></span><span style=display:flex;background-color:#3c3d38><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>push</span>({ <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;users&#39;</span> })
</span></span><span style=display:flex;background-color:#3c3d38><span>  }
</span></span><span style=display:flex;background-color:#3c3d38><span>}
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;</span></span></code></pre></div></div></div></div></div><p>Finally, we can make a minor update to the template to also use the <code>userId</code> value instead of <code>props.id</code></p><div class=tab-panel data-tab-group=e43a0aba6948e58211cc3b6de998241e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersusereditvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e43a0aba6948e58211cc3b6de998241e","srccomponentsusersusereditvue")'>
<span class=tab-nav-text>src/components/users/UserEdit.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersusereditvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-vue data-lang=vue><span style=display:flex><span>&lt;<span style=color:#f92672>template</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;flex flex-col gap-3 max-w-xl justify-items-center&#34;</span>&gt;
</span></span><span style=display:flex;background-color:#3c3d38><span>    &lt;<span style=color:#f92672>h1</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text-xl text-center m-1&#34;</span>&gt;{{ <span style=color:#a6e22e>userId</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;Edit User&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;New User&#39;</span> }}&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!--</span> <span style=color:#a6e22e>other</span> <span style=color:#a6e22e>code</span> <span style=color:#a6e22e>omitted</span> <span style=color:#a6e22e>here</span> <span style=color:#f92672>--&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span>    &lt;<span style=color:#f92672>Button</span> <span style=color:#a6e22e>severity</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;secondary&#34;</span> <span style=color:#f92672>@click</span><span style=color:#e6db74>=&#34;leave&#34;</span> <span style=color:#a6e22e>label</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Cancel&#34;</span> /&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>template</span>&gt;</span></span></code></pre></div></div></div></div></div><p>That&rsquo;s all it takes! Now, when we click the <strong>New User</strong> or <strong>Edit User</strong> buttons on our <code>UsersList</code> component, we&rsquo;ll see a pop-up dialog that contains our <code>UserEdit</code> component instead of being taken to an entirely new page.</p><p><a href=#R-image-f79396c3d102b489850002ad3ecfedb2 class=lightbox-link><img alt=DynamicDialog class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/07/dynamicdialog.gif style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f79396c3d102b489850002ad3ecfedb2><img alt=DynamicDialog class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/07/dynamicdialog.gif></a></p><h2 id=a-bug-reactive-state-across-components>A Bug! Reactive State Across Components</h2><p>A very keen eye may notice a bug in the implementation of this component already - what if the user changes a value but then clicks the <strong>Cancel</strong> button on the modal dialog? Let&rsquo;s see what that looks like:</p><p><a href=#R-image-eb124da2caa9ce3218ad707fba92f11d class=lightbox-link><img alt=DynamicDialogBug class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/07/dynamicdialogbug.gif style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-eb124da2caa9ce3218ad707fba92f11d><img alt=DynamicDialogBug class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/07/dynamicdialogbug.gif></a></p><p>As we can see, the edits made in the <code>UserEdit</code> dialog are immediately reflected in the contents of the <code>UsersList</code> component as well. This is because they are both using the same Pinia store and referencing the same list of users in both components. So, this can present all sorts of strange issues in our program.</p><p>There are at least a couple of different ways we can go about fixing this:</p><ol><li>When the dialog closes, we can call <code>userStore.hydrate()</code> from the <code>UsersList</code> component to ensure that it has the latest version of the data from the server. However, if we do this, we could end up calling it twice when a user is saved, since the <code>User</code> store already does this.</li><li>In our <code>EditUser</code> component, we can make sure we are editing a deep copy of our user, and not the same user reference as the one in our Pinia store.</li></ol><p>Let&rsquo;s implement the second solution. Thankfully, it is as simple as using <code>JSON.parse</code> and <code>JSON.stringify</code> to create a quick deep copy of the user we are editing. We can do this in our computed Vue state variable in that component:</p><div class=tab-panel data-tab-group=88e807fec370f32616f5923af2c8d422><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersusereditvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("88e807fec370f32616f5923af2c8d422","srccomponentsusersusereditvue")'>
<span class=tab-nav-text>src/components/users/UserEdit.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersusereditvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-vue data-lang=vue><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Find Single User
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>user</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>computed</span>(() =&gt; {
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>users</span>.<span style=color:#a6e22e>value</span>.<span style=color:#a6e22e>find</span>((<span style=color:#a6e22e>u</span>) =&gt; <span style=color:#a6e22e>u</span>.<span style=color:#a6e22e>id</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>userId</span>.<span style=color:#a6e22e>value</span>) <span style=color:#f92672>||</span> { <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span>, <span style=color:#a6e22e>roles</span><span style=color:#f92672>:</span> [] }),
</span></span><span style=display:flex;background-color:#3c3d38><span>  )
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>// -=-=- other code omitted here -=-=-</span></span></span></code></pre></div></div></div></div></div><p>With that change in place, we no longer see the bug in our output:</p><p><a href=#R-image-cef01302b4f5c4a7802b9c951682b6b7 class=lightbox-link><img alt="DynamicDialog Fixed" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/07/dynamicdialogfixed.gif style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cef01302b4f5c4a7802b9c951682b6b7><img alt="DynamicDialog Fixed" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/07/dynamicdialogfixed.gif></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=preparing-for-deployment>Preparing for Deployment</h1><a href="https://www.youtube.com/watch?v=b1WeopVfwfU">YouTube Video</a><h2 id=preparing-for-deployment>Preparing for Deployment</h2><p>At this point, we have a pretty well developed application, so let&rsquo;s start preparing for deployment. Our end goal is to build a single Docker container that contains our application, as well as the ability to deploy it along with a production database like <a href=https://www.postgresql.org/ rel=external target=_blank>Postgres</a>.</p><p>To begin, we need to create a finalized version of our Vue frontend that can be embedded into our backend application directly.</p><h2 id=building-in-vue>Building in Vue</h2><p>To create a deployment build of our Vue application, we can simply run the following command in the <code>client</code> folder of our application:</p><div class=tab-panel data-tab-group=e9145ce67af6241e8bb743abe7b3fabf><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e9145ce67af6241e8bb743abe7b3fabf","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm run build</span></span></code></pre></div></div></div></div></div><p>When we run that command, we get lots of output about the different parts of our application that are put together to make the final version. We may also get some warnings about chunks being larger than the cutoff, which we won&rsquo;t worry about for now.</p><p>The final version of our application can be found in a new <code>dist</code> folder inside of our <code>client</code> folder, with a long list of contents:</p><p><a href=#R-image-e7df8951e388023de36ffdb51304b062 class=lightbox-link><img alt="Dist Folder Contents" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/07/build_dist.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e7df8951e388023de36ffdb51304b062><img alt="Dist Folder Contents" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/07/build_dist.png></a></p><p>The <code>assets</code> folder contains a large number of items that are all compiled and assembled by the Vite build tool for our application. The key file, however, is the <code>index.html</code> file, which is placed there to serve as the starting point for our application.</p><h2 id=testing-the-built-application>Testing the Built Application</h2><p>To fully test this application, we can simply copy the entire contents of the <code>client/dist</code> folder into the <code>server/public</code> folder, overwriting the existing <code>index.html</code> file in that location.</p><p><a href=#R-image-99cfbb6f903147ee2013a00168d6da91 class=lightbox-link><img alt="Public Folder Contents" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/07/deploy_1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-99cfbb6f903147ee2013a00168d6da91><img alt="Public Folder Contents" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/07/deploy_1.png></a></p><p>In addition, if we&rsquo;ve changed any of the settings in the <code>.env</code> file to refer to the client in development mode, such as the <code>CAS_SERVICE_URL</code> or <code>OPENAPI_HOST</code>, we&rsquo;ll need to change those back to using our server port.</p><p>Now, all we have to do is run the server in development mode, but we don&rsquo;t need to start the client at all:</p><div class=tab-panel data-tab-group=8af42f7330e245cdb284ee1e22a2b336><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("8af42f7330e245cdb284ee1e22a2b336","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm run dev</span></span></code></pre></div></div></div></div></div><p>When the application loads, we can open our web browser on port 3000 (or whichever port our application is configured to use), and we should be greeted with a working version of our application!</p><p><a href=#R-image-3a2d85fdd46a27c2b5dc09ab83475a77 class=lightbox-link><img alt="Working App" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/07/deploy_2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-3a2d85fdd46a27c2b5dc09ab83475a77><img alt="Working App" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/07/deploy_2.png></a></p><p>However, we quickly notice that our placeholder image is no longer appearing in our top menu bar. A quick peek at the console in our browser gives us more information:</p><p><a href=#R-image-fdea1637675aa7442e8a13f29668f6c6 class=lightbox-link><img alt="Broken Image" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/07/deploy_3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fdea1637675aa7442e8a13f29668f6c6><img alt="Broken Image" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/07/deploy_3.png></a></p><p>A bit of online searching can reveal this error - the <a href=https://helmetjs.github.io/ rel=external target=_blank>helmet</a> middleware we are using will prevent images from loading unless they are hosted on our own domain or if they are retrieved from memory using a <code>data:</code> URL. Since we want to allow our placeholder image to load, we can simply update the settings for <code>helmet</code> to allow this in our <code>server/app.js</code> file:</p><div class=tab-panel data-tab-group=4d7cd497d8c095f341127e7471611599><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=appjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4d7cd497d8c095f341127e7471611599","appjs")'>
<span class=tab-nav-text>app.js</span></button></div><div class=tab-content-container><div data-tab-item=appjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// Use libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>express</span>.<span style=color:#a6e22e>json</span>());
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>express</span>.<span style=color:#a6e22e>urlencoded</span>({ <span style=color:#a6e22e>extended</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span> }));
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>helmet</span>({
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>contentSecurityPolicy</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#a6e22e>useDefaults</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#a6e22e>directives</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#e6db74>&#34;img-src&#34;</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;&#39;self&#39;&#34;</span>, <span style=color:#e6db74>&#34;https:&#34;</span>],
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#e6db74>&#34;connect-src&#34;</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;&#39;self&#39;&#34;</span>, <span style=color:#e6db74>&#34;blob:&#34;</span>],
</span></span><span style=display:flex;background-color:#3c3d38><span>    }
</span></span><span style=display:flex;background-color:#3c3d38><span>  }
</span></span><span style=display:flex><span>}));
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>compression</span>());
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>cookieParser</span>());</span></span></code></pre></div></div></div></div></div><p>With that change in place, our placeholder image will now load since it is using an <code>https</code> URL. It will also allow us to properly upload files using the <code>blob:</code> URLs.</p><p>Another issue we&rsquo;ll quickly run into is that anytime we refresh our application on any page other than the homepage, we&rsquo;ll end up with a 404 error message! This is because the server does not know to properly redirect those requests back to the Vue application&rsquo;s router. We can get around that by installing one more middleware, the <a href=https://www.npmjs.com/package/connect-history-api-fallback rel=external target=_blank>connect-history-api-fallback
</a>middleware in our server&rsquo;s <code>app.js</code> file. We&rsquo;ll also need to disable the <code>indexRouter</code> since it is no longer needed, and move the static files and this new middleware to after the authentication routes to allow our application to properly redirect to CAS.</p><div class=tab-panel data-tab-group=0980c20bc872cc0c957e99335d1dac41><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0980c20bc872cc0c957e99335d1dac41","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm install connect-history-api-fallback</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=a6daf71b44a88ae9a6b1794ac02eccc9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=appjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a6daf71b44a88ae9a6b1794ac02eccc9","appjs")'>
<span class=tab-nav-text>app.js</span></button></div><div class=tab-content-container><div data-tab-item=appjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>compression</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;compression&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>cookieParser</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;cookie-parser&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>express</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;express&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>helmet</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;helmet&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>path</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;path&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>swaggerUi</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;swagger-ui-express&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>fs</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;node:fs/promises&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>passport</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;passport&#34;</span>;
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>history</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;connect-history-api-fallback&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Use middlewares
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>requestLogger</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Use routers
</span></span></span><span style=display:flex><span><span style=color:#75715e>//app.use(&#34;/&#34;, indexRouter);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#34;/api&#34;</span>, <span style=color:#a6e22e>apiRouter</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Use sessions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>sessions</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>passport</span>.<span style=color:#a6e22e>authenticate</span>(<span style=color:#e6db74>&#34;session&#34;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Use auth routes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#34;/auth&#34;</span>, <span style=color:#a6e22e>authRouter</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Redirect other requests to Vue application
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>history</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Use static files
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>express</span>.<span style=color:#66d9ef>static</span>(<span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>join</span>(<span style=color:#66d9ef>import</span>.<span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>dirname</span>, <span style=color:#e6db74>&#34;public&#34;</span>)));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>Now, when we refresh our application on any route that is not recognized by the server, it will direct those requests to the Vue application.</p><h2 id=updating-gitignore-files>Updating GitIgnore Files</h2><p>Finally, we should double-check our <code>.gitignore</code> files on both the <code>server</code> and the <code>client</code> to ensure that the built version of our project is not committed to git. In the <code>client/.gitignore</code> file, we already see an entry for <code>dist</code>, so we know that the <code>dist</code> folder and all of its contents will not be committed to git already.</p><p>In the <code>server/.gitignore</code> file, we should add a line to ignore the <code>public</code> folder to the bottom of the file. Then, we can use <code>git rm -r --cached public</code> from within the <code>server</code> folder to remove it from our git index before committing.</p><p>At this point, we can do one last lint, format, commit, and push before we set up our application for deployment!</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Ignoring Files in ESLint</summary><div class=box-content><p>We may run into issues with ESLint trying to clean up our production version of our code if it is stored in the <code>public</code> folder of our <code>server</code> directory. We can ignore it by adding a few lines to the <code>server/eslint.config.js</code> file:</p><div class=tab-panel data-tab-group=09aee13d59b900d02dcae0aa8b791405><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=eslintconfigjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("09aee13d59b900d02dcae0aa8b791405","eslintconfigjs")'>
<span class=tab-nav-text>eslint.config.js</span></button></div><div class=tab-content-container><div data-tab-item=eslintconfigjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>globals</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;globals&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>pluginJs</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;@eslint/js&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @type {import(&#39;eslint&#39;).Linter.Config[]} */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> [
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>languageOptions</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>globals</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        ...<span style=color:#a6e22e>globals</span>.<span style=color:#a6e22e>node</span>,
</span></span><span style=display:flex><span>        ...<span style=color:#a6e22e>globals</span>.<span style=color:#a6e22e>mocha</span>,
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rules</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;no-unused-vars&#34;</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;error&#34;</span>, { <span style=color:#a6e22e>argsIgnorePattern</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;next&#34;</span> }],
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;no-console&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;error&#34;</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex;background-color:#3c3d38><span>  {
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#a6e22e>ignores</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;public/*&#34;</span>],
</span></span><span style=display:flex;background-color:#3c3d38><span>  },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pluginJs</span>.<span style=color:#a6e22e>configs</span>.<span style=color:#a6e22e>recommended</span>,
</span></span><span style=display:flex><span>];</span></span></code></pre></div></div></div></div></div><p>This will tell ESLint to ignore all files in the <code>public</code> directory.</p></div></details><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=dockerfile>Dockerfile</h1><a href="https://www.youtube.com/watch?v=iX5whyRpZJ0">YouTube Video</a><h2 id=dockerfile>Dockerfile</h2><p>We are now ready to create a <code>Dockerfile</code> that will build our application into a single Docker container that can be easily deployed in a variety of different infrastructures. Because our application is really two parts (the <strong>server</strong> and the <strong>client</strong>), we can use a <a href=https://docs.docker.com/get-started/docker-concepts/building-images/multi-stage-builds/ rel=external target=_blank>Multi-Stage Build</a> in Docker to make a very streamlined version of our image.</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Docker Init</summary><div class=box-content><p>In this tutorial, we&rsquo;ll go through building this <code>Dockerfile</code> manually. On systems that have Docker Desktop already installed, we can run <code>docker init</code> to scaffold some of this process. See the documentation for <a href=https://docs.docker.com/reference/cli/docker/init/ rel=external target=_blank>Docker Init</a> for more details on how to use that tool.</p></div></details><h2 id=building-the-client>Building the Client</h2><p>We&rsquo;ll start by creating a new <code>Dockerfile</code> outside of both the <code>client</code> and <code>server</code> folders, so it is at the top level of our project. At the top of the file, we&rsquo;ll add a simple <code>ARG</code> entry to denote the version of Node.js we want to use:</p><div class=tab-panel data-tab-group=c50e829ea0d3333860bc34537082b02b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=dockerfile class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c50e829ea0d3333860bc34537082b02b","dockerfile")'>
<span class=tab-nav-text>Dockerfile</span></button></div><div class=tab-content-container><div data-tab-item=dockerfile class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span><span style=color:#75715e># Node Version</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ARG</span> NODE_VERSION<span style=color:#f92672>=</span><span style=color:#ae81ff>22</span></span></span></code></pre></div></div></div></div></div><p>Next, we need to chose the Docker image we want to use to build our client. There are many different options to choose from, but we can look at the <a href=https://hub.docker.com/_/node/ rel=external target=_blank>Official Docker Node</a> package list to find the correct one fo our project. In this case, we&rsquo;ll use the image <code>22-alpine</code> as the basis for our Docker image. When building Docker images for deployment, we often look for images based on the Alpine Linux distribution, which is very lightweight and generally more secure since it only contains the bare minimum set of features needed for our application. We can read more about using Alpine Docker images in the <a href=https://www.docker.com/blog/how-to-use-the-alpine-docker-official-image/ rel=external target=_blank>Docker Blog</a></p><p>So, we&rsquo;ll add a <code>FROM</code> entry to define the source of our build process, and we&rsquo;ll name this container <code>client</code> to help us keep track of it.</p><div class=tab-panel data-tab-group=b34e9e59bcb3dc48de65b2995d62457c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=dockerfile class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("b34e9e59bcb3dc48de65b2995d62457c","dockerfile")'>
<span class=tab-nav-text>Dockerfile</span></button></div><div class=tab-content-container><div data-tab-item=dockerfile class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span><span style=color:#75715e># Node Version</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ARG</span> NODE_VERSION<span style=color:#f92672>=</span><span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Client Base Image</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># See https://hub.docker.com/_/node/</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:${NODE_VERSION}-alpine as client</span></span></span></code></pre></div></div></div></div></div><p>Now, we need to actually build our application. This usually involves 2 steps:</p><ol><li>Copy our code to the container image</li><li>Run the build process to build our application</li></ol><p>However, we can further optimize this by realizing that we can further separate this by installing all of our Node libraries first, then building our application. Since each step creates a new <a href=https://docs.docker.com/get-started/docker-concepts/building-images/understanding-image-layers/ rel=external target=_blank>Docker Image Layer</a>, we can make our images more efficient by spreading these steps out.</p><p>By doing so, if we make a change to the source code of our application, but we don&rsquo;t change the underlying Node libraries, we can reuse that earlier image layer containing our libraries since we know that it hasn&rsquo;t changed at all. We can read more about this in the <a href=https://docs.docker.com/build/cache/optimize/ rel=external target=_blank>Docker Documentation</a> on optimizing builds by using caching.</p><p>In practice, the steps will look like this:</p><div class=tab-panel data-tab-group=8319851aae8d15eafd2298ab9a6975aa><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=dockerfile class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("8319851aae8d15eafd2298ab9a6975aa","dockerfile")'>
<span class=tab-nav-text>Dockerfile</span></button></div><div class=tab-content-container><div data-tab-item=dockerfile class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span><span style=color:#75715e># Node Version</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ARG</span> NODE_VERSION<span style=color:#f92672>=</span><span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>###############################</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># STAGE 1 - BUILD CLIENT      #</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>###############################</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Client Base Image</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># See https://hub.docker.com/_/node/</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:${NODE_VERSION}-alpine as client</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Use production node environment by default</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> NODE_ENV production<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Store files in /usr/src/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /usr/src/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Download dependencies as a separate step to take advantage of Docker&#39;s caching.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Leverage a cache mount to /root/.npm to speed up subsequent builds.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Leverage a bind mounts to package.json and package-lock.json to avoid having to copy them into</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># into this layer.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># See https://docs.docker.com/build/cache/optimize/</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>bind,source<span style=color:#f92672>=</span>client/package.json,target<span style=color:#f92672>=</span>package.json <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>bind,source<span style=color:#f92672>=</span>client/package-lock.json,target<span style=color:#f92672>=</span>package-lock.json <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>cache,target<span style=color:#f92672>=</span>/root/.npm <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    npm ci --include<span style=color:#f92672>=</span>dev<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Copy the rest of the source files into the image.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> ./client .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Build the client application</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm run build</span></span></code></pre></div></div></div></div></div><p>At the end of this process, we&rsquo;ll have a Docker image named <code>client</code> that contains a completely compiled version of our application in the <code>/usr/src/app/dist</code> folder. That&rsquo;s really the important outcome of this process.</p><h2 id=building-the-server>Building the Server</h2><p>On the server side of things, there are several files and folders we want to make sure are not included in our final Docker image. So, we can create a file <code>server/.dockerignore</code> with the following contents:</p><div class=tab-panel data-tab-group=249131f1891fcc7b7b1ec79b7bb68335><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=dockerignore class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("249131f1891fcc7b7b1ec79b7bb68335","dockerignore")'>
<span class=tab-nav-text>.dockerignore</span></button></div><div class=tab-content-container><div data-tab-item=dockerignore class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0><code class=language-dockerignore data-lang=dockerignore>node_modules
coverage
.env
.env.example
.env.test
.prettierrc
database.sqlite
eslint.config.js
public</code></pre></div></div></div></div></div><p>These are all folders and files that contain information we don&rsquo;t want to include for a variety of security reasons.</p><p>Now, we can initiate the second stage of this build process, which will create a finalized version of our server to run our application. We&rsquo;ll continue building this in the same <code>Dockerfile</code> below the first stage. The first few steps are mostly identical to the client, except this time we are referencing content in the <code>server</code> folder.</p><div class=tab-panel data-tab-group=c9e519f8eac6e1bfa49899b6b32b8d8a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=dockerfile class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c9e519f8eac6e1bfa49899b6b32b8d8a","dockerfile")'>
<span class=tab-nav-text>Dockerfile</span></button></div><div class=tab-content-container><div data-tab-item=dockerfile class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span><span style=color:#75715e>#  -=-=- other code omitted here -=-=-</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>###############################</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># STAGE 2 - BUILD SERVER      #</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>###############################</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Server Base Image</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># See https://hub.docker.com/_/node/</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:${NODE_VERSION}-alpine as server</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Use production node environment by default</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> NODE_ENV production<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Store files in /usr/src/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /usr/src/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Download dependencies as a separate step to take advantage of Docker&#39;s caching.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Leverage a cache mount to /root/.npm to speed up subsequent builds.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Leverage a bind mounts to package.json and package-lock.json to avoid having to copy them into</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># into this layer.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># See https://docs.docker.com/build/cache/optimize/</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>bind,source<span style=color:#f92672>=</span>server/package.json,target<span style=color:#f92672>=</span>package.json <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>bind,source<span style=color:#f92672>=</span>server/package-lock.json,target<span style=color:#f92672>=</span>package-lock.json <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>cache,target<span style=color:#f92672>=</span>/root/.npm <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    npm ci --omit<span style=color:#f92672>=</span>dev<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Copy the rest of the source files into the image</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> ./server .</span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Node Dev Dependencies</summary><div class=box-content><p>Notice that the <code>client</code> build step uses <code>npm ci --include=dev</code> to include the development dependencies for the Vue.js project. These dependencies include tools such as Vite that are actually required to build the project for production, so we have to make sure they are installed.</p><p>In the <code>server</code> build step, however, we are using <code>npm ci --omit=dev</code> to omit any development dependencies from being installed in the container. These dependencies should be tools such as Nodemon and ESLint, which we won&rsquo;t need in the deployed version of our application.</p><p>If we run into errors at either of these steps, we may need to ensure that each Node dependency is properly included in the correct place of the respective <code>package.json</code> file for each project.</p></div></details><p>Once we have installed the libraries and copied the contents of the <code>server</code> folder into the <code>server</code> image, we can also copy the <code>/usr/src/app/dist</code> folder from the <code>client</code> image into the <code>public</code> folder of the <code>server</code> image.</p><div class=tab-panel data-tab-group=bc791f7ae85039cdfdd00ca85653b9cb><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=dockerfile class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("bc791f7ae85039cdfdd00ca85653b9cb","dockerfile")'>
<span class=tab-nav-text>Dockerfile</span></button></div><div class=tab-content-container><div data-tab-item=dockerfile class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span><span style=color:#75715e>#  -=-=- other code omitted here -=-=-</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>###############################</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># STAGE 2 - BUILD SERVER      #</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>###############################</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Server Base Image</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># See https://hub.docker.com/_/node/</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:${NODE_VERSION}-alpine as server</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Use production node environment by default</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> NODE_ENV production<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Store files in /usr/src/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /usr/src/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Download dependencies as a separate step to take advantage of Docker&#39;s caching.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Leverage a cache mount to /root/.npm to speed up subsequent builds.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Leverage a bind mounts to package.json and package-lock.json to avoid having to copy them into</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># into this layer.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># See https://docs.docker.com/build/cache/optimize/</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>bind,source<span style=color:#f92672>=</span>server/package.json,target<span style=color:#f92672>=</span>package.json <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>bind,source<span style=color:#f92672>=</span>server/package-lock.json,target<span style=color:#f92672>=</span>package-lock.json <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>cache,target<span style=color:#f92672>=</span>/root/.npm <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    npm ci --omit<span style=color:#f92672>=</span>dev<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Copy the rest of the source files into the image</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> ./server .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Copy the built version of the client into the image</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>client /usr/src/app/dist ./public</span></span></code></pre></div></div></div></div></div><p>Then, we&rsquo;ll need to make a couple of directories in our container that we can use as volume mounts when we deploy it. These directories will contain our database and our uploaded files:</p><div class=tab-panel data-tab-group=d722e654894c975bb453ddb0d9b14e20><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=dockerfile class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d722e654894c975bb453ddb0d9b14e20","dockerfile")'>
<span class=tab-nav-text>Dockerfile</span></button></div><div class=tab-content-container><div data-tab-item=dockerfile class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span><span style=color:#75715e>#  -=-=- other code omitted here -=-=-</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>###############################</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># STAGE 2 - BUILD SERVER      #</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>###############################</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Server Base Image</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># See https://hub.docker.com/_/node/</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:${NODE_VERSION}-alpine as server</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Use production node environment by default</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> NODE_ENV production<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Store files in /usr/src/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /usr/src/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Download dependencies as a separate step to take advantage of Docker&#39;s caching.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Leverage a cache mount to /root/.npm to speed up subsequent builds.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Leverage a bind mounts to package.json and package-lock.json to avoid having to copy them into</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># into this layer.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># See https://docs.docker.com/build/cache/optimize/</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>bind,source<span style=color:#f92672>=</span>server/package.json,target<span style=color:#f92672>=</span>package.json <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>bind,source<span style=color:#f92672>=</span>server/package-lock.json,target<span style=color:#f92672>=</span>package-lock.json <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>cache,target<span style=color:#f92672>=</span>/root/.npm <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    npm ci --omit<span style=color:#f92672>=</span>dev<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Copy the rest of the source files into the image</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> ./server .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Copy the built version of the client into the image</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>client /usr/src/app/dist ./public<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Make a directory for the database and make it writable</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir -p ./data<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> chown -R node:node ./data<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Make a directory for the uploads and make it writable</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir -p ./public/uploads<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> chown -R node:node ./public/uploads</span></span></code></pre></div></div></div></div></div><p>Finally, we&rsquo;ll end by defining the user the container should use, the default port of our application, a command to check if the application in the container is healthy, and the command to start our application.</p><div class=tab-panel data-tab-group=5012c6d31d6936ecae03e6986b969da0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=dockerfile class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5012c6d31d6936ecae03e6986b969da0","dockerfile")'>
<span class=tab-nav-text>Dockerfile</span></button></div><div class=tab-content-container><div data-tab-item=dockerfile class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-docker data-lang=docker><span style=display:flex><span><span style=color:#75715e>#  -=-=- other code omitted here -=-=-</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>###############################</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># STAGE 2 - BUILD SERVER      #</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>###############################</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Server Base Image</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># See https://hub.docker.com/_/node/</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:${NODE_VERSION}-alpine as server</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Use production node environment by default</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> NODE_ENV production<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Store files in /usr/src/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /usr/src/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Download dependencies as a separate step to take advantage of Docker&#39;s caching.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Leverage a cache mount to /root/.npm to speed up subsequent builds.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Leverage a bind mounts to package.json and package-lock.json to avoid having to copy them into</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># into this layer.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># See https://docs.docker.com/build/cache/optimize/</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>bind,source<span style=color:#f92672>=</span>server/package.json,target<span style=color:#f92672>=</span>package.json <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>bind,source<span style=color:#f92672>=</span>server/package-lock.json,target<span style=color:#f92672>=</span>package-lock.json <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --mount<span style=color:#f92672>=</span>type<span style=color:#f92672>=</span>cache,target<span style=color:#f92672>=</span>/root/.npm <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    npm ci --omit<span style=color:#f92672>=</span>dev<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Copy the rest of the source files into the image</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> ./server .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Copy the built version of the client into the image</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>client /usr/src/app/dist ./public<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Make a directory for the database and make it writable</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir -p ./data<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> chown -R node:node ./data<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Make a directory for the uploads and make it writable</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir -p ./public/uploads<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> chown -R node:node ./public/uploads<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Run the application as a non-root user.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>USER</span><span style=color:#e6db74> node</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Expose the port that the application listens on.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 3000</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Command to check for a healthy application</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>HEALTHCHECK</span> CMD wget --no-verbose --tries<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> --spider http://localhost:3000/api <span style=color:#f92672>||</span> exit <span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Run the application.</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> npm run start</span></span></code></pre></div></div></div></div></div><p>There we go! That is what it takes to build a deployable version of this application. Notice that the <code>Dockerfile</code> we created here is very different from the devcontainer image we are using to develop our application in. A common misconception when using Docker is that we can use the same image for both development and deployment, but generally that is a very insecure and unsafe practice. It is much better to have a fully-featured image available for development, and then use a very secure and minimal image for deployment, often one that is built using a multi-stage build process that takes advantage of layer caching to make it much more efficient.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=github-actions>GitHub Actions</h1><a href="https://www.youtube.com/watch?v=HRYpkcwdyIw">YouTube Video</a><h2 id=github-actions>GitHub Actions</h2><p>The last step in configuring our application for deployment is to create a <a href=https://github.com/features/actions rel=external target=_blank>GitHub Action</a> that will automatically build our Docker container when we commit a release tag to GitHub. This process will ensure that our image is always up to date and available for users to download and use.</p><p>Learning how to build a GitHub Action script could be an entire course unto itself. For this project, we&rsquo;ll run through the basic steps used to test and build our application&rsquo;s Docker image, but there are many more steps that could be added. For example, we could have GitHub automatically run our test scripts before building the image, preventing any broken images if the tests aren&rsquo;t passing. We can also add options to automatically deploy our image to our hosting service whenever it is updated. We can even have it send us a message on our messaging platform of choice when it is done building. Feel free to read up on all of the different actions available in the <a href="https://github.com/marketplace?type=actions" rel=external target=_blank>GitHub Actions Marketplace</a>.</p><h2 id=build-docker-action>Build Docker Action</h2><p>To create this GitHub action, we&rsquo;ll place a file named <code>build_docker.yml</code> in the <code>.github/workflows</code> directory at the very top level of our project.</p><p>We&rsquo;ll start with a name for the workflow, as well as a list of triggers that will start the workflow when a particular action is taken on our GitHub repository:</p><div class=tab-panel data-tab-group=856cc33d6be66e6f7ef162735dd93883><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=githubworkflowsbuild_dockeryml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("856cc33d6be66e6f7ef162735dd93883","githubworkflowsbuild_dockeryml")'>
<span class=tab-nav-text>.github/workflows/build_docker.yml</span></button></div><div class=tab-content-container><div data-tab-item=githubworkflowsbuild_dockeryml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># Workflow name</span>
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build Docker</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Run only on new tags being pushed</span>
</span></span><span style=display:flex><span><span style=color:#75715e># https://docs.github.com/en/actions/using-workflows/triggering-a-workflow</span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>tags</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#39;v*.*.*&#39;</span></span></span></code></pre></div></div></div></div></div><p>Next, we&rsquo;ll define the jobs to be executed as part of this GitHub Action. In this case, we&rsquo;ll only have a single job, <code>build</code>, which will build our Docker image. For that job, we&rsquo;ll use <a href=https://docs.github.com/en/actions/using-github-hosted-runners/using-github-hosted-runners/about-github-hosted-runners rel=external target=_blank>GitHub&rsquo;s Ubuntu Job Runner</a>, but there are many different options available for us.</p><div class=tab-panel data-tab-group=6650704ff165228fa9c294587749626d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=githubworkflowsbuild_dockeryml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6650704ff165228fa9c294587749626d","githubworkflowsbuild_dockeryml")'>
<span class=tab-nav-text>.github/workflows/build_docker.yml</span></button></div><div class=tab-content-container><div data-tab-item=githubworkflowsbuild_dockeryml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># Workflow name</span>
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build Docker</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Run only on new tags being pushed</span>
</span></span><span style=display:flex><span><span style=color:#75715e># https://docs.github.com/en/actions/using-workflows/triggering-a-workflow</span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>tags</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#39;v*.*.*&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Define a single job named build</span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Run job on Ubuntu runner</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span></span></span></code></pre></div></div></div></div></div><p>Following that, we&rsquo;ll list the steps required to complete the job. Each step is documented with a link to the documentation for that step.</p><div class=tab-panel data-tab-group=2aac2bd1cee0882afb8a6fe087de768c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=githubworkflowsbuild_dockeryml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2aac2bd1cee0882afb8a6fe087de768c","githubworkflowsbuild_dockeryml")'>
<span class=tab-nav-text>.github/workflows/build_docker.yml</span></button></div><div class=tab-content-container><div data-tab-item=githubworkflowsbuild_dockeryml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># Workflow name</span>
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build Docker</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Run only on new tags being pushed</span>
</span></span><span style=display:flex><span><span style=color:#75715e># https://docs.github.com/en/actions/using-workflows/triggering-a-workflow</span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>tags</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#39;v*.*.*&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Define a single job named build</span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Run job on Ubuntu runner</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Job Steps</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># Step 1 - Checkout the Repository</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># https://github.com/actions/checkout</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>1</span> - <span style=color:#ae81ff>Checkout Repository</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Step 2 - Log In to GitHub Container Registry</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># https://github.com/docker/login-action</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>2</span> - <span style=color:#ae81ff>Login to GitHub Container Registry</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>docker/login-action@v3</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>registry</span>: <span style=color:#ae81ff>ghcr.io</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>username</span>: <span style=color:#ae81ff>${{ github.repository_owner }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>password</span>: <span style=color:#ae81ff>${{ secrets.GITHUB_TOKEN }}</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#75715e># Step 3 - Build and Push Docker Image</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># https://github.com/docker/build-push-action</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>3</span> - <span style=color:#ae81ff>Build and Push Docker Image</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>docker/build-push-action@v6</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>context</span>: <span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>push</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>tags</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            ghcr.io/${{ github.repository }}:${{ github.ref_name }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            ghcr.io/${{ github.repository }}:latest</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Step 4 - Make Release on GitHub</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># https://github.com/softprops/action-gh-release</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>4</span> - <span style=color:#ae81ff>Release</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>softprops/action-gh-release@v2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>generate_release_notes</span>: <span style=color:#66d9ef>true</span></span></span></code></pre></div></div></div></div></div><p>As we can see, the basic steps are as follows:</p><ol><li>Checkout the current GitHub repository code</li><li>Connect to the GitHub Container Registry to store the image</li><li>Build and Push the Docker Image to the GitHub Container Registry</li><li>Create a Release on GitHub with the version information</li></ol><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Handling Uppercase Repository Names</summary><div class=box-content><p>GitHub is case-preserving, and allows repository names and usernames to include uppercase letters. However, Docker tags must be lowercase, so any repository names with uppercase letters will cause issues with this process.</p><p>To solve this, we can add a new step to convert our repository name to lowercase:</p><div class=tab-panel data-tab-group=6cd6fb83eae4c6b41fe47cfad9d40593><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=githubworkflowsbuild_dockeryml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6cd6fb83eae4c6b41fe47cfad9d40593","githubworkflowsbuild_dockeryml")'>
<span class=tab-nav-text>.github/workflows/build_docker.yml</span></button></div><div class=tab-content-container><div data-tab-item=githubworkflowsbuild_dockeryml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>      <span style=color:#75715e># Step 3a - Get Lowercase Repository Name</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># See https://github.com/orgs/community/discussions/27086</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>3a - Get Lowercase Repository Name</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;REPO_LOWER=${GITHUB_REPOSITORY,,}&#34; &gt;&gt; ${GITHUB_ENV}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Step 3b - Build and Push Docker Image</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># https://github.com/docker/build-push-action</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>3b - Build and Push Docker Image</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>docker/build-push-action@v6</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>context</span>: <span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>push</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>tags</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            ghcr.io/${{ env.REPO_LOWER }}:${{ github.ref_name }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            ghcr.io/${{ env.REPO_LOWER }}:latest</span></span></span></code></pre></div></div></div></div></div><p>Alternatively, much of this is also handled by the <a href=https://github.com/docker/metadata-action rel=external target=_blank>Docker Metadata Action</a>, which can be used to automatically configure tags and labels attached to a Docker container built by a GitHub action. For larger-scale projects, adding the Docker Metadata Action to this process is a helpful step.</p></div></details><h2 id=triggering-a-release>Triggering a Release</h2><p>Before we can trigger this workflow, we should commit and push it to GitHub along with our <code>Dockerfile</code> from the previous page.</p><p>Once we have done that, we can create a new <a href=https://semver.org/ rel=external target=_blank>Semantic Versioning</a>, or SemVer, style release tag and push it to GitHub:</p><div class=tab-panel data-tab-group=0905b2c8aea9f4ef285fc34521325671><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0905b2c8aea9f4ef285fc34521325671","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ git tag v0.0.1
</span></span><span style=display:flex><span>$ git push --tags</span></span></code></pre></div></div></div></div></div><p>When we do so, we can go back to our GitHub repository and check for a small yellow circle to appear at the top of our code, which shows that the GitHub Action is executing</p><p><a href=#R-image-5430e9f6d45ee6acffe90de676931008 class=lightbox-link><img alt="Running Action" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/07/deploy_4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5430e9f6d45ee6acffe90de676931008><img alt="Running Action" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/07/deploy_4.png></a></p><p>After a minute or so, we can refresh the page to see a green checkmark in its place, as well as additional information on the right side of the page showing the release version and a link to the newly built Docker container stored in the GitHub Container Registry.</p><p><a href=#R-image-cc423690dfd383085254d888e8919b17 class=lightbox-link><img alt="Completed Build" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/07/deploy_5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cc423690dfd383085254d888e8919b17><img alt="Completed Build" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/07/deploy_5.png></a></p><p>If we click on that link, we can find information about how to actually pull and use that Docker container in our deployment environment:</p><p><a href=#R-image-12d3f84fc7faed2d7279e2a8525ca352 class=lightbox-link><img alt="Final Container" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/07/deploy_6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-12d3f84fc7faed2d7279e2a8525ca352><img alt="Final Container" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/07/deploy_6.png></a></p><p>There we go! We now have a working Docker container for our application.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=docker-compose>Docker Compose</h1><a href="https://www.youtube.com/watch?v=SjfFPNsLDn0">YouTube Video</a><h2 id=docker-compose>Docker Compose</h2><p>The last step we can take to make our application easier to deploy is to create a <a href=https://docs.docker.com/compose/ rel=external target=_blank>Docker Compose</a> file that shows how to deploy this application easily within a Docker environment. It is becoming more and more popular for self-hosted projects and web applications to include a sample Docker Compose file to show how the application should be deployed in practice. So, let&rsquo;s look at a quick example for our application.</p><p>We&rsquo;ll place this file at the top-level of our application in a file named <code>compose.yml</code> with the following contents:</p><div class=tab-panel data-tab-group=d54db16e6c25bed673e1757fa2f3abae><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=composeyml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d54db16e6c25bed673e1757fa2f3abae","composeyml")'>
<span class=tab-nav-text>compose.yml</span></button></div><div class=tab-content-container><div data-tab-item=composeyml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>######################################</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Lost Communities Solution</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Repository:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># https://github.com/cis526-codio/lost-communities-solution</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>lostcommunities</span>:
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Docker Image</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ghcr.io/cis526-codio/lost-communities-solution:latest</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Container Name</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>lostcommunities</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Restart Container Unless Stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Network Ports</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;3000:3000&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Volumes</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>lostcommunities_data:/usr/src/app/data:rw</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>lostcommunities_uploads:/usr/src/app/public/uploads:rw</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Environment Variables</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># =+=+=+= REQUIRED VALUES =+=+=+=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># These values must be configured for deployment</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Session Secret Key</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>SESSION_SECRET</span>: <span style=color:#e6db74>&#39;thisisasupersecretkey&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># JWT Secret Key</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>JWT_SECRET_KEY</span>: <span style=color:#e6db74>&#39;thisisasupersecretkey&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Use Node and run `require(&#39;crypto&#39;).randomBytes(64).toString(&#39;hex&#39;)` to get a random value</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># CAS Authentication Settings</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># CAS Server URL (send users here to login)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>CAS_URL</span>: <span style=color:#e6db74>&#39;https://testcas.cs.ksu.edu&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># CAS Service URL (CAS returns users here; usually where this app is deployed)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>CAS_SERVICE_URL</span>: <span style=color:#e6db74>&#39;http://localhost:3000&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Database File Name</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Options: &#39;:memory:&#39; to use an in-memory database (not recommended), or any file name otherwise</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_FILE</span>: <span style=color:#e6db74>&#39;data/database.sqlite&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Seed initial data on first startup</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>SEED_DATA</span>: <span style=color:#e6db74>&#39;true&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># =+=+=+= OPTIONAL VALUES =+=+=+=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># These values are set to reasonable defaults</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># but can be overridden. Default values are shown as comments</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Log Level</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Options: error | warn | info | http | verbose | debug | sql | silly</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#LOG_LEVEL: &#39;http&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Network Port</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#PORT: &#39;3000&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># =+=+=+= OTHER VALUES =+=+=+=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># These values are not recommended for deployment but are available</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Custom Session Cookie Name</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#SESSION_NAME: &#39;connect.sid&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Open API Documentation</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Show OpenAPI Documentation at `/docs` path</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#OPENAPI_VISIBLE: &#39;false&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Open API Host for testing</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#OPENAPI_HOST: &#39;http://localhost:3000&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Export Open API JSON File</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#OPENAPI_EXPORT: &#39;false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Open API Export File Path</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#OPENAPI_EXPORT_PATH: &#39;openapi.json&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Enable Bypass Authentication</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Use path `/auth/bypass?token=&lt;username&gt;` to log in as any user</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># DO NOT ENABLE IN PRODUCTION - THIS IS INSECURE!</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#BYPASS_AUTH: &#39;false&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>lostcommunities_data</span>:
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>lostcommunities_uploads:</span></span></span></code></pre></div></div></div></div></div><p>Most of this file is pretty straightforward. The one unique bit to point out is the two <code>volume</code> mounts, which connect a Docker volume to both the <code>data</code> and the <code>public/uploads</code> folders of our container. The first folder was created to specifically store our database file, and the second one will store all uploaded files from the users. In our Docker Compose file we are simply storing these in Docker volumes, but an experienced system administrator could change these to link directly to a path on the host system, making it easy to access.</p><details open class="box cstyle notices tip"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Update the Image Path</summary><div class=box-content><p>Remember to update the image path in the Docker Compose file to match the path where your own Docker image can be found on the GitHub Container Registry - you can find it in your repository by clicking the Package name on the right side of the page.</p></div></details><h2 id=using-docker-compose>Using Docker Compose</h2><p>To actually deploy this application, we can simply download a copy of this <code>compose.yml</code> file on any system with Docker installed, and then run the following command to deploy it:</p><div class=tab-panel data-tab-group=e14d81749c933c561c87407fc22712c9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e14d81749c933c561c87407fc22712c9","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker compose up -d</span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Authenticating with GitHub Container Registry</summary><div class=box-content><p>Since our Docker image is stored in a private repository on GitHub, we&rsquo;ll need to authenticate with the GitHub Container Registry. Instructions for doing this with a GitHub Personal Access Token can be found in the <a href=https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry#authenticating-with-a-personal-access-token-classic rel=external target=_blank>GitHub Documentation</a>.</p></div></details><p>If everything works correctly, we should see our application start in the terminal:</p><p><a href=#R-image-24b705f6c7ceccd80df4a956fe620eb7 class=lightbox-link><img alt="Docker Compose Deploy" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/07/deploy_7.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-24b705f6c7ceccd80df4a956fe620eb7><img alt="Docker Compose Deploy" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/07/deploy_7.png></a></p><p>We can test it by going to <code>http://localhost:3000</code> on our local system, or whatever URL is attached to the deployed container.</p><p><a href=#R-image-c5cdaae4434c3a26d7c16b9fffca7696 class=lightbox-link><img alt="Docker Container Running" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/07/deploy_8.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c5cdaae4434c3a26d7c16b9fffca7696><img alt="Docker Container Running" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/07/deploy_8.png></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=external-database>External Database</h1><a href="https://www.youtube.com/watch?v=z95i3xT8DN4">YouTube Video</a><h2 id=connecting-to-an-external-database>Connecting to an External Database</h2><p>Finally, what if we&rsquo;d like to update our application to connect to an external database? This could be very useful if we plan on using this application in production with a large amount of data, because an external database will be much faster and handle large amounts of data much better than our SQLite database stored in a single file.</p><p>For this example, we&rsquo;ll update our application to be able to use <a href=https://www.postgresql.org/ rel=external target=_blank>Postgres</a>. Most of this process can be discovered by reading the <a href=https://sequelize.org/docs/v6/getting-started/ rel=external target=_blank>Sequelize Documentation</a> to see how to connect other database types to our application.</p><h2 id=update-database-configuration>Update Database Configuration</h2><p>First, we need to update the database configuration for our application, which is in the <code>configs/database.js</code> file in our <code>server</code> folder. We&rsquo;ll add several additional options to allow us to specify the dialect, hostname, username, and password for another database engine.</p><div class=tab-panel data-tab-group=95819ff1ee9309bf8e0f5790fa943c9f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configsdatabasejs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("95819ff1ee9309bf8e0f5790fa943c9f","configsdatabasejs")'>
<span class=tab-nav-text>configs/database.js</span></button></div><div class=tab-content-container><div data-tab-item=configsdatabasejs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Configuration information for Sequelize database ORM
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports sequelize a Sequelize instance
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Sequelize</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;sequelize&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import logger configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>logger</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./logger.js&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create Sequelize instance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sequelize</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Sequelize</span>({
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Supports &#34;sqlite&#34; or &#34;postgres&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>dialect</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_DIALECT</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;sqlite&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Only used by SQLite
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>storage</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_FILE</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;:memory:&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Used by Postgres
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>host</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_HOST</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;lostcommunities_db&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>port</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_PORT</span> <span style=color:#f92672>||</span> <span style=color:#ae81ff>5432</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_USERNAME</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;lostcommunities&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>password</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_PASSWORD</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;lostcommunities&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>database</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_NAME</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;lostcommunities&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>logging</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>sql</span>.<span style=color:#a6e22e>bind</span>(<span style=color:#a6e22e>logger</span>),
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>sequelize</span>;</span></span></code></pre></div></div></div></div></div><p>We&rsquo;ll also need to install the appropriate database libraries in our <code>server</code> application:</p><div class=tab-panel data-tab-group=f2f68a4fa566c7735264dd97d7401209><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f2f68a4fa566c7735264dd97d7401209","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm install pg pg-hstore</span></span></code></pre></div></div></div></div></div><h2 id=properly-update-ids-after-seeding>Properly Update IDs after Seeding</h2><p>In addition, we also must handle a bug where Postgres will not properly keep track of any IDs that are added during the seeding process, so in each of our seeds we need to update the internal sequence used by Postgres to keep track of the next ID to use:</p><div class=tab-panel data-tab-group=dda15a3272afdd2eb7ba5941caee29ef><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=seeds00_usersjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("dda15a3272afdd2eb7ba5941caee29ef","seeds00_usersjs")'>
<span class=tab-nav-text>seeds/00_users.js</span></button></div><div class=tab-content-container><div data-tab-item=seeds00_usersjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>up</span>({ <span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>queryInterface</span> }) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>bulkInsert</span>(<span style=color:#e6db74>&#34;users&#34;</span>, <span style=color:#a6e22e>users</span>);
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_DIALECT</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;postgres&#39;</span>) {
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>sequelize</span>.<span style=color:#a6e22e>query</span>(<span style=color:#e6db74>&#34;SELECT setval(&#39;users_id_seq&#39;, max(id)) FROM users;&#34;</span>);
</span></span><span style=display:flex;background-color:#3c3d38><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=a0bfc5511cc0ae6eb4d99b61dc405bd4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=seeds01_rolesjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a0bfc5511cc0ae6eb4d99b61dc405bd4","seeds01_rolesjs")'>
<span class=tab-nav-text>seeds/01_roles.js</span></button></div><div class=tab-content-container><div data-tab-item=seeds01_rolesjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>up</span>({ <span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>queryInterface</span> }) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>bulkInsert</span>(<span style=color:#e6db74>&#34;roles&#34;</span>, <span style=color:#a6e22e>roles</span>);
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_DIALECT</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;postgres&#39;</span>) {
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>sequelize</span>.<span style=color:#a6e22e>query</span>(<span style=color:#e6db74>&#34;SELECT setval(&#39;roles_id_seq&#39;, max(id)) FROM roles;&#34;</span>);
</span></span><span style=display:flex;background-color:#3c3d38><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>bulkInsert</span>(<span style=color:#e6db74>&#34;user_roles&#34;</span>, <span style=color:#a6e22e>user_roles</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>This error is discussed at length in a <a href=https://github.com/sequelize/sequelize/issues/9295 rel=external target=_blank>Sequelize GitHub Issue</a>.</p><h2 id=environment-variables>Environment Variables</h2><p>We should also add these new environment variable entries to our <code>.env.example</code> file, including relocating the existing <code>DATABASE_FILE</code> entry to this section with the others. Since we aren&rsquo;t using them in development or testing, we can leave them out of the other files for now.</p><div class=tab-panel data-tab-group=799801cd1bd60c0a003b20a4976de1cc><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=envexample class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("799801cd1bd60c0a003b20a4976de1cc","envexample")'>
<span class=tab-nav-text>.env.example</span></button></div><div class=tab-content-container><div data-tab-item=envexample class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-env data-lang=env><span style=display:flex><span><span style=color:#75715e># -=-=- other settings omitted here -=-=-</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Database Settings</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Options are &#34;sqlite&#34; or &#34;postgres&#34;</span>
</span></span><span style=display:flex><span>DATABASE_DIALECT<span style=color:#f92672>=</span>sqlite
</span></span><span style=display:flex><span><span style=color:#75715e># File is specified for SQLite</span>
</span></span><span style=display:flex><span>DATABASE_FILE<span style=color:#f92672>=</span>database.sqlite
</span></span><span style=display:flex><span><span style=color:#75715e># Other settings are for Postgres</span>
</span></span><span style=display:flex><span>DATABASE_HOST<span style=color:#f92672>=</span>localhost
</span></span><span style=display:flex><span>DATABASE_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>DATABASE_USERNAME<span style=color:#f92672>=</span>lostcommunities
</span></span><span style=display:flex><span>DATABASE_PASSWORD<span style=color:#f92672>=</span>lostcommunities
</span></span><span style=display:flex><span>DATABASE_NAME<span style=color:#f92672>=</span>lostcommunities</span></span></code></pre></div></div></div></div></div><h2 id=update-docker-compose>Update Docker Compose</h2><p>To test this, we&rsquo;ll need a running Postgres instance. While we can create one in our GitHub Codespaces by adding some additional configuration files, it is a bit more complex. So, let&rsquo;s just update our <code>compose.yml</code> file for deployment and test using another database there.</p><div class=tab-panel data-tab-group=ba5476e99b37454538556e0bd1ca9150><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=composeyml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ba5476e99b37454538556e0bd1ca9150","composeyml")'>
<span class=tab-nav-text>compose.yml</span></button></div><div class=tab-content-container><div data-tab-item=composeyml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>######################################</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Lost Communities Solution</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Repository:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># https://github.com/cis526-codio/lost-communities-solution</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>lostcommunities</span>:
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Docker Image</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ghcr.io/cis526-codio/lost-communities-solution:latest</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Container Name</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>lostcommunities</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Restart Container Unless Stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Networks</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>lostcommunities_network</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Network Ports</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;3000:3000&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Volumes</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>lostcommunities_data:/usr/src/app/data:rw</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>lostcommunities_uploads:/usr/src/app/public/uploads:rw</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Environment Variables</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># =+=+=+= REQUIRED VALUES =+=+=+=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># These values must be configured for deployment</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Session Secret Key</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>SESSION_SECRET</span>: <span style=color:#e6db74>&#39;thisisasupersecretkey&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># JWT Secret Key</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>JWT_SECRET_KEY</span>: <span style=color:#e6db74>&#39;thisisasupersecretkey&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Use Node and run `require(&#39;crypto&#39;).randomBytes(64).toString(&#39;hex&#39;)` to get a random value</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># CAS Authentication Settings</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># CAS Server URL (send users here to login)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>CAS_URL</span>: <span style=color:#e6db74>&#39;https://testcas.cs.ksu.edu&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># CAS Service URL (CAS returns users here; usually where this app is deployed)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>CAS_SERVICE_URL</span>: <span style=color:#e6db74>&#39;http://localhost:3000&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Database Options</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Database Dialect</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Options: &#39;sqlite&#39; (default) or &#39;postgres&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_DIALECT</span>: <span style=color:#e6db74>&#39;postgres&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># For SQLite Only - Specify file location</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Options: &#39;:memory:&#39; to use an in-memory database (not recommended), or any file name otherwise</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># DATABASE_FILE: &#39;data/database.sqlite&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># For Postgres Only - Specify database information</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_HOST</span>: <span style=color:#ae81ff>lostcommunities_db</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_PORT</span>: <span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_USERNAME</span>: <span style=color:#ae81ff>lostcommunities</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_PASSWORD</span>: <span style=color:#ae81ff>lostcommunities</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_NAME</span>: <span style=color:#ae81ff>lostcommunities</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Seed initial data on first startup</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>SEED_DATA</span>: <span style=color:#e6db74>&#39;true&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># =+=+=+= OPTIONAL VALUES =+=+=+=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># These values are set to reasonable defaults</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># but can be overridden. Default values are shown as comments</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Log Level</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Options: error | warn | info | http | verbose | debug | sql | silly</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#LOG_LEVEL: &#39;http&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Network Port Within the Container</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#PORT: &#39;3000&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># =+=+=+= OTHER VALUES =+=+=+=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># These values are not recommended for deployment but are available</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Custom Session Cookie Name</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#SESSION_NAME: &#39;connect.sid&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Open API Documentation</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Show OpenAPI Documentation at `/docs` path</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#OPENAPI_VISIBLE: &#39;false&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Open API Host for testing</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#OPENAPI_HOST: &#39;http://localhost:3000&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Export Open API JSON File</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#OPENAPI_EXPORT: &#39;false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Open API Export File Path</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#OPENAPI_EXPORT_PATH: &#39;openapi.json&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Enable Bypass Authentication</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Use path `/auth/bypass?token=&lt;username&gt;` to log in as any user</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># DO NOT ENABLE IN PRODUCTION - THIS IS INSECURE!</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#BYPASS_AUTH: &#39;false&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>######################################</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Postgres Database</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Image Location:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># https://hub.docker.com/_/postgres</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>lostcommunities_db</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Docker Image</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres:17-alpine</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Container Name</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>lostcommunities_db</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Restart Container Unless Stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Networks</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>lostcommunities_network</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Volumes</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>lostcommunities_db_data:/var/lib/postgresql/data:rw</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Environment Variables</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_USER</span>: <span style=color:#ae81ff>lostcommunities</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_PASSWORD</span>: <span style=color:#ae81ff>lostcommunities</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_DB</span>: <span style=color:#ae81ff>lostcommunities</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>lostcommunities_data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>lostcommunities_uploads</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>lostcommunities_db_data</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>lostcommunities_network</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>internal</span>: <span style=color:#66d9ef>true</span></span></span></code></pre></div></div></div></div></div><p>This Docker Compose file follows some best practices for deploying a Postgres container in the cloud, and even separates the database connection between our application container and the Postgres container in an internal Docker network to make it even more secure.</p><p>Once we deploy this application, we can even check that the Postgres server has our current data to ensure it is working properly:</p><p><a href=#R-image-89f4554bb3b300c0db3e1dd55ef446af class=lightbox-link><img alt="Postgres Running" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/07/deploy_9.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-89f4554bb3b300c0db3e1dd55ef446af><img alt="Postgres Running" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/07/deploy_9.png></a></p><p>Now our application is ready for a full deployment!</p><footer class=footline></footer></article></section></div></main><div class=git-footer><p class=theme-version-footer>8.0.0</p><p>Last modified by:
<i class='fa-fw fas fa-user'></i> Russell Feldhausen
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cis526/commit/88dc52af7821b9338bcedf83c0737bdfbc9b262e>Apr 28, 2025</a></p></div></div><script src=/cis526/js/clipboard/clipboard.min.js?1753540871 defer></script><script src=/cis526/js/perfect-scrollbar/perfect-scrollbar.min.js?1753540871 defer></script><script src=/cis526/js/theme.min.js?1753540871 defer></script></body></html>