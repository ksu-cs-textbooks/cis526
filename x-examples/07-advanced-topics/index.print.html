<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="This example project builds on the previous Vue.js CRUD app by discussing some more advanced topics related to web application development.
Project Deliverables At the end of this example, we will have a project with the following features:
Prior Work This project picks up right where the last one left off, so if you haven’t completed that one yet, go back and do that before starting this one.
Let’s get started!"><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Advanced Topics :: CIS 526 Textbook"><meta name=twitter:description content="This example project builds on the previous Vue.js CRUD app by discussing some more advanced topics related to web application development.
Project Deliverables At the end of this example, we will have a project with the following features:
Prior Work This project picks up right where the last one left off, so if you haven’t completed that one yet, go back and do that before starting this one.
Let’s get started!"><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/x-examples/07-advanced-topics/"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Advanced Topics :: CIS 526 Textbook"><meta property="og:description" content="This example project builds on the previous Vue.js CRUD app by discussing some more advanced topics related to web application development.
Project Deliverables At the end of this example, we will have a project with the following features:
Prior Work This project picks up right where the last one left off, so if you haven’t completed that one yet, go back and do that before starting this one.
Let’s get started!"><meta property="og:locale" content="en-us"><meta property="og:type" content="website"><meta itemprop=name content="Advanced Topics :: CIS 526 Textbook"><meta itemprop=description content="This example project builds on the previous Vue.js CRUD app by discussing some more advanced topics related to web application development.
Project Deliverables At the end of this example, we will have a project with the following features:
Prior Work This project picks up right where the last one left off, so if you haven’t completed that one yet, go back and do that before starting this one.
Let’s get started!"><meta itemprop=dateModified content="2025-04-16T16:10:10-05:00"><meta itemprop=wordCount content="71"><title>Advanced Topics :: CIS 526 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis526/x-examples/07-advanced-topics/ rel=canonical type=text/html title="Advanced Topics :: CIS 526 Textbook"><link href=/cis526/x-examples/07-advanced-topics/index.xml rel=alternate type=application/rss+xml title="Advanced Topics :: CIS 526 Textbook"><link href=/cis526/x-examples/07-advanced-topics/tele.html rel=alternate type=text/html title="Advanced Topics :: CIS 526 Textbook"><link href=/cis526/x-examples/07-advanced-topics/embed.html rel=alternate type=text/html title="Advanced Topics :: CIS 526 Textbook"><link href=/cis526/css/fontawesome-all.min.css?1744837859 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fontawesome-all.min.css?1744837859 rel=stylesheet></noscript><link href=/cis526/css/nucleus.css?1744837859 rel=stylesheet><link href=/cis526/css/auto-complete.css?1744837859 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/auto-complete.css?1744837859 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar.min.css?1744837859 rel=stylesheet><link href=/cis526/css/fonts.css?1744837859 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fonts.css?1744837859 rel=stylesheet></noscript><link href=/cis526/css/theme.css?1744837859 rel=stylesheet><link href=/cis526/css/theme-auto.css?1744837859 rel=stylesheet id=R-variant-style><link href=/cis526/css/chroma-auto.css?1744837859 rel=stylesheet id=R-variant-chroma-style><link href=/cis526/css/variant.css?1744837859 rel=stylesheet><link href=/cis526/css/print.css?1744837859 rel=stylesheet media=print><link href=/cis526/css/format-print.css?1744837859 rel=stylesheet><script src=/cis526/js/variant.js?1744837859></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.index_js_url="/cis526/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis526/css/custom.css?1744837859 rel=stylesheet></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/cis526/x-examples/07-advanced-topics/><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cis526/x-examples/><span itemprop=name>Example Projects</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Advanced Topics</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/06-vue-crud-app/06-delete-user/ title="Delete User (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/07-advanced-topics/01-pinia/ title="Pinia (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=advanced-topics>Advanced Topics</h1><p>This example project builds on the previous Vue.js CRUD app by discussing some more advanced topics related to web application development.</p><h2 id=project-deliverables>Project Deliverables</h2><p>At the end of this example, we will have a project with the following features:</p><ol><li></li></ol><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Prior Work</div><div class=box-content><p>This project picks up right where the last one left off, so if you haven&rsquo;t completed that one yet, go back and do that before starting this one.</p></div></div><p>Let&rsquo;s get started!</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Advanced Topics</h1><article class=default><header class=headline></header><h1 id=pinia>Pinia</h1><a href="https://www.youtube.com/watch?v=id">YouTube Video</a><h2 id=props>Props</h2><p>So far, we&rsquo;ve mostly been dealing with data in our Vue components in one of two ways:</p><ol><li>It is requested directly from the RESTful API for the component (as in the <code>UsersList</code> and <code>UserEdit</code> components)</li><li>It is passed in from a parent component, especially if it is a small helper component (as in the <code>RoleChip</code> and <code>TextField</code> components)</li></ol><p>The only exception is the user&rsquo;s JSON Web Token (JWT), which we have stored in a Pinia store. However, we didn&rsquo;t spend much time talking about <em>why</em> we stored that token in a Pinia store instead of just making it a global reactive state component and passing that state down the component tree using props.</p><p>The concept of passing props down through components, especially between many layers of components, is known as <a href=https://vuejs.org/guide/components/provide-inject rel=external target=_blank>Prop Drilling</a></p><p><a href=#R-image-588583b0f64e2e573ff23814e5931030 class=lightbox-link><img alt="Prop Drilling" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/07/prop-drilling.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-588583b0f64e2e573ff23814e5931030><img alt="Prop Drilling" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/07/prop-drilling.png></a><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><p>While this method can work well, it can also make an application very complicated with the sheer number of props that must be passed through each component. For example, imagine if each page and component needed access to the user&rsquo;s JWT to determine which actions to allow (a very real example from the project we are working). In that case, each component may need to be aware of the token as an incoming prop, and may also need to pass it along to any child components that may need it, even if it is three or four layers deep.</p><h2 id=provide--inject>Provide / Inject</h2><p>The Vue framework itself does have a solution to this problem, which is the <a href=https://vuejs.org/guide/components/provide-inject rel=external target=_blank>Provide / Inject</a> interface. In effect, a component can declare a reactive state item and add it to a global dictionary of state items that are available using the <code>provide</code> method along with a unique key for that item, and any other component can receive a reference to that state item using the <code>inject</code> method with the same key.</p><p><a href=#R-image-0d389b2309893c25432fded458f9c372 class=lightbox-link><img alt="Provide Inject" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/07/provide-inject.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0d389b2309893c25432fded458f9c372><img alt="Provide Inject" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/07/provide-inject.png></a><sup id=fnref1:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><p>This is a bit of an improvement, but still has many issues that are discussed in the documentation. For example, it is best to only modify the state at the top-level component that is providing the state, so an additional function may need to be provided to enable proper editing of the state. In addition, for large apps it can be very difficult to ensure that each key is unique, and having hundreds or thousands of keys to keep track of can be a huge burden for programmers.</p><h2 id=pinia>Pinia</h2><p>The <a href=https://pinia.vuejs.org/ rel=external target=_blank>Pinia</a> library tries to solve all of these issues by providing convenient <em>stores</em> for different types of information in the application. Each store is typically oriented toward a specific type of data (such as users or documents), and it contains all the methods needed to read and modify the state as needed. Then, each component that needs access to the state can simply request a reference to the stores it needs, and everything is nicely compartmentalized and easy to maintain.</p><p>To see how this can help simplify our application, let&rsquo;s look at how we can create a <code>Users</code> store to interface with our RESTful API and maintain a globally-accessible store for data about our users.</p><h2 id=creating-a-pinia-store>Creating a Pinia Store</h2><p>To create a Pinia store, we can create a new file <code>src/stores/User.js</code> with the following initial content:</p><div class=tab-panel data-tab-group=212fa677da24bd2b706061bc518fecf9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srcstoresuserjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("212fa677da24bd2b706061bc518fecf9","srcstoresuserjs")'>
<span class=tab-nav-text>src/stores/User.js</span></button></div><div class=tab-content-container><div data-tab-item=srcstoresuserjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @file User Store
</span></span></span><span class=line><span class=cl><span class=cm> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import Libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>defineStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;pinia&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>api</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@/configs/api&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Define Store
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useUserStore</span> <span class=o>=</span> <span class=nx>defineStore</span><span class=p>(</span><span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// State Properties
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// Getters
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// Actions
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// Return all state, getters, and actions
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=p>{</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span></span></span></code></pre></div></div></div></div></div><p>This is a nice starting structure for a store. At the bare minimum, we use the <a href=https://pinia.vuejs.org/core-concepts/ rel=external target=_blank>defineStore</a> method from Pinia to create the store. Inside of that method is a lambda function that actually defines the contents of the store itself, which we&rsquo;ll iteratively build over time. We&rsquo;ve also imported a few useful library functions, including our pre-built Axios API interface to make it easy to send requests to our API.</p><h2 id=properties>Properties</h2><p>The first items we should add to our Pinia store are the state properties that we&rsquo;ll be tracking. These can be anything from simple values all the way up to entire arrays of objects full of data. In most cases, it makes sense to have each Pinia store track data in a format similar to what our application will need. For this example, we&rsquo;ll use this store to track both the <code>users</code> and <code>roles</code> that are available in our system. So, we&rsquo;ll need to create two reactive state variables using the <code>ref()</code> function from Vue to store that data as state in our Pinia store:</p><div class=tab-panel data-tab-group=eda0cafaba738687d7e7a143569c4a6d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srcstoresuserjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("eda0cafaba738687d7e7a143569c4a6d","srcstoresuserjs")'>
<span class=tab-nav-text>src/stores/User.js</span></button></div><div class=tab-content-container><div data-tab-item=srcstoresuserjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Define Store
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useUserStore</span> <span class=o>=</span> <span class=nx>defineStore</span><span class=p>(</span><span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// State Properties
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>users</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>([])</span>
</span></span><span class="line hl"><span class=cl>  <span class=kr>const</span> <span class=nx>roles</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>([])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Getters
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// Actions
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// Return all state, getters, and actions
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=p>{</span> <span class=nx>users</span><span class=p>,</span> <span class=nx>roles</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span></span></span></code></pre></div></div></div></div></div><p>Each state property in Pinia is just a reactive state variable from Vue that can be shared across our entire application. So, we&rsquo;ll just initialize each one to an empty array for now.</p><h2 id=actions---hydrate>Actions - Hydrate</h2><p>Before we tackle any getters, let&rsquo;s look at how we can actually get this data from our RESTful API. In many web development frameworks, the process of loading data from the AI is sometimes referred to as <a href=https://en.wikipedia.org/wiki/Hydration_(web_development) rel=external target=_blank>Hydration</a>. So, let&rsquo;s write a method we can use the <em>hydrate</em> these two state variables by making a request to our RESTful API. Most of this code is lifted directly from our existing <code>UsersList</code> component:</p><div class=tab-panel data-tab-group=2ba81492669bcf4ddbacb29189a1578a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srcstoresuserjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2ba81492669bcf4ddbacb29189a1578a","srcstoresuserjs")'>
<span class=tab-nav-text>src/stores/User.js</span></button></div><div class=tab-content-container><div data-tab-item=srcstoresuserjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Define Store
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useUserStore</span> <span class=o>=</span> <span class=nx>defineStore</span><span class=p>(</span><span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// Actions
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * Load users and roles from the API
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=kd>function</span> <span class=nx>hydrate</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>api</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/api/v1/users&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>users</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>response</span><span class=p>.</span><span class=nx>data</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>api</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/api/v1/roles&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>roles</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>response</span><span class=p>.</span><span class=nx>data</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Return all state, getters, and actions
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=p>{</span> <span class=nx>users</span><span class=p>,</span> <span class=nx>roles</span><span class=p>,</span> <span class=nx>hydrate</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>})</span></span></span></code></pre></div></div></div></div></div><p>As we can see, this function will make two asynchronous requests to the RESTful API to load both the users and roles, and when those requests are resolved it will store the data in the appropriate state variable.</p><h2 id=getters>Getters</h2><p>For this Pinia store, we won&rsquo;t need any individual getters. Instead, we&rsquo;ll just use some functions in the component as needed to extract data from the store.</p><h2 id=actions---save--delete>Actions - Save & Delete</h2><p>Finally, let&rsquo;s add two more actions to allow us to both save and delete a user through our RESTful API. The code for the <code>save</code> function is mostly taken from our <code>UserEdit</code> component, while the code to delete a user comes from the <code>UserList</code> component, both with minor changes.</p><div class=tab-panel data-tab-group=e06984115bf36d1d94f30a8a0576c430><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srcstoresuserjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e06984115bf36d1d94f30a8a0576c430","srcstoresuserjs")'>
<span class=tab-nav-text>src/stores/User.js</span></button></div><div class=tab-content-container><div data-tab-item=srcstoresuserjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Define Store
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=kr>const</span> <span class=nx>useUserStore</span> <span class=o>=</span> <span class=nx>defineStore</span><span class=p>(</span><span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// Actions
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * Save a user
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=kd>function</span> <span class=nx>saveUser</span><span class=p>(</span><span class=nx>id</span><span class=p>,</span> <span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>method</span> <span class=o>=</span> <span class=s1>&#39;post&#39;</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>url</span> <span class=o>=</span> <span class=s1>&#39;/api/v1/users&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>method</span> <span class=o>=</span> <span class=s1>&#39;put&#39;</span>
</span></span><span class=line><span class=cl>      <span class=nx>url</span> <span class=o>=</span> <span class=nx>url</span> <span class=o>+</span> <span class=s1>&#39;/&#39;</span> <span class=o>+</span> <span class=nx>id</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>api</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>method</span><span class=o>:</span> <span class=nx>method</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>url</span><span class=o>:</span> <span class=nx>url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span><span class=o>:</span> <span class=nx>user</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// rehydrate data
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>hydrate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>response</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Error saving user!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=nx>error</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * Delete a user
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=kd>function</span> <span class=nx>deleteUser</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>api</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=k>delete</span><span class=p>(</span><span class=s1>&#39;/api/v1/users/&#39;</span> <span class=o>+</span> <span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// rehydrate data
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=p>.</span><span class=nx>hydrate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>response</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Error deleting user!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Return all state, getters, and actions
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=p>{</span> <span class=nx>users</span><span class=p>,</span> <span class=nx>roles</span><span class=p>,</span> <span class=nx>hydrate</span><span class=p>,</span> <span class=nx>saveUser</span><span class=p>,</span> <span class=nx>deleteUser</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>})</span></span></span></code></pre></div></div></div></div></div><p>As we can see in the code above, after each successful API call, we immediately call the <code>hydrate</code> method to update the contents of our <code>users</code> and <code>roles</code> list before passing the response back to the calling method. This ensures that our data is always in sync with the RESTful API backend anytime we make a change. In addition, we are carefully logging any errors we receive here, but we are still throwing the errors back to the calling method so they can be handled there as well.</p><p>That is the basic contents of our <code>Users</code> store, which we can use throughout our application.</p><h2 id=using-a-store---userslist>Using a Store - UsersList</h2><p>Now, let&rsquo;s look at how we can use our store in our various components that require data from the <code>Users</code> and <code>Roles</code> APIs. First, we can take a look at our existing <code>UsersList</code> component - there are many lines that we&rsquo;ll remove or change within the component. Each change is highlighted and described below, with removed lines commented out.</p><div class=tab-panel data-tab-group=1e1cc96123549e7458d39ae3a77a8a47><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersuserslistvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("1e1cc96123549e7458d39ae3a77a8a47","srccomponentsusersuserslistvue")'>
<span class=tab-nav-text>src/components/users/UsersList.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersuserslistvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class="line hl"><span class=cl><span class=c1>// Create Reactive State
</span></span></span><span class="line hl"><span class=cl><span class=c1>// const users = ref([])
</span></span></span><span class="line hl"><span class=cl><span class=c1>// const roles = ref([])
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class="line hl"><span class=cl><span class=c1>// Stores
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>storeToRefs</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;pinia&#39;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useUserStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@/stores/User&#39;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>const</span> <span class=nx>userStore</span> <span class=o>=</span> <span class=nx>useUserStore</span><span class=p>();</span>
</span></span><span class="line hl"><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>users</span><span class=p>,</span> <span class=nx>roles</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>storeToRefs</span><span class=p>(</span><span class=nx>userStore</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div></div></div></div></div><p>First, we replace the two reactive state variables for <code>users</code> and <code>roles</code> with the same state variables that are extracted from the Pinia store using the <code>storeToRefs()</code> function, which will <a href=https://pinia.vuejs.org/core-concepts/#Destructuring-from-a-Store rel=external target=_blank>Destructure the Store</a> and make the variables directly available to our code.</p><div class=tab-panel data-tab-group=64c41cd8805b8cb49cf6c12265957adf><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersuserslistvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("64c41cd8805b8cb49cf6c12265957adf","srccomponentsusersuserslistvue")'>
<span class=tab-nav-text>src/components/users/UsersList.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersuserslistvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class="line hl"><span class=cl><span class=c1>// Load Users
</span></span></span><span class="line hl"><span class=cl><span class=c1>//api
</span></span></span><span class="line hl"><span class=cl><span class=c1>//  .get(&#39;/api/v1/users&#39;)
</span></span></span><span class="line hl"><span class=cl><span class=c1>//  .then(function (response) {
</span></span></span><span class="line hl"><span class=cl><span class=c1>//    users.value = response.data
</span></span></span><span class="line hl"><span class=cl><span class=c1>//  })
</span></span></span><span class="line hl"><span class=cl><span class=c1>//  .catch(function (error) {
</span></span></span><span class="line hl"><span class=cl><span class=c1>//    console.log(error)
</span></span></span><span class="line hl"><span class=cl><span class=c1>//  })
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class="line hl"><span class=cl><span class=c1>// Load Roles
</span></span></span><span class="line hl"><span class=cl><span class=c1>//api
</span></span></span><span class="line hl"><span class=cl><span class=c1>//  .get(&#39;/api/v1/roles&#39;)
</span></span></span><span class="line hl"><span class=cl><span class=c1>//  .then(function (response) {
</span></span></span><span class="line hl"><span class=cl><span class=c1>//    roles.value = response.data
</span></span></span><span class="line hl"><span class=cl><span class=c1>//  })
</span></span></span><span class="line hl"><span class=cl><span class=c1>//  .catch(function (error) {
</span></span></span><span class="line hl"><span class=cl><span class=c1>//    console.log(error)
</span></span></span><span class="line hl"><span class=cl><span class=c1>//  })
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class="line hl"><span class=cl><span class=c1>// Hydrate Store
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=nx>userStore</span><span class=p>.</span><span class=nx>hydrate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div></div></div></div></div><p>Next, we can replace all of the code used to load the users and roles on the page to a simple call to the <code>hydrate</code> method in the store itself.</p><div class=tab-panel data-tab-group=bced798dff131015e34d82d7e23916ef><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersuserslistvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("bced798dff131015e34d82d7e23916ef","srccomponentsusersuserslistvue")'>
<span class=tab-nav-text>src/components/users/UsersList.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersuserslistvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Delete User
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>deleteUser</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>  <span class=c1>// api
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>  <span class=c1>//   .delete(&#39;/api/v1/users/&#39; + id)
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>  <span class=nx>userStore</span><span class=p>.</span><span class=nx>deleteUser</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>toast</span><span class=p>.</span><span class=nx>add</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>severity</span><span class=o>:</span> <span class=s1>&#39;success&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>summary</span><span class=o>:</span> <span class=s1>&#39;Success&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>detail</span><span class=o>:</span> <span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>life</span><span class=o>:</span> <span class=mi>5000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class="line hl"><span class=cl>        <span class=c1>// Remove that element from the reactive array
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>        <span class=c1>// users.value.splice(
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>        <span class=c1>//   users.value.findIndex((u) =&gt; u.id == id),
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>        <span class=c1>//   1,
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>        <span class=c1>// )
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>toast</span><span class=p>.</span><span class=nx>add</span><span class=p>({</span> <span class=nx>severity</span><span class=o>:</span> <span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=nx>summary</span><span class=o>:</span> <span class=s1>&#39;Error&#39;</span><span class=p>,</span> <span class=nx>detail</span><span class=o>:</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>life</span><span class=o>:</span> <span class=mi>5000</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div></div></div></div></div><p>Finally, in the method to delete a user, we can replace the API call with a call to the <code>deleteUser</code> method inside of the Pinia store to handle deleting the user with the selected ID. We can also remove the code that will remove the user from the list, since we no longer need to do that here; instead, the Pinia store will query the updated data from the RESTful API, and the user should no longer be present in that data when it is received.</p><p>Those are all of the changes needed to switch the <code>UsersList</code> component to use the store. The template itself remains exactly the same.</p><h2 id=using-a-store---useredit>Using a Store - UserEdit</h2><p>We can also update our <code>UserEdit</code> component in a similar way:</p><div class=tab-panel data-tab-group=c94acbbbf134080efc595cc2d638abc8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersusereditvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c94acbbbf134080efc595cc2d638abc8","srccomponentsusersusereditvue")'>
<span class=tab-nav-text>src/components/users/UserEdit.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersusereditvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Declare State
</span></span></span><span class="line hl"><span class=cl><span class=c1>// const user = ref({})
</span></span></span><span class="line hl"><span class=cl><span class=c1>// const roles = ref([])
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>errors</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>([])</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=c1>// Stores
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>storeToRefs</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;pinia&#39;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useUserStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@/stores/User&#39;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>const</span> <span class=nx>userStore</span> <span class=o>=</span> <span class=nx>useUserStore</span><span class=p>();</span>
</span></span><span class="line hl"><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>users</span><span class=p>,</span> <span class=nx>roles</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>storeToRefs</span><span class=p>(</span><span class=nx>userStore</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=c1>// Find single user or a blank user
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>  <span class=k>return</span> <span class=p>(</span><span class=nx>users</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>find</span><span class=p>((</span><span class=nx>u</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>u</span><span class=p>.</span><span class=nx>id</span> <span class=o>==</span> <span class=nx>props</span><span class=p>.</span><span class=nx>id</span><span class=p>)</span> <span class=o>||</span> <span class=p>{</span> <span class=nx>username</span><span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=nx>roles</span><span class=o>:</span> <span class=p>[]</span> <span class=p>})</span>
</span></span><span class="line hl"><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div></div></div></div></div><p>First, we can replace the reactive state variables with the same variables from the Users store. To get a single user, we can create a computed state variable that will find the user in the list that matches the incoming <code>props.id</code>. If a user can&rsquo;t be found, it will generate a blank <code>User</code> object that can be used to create a new user.</p><p>Likewise, we can remove all of the code that loads users and roles and replace that with a <code>hydrate</code> function call in our Pinia store:</p><div class=tab-panel data-tab-group=0db1b7349ea3d1a190f7d83a202c50c2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersusereditvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0db1b7349ea3d1a190f7d83a202c50c2","srccomponentsusersusereditvue")'>
<span class=tab-nav-text>src/components/users/UserEdit.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersusereditvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class="line hl"><span class=cl><span class=c1>// Load Users
</span></span></span><span class="line hl"><span class=cl><span class=c1>// if (props.id) {
</span></span></span><span class="line hl"><span class=cl><span class=c1>//   api
</span></span></span><span class="line hl"><span class=cl><span class=c1>//     .get(&#39;/api/v1/users/&#39; + props.id)
</span></span></span><span class="line hl"><span class=cl><span class=c1>//     .then(function (response) {
</span></span></span><span class="line hl"><span class=cl><span class=c1>//       user.value = response.data
</span></span></span><span class="line hl"><span class=cl><span class=c1>//     })
</span></span></span><span class="line hl"><span class=cl><span class=c1>//     .catch(function (error) {
</span></span></span><span class="line hl"><span class=cl><span class=c1>//       console.log(error)
</span></span></span><span class="line hl"><span class=cl><span class=c1>//     })
</span></span></span><span class="line hl"><span class=cl><span class=c1>// } else {
</span></span></span><span class="line hl"><span class=cl><span class=c1>//   // Empty Value for User Object
</span></span></span><span class="line hl"><span class=cl><span class=c1>//   user.value = {
</span></span></span><span class="line hl"><span class=cl><span class=c1>//     username: &#39;&#39;,
</span></span></span><span class="line hl"><span class=cl><span class=c1>//     roles: [],
</span></span></span><span class="line hl"><span class=cl><span class=c1>//   }
</span></span></span><span class="line hl"><span class=cl><span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class="line hl"><span class=cl><span class=c1>// Load Roles
</span></span></span><span class="line hl"><span class=cl><span class=c1>// api
</span></span></span><span class="line hl"><span class=cl><span class=c1>//   .get(&#39;/api/v1/roles&#39;)
</span></span></span><span class="line hl"><span class=cl><span class=c1>//   .then(function (response) {
</span></span></span><span class="line hl"><span class=cl><span class=c1>//     roles.value = response.data
</span></span></span><span class="line hl"><span class=cl><span class=c1>//   })
</span></span></span><span class="line hl"><span class=cl><span class=c1>//   .catch(function (error) {
</span></span></span><span class="line hl"><span class=cl><span class=c1>//     console.log(error)
</span></span></span><span class="line hl"><span class=cl><span class=c1>//   })
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class="line hl"><span class=cl><span class=nx>userStore</span><span class=p>.</span><span class=nx>hydrate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div></div></div></div></div><p>Finally, we can replace the call to the <code>api</code> library to save the user with a call to the <code>saveUser</code> method in the <code>UserStore</code>:</p><div class=tab-panel data-tab-group=d8c058ac4b8908fa9d5f0c5287d7a336><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersusereditvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d8c058ac4b8908fa9d5f0c5287d7a336","srccomponentsusersusereditvue")'>
<span class=tab-nav-text>src/components/users/UserEdit.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersusereditvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Save User
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>save</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>  <span class=nx>errors</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=nx>userStore</span><span class=p>.</span><span class=nx>saveUser</span><span class=p>(</span><span class=nx>props</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span> <span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=mi>201</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>toast</span><span class=p>.</span><span class=nx>add</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>severity</span><span class=o>:</span> <span class=s1>&#39;success&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>summary</span><span class=o>:</span> <span class=s1>&#39;Success&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>detail</span><span class=o>:</span> <span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>life</span><span class=o>:</span> <span class=mi>5000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=nx>router</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;users&#39;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=mi>422</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>toast</span><span class=p>.</span><span class=nx>add</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>severity</span><span class=o>:</span> <span class=s1>&#39;warn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>summary</span><span class=o>:</span> <span class=s1>&#39;Warning&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>detail</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>error</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>life</span><span class=o>:</span> <span class=mi>5000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=nx>errors</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>error</span><span class=p>.</span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>errors</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>toast</span><span class=p>.</span><span class=nx>add</span><span class=p>({</span> <span class=nx>severity</span><span class=o>:</span> <span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=nx>summary</span><span class=o>:</span> <span class=s1>&#39;Error&#39;</span><span class=p>,</span> <span class=nx>detail</span><span class=o>:</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>life</span><span class=o>:</span> <span class=mi>5000</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div></div></div></div></div><p>With those changes in place, we can also edit our users and create new users.</p><h2 id=using-a-store---roles>Using a Store - Roles</h2><p>Finally, we can update our <code>RolesList</code> to also use the store:</p><div class=tab-panel data-tab-group=13ab022e1a3b730e546040bc9914b5ab><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsrolesroleslistvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("13ab022e1a3b730e546040bc9914b5ab","srccomponentsrolesroleslistvue")'>
<span class=tab-nav-text>src/components/roles/RolesList.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsrolesroleslistvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class="line hl"><span class=cl><span class=c1>// Stores
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>storeToRefs</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;pinia&#39;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useUserStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@/stores/User&#39;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>const</span> <span class=nx>userStore</span> <span class=o>=</span> <span class=nx>useUserStore</span><span class=p>();</span>
</span></span><span class="line hl"><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>roles</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>storeToRefs</span><span class=p>(</span><span class=nx>userStore</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=c1>// Hydrate Store
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=nx>userStore</span><span class=p>.</span><span class=nx>hydrate</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div></div></div></div></div><p>At this point, all API calls to the <code>users</code> and <code>roles</code> endpoints should now be routed through our <code>User</code> Pinia store.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Image Source: <a href=https://vuejs.org/guide/components/provide-inject rel=external target=_blank>Pinia Documentation</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=reusing-components>Reusing Components</h1><a href="https://www.youtube.com/watch?v=id">YouTube Video</a><h2 id=reusing-components>Reusing Components</h2><p>One of the many amazing features of a front-end framework such as Vue is the ability to reuse components in very powerful ways. For example, right now our application uses an entirely separate view and component to handle editing and updating users, but that means that we have to constantly jump back and forth between two views when working with users. Now that those views are using a shared Pinia store, we can use a <a href=https://primevue.org/dynamicdialog/ rel=external target=_blank>PrimeVue DynamicDialog</a> component to allow us to open the <code>UserEdit</code> component in a popup dialog on our <code>UsersList</code> component.</p><h2 id=installing-dynamicdialog>Installing DynamicDialog</h2><p>To begin, we must install the service for this component in our <code>src/main.js</code> along with the other services for PrimeVue components:</p><div class=tab-panel data-tab-group=0bfecef133cc0c72eede6ed7884012f3><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srcmainjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0bfecef133cc0c72eede6ed7884012f3","srcmainjs")'>
<span class=tab-nav-text>src/main.js</span></button></div><div class=tab-content-container><div data-tab-item=srcmainjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @file Main Vue application
</span></span></span><span class=line><span class=cl><span class=cm> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import Libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>createApp</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createPinia</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;pinia&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>PrimeVue</span> <span class=nx>from</span> <span class=s1>&#39;primevue/config&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Aura</span> <span class=nx>from</span> <span class=s1>&#39;@primeuix/themes/aura&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Tooltip</span> <span class=nx>from</span> <span class=s1>&#39;primevue/tooltip&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>ToastService</span> <span class=nx>from</span> <span class=s1>&#39;primevue/toastservice&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>ConfirmationService</span> <span class=nx>from</span> <span class=s1>&#39;primevue/confirmationservice&#39;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>import</span> <span class=nx>DialogService</span> <span class=nx>from</span> <span class=s1>&#39;primevue/dialogservice&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Create Vue App
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>createApp</span><span class=p>(</span><span class=nx>App</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Install Libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>createPinia</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>router</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>PrimeVue</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Theme Configuration
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>theme</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>preset</span><span class=o>:</span> <span class=nx>Aura</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>options</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>darkModeSelector</span><span class=o>:</span> <span class=s1>&#39;.app-dark-mode&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>ToastService</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>ConfirmationService</span><span class=p>)</span>
</span></span><span class="line hl"><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>DialogService</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>Then, we can add the single instance of the component to our top-level <code>App.vue</code> component along with the other service components:</p><div class=tab-panel data-tab-group=c7d65d947b04e0acee3cae80e79e60f7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srcappvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c7d65d947b04e0acee3cae80e79e60f7","srcappvue")'>
<span class=tab-nav-text>src/App.vue</span></button></div><div class=tab-content-container><div data-tab-item=srcappvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @file Main Vue Application
</span></span></span><span class=line><span class=cl><span class=cm> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import Components
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>Toast</span> <span class=nx>from</span> <span class=s1>&#39;primevue/toast&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>ConfirmDialog</span> <span class=nx>from</span> <span class=s1>&#39;primevue/confirmdialog&#39;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>import</span> <span class=nx>DynamicDialog</span> <span class=nx>from</span> <span class=s1>&#39;primevue/dynamicdialog&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>TopMenu</span> <span class=nx>from</span> <span class=s1>&#39;./components/layout/TopMenu.vue&#39;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>header</span><span class=p>&gt;&lt;/</span><span class=nt>header</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>nav</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>Navigation</span> <span class=nx>Menu</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>TopMenu</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>nav</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>main</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;m-2&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=c>&lt;!--</span> <span class=nx>Main</span> <span class=nx>Application</span> <span class=nx>View</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>RouterView</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>main</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>footer</span><span class=p>&gt;&lt;/</span><span class=nt>footer</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>Toast</span> <span class=na>position</span><span class=o>=</span><span class=s>&#34;bottom-right&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>ConfirmDialog</span> <span class=p>/&gt;</span>
</span></span><span class="line hl"><span class=cl>  <span class=p>&lt;</span><span class=nt>DynamicDialog</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span></span></span></code></pre></div></div></div></div></div><p>That&rsquo;s all it takes to make this feature available throughout our application.</p><h2 id=updating-userslist-to-use-dynamicdialog>Updating UsersList to use DynamicDialog</h2><p>Now, in our <code>UsersList</code> component, we simply have to add a few imports as well as function to load the component in a dialog box:</p><div class=tab-panel data-tab-group=d25b26ae0f17acbc1e4390893e722031><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersuserslistvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d25b26ae0f17acbc1e4390893e722031","srccomponentsusersuserslistvue")'>
<span class=tab-nav-text>src/components/users/UsersList.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersuserslistvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Import Libraries
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>ref</span><span class=p>,</span> <span class=nx>defineAsyncComponent</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>formatDistance</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;date-fns&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>DataTable</span> <span class=nx>from</span> <span class=s1>&#39;primevue/datatable&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Column</span> <span class=nx>from</span> <span class=s1>&#39;primevue/column&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>IconField</span><span class=p>,</span> <span class=nx>InputIcon</span><span class=p>,</span> <span class=nx>InputText</span><span class=p>,</span> <span class=nx>MultiSelect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;primevue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>FilterMatchMode</span><span class=p>,</span> <span class=nx>FilterService</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@primevue/core/api&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>RoleChip</span> <span class=nx>from</span> <span class=s1>&#39;../roles/RoleChip.vue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Button</span> <span class=nx>from</span> <span class=s1>&#39;primevue/button&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useRouter</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue-router&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>useRouter</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useToast</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;primevue/usetoast&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>toast</span> <span class=o>=</span> <span class=nx>useToast</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useConfirm</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;primevue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>confirm</span> <span class=o>=</span> <span class=nx>useConfirm</span><span class=p>()</span>
</span></span><span class="line hl"><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useDialog</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;primevue/usedialog&#39;</span><span class=p>;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>const</span> <span class=nx>dialog</span> <span class=o>=</span> <span class=nx>useDialog</span><span class=p>();</span>
</span></span><span class="line hl"><span class=cl><span class=kr>const</span> <span class=nx>userEditComponent</span> <span class=o>=</span> <span class=nx>defineAsyncComponent</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=kr>import</span><span class=p>(</span><span class=s1>&#39;./UserEdit.vue&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class="line hl"><span class=cl><span class=c1>// Load Dialog
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>editDialog</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>  <span class=nx>dialog</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=nx>userEditComponent</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>    <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>      <span class=nx>style</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>          <span class=nx>width</span><span class=o>:</span> <span class=s1>&#39;40vw&#39;</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>      <span class=p>},</span>
</span></span><span class="line hl"><span class=cl>      <span class=nx>modal</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class="line hl"><span class=cl>    <span class=p>},</span>
</span></span><span class="line hl"><span class=cl>    <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>      <span class=nx>id</span><span class=o>:</span> <span class=nx>id</span>
</span></span><span class="line hl"><span class=cl>    <span class=p>}</span>
</span></span><span class="line hl"><span class=cl>  <span class=p>});</span>
</span></span><span class="line hl"><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div></div></div></div></div><p>Notice in the <code>dialog.open</code> function call, we are including the <code>userEditComponent</code> that we are loading asynchronously in the background using the <code>defineAsyncComponent</code> function in Vue. This allows us to load the main <code>UsersList</code> component fully first, and then in the background it will load the <code>UserEdit</code> component as needed. We are also passing along the <code>id</code> of the user to be edited as part of the <code>data</code> that is sent to the component.</p><p>Finally, in the template, we just replace the click handlers for the <strong>New</strong> and <strong>Edit</strong> buttons to call this new <code>editDialog</code> function:</p><div class=tab-panel data-tab-group=1b3c36c4dd7fef054275a6afc85f557e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersuserslistvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("1b3c36c4dd7fef054275a6afc85f557e","srccomponentsusersuserslistvue")'>
<span class=tab-nav-text>src/components/users/UsersList.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersuserslistvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>DataTable</span>
</span></span><span class=line><span class=cl>    <span class=nt>:value</span><span class=o>=</span><span class=s>&#34;users&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>v</span><span class=nt>-model:filters</span><span class=o>=</span><span class=s>&#34;filters&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nt>:globalFilterFields</span><span class=o>=</span><span class=s>&#34;[&#39;username&#39;]&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>filterDisplay</span><span class=o>=</span><span class=s>&#34;menu&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>sortField</span><span class=o>=</span><span class=s>&#34;username&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nt>:sortOrder</span><span class=o>=</span><span class=s>&#34;1&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>template</span> <span class=err>#</span><span class=na>header</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex justify-between&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>Button</span>
</span></span><span class=line><span class=cl>          <span class=na>label</span><span class=o>=</span><span class=s>&#34;New User&#34;</span>
</span></span><span class=line><span class=cl>          <span class=na>icon</span><span class=o>=</span><span class=s>&#34;pi pi-user-plus&#34;</span>
</span></span><span class=line><span class=cl>          <span class=na>severity</span><span class=o>=</span><span class=s>&#34;success&#34;</span>
</span></span><span class="line hl"><span class=cl>          <span class=nt>@click</span><span class=s>=&#34;editDialog()&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!--</span> <span class=nx>other</span> <span class=nx>code</span> <span class=nx>omitted</span> <span class=nx>here</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>other</span> <span class=nx>code</span> <span class=nx>omitted</span> <span class=nx>here</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>Column</span> <span class=na>header</span><span class=o>=</span><span class=s>&#34;Actions&#34;</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;min-width: 8rem&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>template</span> <span class=err>#</span><span class=na>body</span><span class=o>=</span><span class=s>&#34;slotProps&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex gap-2&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>Button</span>
</span></span><span class=line><span class=cl>            <span class=na>icon</span><span class=o>=</span><span class=s>&#34;pi pi-pencil&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>outlined</span>
</span></span><span class=line><span class=cl>            <span class=na>rounded</span>
</span></span><span class="line hl"><span class=cl>            <span class=nt>@click</span><span class=s>=&#34;editDialog(slotProps.data.id)&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>v</span><span class=nt>-tooltip</span><span class=na>.bottom</span><span class=err>=&#34;&#39;</span><span class=na>Edit</span><span class=err>&#39;&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>&lt;</span><span class=nt>Button</span>
</span></span><span class=line><span class=cl>            <span class=na>icon</span><span class=o>=</span><span class=s>&#34;pi pi-trash&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>outlined</span>
</span></span><span class=line><span class=cl>            <span class=na>rounded</span>
</span></span><span class=line><span class=cl>            <span class=na>severity</span><span class=o>=</span><span class=s>&#34;danger&#34;</span>
</span></span><span class=line><span class=cl>            <span class=nt>@click</span><span class=s>=&#34;confirmDelete(slotProps.data.id)&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>v</span><span class=nt>-tooltip</span><span class=na>.bottom</span><span class=err>=&#34;&#39;</span><span class=na>Delete</span><span class=err>&#39;&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>Column</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>DataTable</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span></span></span></code></pre></div></div></div></div></div><p>Now, when we click those buttons, it will open the <code>EditUser</code> component in a modal popup dialog instead of directing users to a new route. Of course, on some pages, we may need to check that the user has specific roles before allowing the user to actually load the popup, just like we have to check for those roles before the user navigates to those routes. Since we are now bypassing the Vue Router, any logic in the router may need to be recreated here.</p><h2 id=updating-useredit-component>Updating UserEdit Component</h2><p>Finally, we must make a few minor tweaks to the <code>UserEdit</code> component so that it can run seamlessly in both a stand-alone view as well as part of a popup dialog. The major change comes in the way the incoming data is received, and what should happen when the user is successfully saved.</p><p>The PrimeVue DynamicDialog service uses Vue&rsquo;s <a href=https://vuejs.org/guide/components/provide-inject rel=external target=_blank>Provide / Inject</a> interface to send data to the component loaded in a dialog. So, in our component, we must declare a few additional state variables, as well as small piece of code to detect whether it is running in a dialog or as a standalone component in a view.</p><div class=tab-panel data-tab-group=ef2536d4a8d4c534e99dcb18e0827039><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersusereditvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ef2536d4a8d4c534e99dcb18e0827039","srccomponentsusersusereditvue")'>
<span class=tab-nav-text>src/components/users/UserEdit.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersusereditvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Declare State
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>errors</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>([])</span>
</span></span><span class="line hl"><span class=cl><span class=kr>const</span> <span class=nx>isDialog</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class="line hl"><span class=cl><span class=kr>const</span> <span class=nx>userId</span> <span class=o>=</span> <span class=nx>ref</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=c1>// Detect Dialog
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>dialogRef</span> <span class=o>=</span> <span class=nx>inject</span><span class=p>(</span><span class=s1>&#39;dialogRef&#39;</span><span class=p>)</span>
</span></span><span class="line hl"><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>dialogRef</span> <span class=o>&amp;&amp;</span> <span class=nx>dialogRef</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>  <span class=c1>// running in a dialog
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>  <span class=nx>isDialog</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class="line hl"><span class=cl>  <span class=nx>userId</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>dialogRef</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class="line hl"><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>  <span class=c1>// running in a view
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>  <span class=nx>userId</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>props</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class="line hl"><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div></div></div></div></div><p>For this component, we have created a new <code>isDialog</code> reactive state variable that will be set to <code>true</code> if the component detects it has been loaded in a dynamic dialog. It does this by checking for the status of the <code>dialogRef</code> injected state variable. We are also now storing the ID of the user to be edited in a new <code>userId</code> reactive state variable instead of relying on the <code>props.id</code> variable, which will not be present when the component is loaded in a dialog.</p><p>So, we simply need to replace all references to <code>props.id</code> to use <code>userId</code> instead. We can also change the action that occurs when the user is successfully saved - if the component is running in a dialog, it should simply close the dialog instead of using the router to navigate back to the previous page.</p><div class=tab-panel data-tab-group=f2f8fb52ea48cdaae1e27c0461a472e8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersusereditvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f2f8fb52ea48cdaae1e27c0461a472e8","srccomponentsusersusereditvue")'>
<span class=tab-nav-text>src/components/users/UserEdit.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersusereditvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>setup</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Find Single User
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>  <span class=k>return</span> <span class=nx>users</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>find</span><span class=p>((</span><span class=nx>u</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>u</span><span class=p>.</span><span class=nx>id</span> <span class=o>==</span> <span class=nx>userId</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=o>||</span> <span class=p>{</span> <span class=nx>username</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nx>roles</span><span class=o>:</span> <span class=p>[]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Save User
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>save</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>errors</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>  <span class=nx>userStore</span>
</span></span><span class="line hl"><span class=cl>    <span class=p>.</span><span class=nx>saveUser</span><span class=p>(</span><span class=nx>userId</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span> <span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=mi>201</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>toast</span><span class=p>.</span><span class=nx>add</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>severity</span><span class=o>:</span> <span class=s1>&#39;success&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>summary</span><span class=o>:</span> <span class=s1>&#39;Success&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>detail</span><span class=o>:</span> <span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>message</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>life</span><span class=o>:</span> <span class=mi>5000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class="line hl"><span class=cl>        <span class=nx>leave</span><span class=p>()</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=mi>422</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>toast</span><span class=p>.</span><span class=nx>add</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>severity</span><span class=o>:</span> <span class=s1>&#39;warn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>summary</span><span class=o>:</span> <span class=s1>&#39;Warning&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>detail</span><span class=o>:</span> <span class=nx>error</span><span class=p>.</span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>error</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>life</span><span class=o>:</span> <span class=mi>5000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=nx>errors</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>error</span><span class=p>.</span><span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>errors</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>toast</span><span class=p>.</span><span class=nx>add</span><span class=p>({</span> <span class=nx>severity</span><span class=o>:</span> <span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=nx>summary</span><span class=o>:</span> <span class=s1>&#39;Error&#39;</span><span class=p>,</span> <span class=nx>detail</span><span class=o>:</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>life</span><span class=o>:</span> <span class=mi>5000</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=c1>// Leave Component
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>leave</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>isDialog</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>    <span class=nx>dialogRef</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>close</span><span class=p>()</span>
</span></span><span class="line hl"><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>    <span class=nx>router</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span> <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;users&#39;</span> <span class=p>})</span>
</span></span><span class="line hl"><span class=cl>  <span class=p>}</span>
</span></span><span class="line hl"><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span></span></span></code></pre></div></div></div></div></div><p>Finally, we can make a minor update to the template to also use the <code>userId</code> value instead of <code>props.id</code></p><div class=tab-panel data-tab-group=691507ad66c900b2bbb5f0ed609d6989><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersusereditvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("691507ad66c900b2bbb5f0ed609d6989","srccomponentsusersusereditvue")'>
<span class=tab-nav-text>src/components/users/UserEdit.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersusereditvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;flex flex-col gap-3 max-w-xl justify-items-center&#34;</span><span class=p>&gt;</span>
</span></span><span class="line hl"><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;text-xl text-center m-1&#34;</span><span class=p>&gt;{{</span> <span class=nx>userId</span> <span class=o>?</span> <span class=s1>&#39;Edit User&#39;</span> <span class=o>:</span> <span class=s1>&#39;New User&#39;</span> <span class=p>}}&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>other</span> <span class=nx>code</span> <span class=nx>omitted</span> <span class=nx>here</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl>    <span class=p>&lt;</span><span class=nt>Button</span> <span class=na>severity</span><span class=o>=</span><span class=s>&#34;secondary&#34;</span> <span class=nt>@click</span><span class=s>=&#34;leave&#34;</span> <span class=na>label</span><span class=o>=</span><span class=s>&#34;Cancel&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span></span></span></code></pre></div></div></div></div></div><p>That&rsquo;s all it takes! Now, when we click the <strong>New User</strong> or <strong>Edit User</strong> buttons on our <code>UsersList</code> component, we&rsquo;ll see a pop-up dialog that contains our <code>UserEdit</code> component instead of being taken to an entirely new page.</p><p><a href=#R-image-85bd98a261d3d31cda5a04f464c53838 class=lightbox-link><img alt=DynamicDialog class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/07/dynamicdialog.gif style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-85bd98a261d3d31cda5a04f464c53838><img alt=DynamicDialog class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/07/dynamicdialog.gif></a></p><h2 id=a-bug-reactive-state-across-components>A Bug! Reactive State Across Components</h2><p>A very keen eye may notice a bug in the implementation of this component already - what if the user changes a value but then clicks the <strong>Cancel</strong> button on the modal dialog? Let&rsquo;s see what that looks like:</p><p><a href=#R-image-d16067e0e8d2e06d9e7df990b7024cf2 class=lightbox-link><img alt=DynamicDialogBug class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/07/dynamicdialogbug.gif style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d16067e0e8d2e06d9e7df990b7024cf2><img alt=DynamicDialogBug class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/07/dynamicdialogbug.gif></a></p><p>As we can see, the edits made in the <code>UserEdit</code> dialog are immediately reflected in the contents of the <code>UsersList</code> component as well. This is because they are both using the same Pinia store and referencing the same list of users in both components. So, this can present all sorts of strange issues in our program.</p><p>There are at least a couple of different ways we can go about fixing this:</p><ol><li>When the dialog closes, we can call <code>userStore.hydrate()</code> from the <code>UsersList</code> component to ensure that it has the latest version of the data from the server. However, if we do this, we could end up calling it twice when a user is saved, since the <code>User</code> store already does this.</li><li>In our <code>EditUser</code> component, we can make sure we are editing a deep copy of our user, and not the same user reference as the one in our Pinia store.</li></ol><p>Let&rsquo;s implement the second solution. Thankfully, it is as simple as using <code>JSON.parse</code> and <code>JSON.stringify</code> to create a quick deep copy of the user we are editing. We can do this in our computed Vue state variable in that component:</p><div class=tab-panel data-tab-group=fa8a13da5c6dfb63de1ec926c113d88b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srccomponentsusersusereditvue class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("fa8a13da5c6dfb63de1ec926c113d88b","srccomponentsusersusereditvue")'>
<span class=tab-nav-text>src/components/users/UserEdit.vue</span></button></div><div class=tab-content-container><div data-tab-item=srccomponentsusersusereditvue class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Find Single User
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=nx>computed</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>  <span class=k>return</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span>
</span></span><span class="line hl"><span class=cl>    <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>users</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>find</span><span class=p>((</span><span class=nx>u</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>u</span><span class=p>.</span><span class=nx>id</span> <span class=o>==</span> <span class=nx>userId</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=o>||</span> <span class=p>{</span> <span class=nx>username</span><span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nx>roles</span><span class=o>:</span> <span class=p>[]</span> <span class=p>}),</span>
</span></span><span class="line hl"><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>// -=-=- other code omitted here -=-=-</span></span></span></code></pre></div></div></div></div></div><p>With that change in place, we no longer see the bug in our output:</p><p><a href=#R-image-f69d01b02da7f84770fc66d7d53905a0 class=lightbox-link><img alt="DynamicDialog Fixed" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/07/dynamicdialogfixed.gif style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f69d01b02da7f84770fc66d7d53905a0><img alt="DynamicDialog Fixed" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/07/dynamicdialogfixed.gif></a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=preparing-for-deployment>Preparing for Deployment</h1><a href="https://www.youtube.com/watch?v=id">YouTube Video</a><h2 id=preparing-for-deployment>Preparing for Deployment</h2><p>At this point, we have a pretty well developed application, so let&rsquo;s start preparing for deployment. Our end goal is to build a single Docker container that contains our application, as well as the ability to deploy it along with a production database like <a href=https://www.postgresql.org/ rel=external target=_blank>Postgres</a>.</p><p>To begin, we need to create a finalized version of our Vue frontend that can be embedded into our backend application directly.</p><h2 id=building-in-vue>Building in Vue</h2><p>To create a deployment build of our Vue application, we can simply run the following command in the <code>client</code> folder of our application:</p><div class=tab-panel data-tab-group=bd7daba791cc51a46697a3e05feef04f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("bd7daba791cc51a46697a3e05feef04f","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm run build</span></span></code></pre></div></div></div></div></div><p>When we run that command, we get lots of output about the different parts of our application that are put together to make the final version. We may also get some warnings about chunks being larger than the cutoff, which we won&rsquo;t worry about for now.</p><p>The final version of our application can be found in a new <code>dist</code> folder inside of our <code>client</code> folder, with a long list of contents:</p><p><a href=#R-image-1d8d4dd6b376002538c39eb2a28c82ae class=lightbox-link><img alt="Dist Folder Contents" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/07/build_dist.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-1d8d4dd6b376002538c39eb2a28c82ae><img alt="Dist Folder Contents" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/07/build_dist.png></a></p><p>The <code>assets</code> folder contains a large number of items that are all compiled and assembled by the Vite build tool for our application. The key file, however, is the <code>index.html</code> file, which is placed there to serve as the starting point for our application.</p><h2 id=testing-the-built-application>Testing the Built Application</h2><p>To fully test this application, we</p><footer class=footline></footer></article></section></div></main><div class=git-footer><p class=theme-version-footer>6.0.0</p><p>Last modified by:
<i class='fas fa-user'></i> Russell Feldhausen
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cis526/commit/6c854784ca8f2038eebd3a7853c10fa1456f4440>Apr 16, 2025</a></p></div></div><script src=/cis526/js/clipboard.min.js?1744837859 defer></script><script src=/cis526/js/perfect-scrollbar.min.js?1744837859 defer></script><script src=/cis526/js/theme.js?1744837859 defer></script></body></html>