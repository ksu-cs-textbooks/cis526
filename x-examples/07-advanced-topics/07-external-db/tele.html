<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.148.1"><meta name=generator content="Relearn 8.0.0"><meta name=description content="YouTube Video Connecting to an External Database Finally, what if we’d like to update our application to connect to an external database? This could be very useful if we plan on using this application in production with a large amount of data, because an external database will be much faster and handle large amounts of data much better than our SQLite database stored in a single file.
For this example, we’ll update our application to be able to use Postgres. Most of this process can be discovered by reading the Sequelize Documentation to see how to connect other database types to our application."><meta name=author content="Nathan Bean & Russell Feldhausen"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta name=twitter:title content="External Database :: CIS 526 Textbook"><meta name=twitter:description content="YouTube Video Connecting to an External Database Finally, what if we’d like to update our application to connect to an external database? This could be very useful if we plan on using this application in production with a large amount of data, because an external database will be much faster and handle large amounts of data much better than our SQLite database stored in a single file.
For this example, we’ll update our application to be able to use Postgres. Most of this process can be discovered by reading the Sequelize Documentation to see how to connect other database types to our application."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/x-examples/07-advanced-topics/07-external-db/index.html"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="External Database :: CIS 526 Textbook"><meta property="og:description" content="YouTube Video Connecting to an External Database Finally, what if we’d like to update our application to connect to an external database? This could be very useful if we plan on using this application in production with a large amount of data, because an external database will be much faster and handle large amounts of data much better than our SQLite database stored in a single file.
For this example, we’ll update our application to be able to use Postgres. Most of this process can be discovered by reading the Sequelize Documentation to see how to connect other database types to our application."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="Example Projects"><meta property="article:modified_time" content="2025-04-26T15:56:55-05:00"><meta property="og:image" content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta itemprop=name content="External Database :: CIS 526 Textbook"><meta itemprop=description content="YouTube Video Connecting to an External Database Finally, what if we’d like to update our application to connect to an external database? This could be very useful if we plan on using this application in production with a large amount of data, because an external database will be much faster and handle large amounts of data much better than our SQLite database stored in a single file.
For this example, we’ll update our application to be able to use Postgres. Most of this process can be discovered by reading the Sequelize Documentation to see how to connect other database types to our application."><meta itemprop=dateModified content="2025-04-26T15:56:55-05:00"><meta itemprop=wordCount content="1001"><meta itemprop=image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><title>External Database :: CIS 526 Textbook</title><link href=https://textbooks.cs.ksu.edu/cis526/x-examples/07-advanced-topics/07-external-db/index.html rel=canonical type=text/html title="External Database :: CIS 526 Textbook"><link href=/cis526/x-examples/07-advanced-topics/07-external-db/index.xml rel=alternate type=application/rss+xml title="External Database :: CIS 526 Textbook"><link href=/cis526/x-examples/07-advanced-topics/07-external-db/index.print.html rel=alternate type=text/html title="External Database :: CIS 526 Textbook"><link href=/cis526/x-examples/07-advanced-topics/07-external-db/embed.html rel=alternate type=text/html title="External Database :: CIS 526 Textbook"><link href=/cis526/css/auto-complete/auto-complete.min.css?1768424848 rel=stylesheet><script src=/cis526/js/auto-complete/auto-complete.min.js?1768424848 defer></script><script src=/cis526/js/search-lunr.min.js?1768424848 defer></script><script src=/cis526/js/search.min.js?1768424848 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/cis526/searchindex.en.js?1768424848"</script><script src=/cis526/js/lunr/lunr.min.js?1768424848 defer></script><script src=/cis526/js/lunr/lunr.stemmer.support.min.js?1768424848 defer></script><script src=/cis526/js/lunr/lunr.multi.min.js?1768424848 defer></script><script src=/cis526/js/lunr/lunr.en.min.js?1768424848 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1768424848 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1768424848 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar/perfect-scrollbar.min.css?1768424848 rel=stylesheet><link href=/cis526/css/theme.min.css?1768424848 rel=stylesheet><link href=/cis526/css/format-html.min.css?1768424848 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/x-examples/07-advanced-topics/07-external-db/index.html",window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!1,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["light-theme"],window.relearn.customvariantname="my-custom-variant",window.relearn.writeVariant=!1,window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.writeVariant&&window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><link href=/cis526/css/custom.css?1768424848 rel=stylesheet></head><body class="mobile-support html" data-url=/cis526/x-examples/07-advanced-topics/07-external-db/index.html><div id=tele class="tele mirror"><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable x-examples" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=external-database>External Database</h1><a href="https://www.youtube.com/watch?v=z95i3xT8DN4">YouTube Video</a><h2 id=connecting-to-an-external-database>Connecting to an External Database</h2><p>Finally, what if we&rsquo;d like to update our application to connect to an external database? This could be very useful if we plan on using this application in production with a large amount of data, because an external database will be much faster and handle large amounts of data much better than our SQLite database stored in a single file.</p><p>For this example, we&rsquo;ll update our application to be able to use <a href=https://www.postgresql.org/ rel=external target=_blank>Postgres</a>. Most of this process can be discovered by reading the <a href=https://sequelize.org/docs/v6/getting-started/ rel=external target=_blank>Sequelize Documentation</a> to see how to connect other database types to our application.</p><h2 id=update-database-configuration>Update Database Configuration</h2><p>First, we need to update the database configuration for our application, which is in the <code>configs/database.js</code> file in our <code>server</code> folder. We&rsquo;ll add several additional options to allow us to specify the dialect, hostname, username, and password for another database engine.</p><div class=tab-panel data-tab-group=8e6000612a7e58e31686487f0e096a8f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configsdatabasejs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("8e6000612a7e58e31686487f0e096a8f","configsdatabasejs")'>
<span class=tab-nav-text>configs/database.js</span></button></div><div class=tab-content-container><div data-tab-item=configsdatabasejs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Configuration information for Sequelize database ORM
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports sequelize a Sequelize instance
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Sequelize</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;sequelize&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import logger configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>logger</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./logger.js&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create Sequelize instance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sequelize</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Sequelize</span>({
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Supports &#34;sqlite&#34; or &#34;postgres&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>dialect</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_DIALECT</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;sqlite&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Only used by SQLite
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>storage</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_FILE</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;:memory:&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Used by Postgres
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>host</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_HOST</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;lostcommunities_db&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>port</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_PORT</span> <span style=color:#f92672>||</span> <span style=color:#ae81ff>5432</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_USERNAME</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;lostcommunities&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>password</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_PASSWORD</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;lostcommunities&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>database</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_NAME</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;lostcommunities&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>logging</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>sql</span>.<span style=color:#a6e22e>bind</span>(<span style=color:#a6e22e>logger</span>),
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>sequelize</span>;</span></span></code></pre></div></div></div></div></div><p>We&rsquo;ll also need to install the appropriate database libraries in our <code>server</code> application:</p><div class=tab-panel data-tab-group=22ff09481f960ac66c2d16aa98768fbe><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("22ff09481f960ac66c2d16aa98768fbe","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm install pg pg-hstore</span></span></code></pre></div></div></div></div></div><h2 id=properly-update-ids-after-seeding>Properly Update IDs after Seeding</h2><p>In addition, we also must handle a bug where Postgres will not properly keep track of any IDs that are added during the seeding process, so in each of our seeds we need to update the internal sequence used by Postgres to keep track of the next ID to use:</p><div class=tab-panel data-tab-group=7978b79d7c79fb6397788a6865401b2c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=seeds00_usersjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("7978b79d7c79fb6397788a6865401b2c","seeds00_usersjs")'>
<span class=tab-nav-text>seeds/00_users.js</span></button></div><div class=tab-content-container><div data-tab-item=seeds00_usersjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>up</span>({ <span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>queryInterface</span> }) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>bulkInsert</span>(<span style=color:#e6db74>&#34;users&#34;</span>, <span style=color:#a6e22e>users</span>);
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_DIALECT</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;postgres&#39;</span>) {
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>sequelize</span>.<span style=color:#a6e22e>query</span>(<span style=color:#e6db74>&#34;SELECT setval(&#39;users_id_seq&#39;, max(id)) FROM users;&#34;</span>);
</span></span><span style=display:flex;background-color:#3c3d38><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=bb795949edda3b04b67082231df5ad63><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=seeds01_rolesjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("bb795949edda3b04b67082231df5ad63","seeds01_rolesjs")'>
<span class=tab-nav-text>seeds/01_roles.js</span></button></div><div class=tab-content-container><div data-tab-item=seeds01_rolesjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>up</span>({ <span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>queryInterface</span> }) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>bulkInsert</span>(<span style=color:#e6db74>&#34;roles&#34;</span>, <span style=color:#a6e22e>roles</span>);
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_DIALECT</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;postgres&#39;</span>) {
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>sequelize</span>.<span style=color:#a6e22e>query</span>(<span style=color:#e6db74>&#34;SELECT setval(&#39;roles_id_seq&#39;, max(id)) FROM roles;&#34;</span>);
</span></span><span style=display:flex;background-color:#3c3d38><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>bulkInsert</span>(<span style=color:#e6db74>&#34;user_roles&#34;</span>, <span style=color:#a6e22e>user_roles</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>This error is discussed at length in a <a href=https://github.com/sequelize/sequelize/issues/9295 rel=external target=_blank>Sequelize GitHub Issue</a>.</p><h2 id=environment-variables>Environment Variables</h2><p>We should also add these new environment variable entries to our <code>.env.example</code> file, including relocating the existing <code>DATABASE_FILE</code> entry to this section with the others. Since we aren&rsquo;t using them in development or testing, we can leave them out of the other files for now.</p><div class=tab-panel data-tab-group=2b4be425b570bf742c8779abdc8c7b77><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=envexample class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2b4be425b570bf742c8779abdc8c7b77","envexample")'>
<span class=tab-nav-text>.env.example</span></button></div><div class=tab-content-container><div data-tab-item=envexample class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-env data-lang=env><span style=display:flex><span><span style=color:#75715e># -=-=- other settings omitted here -=-=-</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Database Settings</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Options are &#34;sqlite&#34; or &#34;postgres&#34;</span>
</span></span><span style=display:flex><span>DATABASE_DIALECT<span style=color:#f92672>=</span>sqlite
</span></span><span style=display:flex><span><span style=color:#75715e># File is specified for SQLite</span>
</span></span><span style=display:flex><span>DATABASE_FILE<span style=color:#f92672>=</span>database.sqlite
</span></span><span style=display:flex><span><span style=color:#75715e># Other settings are for Postgres</span>
</span></span><span style=display:flex><span>DATABASE_HOST<span style=color:#f92672>=</span>localhost
</span></span><span style=display:flex><span>DATABASE_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>DATABASE_USERNAME<span style=color:#f92672>=</span>lostcommunities
</span></span><span style=display:flex><span>DATABASE_PASSWORD<span style=color:#f92672>=</span>lostcommunities
</span></span><span style=display:flex><span>DATABASE_NAME<span style=color:#f92672>=</span>lostcommunities</span></span></code></pre></div></div></div></div></div><h2 id=update-docker-compose>Update Docker Compose</h2><p>To test this, we&rsquo;ll need a running Postgres instance. While we can create one in our GitHub Codespaces by adding some additional configuration files, it is a bit more complex. So, let&rsquo;s just update our <code>compose.yml</code> file for deployment and test using another database there.</p><div class=tab-panel data-tab-group=acf3b4d95d4f61976df2319927d07d48><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=composeyml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("acf3b4d95d4f61976df2319927d07d48","composeyml")'>
<span class=tab-nav-text>compose.yml</span></button></div><div class=tab-content-container><div data-tab-item=composeyml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>######################################</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Lost Communities Solution</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Repository:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># https://github.com/cis526-codio/lost-communities-solution</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>lostcommunities</span>:
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Docker Image</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ghcr.io/cis526-codio/lost-communities-solution:latest</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Container Name</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>lostcommunities</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Restart Container Unless Stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Networks</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>lostcommunities_network</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Network Ports</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;3000:3000&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Volumes</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>lostcommunities_data:/usr/src/app/data:rw</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>lostcommunities_uploads:/usr/src/app/public/uploads:rw</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Environment Variables</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># =+=+=+= REQUIRED VALUES =+=+=+=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># These values must be configured for deployment</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Session Secret Key</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>SESSION_SECRET</span>: <span style=color:#e6db74>&#39;thisisasupersecretkey&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># JWT Secret Key</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>JWT_SECRET_KEY</span>: <span style=color:#e6db74>&#39;thisisasupersecretkey&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Use Node and run `require(&#39;crypto&#39;).randomBytes(64).toString(&#39;hex&#39;)` to get a random value</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># CAS Authentication Settings</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># CAS Server URL (send users here to login)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>CAS_URL</span>: <span style=color:#e6db74>&#39;https://testcas.cs.ksu.edu&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># CAS Service URL (CAS returns users here; usually where this app is deployed)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>CAS_SERVICE_URL</span>: <span style=color:#e6db74>&#39;http://localhost:3000&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Database Options</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Database Dialect</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Options: &#39;sqlite&#39; (default) or &#39;postgres&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_DIALECT</span>: <span style=color:#e6db74>&#39;postgres&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># For SQLite Only - Specify file location</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Options: &#39;:memory:&#39; to use an in-memory database (not recommended), or any file name otherwise</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># DATABASE_FILE: &#39;data/database.sqlite&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># For Postgres Only - Specify database information</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_HOST</span>: <span style=color:#ae81ff>lostcommunities_db</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_PORT</span>: <span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_USERNAME</span>: <span style=color:#ae81ff>lostcommunities</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_PASSWORD</span>: <span style=color:#ae81ff>lostcommunities</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_NAME</span>: <span style=color:#ae81ff>lostcommunities</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Seed initial data on first startup</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>SEED_DATA</span>: <span style=color:#e6db74>&#39;true&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># =+=+=+= OPTIONAL VALUES =+=+=+=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># These values are set to reasonable defaults</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># but can be overridden. Default values are shown as comments</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Log Level</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Options: error | warn | info | http | verbose | debug | sql | silly</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#LOG_LEVEL: &#39;http&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Network Port Within the Container</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#PORT: &#39;3000&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># =+=+=+= OTHER VALUES =+=+=+=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># These values are not recommended for deployment but are available</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Custom Session Cookie Name</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#SESSION_NAME: &#39;connect.sid&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Open API Documentation</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Show OpenAPI Documentation at `/docs` path</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#OPENAPI_VISIBLE: &#39;false&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Open API Host for testing</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#OPENAPI_HOST: &#39;http://localhost:3000&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Export Open API JSON File</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#OPENAPI_EXPORT: &#39;false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Open API Export File Path</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#OPENAPI_EXPORT_PATH: &#39;openapi.json&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Enable Bypass Authentication</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Use path `/auth/bypass?token=&lt;username&gt;` to log in as any user</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># DO NOT ENABLE IN PRODUCTION - THIS IS INSECURE!</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#BYPASS_AUTH: &#39;false&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>######################################</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Postgres Database</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Image Location:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># https://hub.docker.com/_/postgres</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>lostcommunities_db</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Docker Image</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres:17-alpine</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Container Name</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>lostcommunities_db</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Restart Container Unless Stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Networks</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>lostcommunities_network</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Volumes</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>lostcommunities_db_data:/var/lib/postgresql/data:rw</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Environment Variables</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_USER</span>: <span style=color:#ae81ff>lostcommunities</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_PASSWORD</span>: <span style=color:#ae81ff>lostcommunities</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_DB</span>: <span style=color:#ae81ff>lostcommunities</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>lostcommunities_data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>lostcommunities_uploads</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>lostcommunities_db_data</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>lostcommunities_network</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>internal</span>: <span style=color:#66d9ef>true</span></span></span></code></pre></div></div></div></div></div><p>This Docker Compose file follows some best practices for deploying a Postgres container in the cloud, and even separates the database connection between our application container and the Postgres container in an internal Docker network to make it even more secure.</p><p>Once we deploy this application, we can even check that the Postgres server has our current data to ensure it is working properly:</p><p><a href=#R-image-b0e402a1a94e3788990dde555bd670f8 class=lightbox-link><img alt="Postgres Running" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/07/deploy_9.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b0e402a1a94e3788990dde555bd670f8><img alt="Postgres Running" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/07/deploy_9.png></a></p><p>Now our application is ready for a full deployment!</p><footer class=footline></footer></article></div></main></div><script src=/cis526/js/clipboard/clipboard.min.js?1768424848 defer></script><script src=/cis526/js/perfect-scrollbar/perfect-scrollbar.min.js?1768424848 defer></script><script src=/cis526/js/theme.min.js?1768424848 defer></script></div><script src=/cis526/js/tele-scroll.min.js?1768424848 defer></script></body></html>