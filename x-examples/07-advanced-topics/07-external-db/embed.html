<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="Connecting to an External Database Finally, what if we’d like to update our application to connect to an external database? This could be very useful if we plan on using this application in production with a large amount of data, because an external database will be much faster and handle large amounts of data much better than our SQLite database stored in a single file.
For this example, we’ll update our application to be able to use Postgres."><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="External Database :: CIS 526 Textbook"><meta name=twitter:description content="Connecting to an External Database Finally, what if we’d like to update our application to connect to an external database? This could be very useful if we plan on using this application in production with a large amount of data, because an external database will be much faster and handle large amounts of data much better than our SQLite database stored in a single file.
For this example, we’ll update our application to be able to use Postgres."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/x-examples/07-advanced-topics/07-external-db/embed.html"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="External Database :: CIS 526 Textbook"><meta property="og:description" content="Connecting to an External Database Finally, what if we’d like to update our application to connect to an external database? This could be very useful if we plan on using this application in production with a large amount of data, because an external database will be much faster and handle large amounts of data much better than our SQLite database stored in a single file.
For this example, we’ll update our application to be able to use Postgres."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Example Projects"><meta property="article:modified_time" content="2025-04-26T15:56:55-05:00"><meta itemprop=name content="External Database :: CIS 526 Textbook"><meta itemprop=description content="Connecting to an External Database Finally, what if we’d like to update our application to connect to an external database? This could be very useful if we plan on using this application in production with a large amount of data, because an external database will be much faster and handle large amounts of data much better than our SQLite database stored in a single file.
For this example, we’ll update our application to be able to use Postgres."><meta itemprop=dateModified content="2025-04-26T15:56:55-05:00"><meta itemprop=wordCount content="999"><title>External Database :: CIS 526 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis526/x-examples/07-advanced-topics/07-external-db/ rel=canonical type=text/html title="External Database :: CIS 526 Textbook"><link href=/cis526/x-examples/07-advanced-topics/07-external-db/index.xml rel=alternate type=application/rss+xml title="External Database :: CIS 526 Textbook"><link href=/cis526/x-examples/07-advanced-topics/07-external-db/index.print.html rel=alternate type=text/html title="External Database :: CIS 526 Textbook"><link href=/cis526/x-examples/07-advanced-topics/07-external-db/tele.html rel=alternate type=text/html title="External Database :: CIS 526 Textbook"><link href=/cis526/css/fontawesome-all.min.css?1746820435 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fontawesome-all.min.css?1746820435 rel=stylesheet></noscript><link href=/cis526/css/nucleus.css?1746820435 rel=stylesheet><link href=/cis526/css/auto-complete.css?1746820435 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/auto-complete.css?1746820435 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar.min.css?1746820435 rel=stylesheet><link href=/cis526/css/fonts.css?1746820435 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fonts.css?1746820435 rel=stylesheet></noscript><link href=/cis526/css/theme.css?1746820435 rel=stylesheet><link href=/cis526/css/theme-light-theme.css?1746820435 rel=stylesheet id=R-variant-style><link href=/cis526/css/chroma-relearn-light.css?1746820435 rel=stylesheet id=R-variant-chroma-style><link href=/cis526/css/variant.css?1746820435 rel=stylesheet><link href=/cis526/css/print.css?1746820435 rel=stylesheet media=print><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.index_js_url="/cis526/index.search.js",window.variants&&variants.init(["light-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis526/css/custom.css?1746820435 rel=stylesheet></head><body class="mobile-support embed disableInlineCopyToClipboard" data-url=/cis526/x-examples/07-advanced-topics/07-external-db/embed.html><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/z95i3xT8DN4 style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><h2 id=connecting-to-an-external-database>Connecting to an External Database</h2><p>Finally, what if we&rsquo;d like to update our application to connect to an external database? This could be very useful if we plan on using this application in production with a large amount of data, because an external database will be much faster and handle large amounts of data much better than our SQLite database stored in a single file.</p><p>For this example, we&rsquo;ll update our application to be able to use <a href=https://www.postgresql.org/ rel=external target=_blank>Postgres</a>. Most of this process can be discovered by reading the <a href=https://sequelize.org/docs/v6/getting-started/ rel=external target=_blank>Sequelize Documentation</a> to see how to connect other database types to our application.</p><h2 id=update-database-configuration>Update Database Configuration</h2><p>First, we need to update the database configuration for our application, which is in the <code>configs/database.js</code> file in our <code>server</code> folder. We&rsquo;ll add several additional options to allow us to specify the dialect, hostname, username, and password for another database engine.</p><div class=tab-panel data-tab-group=7430230a8193a7dbe80c3691474cc78e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configsdatabasejs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("7430230a8193a7dbe80c3691474cc78e","configsdatabasejs")'>
<span class=tab-nav-text>configs/database.js</span></button></div><div class=tab-content-container><div data-tab-item=configsdatabasejs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @file Configuration information for Sequelize database ORM
</span></span></span><span class=line><span class=cl><span class=cm> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span class=line><span class=cl><span class=cm> * @exports sequelize a Sequelize instance
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>Sequelize</span> <span class=nx>from</span> <span class=s2>&#34;sequelize&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import logger configuration
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>logger</span> <span class=nx>from</span> <span class=s2>&#34;./logger.js&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create Sequelize instance
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>sequelize</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Sequelize</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Supports &#34;sqlite&#34; or &#34;postgres&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>dialect</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DATABASE_DIALECT</span> <span class=o>||</span> <span class=s2>&#34;sqlite&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Only used by SQLite
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>storage</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DATABASE_FILE</span> <span class=o>||</span> <span class=s2>&#34;:memory:&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Used by Postgres
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>host</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DATABASE_HOST</span> <span class=o>||</span> <span class=s2>&#34;lostcommunities_db&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>port</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DATABASE_PORT</span> <span class=o>||</span> <span class=mi>5432</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>username</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DATABASE_USERNAME</span> <span class=o>||</span> <span class=s2>&#34;lostcommunities&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>password</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DATABASE_PASSWORD</span> <span class=o>||</span> <span class=s2>&#34;lostcommunities&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>database</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DATABASE_NAME</span> <span class=o>||</span> <span class=s2>&#34;lostcommunities&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>logging</span><span class=o>:</span> <span class=nx>logger</span><span class=p>.</span><span class=nx>sql</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=nx>logger</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>sequelize</span><span class=p>;</span></span></span></code></pre></div></div></div></div></div><p>We&rsquo;ll also need to install the appropriate database libraries in our <code>server</code> application:</p><div class=tab-panel data-tab-group=cfccae99ae31e01e0c835631f7684ed3><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("cfccae99ae31e01e0c835631f7684ed3","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm install pg pg-hstore</span></span></code></pre></div></div></div></div></div><h2 id=properly-update-ids-after-seeding>Properly Update IDs after Seeding</h2><p>In addition, we also must handle a bug where Postgres will not properly keep track of any IDs that are added during the seeding process, so in each of our seeds we need to update the internal sequence used by Postgres to keep track of the next ID to use:</p><div class=tab-panel data-tab-group=c74aec5459c04c2a942a693e9779bd47><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=seeds00_usersjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c74aec5459c04c2a942a693e9779bd47","seeds00_usersjs")'>
<span class=tab-nav-text>seeds/00_users.js</span></button></div><div class=tab-content-container><div data-tab-item=seeds00_usersjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>up</span><span class=p>({</span> <span class=nx>context</span><span class=o>:</span> <span class=nx>queryInterface</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>queryInterface</span><span class=p>.</span><span class=nx>bulkInsert</span><span class=p>(</span><span class=s2>&#34;users&#34;</span><span class=p>,</span> <span class=nx>users</span><span class=p>);</span>
</span></span><span class="line hl"><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DATABASE_DIALECT</span> <span class=o>==</span> <span class=s1>&#39;postgres&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>    <span class=kr>await</span> <span class=nx>queryInterface</span><span class=p>.</span><span class=nx>sequelize</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s2>&#34;SELECT setval(&#39;users_id_seq&#39;, max(id)) FROM users;&#34;</span><span class=p>);</span>
</span></span><span class="line hl"><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=d3d86774234413cfa8ae81a582cb1765><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=seeds01_rolesjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d3d86774234413cfa8ae81a582cb1765","seeds01_rolesjs")'>
<span class=tab-nav-text>seeds/01_roles.js</span></button></div><div class=tab-content-container><div data-tab-item=seeds01_rolesjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>up</span><span class=p>({</span> <span class=nx>context</span><span class=o>:</span> <span class=nx>queryInterface</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>queryInterface</span><span class=p>.</span><span class=nx>bulkInsert</span><span class=p>(</span><span class=s2>&#34;roles&#34;</span><span class=p>,</span> <span class=nx>roles</span><span class=p>);</span>
</span></span><span class="line hl"><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>DATABASE_DIALECT</span> <span class=o>==</span> <span class=s1>&#39;postgres&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>    <span class=kr>await</span> <span class=nx>queryInterface</span><span class=p>.</span><span class=nx>sequelize</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s2>&#34;SELECT setval(&#39;roles_id_seq&#39;, max(id)) FROM roles;&#34;</span><span class=p>);</span>
</span></span><span class="line hl"><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>queryInterface</span><span class=p>.</span><span class=nx>bulkInsert</span><span class=p>(</span><span class=s2>&#34;user_roles&#34;</span><span class=p>,</span> <span class=nx>user_roles</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>This error is discussed at length in a <a href=https://github.com/sequelize/sequelize/issues/9295 rel=external target=_blank>Sequelize GitHub Issue</a>.</p><h2 id=environment-variables>Environment Variables</h2><p>We should also add these new environment variable entries to our <code>.env.example</code> file, including relocating the existing <code>DATABASE_FILE</code> entry to this section with the others. Since we aren&rsquo;t using them in development or testing, we can leave them out of the other files for now.</p><div class=tab-panel data-tab-group=f9b2ab4df0091f8870ac4de1eb44c0e6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=envexample class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f9b2ab4df0091f8870ac4de1eb44c0e6","envexample")'>
<span class=tab-nav-text>.env.example</span></button></div><div class=tab-content-container><div data-tab-item=envexample class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=c1># -=-=- other settings omitted here -=-=-</span>
</span></span><span class=line><span class=cl><span class=c1># Database Settings</span>
</span></span><span class=line><span class=cl><span class=c1># Options are &#34;sqlite&#34; or &#34;postgres&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DATABASE_DIALECT</span><span class=o>=</span>sqlite
</span></span><span class=line><span class=cl><span class=c1># File is specified for SQLite</span>
</span></span><span class=line><span class=cl><span class=nv>DATABASE_FILE</span><span class=o>=</span>database.sqlite
</span></span><span class=line><span class=cl><span class=c1># Other settings are for Postgres</span>
</span></span><span class=line><span class=cl><span class=nv>DATABASE_HOST</span><span class=o>=</span>localhost
</span></span><span class=line><span class=cl><span class=nv>DATABASE_PORT</span><span class=o>=</span><span class=m>5432</span>
</span></span><span class=line><span class=cl><span class=nv>DATABASE_USERNAME</span><span class=o>=</span>lostcommunities
</span></span><span class=line><span class=cl><span class=nv>DATABASE_PASSWORD</span><span class=o>=</span>lostcommunities
</span></span><span class=line><span class=cl><span class=nv>DATABASE_NAME</span><span class=o>=</span>lostcommunities</span></span></code></pre></div></div></div></div></div><h2 id=update-docker-compose>Update Docker Compose</h2><p>To test this, we&rsquo;ll need a running Postgres instance. While we can create one in our GitHub Codespaces by adding some additional configuration files, it is a bit more complex. So, let&rsquo;s just update our <code>compose.yml</code> file for deployment and test using another database there.</p><div class=tab-panel data-tab-group=5c52e8a3d144ae8a8a494188220ed871><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=composeyml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5c52e8a3d144ae8a8a494188220ed871","composeyml")'>
<span class=tab-nav-text>compose.yml</span></button></div><div class=tab-content-container><div data-tab-item=composeyml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>######################################</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Lost Communities Solution</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Repository:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># https://github.com/cis526-codio/lost-communities-solution</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>lostcommunities</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Docker Image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io/cis526-codio/lost-communities-solution:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Container Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>lostcommunities</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Restart Container Unless Stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Networks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>lostcommunities_network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Network Ports</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;3000:3000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Volumes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>lostcommunities_data:/usr/src/app/data:rw</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>lostcommunities_uploads:/usr/src/app/public/uploads:rw</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Environment Variables</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># =+=+=+= REQUIRED VALUES =+=+=+=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># These values must be configured for deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Session Secret Key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>SESSION_SECRET</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;thisisasupersecretkey&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># JWT Secret Key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>JWT_SECRET_KEY</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;thisisasupersecretkey&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Use Node and run `require(&#39;crypto&#39;).randomBytes(64).toString(&#39;hex&#39;)` to get a random value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CAS Authentication Settings</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CAS Server URL (send users here to login)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>CAS_URL</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;https://testcas.cs.ksu.edu&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># CAS Service URL (CAS returns users here; usually where this app is deployed)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>CAS_SERVICE_URL</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;http://localhost:3000&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Database Options</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Database Dialect</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Options: &#39;sqlite&#39; (default) or &#39;postgres&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DATABASE_DIALECT</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;postgres&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># For SQLite Only - Specify file location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Options: &#39;:memory:&#39; to use an in-memory database (not recommended), or any file name otherwise</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># DATABASE_FILE: &#39;data/database.sqlite&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># For Postgres Only - Specify database information</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DATABASE_HOST</span><span class=p>:</span><span class=w> </span><span class=l>lostcommunities_db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DATABASE_PORT</span><span class=p>:</span><span class=w> </span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DATABASE_USERNAME</span><span class=p>:</span><span class=w> </span><span class=l>lostcommunities</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DATABASE_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>lostcommunities</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DATABASE_NAME</span><span class=p>:</span><span class=w> </span><span class=l>lostcommunities</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Seed initial data on first startup</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>SEED_DATA</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;true&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># =+=+=+= OPTIONAL VALUES =+=+=+=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># These values are set to reasonable defaults</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># but can be overridden. Default values are shown as comments</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Log Level</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Options: error | warn | info | http | verbose | debug | sql | silly</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#LOG_LEVEL: &#39;http&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Network Port Within the Container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#PORT: &#39;3000&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># =+=+=+= OTHER VALUES =+=+=+=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># These values are not recommended for deployment but are available</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Custom Session Cookie Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#SESSION_NAME: &#39;connect.sid&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Open API Documentation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Show OpenAPI Documentation at `/docs` path</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#OPENAPI_VISIBLE: &#39;false&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Open API Host for testing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#OPENAPI_HOST: &#39;http://localhost:3000&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Export Open API JSON File</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#OPENAPI_EXPORT: &#39;false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Open API Export File Path</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#OPENAPI_EXPORT_PATH: &#39;openapi.json&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Enable Bypass Authentication</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Use path `/auth/bypass?token=&lt;username&gt;` to log in as any user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># DO NOT ENABLE IN PRODUCTION - THIS IS INSECURE!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#BYPASS_AUTH: &#39;false&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>######################################</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Postgres Database</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Image Location:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># https://hub.docker.com/_/postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>lostcommunities_db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Docker Image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:17-alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Container Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>lostcommunities_db</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Restart Container Unless Stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Networks</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>lostcommunities_network</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Volumes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>lostcommunities_db_data:/var/lib/postgresql/data:rw</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Environment Variables</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class=l>lostcommunities</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class=l>lostcommunities</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class=l>lostcommunities</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>lostcommunities_data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>lostcommunities_uploads</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>lostcommunities_db_data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>lostcommunities_network</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>internal</span><span class=p>:</span><span class=w> </span><span class=kc>true</span></span></span></code></pre></div></div></div></div></div><p>This Docker Compose file follows some best practices for deploying a Postgres container in the cloud, and even separates the database connection between our application container and the Postgres container in an internal Docker network to make it even more secure.</p><p>Once we deploy this application, we can even check that the Postgres server has our current data to ensure it is working properly:</p><p><a href=#R-image-0395aaa72ae435b6ad804c4d70c61b8f class=lightbox-link><img alt="Postgres Running" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/07/deploy_9.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0395aaa72ae435b6ad804c4d70c61b8f><img alt="Postgres Running" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/07/deploy_9.png></a></p><p>Now our application is ready for a full deployment!</p><footer class=footline></footer></article></div></main></div><script src=/cis526/js/clipboard.min.js?1746820435 defer></script><script src=/cis526/js/perfect-scrollbar.min.js?1746820435 defer></script><script src=/cis526/js/theme.js?1746820435 defer></script><script src=/cis526/js/embed-iframe.js?1746820435 defer></script></body></html>