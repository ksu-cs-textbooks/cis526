<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="YouTube Video Warning In this video, the new api.js file was accidentally created in the router folder. It should be moved to the configs folder, which is shown in the next video.
Automatically Logging In One thing we may quickly realize as we use our application as it currently stands is that the user has to click the “Login” button twice to actually get logged into the system. That seems a bit counterintuitive, so we should take a minute to try and fix that."><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Route Guards :: CIS 526 Textbook"><meta name=twitter:description content="YouTube Video Warning In this video, the new api.js file was accidentally created in the router folder. It should be moved to the configs folder, which is shown in the next video.
Automatically Logging In One thing we may quickly realize as we use our application as it currently stands is that the user has to click the “Login” button twice to actually get logged into the system. That seems a bit counterintuitive, so we should take a minute to try and fix that."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/x-examples/05-vue-starter/10-routeguard/"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Route Guards :: CIS 526 Textbook"><meta property="og:description" content="YouTube Video Warning In this video, the new api.js file was accidentally created in the router folder. It should be moved to the configs folder, which is shown in the next video.
Automatically Logging In One thing we may quickly realize as we use our application as it currently stands is that the user has to click the “Login” button twice to actually get logged into the system. That seems a bit counterintuitive, so we should take a minute to try and fix that."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Example Projects"><meta property="article:modified_time" content="2025-04-05T18:31:19-05:00"><meta itemprop=name content="Route Guards :: CIS 526 Textbook"><meta itemprop=description content="YouTube Video Warning In this video, the new api.js file was accidentally created in the router folder. It should be moved to the configs folder, which is shown in the next video.
Automatically Logging In One thing we may quickly realize as we use our application as it currently stands is that the user has to click the “Login” button twice to actually get logged into the system. That seems a bit counterintuitive, so we should take a minute to try and fix that."><meta itemprop=dateModified content="2025-04-05T18:31:19-05:00"><meta itemprop=wordCount content="1237"><title>Route Guards :: CIS 526 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis526/x-examples/05-vue-starter/10-routeguard/ rel=canonical type=text/html title="Route Guards :: CIS 526 Textbook"><link href=/cis526/x-examples/05-vue-starter/10-routeguard/index.xml rel=alternate type=application/rss+xml title="Route Guards :: CIS 526 Textbook"><link href=/cis526/x-examples/05-vue-starter/10-routeguard/index.print.html rel=alternate type=text/html title="Route Guards :: CIS 526 Textbook"><link href=/cis526/x-examples/05-vue-starter/10-routeguard/embed.html rel=alternate type=text/html title="Route Guards :: CIS 526 Textbook"><link href=/cis526/css/fontawesome-all.min.css?1746305478 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fontawesome-all.min.css?1746305478 rel=stylesheet></noscript><link href=/cis526/css/nucleus.css?1746305478 rel=stylesheet><link href=/cis526/css/auto-complete.css?1746305478 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/auto-complete.css?1746305478 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar.min.css?1746305478 rel=stylesheet><link href=/cis526/css/fonts.css?1746305478 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fonts.css?1746305478 rel=stylesheet></noscript><link href=/cis526/css/theme.css?1746305478 rel=stylesheet><link href=/cis526/css/theme-auto.css?1746305478 rel=stylesheet id=R-variant-style><link href=/cis526/css/chroma-auto.css?1746305478 rel=stylesheet id=R-variant-chroma-style><link href=/cis526/css/variant.css?1746305478 rel=stylesheet><link href=/cis526/css/print.css?1746305478 rel=stylesheet media=print><script src=/cis526/js/variant.js?1746305478></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.index_js_url="/cis526/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis526/css/custom.css?1746305478 rel=stylesheet></head><body class="mobile-support tele disableInlineCopyToClipboard" data-url=/cis526/x-examples/05-vue-starter/10-routeguard/><div id=tele class="tele mirror"><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=route-guards>Route Guards</h1><a href="https://www.youtube.com/watch?v=sK_-Cyn89T4">YouTube Video</a><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div><div class=box-content><p>In this video, the new <code>api.js</code> file was accidentally created in the <code>router</code> folder. It should be moved to the <code>configs</code> folder, which is shown in the next video.</p></div></div><h2 id=automatically-logging-in>Automatically Logging In</h2><p>One thing we may quickly realize as we use our application as it currently stands is that the user has to click the &ldquo;Login&rdquo; button twice to actually get logged into the system. That seems a bit counterintuitive, so we should take a minute to try and fix that.</p><p>Effectively, we want our application to try and request a token on behalf of the user behind the scenes as soon as the page is loaded. If a token can be received, we know the user is actually logged in and we can update the user interface accordingly. There are several approaches to do this:</p><ul><li>We can place this code in our top-level <code>App.vue</code> file - this will ensure it runs when any part of the web application is loaded</li><li>We can place it in a <a href=https://router.vuejs.org/guide/advanced/navigation-guards.html rel=external target=_blank>Navigation Guard</a> inside of our Vue Router. This will allow us to make sure the user is logged in, and we can even automatically redirect the user if they try to access something that requires them to log in first</li></ul><p>So, let&rsquo;s add a global navigation guard to our router, ensuring that we only have a single place that requests a token when the user first lands on the page.</p><h2 id=router-navigation-guards>Router Navigation Guards</h2><p>To do this, we need to edit the <code>src/router/index.js</code> to add a special <code>beforeEach</code> function to the router:</p><div class=tab-panel data-tab-group=17c3757da898ebd1a9548226f80d6753><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srcrouterindexjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("17c3757da898ebd1a9548226f80d6753","srcrouterindexjs")'>
<span class=tab-nav-text>src/router/index.js</span></button></div><div class=tab-content-container><div data-tab-item=srcrouterindexjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @file Vue Router for the application
</span></span></span><span class=line><span class=cl><span class=cm> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span class=line><span class=cl><span class=cm> * @exports router a Vue Router
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import Libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>createRouter</span><span class=p>,</span> <span class=nx>createWebHistory</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue-router&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=c1>// Import Stores
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>useTokenStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@/stores/Token&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import Views
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>HomeView</span> <span class=nx>from</span> <span class=s1>&#39;../views/HomeView.vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>createRouter</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Configure History Mode
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>history</span><span class=o>:</span> <span class=nx>createWebHistory</span><span class=p>(</span><span class=kr>import</span><span class=p>.</span><span class=nx>meta</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>BASE_URL</span><span class=p>),</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Configure routes
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>routes</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;/&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;home&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>component</span><span class=o>:</span> <span class=nx>HomeView</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;/about&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;about&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=c1>// route level code-splitting
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=c1>// this generates a separate chunk (About.[hash].js) for this route
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=c1>// which is lazy-loaded when the route is visited.
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>component</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=kr>import</span><span class=p>(</span><span class=s1>&#39;../views/AboutView.vue&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=c1>//Global Route Guard
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=nx>router</span><span class=p>.</span><span class=nx>beforeEach</span><span class=p>(</span><span class=kr>async</span> <span class=p>(</span><span class=nx>to</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>  <span class=c1>// Load Token Store
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>tokenStore</span> <span class=o>=</span> <span class=nx>useTokenStore</span><span class=p>();</span>
</span></span><span class="line hl"><span class=cl>
</span></span><span class="line hl"><span class=cl>  <span class=c1>// Allow access to &#39;home&#39; and &#39;about&#39; routes automatically
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>noLoginRequired</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;home&#39;</span><span class=p>,</span> <span class=s1>&#39;about&#39;</span><span class=p>]</span>
</span></span><span class="line hl"><span class=cl>
</span></span><span class="line hl"><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>noLoginRequired</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>to</span><span class=p>.</span><span class=nx>name</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>    <span class=c1>// If there is no token already
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>tokenStore</span><span class=p>.</span><span class=nx>token</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>      <span class=c1>// Request a token in the background 
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>      <span class=nx>tokenStore</span><span class=p>.</span><span class=nx>getToken</span><span class=p>()</span>
</span></span><span class="line hl"><span class=cl>    <span class=p>}</span>
</span></span><span class="line hl"><span class=cl>
</span></span><span class="line hl"><span class=cl>  <span class=c1>// For all other routes
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>    <span class=c1>// If there is no token already
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>tokenStore</span><span class=p>.</span><span class=nx>token</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>      <span class=c1>// Request a token and redirect if not logged in 
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=nx>tokenStore</span><span class=p>.</span><span class=nx>getToken</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class="line hl"><span class=cl>    <span class=p>}</span>
</span></span><span class="line hl"><span class=cl>  <span class=p>}</span>
</span></span><span class="line hl"><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>router</span></span></span></code></pre></div></div></div></div></div><p>In this navigation guard, we have identified two routes, <code>'home'</code> and <code>'about'</code> that don&rsquo;t require the user to log in first. So, if the route matches either of those, we request a token in the background if we don&rsquo;t already have one, but we don&rsquo;t <code>await</code> that function since we don&rsquo;t need it in order to complete the process. However, for all other routes that we&rsquo;ll create later in this project, we will <code>await</code> on the <code>tokenStore.getToken()</code> function to ensure that the user has a valid token available before allowing the application to load the next page. As we continue to add features to our application, we&rsquo;ll see that this is a very powerful way to keep track of our user and ensure they are always properly authenticated.</p><h2 id=axios-interceptors>Axios Interceptors</h2><p>We can also simplify one other part of our application by automatically configuring Axios with a few additional settings that will automatically inject the <code>Authorization: Bearer</code> header into each request, as well as silently requesting a new JWT token if ours appears to have expired.</p><p>For this, we&rsquo;ll create a new folder called <code>src/configs</code> and place a new file <code>api.js</code> inside of that folder with the following content:</p><div class=tab-panel data-tab-group=5e277c9e12f98f95016901ca12e8a688><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srcconfigsapijs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5e277c9e12f98f95016901ca12e8a688","srcconfigsapijs")'>
<span class=tab-nav-text>src/configs/api.js</span></button></div><div class=tab-content-container><div data-tab-item=srcconfigsapijs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @file Axios Configuration and Interceptors
</span></span></span><span class=line><span class=cl><span class=cm> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import Libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s1>&#39;axios&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import Stores
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>useTokenStore</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@/stores/Token&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Axios Instance Setup
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>api</span> <span class=o>=</span> <span class=nx>axios</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Accept</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Add Interceptors
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>setupAxios</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Configure Requests
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>api</span><span class=p>.</span><span class=nx>interceptors</span><span class=p>.</span><span class=nx>request</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nx>config</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// If we are not trying to get a token or API versions, send the token
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>url</span> <span class=o>!==</span> <span class=s1>&#39;/auth/token&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>config</span><span class=p>.</span><span class=nx>url</span> <span class=o>!==</span> <span class=s1>&#39;/api&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>tokenStore</span> <span class=o>=</span> <span class=nx>useTokenStore</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>tokenStore</span><span class=p>.</span><span class=nx>token</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>config</span><span class=p>.</span><span class=nx>headers</span><span class=p>[</span><span class=s1>&#39;Authorization&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;Bearer &#39;</span> <span class=o>+</span> <span class=nx>tokenStore</span><span class=p>.</span><span class=nx>token</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>config</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// If we receive any errors, reject with the error
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>reject</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Configure Response
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>api</span><span class=p>.</span><span class=nx>interceptors</span><span class=p>.</span><span class=nx>response</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Do not modify the response
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>(</span><span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>res</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Gracefully handle errors
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>async</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Store original request config
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>config</span> <span class=o>=</span> <span class=nx>err</span><span class=p>.</span><span class=nx>config</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// If we are not trying to request a token but we get an error message
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span><span class=p>(</span><span class=nx>config</span><span class=p>.</span><span class=nx>url</span> <span class=o>!==</span> <span class=s1>&#39;/auth/token&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>err</span><span class=p>.</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// If the error is a 401 unauthorized, we might have a bad token
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>.</span><span class=nx>response</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=mi>401</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// Prevent infinite loops by tracking retries
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>config</span><span class=p>.</span><span class=nx>_retry</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>config</span><span class=p>.</span><span class=nx>_retry</span> <span class=o>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>// Try to request a new token
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=kr>const</span> <span class=nx>tokenStore</span> <span class=o>=</span> <span class=nx>useTokenStore</span><span class=p>();</span>
</span></span><span class=line><span class=cl>              <span class=kr>await</span> <span class=nx>tokenStore</span><span class=p>.</span><span class=nx>getToken</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>              <span class=c1>// Retry the original request
</span></span></span><span class=line><span class=cl><span class=c1></span>              <span class=k>return</span> <span class=nx>api</span><span class=p>(</span><span class=nx>config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=k>return</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>reject</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// This is a retry, so force an authentication
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kr>const</span> <span class=nx>tokenStore</span> <span class=o>=</span> <span class=nx>useTokenStore</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=kr>await</span> <span class=nx>tokenStore</span><span class=p>.</span><span class=nx>getToken</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// If we can&#39;t handle it, return the error
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>return</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>reject</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=p>{</span> <span class=nx>api</span><span class=p>,</span> <span class=nx>setupAxios</span> <span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>This file configures an Axios instance to only accept <code>application/json</code> requests, which makes sense for our application. Then, in the <code>setupAxios</code> function, it will add some basic interceptors to modify any requests sent from this instance as well as responses received:</p><ul><li>If we try to request any URL other than <code>/auth/token</code> and <code>/api</code>, we&rsquo;ll assume that the user is accessing a route that requires a valid bearer token. So, we can automatically inject that into our request.</li><li>When we receive an error as a response, we&rsquo;ll check to see if it is an HTTP 401 Unauthorized error. If it comes from any URL except the <code>/auth/token</code> URL, we can assume that we might have an invalid token. So, we&rsquo;ll quickly try to request one in the background, and then retry the original request once. If it fails a second time, we&rsquo;ll redirect the user back to the login page so they can re-authenticate with the system.</li></ul><p>To use these interceptors, we must first enable them in the <code>src/main.js</code> file:</p><div class=tab-panel data-tab-group=7464b8ffdba9790fdf8317429b8db33d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=srcmainjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("7464b8ffdba9790fdf8317429b8db33d","srcmainjs")'>
<span class=tab-nav-text>src/main.js</span></button></div><div class=tab-content-container><div data-tab-item=srcmainjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @file Main Vue application
</span></span></span><span class=line><span class=cl><span class=cm> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import Libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>createApp</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;vue&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createPinia</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;pinia&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>PrimeVue</span> <span class=nx>from</span> <span class=s1>&#39;primevue/config&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Aura</span> <span class=nx>from</span> <span class=s1>&#39;@primeuix/themes/aura&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Tooltip</span> <span class=nx>from</span> <span class=s1>&#39;primevue/tooltip&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import CSS
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=s1>&#39;./assets/main.css&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import Vue App
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>App</span> <span class=nx>from</span> <span class=s1>&#39;./App.vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import Configurations
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>router</span> <span class=nx>from</span> <span class=s1>&#39;./router&#39;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>setupAxios</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;./configs/api&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create Vue App
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>createApp</span><span class=p>(</span><span class=nx>App</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Install Libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>createPinia</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>router</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>PrimeVue</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Theme Configuration
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>theme</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>preset</span><span class=o>:</span> <span class=nx>Aura</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>options</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>darkModeSelector</span><span class=o>:</span> <span class=s1>&#39;.app-dark-mode&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Install Directives
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>directive</span><span class=p>(</span><span class=s1>&#39;tooltip&#39;</span><span class=p>,</span> <span class=nx>Tooltip</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=c1>// Setup Interceptors
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=nx>setupAxios</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Mount Vue App on page
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>mount</span><span class=p>(</span><span class=s1>&#39;#app&#39;</span><span class=p>)</span></span></span></code></pre></div></div></div></div></div><p>Now, anytime we want to request data from a protected route, we can use the <code>api</code> instance of Axios that we configured!</p><footer class=footline></footer></article></div></main></div></div><script src=/cis526/js/clipboard.min.js?1746305478 defer></script><script src=/cis526/js/perfect-scrollbar.min.js?1746305478 defer></script><script src=/cis526/js/theme.js?1746305478 defer></script><script src=/cis526/js/tele-scroll.js?1746305478 defer></script></body></html>