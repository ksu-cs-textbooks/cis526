<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.148.1"><meta name=generator content="Relearn 8.0.0"><meta name=description content="This example project builds on the previous Express Starter Project by adding a database. A database is a powerful way to store and retrieve the data used by our web application.
To accomplish this, weâ€™ll learn about different libraries that interface between our application and a database. Once weâ€™ve installed a library, weâ€™ll discover how to use that library to create database tables, add initial data to those tables, and then easily access them within our application."><meta name=author content="Nathan Bean & Russell Feldhausen"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta name=twitter:title content="Adding a Database :: CIS 526 Textbook"><meta name=twitter:description content="This example project builds on the previous Express Starter Project by adding a database. A database is a powerful way to store and retrieve the data used by our web application.
To accomplish this, weâ€™ll learn about different libraries that interface between our application and a database. Once weâ€™ve installed a library, weâ€™ll discover how to use that library to create database tables, add initial data to those tables, and then easily access them within our application."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/x-examples/02-database/index.html"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Adding a Database :: CIS 526 Textbook"><meta property="og:description" content="This example project builds on the previous Express Starter Project by adding a database. A database is a powerful way to store and retrieve the data used by our web application.
To accomplish this, weâ€™ll learn about different libraries that interface between our application and a database. Once weâ€™ve installed a library, weâ€™ll discover how to use that library to create database tables, add initial data to those tables, and then easily access them within our application."><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta property="og:image" content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta itemprop=name content="Adding a Database :: CIS 526 Textbook"><meta itemprop=description content="This example project builds on the previous Express Starter Project by adding a database. A database is a powerful way to store and retrieve the data used by our web application.
To accomplish this, weâ€™ll learn about different libraries that interface between our application and a database. Once weâ€™ve installed a library, weâ€™ll discover how to use that library to create database tables, add initial data to those tables, and then easily access them within our application."><meta itemprop=dateModified content="2025-02-03T15:11:09-06:00"><meta itemprop=wordCount content="171"><meta itemprop=image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><title>Adding a Database :: CIS 526 Textbook</title><link href=https://textbooks.cs.ksu.edu/cis526/x-examples/02-database/index.html rel=canonical type=text/html title="Adding a Database :: CIS 526 Textbook"><link href=/cis526/x-examples/02-database/index.xml rel=alternate type=application/rss+xml title="Adding a Database :: CIS 526 Textbook"><link href=/cis526/x-examples/02-database/tele.html rel=alternate type=text/html title="Adding a Database :: CIS 526 Textbook"><link href=/cis526/x-examples/02-database/embed.html rel=alternate type=text/html title="Adding a Database :: CIS 526 Textbook"><link href=/cis526/css/auto-complete/auto-complete.min.css?1758047999 rel=stylesheet><script src=/cis526/js/auto-complete/auto-complete.min.js?1758047999 defer></script><script src=/cis526/js/search-lunr.min.js?1758047999 defer></script><script src=/cis526/js/search.min.js?1758047999 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/cis526/searchindex.en.js?1758047999"</script><script src=/cis526/js/lunr/lunr.min.js?1758047999 defer></script><script src=/cis526/js/lunr/lunr.stemmer.support.min.js?1758047999 defer></script><script src=/cis526/js/lunr/lunr.multi.min.js?1758047999 defer></script><script src=/cis526/js/lunr/lunr.en.min.js?1758047999 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1758047999 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1758047999 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar/perfect-scrollbar.min.css?1758047999 rel=stylesheet><link href=/cis526/css/theme.min.css?1758047999 rel=stylesheet><link href=/cis526/css/format-print.min.css?1758047999 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/x-examples/02-database/index.html",window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!1,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["light-theme"],window.relearn.customvariantname="my-custom-variant",window.relearn.writeVariant=!1,window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.writeVariant&&window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><link href=/cis526/css/custom.css?1758047999 rel=stylesheet></head><body class="mobile-support print" data-url=/cis526/x-examples/02-database/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#project-deliverables>Project Deliverables</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement class=a11y-only><a itemprop=item href=/cis526/index.html><span itemprop=name>Web Application Development</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cis526/x-examples/index.html><span itemprop=name>Example Projects</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Adding a Database</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-edit" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=https://github.com/ksu-cs-textbooks/cis526/edit/main/content/x-examples/02-database/_index.md rel=external target=_blank title="Edit (CTRL+ALT+w)"><i class="fa-fw fas fa-pen"></i></a></div><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/02-database/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/01-express-starter/11-summary/index.html title="Summary (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/02-database/01-sequelize/index.html title="Sequelize (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more><div class="topbar-button topbar-button-embed" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/02-database/embed.html title="Embeddable Version"><i class="fa-fw fas fa-expand-arrows-alt"></i></a></div><div class="topbar-button topbar-button-tele" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/02-database/tele.html title="Teleprompter View"><i class="fa-fw fas fa-tv"></i></a></div></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable x-examples" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=adding-a-database>Adding a Database</h1><p>This example project builds on the previous Express Starter Project by adding a database. A database is a powerful way to store and retrieve the data used by our web application.</p><p>To accomplish this, we&rsquo;ll learn about different libraries that interface between our application and a database. Once we&rsquo;ve installed a library, we&rsquo;ll discover how to use that library to create database tables, add initial data to those tables, and then easily access them within our application.</p><h2 id=project-deliverables>Project Deliverables</h2><p>At the end of this example, we will have a project with the following features:</p><ol><li>An SQLite database</li><li>The Sequelize ORM tool</li><li>The Umzug migration tool</li><li>A simple migration to create tables for Users and Roles</li><li>Seed data for those tables</li><li>Automated processes to migrate and seed the data on application startup</li><li>A simple route to query user information</li></ol><details open class="box cstyle notices warning"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-triangle"></i>
Prior Work</summary><div class=box-content><p>This project picks up right where the last one left off, so if you haven&rsquo;t completed that one yet, go back and do that before starting this one.</p></div></details><p>Let&rsquo;s get started!</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Adding a Database</h1><article class=default><header class=headline></header><h1 id=sequelize>Sequelize</h1><a href="https://www.youtube.com/watch?v=RN46EzaMHy0">YouTube Video</a><h2 id=database-libraries>Database Libraries</h2><p>To begin, we must first select a library to use when interfacing with our database. There are many different types of libraries, and many different options to choose from.</p><ol><li><p>First and foremost, we can always just write raw SQL queries directly in our code. This is often very straightforward, but also can lead to very complex code and security issues. It also doesn&rsquo;t offer many of the more advanced features such as mapping database results to object types and automatically managing database schemas.</p></li><li><p>Another option is an SQL query library, such as <a href=https://knexjs.org/ rel=external target=_blank>Knex.js</a> or <a href=https://kysely.dev/ rel=external target=_blank>Kysely</a>. These libraries provide a helpful abstraction on top of SQL, allowing developers to build queries using syntax that is more comfortable and familiar to them. These libraries also have additional features to manage database schemas and sample data</p></li><li><p>The final option is an <a href=https://en.wikipedia.org/wiki/Object%E2%80%93relational_mapping rel=external target=_blank>Object-Relational Mapping (ORM)</a> library such as <a href=https://vincit.github.io/objection.js/ rel=external target=_blank>Objection</a> or <a href=https://sequelize.org/ rel=external target=_blank>Sequelize</a>. These libraries provide the most abstraction away from raw SQL, often allowing developers to store and retrieve data in a database as if it were stored in a list or dictionary data structure.</p></li></ol><p>For this project, we&rsquo;re going to use the <a href=https://sequelize.org/ rel=external target=_blank>Sequelize</a> ORM, coupled with the <a href=https://github.com/sequelize/umzug rel=external target=_blank>Umzug</a> migration tool. Both of these libraries are very commonly used in Node.js projects, and are actively maintained.</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Database Engines</summary><div class=box-content><p>We also have many choices for the database engine we want to use for our web projects. Some common options include <a href=https://www.postgresql.org/ rel=external target=_blank>PostgreSQL</a>, <a href=https://www.mysql.com/ rel=external target=_blank>MySQL</a>, <a href=https://mariadb.org/ rel=external target=_blank>MariaDB</a>, <a href=https://www.mongodb.com/ rel=external target=_blank>MongoDB</a>, <a href=https://firebase.google.com/ rel=external target=_blank>Firebase</a>, and many more.</p><p>For this project, we&rsquo;re going to use <a href=https://www.sqlite.org/ rel=external target=_blank>SQLite</a>. SQLite is unique because it is a database engine that only requires a single file, so it is self-contained and easy to work with. It doesn&rsquo;t require any external database servers or software, making it perfect for a small development project. In fact, SQLite may be one of the most <a href=https://www.sqlite.org/mostdeployed.html rel=external target=_blank>widely deployed software modules</a> in the whole world!</p><p>Naturally, if wer plan on growing a web application beyond a simple hobby project with a few users, we should spend some time researching a reliable database solution. Thankfully, the Sequelize ORM supports <a href=https://sequelize.org/docs/v6/other-topics/dialect-specific-things/ rel=external target=_blank>many different database engines</a> so it is easy to switch.</p></div></details><h2 id=installing-sequelize>Installing Sequelize</h2><p>To begin, let&rsquo;s install both <code>sequelize</code> as well as the <code>sqlite3</code> library using <code>npm</code>:</p><div class=tab-panel data-tab-group=46b7463f5052be0dfd6c95731d7ffeaa><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("46b7463f5052be0dfd6c95731d7ffeaa","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm install sqlite3 sequelize</span></span></code></pre></div></div></div></div></div><p>Once those libraries are installed, we can now configure <code>sequelize</code> following the information in the <a href=https://sequelize.org/docs/v6/getting-started/ rel=external target=_blank>Sequelize Documentation</a>. Let&rsquo;s create a new file <code>configs/database.js</code> to store our database configuration:</p><div class=tab-panel data-tab-group=7697cce87046ef872161b29ffc879925><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configsdatabasejs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("7697cce87046ef872161b29ffc879925","configsdatabasejs")'>
<span class=tab-nav-text>configs/database.js</span></button></div><div class=tab-content-container><div data-tab-item=configsdatabasejs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Configuration information for Sequelize database ORM
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports sequelize a Sequelize instance
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Sequelize</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;sequelize&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import logger configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>logger</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./logger.js&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create Sequelize instance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sequelize</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Sequelize</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>dialect</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;sqlite&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>storage</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DATABASE_FILE</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;:memory:&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>logging</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>sql</span>.<span style=color:#a6e22e>bind</span>(<span style=color:#a6e22e>logger</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>sequelize</span>;</span></span></code></pre></div></div></div></div></div><p>This file creates a very simple configuration for <code>sequelize</code> that uses the <code>sqlite</code> dialect. It uses the <code>DATABASE_FILE</code> environment variable to control the location of the database in the file system, and it also uses the <code>logger.sql</code> log level to log any data produced by the library. If a <code>DATABASE_FILE</code> environment variable is not provided, it will default to storing data in the SQLite <a href=https://www.sqlite.org/inmemorydb.html rel=external target=_blank>In-Memory Database</a>, which is great for testing and quick development.</p><p>Of course, a couple of those items don&rsquo;t actually exist yet, so let&rsquo;s add those in before we move on! First, we need to add a <code>DATABASE_FILE</code> environment variable to both our <code>.env</code> and <code>.env.example</code> files:</p><div class=tab-panel data-tab-group=163f2cb1206dee65d7c262ad01a800b2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=env class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("163f2cb1206dee65d7c262ad01a800b2","env")'>
<span class=tab-nav-text>.env</span></button></div><div class=tab-content-container><div data-tab-item=env class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-env data-lang=env><span style=display:flex><span>LOG_LEVEL<span style=color:#f92672>=</span>debug
</span></span><span style=display:flex><span>PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>OPENAPI_HOST<span style=color:#f92672>=</span>https://$CODESPACE_NAME-$PORT.$GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN
</span></span><span style=display:flex><span>OPENAPI_VISIBLE<span style=color:#f92672>=</span>true
</span></span><span style=display:flex;background-color:#3c3d38><span>DATABASE_FILE<span style=color:#f92672>=</span>database.sqlite</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=5e1a21766982982241d8f857e8b9a977><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=envexample class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5e1a21766982982241d8f857e8b9a977","envexample")'>
<span class=tab-nav-text>.env.example</span></button></div><div class=tab-content-container><div data-tab-item=envexample class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-env data-lang=env><span style=display:flex><span>LOG_LEVEL<span style=color:#f92672>=</span>debug
</span></span><span style=display:flex><span>PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>OPENAPI_HOST<span style=color:#f92672>=</span>http://localhost:3000
</span></span><span style=display:flex><span><span style=color:#75715e># For GitHub Codespaces</span>
</span></span><span style=display:flex><span><span style=color:#75715e># OPENAPI_HOST=https://$CODESPACE_NAME-$PORT.$GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN</span>
</span></span><span style=display:flex><span>OPENAPI_VISIBLE<span style=color:#f92672>=</span>false
</span></span><span style=display:flex;background-color:#3c3d38><span>DATABASE_FILE<span style=color:#f92672>=</span>database.sqlite</span></span></code></pre></div></div></div></div></div><p>We also need to add a new logging level called <code>sql</code> to our logger configuration in <code>configs/logger.js</code>. This is a bit more involved, because it means we have to now list all intended logging levels explicitly. See the highlighted lines below for what has been changed, but the entire file is included for convenience:</p><div class=tab-panel data-tab-group=ff90ac1c97c68c4515b66d4b7515b4b8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configsloggerjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ff90ac1c97c68c4515b66d4b7515b4b8","configsloggerjs")'>
<span class=tab-nav-text>configs/logger.js</span></button></div><div class=tab-content-container><div data-tab-item=configsloggerjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Configuration information for Winston logger
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports logger a Winston logger object
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>winston</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;winston&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Extract format options
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>combine</span>, <span style=color:#a6e22e>timestamp</span>, <span style=color:#a6e22e>printf</span>, <span style=color:#a6e22e>colorize</span>, <span style=color:#a6e22e>align</span>, <span style=color:#a6e22e>errors</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>winston</span>.<span style=color:#a6e22e>format</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Determines the correct logging level based on the Node environment
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @returns {string} the desired log level
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>level</span> () {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;error&#39;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;error&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;1&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;warn&#39;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;warn&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;2&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;info&#39;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;info&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;3&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;http&#39;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;http&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;4&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;verbose&#39;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;verbose&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;5&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;debug&#39;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;debug&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;6&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;sql&#39;</span>) {
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;sql&#39;</span>;
</span></span><span style=display:flex;background-color:#3c3d38><span>    }
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;7&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>LOG_LEVEL</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;silly&#39;</span>) {
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;silly&#39;</span>;
</span></span><span style=display:flex;background-color:#3c3d38><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;http&#39;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Custom logging levels for the application
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>levels</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>error</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>warn</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>info</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>http</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>verbose</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>4</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>debug</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>sql</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>6</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>silly</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex;background-color:#3c3d38><span>}
</span></span><span style=display:flex;background-color:#3c3d38><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Custom colors
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>colors</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>error</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;red&#39;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>warn</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;yellow&#39;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>info</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;green&#39;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>http</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;green&#39;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>verbose</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;cyan&#39;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>debug</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;blue&#39;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>sql</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;gray&#39;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>silly</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;magenta&#39;</span>
</span></span><span style=display:flex;background-color:#3c3d38><span>}
</span></span><span style=display:flex;background-color:#3c3d38><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#a6e22e>winston</span>.<span style=color:#a6e22e>addColors</span>(<span style=color:#a6e22e>colors</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Creates the Winston instance with the desired configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>logger</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>winston</span>.<span style=color:#a6e22e>createLogger</span>({
</span></span><span style=display:flex><span>  <span style=color:#75715e>// call `level` function to get default log level
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>level</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>level</span>(),
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>levels</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>levels</span>,
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Format configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// See https://github.com/winstonjs/logform
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>format</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>combine</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>colorize</span>({ <span style=color:#a6e22e>all</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> }),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>errors</span>({ <span style=color:#a6e22e>stack</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> }),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>timestamp</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>format</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;YYYY-MM-DD hh:mm:ss.SSS A&#34;</span>,
</span></span><span style=display:flex><span>    }),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>align</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>info</span>) =&gt;
</span></span><span style=display:flex><span>        <span style=color:#e6db74>`[</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>info</span>.<span style=color:#a6e22e>timestamp</span><span style=color:#e6db74>}</span><span style=color:#e6db74>] </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>info</span>.<span style=color:#a6e22e>level</span><span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>info</span>.<span style=color:#a6e22e>stack</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>info</span>.<span style=color:#a6e22e>message</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;\n&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>info</span>.<span style=color:#a6e22e>stack</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>info</span>.<span style=color:#a6e22e>message</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>    ),
</span></span><span style=display:flex><span>  ),
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Output configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>transports</span><span style=color:#f92672>:</span> [<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>winston</span>.<span style=color:#a6e22e>transports</span>.<span style=color:#a6e22e>Console</span>()],
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>logger</span>;</span></span></code></pre></div></div></div></div></div><p>We have added a new <code>sql</code> logging level that is now part of our logging setup. One of the unique features of <code>sequelize</code> is that it will actually allow us to log all SQL queries run against our database, so we can enable and disable that level of logging by adjusting the <code>LOG_LEVEL</code> environment variable as desired.</p><p>There! We now have a working database configuration. Before we can make use of it, however, we need to add additional code to create and populate our database. So, we&rsquo;ll need to continue on in this tutorial before we can actually test our application.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=migrations>Migrations</h1><a href="https://www.youtube.com/watch?v=P-0Iuaj_BAE">YouTube Video</a><h2 id=umzug>Umzug</h2><p>Now that we have a database configured in our application, we need to create some way to actually populate that database with the tables and information our app requires. We could obviously do that manually, but that really makes it difficult (if not impossible) to automatically build, test, and deploy this application.</p><p>Thankfully, most database libraries also have a way to automate building the database structure. This is known as <a href=https://en.wikipedia.org/wiki/Schema_migration rel=external target=_blank>schema migration</a> or often just <strong>migration</strong>. We call it migration because it allows us to update the database schema along with new versions of the application, effectively <em>migrating</em> our data to new versions as we go.</p><p>The <code>sequelize</code> library recommends using another library, named <a href=https://github.com/sequelize/umzug rel=external target=_blank>Umzug</a>, as the preferred way to manage database migrations. It is actually completely framework agnostic, and would even work with ORMs other than Sequelize.</p><h2 id=setting-up-umzug>Setting up Umzug</h2><p>To begin, let&rsquo;s install <code>umzug</code> using <code>npm</code>:</p><div class=tab-panel data-tab-group=fc134048a22f8fd9615977d920efa6b8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("fc134048a22f8fd9615977d920efa6b8","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm install umzug</span></span></code></pre></div></div></div></div></div><p>Next, we can create a configuration file to handle our migrations, named <code>configs/migrations.js</code>, with the following content as described in the <a href=https://github.com/sequelize/umzug rel=external target=_blank>Umzug Documentation</a>:</p><div class=tab-panel data-tab-group=0c6f7854a9fe15aa93795fbfe04b2f70><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configsmigrationsjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0c6f7854a9fe15aa93795fbfe04b2f70","configsmigrationsjs")'>
<span class=tab-nav-text>configs/migrations.js</span></button></div><div class=tab-content-container><div data-tab-item=configsmigrationsjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Configuration information for Umzug migration engine
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports umzug an Umzug instance
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import Libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Umzug</span>, <span style=color:#a6e22e>SequelizeStorage</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;umzug&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import database configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>database</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./database.js&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>logger</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./logger.js&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create Umzug instance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>umzug</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Umzug</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>migrations</span><span style=color:#f92672>:</span> {<span style=color:#a6e22e>glob</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;migrations/*.js&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>getQueryInterface</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>storage</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SequelizeStorage</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>sequelize</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>database</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>modelName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;migrations&#39;</span>
</span></span><span style=display:flex><span>    }),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>logger</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>logger</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>umzug</span>;</span></span></code></pre></div></div></div></div></div><p>Notice that this configuration uses our existing <code>sequelize</code> database configuration, and also uses an instance of our <code>logger</code> as well. It is set to look for any migrations stored in the <code>migrations/</code> folder.</p><p>The <code>umzug</code> library also has a very handy way to run migrations directly from the terminal using a simple JavaScript file, so let&rsquo;s create a new file named <code>migrate.js</code> in the root of the <code>server</code> directory as well with this content:</p><div class=tab-panel data-tab-group=07b716a7ca19d20585e65a35d8613f4c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=migratejs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("07b716a7ca19d20585e65a35d8613f4c","migratejs")'>
<span class=tab-nav-text>migrate.js</span></button></div><div class=tab-content-container><div data-tab-item=migratejs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// Load environment (must be first)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#34;@dotenvx/dotenvx/config&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import configurations
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>migrations</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./configs/migrations.js&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Run Umzug as CLI application
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>migrations</span>.<span style=color:#a6e22e>runAsCLI</span>();</span></span></code></pre></div></div></div></div></div><p>This file will simply load our environment configuration as well as the <code>umzug</code> instance for migrations, and then instruct it to run as a command-line interface (CLI) application. This is very handy, as we&rsquo;ll see shortly.</p><h2 id=creating-a-migration>Creating a Migration</h2><p>Now we can create a new migration to actually start building our database structure for our application. For this simple example, we&rsquo;ll build a <code>users</code> table with four fields:</p><p><a href=#R-image-4ac3318844ea25119a61c8ef26f170c6 class=lightbox-link><img alt="Users ERD" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/02/migration_users.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4ac3318844ea25119a61c8ef26f170c6><img alt="Users ERD" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/02/migration_users.png></a></p><p>We can refer to both the <a href=https://github.com/sequelize/umzug rel=external target=_blank>Umzug Documentation</a> and <a href=https://github.com/sequelize/umzug/tree/main/examples/1-sequelize-typescript rel=external target=_blank>Examples</a> as well as the <a href=https://sequelize.org/docs/v6/other-topics/migrations/ rel=external target=_blank>Sequelize Documentation</a>. So, let&rsquo;s create a new folder named <code>migrations</code> to match our configuration above, then a new file named <code>00_users.js</code> to hold the migration for our <code>users</code> table:</p><div class=tab-panel data-tab-group=ad79e1c443ced3d4485dc48b2327ec56><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=migrations00_usersjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ad79e1c443ced3d4485dc48b2327ec56","migrations00_usersjs")'>
<span class=tab-nav-text>migrations/00_users.js</span></button></div><div class=tab-content-container><div data-tab-item=migrations00_usersjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Users table migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports up the Up migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports down the Down migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import Libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> {<span style=color:#a6e22e>Sequelize</span>} <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;sequelize&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Apply the migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {queryInterface} context the database context to use 
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>up</span>({<span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>queryInterface</span>}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>createTable</span>(<span style=color:#e6db74>&#39;users&#39;</span>, {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>INTEGER</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>primaryKey</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>autoIncrement</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>STRING</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>unique</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>DATE</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>DATE</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Roll back the migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {queryInterface} context the database context to use 
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>down</span>({<span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>queryInterface</span>}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>dropTable</span>(<span style=color:#e6db74>&#39;users&#39;</span>);
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>A migration consists of two functions. First, the <code>up</code> function is called when the migration is applied, and it should define or modify the database structure as desired. In this case, since this is the first migration, we can assume we are starting with a blank database and go from there. The other function, <code>down</code>, is called whenever we want to undo, or <em>rollback</em>, the migration. It should effectively undo any changes made by the <code>up</code> function, leaving the database in the state it was before the migration was applied.</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Sequential File Names</summary><div class=box-content><p>Most migration systems, including <code>umzug</code>, apply the migrations in order according to the filenames of the migrations. Some systems automatically append a timestamp to the name of the migration file when it is created, such as <code>20250203112345_users.js</code>. For our application, we will simply number them sequentially, starting with <code>00</code>.</p></div></details><p>Finally, we can use the <code>migrate.js</code> file we created to run <code>umzug</code> from the command line to apply the migration:</p><div class=tab-panel data-tab-group=f1ed9c1a2da52898ed694070c1323120><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f1ed9c1a2da52898ed694070c1323120","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ node migrate up</span></span></code></pre></div></div></div></div></div><p>If everything works correctly, we should receive some output showing that our migration succeeded:</p><div class=tab-panel data-tab-group=f527facee50b2273d51740276ee72d33><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f527facee50b2273d51740276ee72d33","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0><code>[dotenvx@1.34.0] injecting env (5) from .env
[2025-02-03 10:59:35.066 PM] info:      { event: &#39;migrating&#39;, name: &#39;00_users.js&#39; }
[2025-02-03 10:59:35.080 PM] info:      { event: &#39;migrated&#39;, name: &#39;00_users.js&#39;, durationSeconds: 0.014 }
[2025-02-03 10:59:35.080 PM] info:      applied 1 migrations.</code></pre></div></div></div></div></div><p>We should also see a file named <code>database.sqlite</code> added to our file structure. If desired, we can install the <a href="https://marketplace.visualstudio.com/items?itemName=qwtel.sqlite-viewer" rel=external target=_blank>SQLite Viewer</a> extension in VS Code to explore the contents of that file to confirm it is working correctly.</p><p><a href=#R-image-2dc9402dc43182765a125bff79597470 class=lightbox-link><img alt="Users Table in SQLite" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/02/migrations_3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-2dc9402dc43182765a125bff79597470><img alt="Users Table in SQLite" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/02/migrations_3.png></a></p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Add Extension to Dev Container</summary><div class=box-content><p>When installing a VS Code extension, we can also choose to have it added directly to our <code>devcontainer.json</code> file so it is available automatically whenever we close this repository into a new codespace or dev container. Just click the gear icon on the marketplace page and choose &ldquo;Add to devcontainer.json&rdquo; from the menu!</p><p><a href=#R-image-4841a2fdad2ded822c18f92b8c6554e7 class=lightbox-link><img alt="Add to Dev Container" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/02/migrations_2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4841a2fdad2ded822c18f92b8c6554e7><img alt="Add to Dev Container" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/02/migrations_2.png></a></p></div></details><p>If we need to roll back that migration, we can use a similar command:</p><div class=tab-panel data-tab-group=47a7abccb85d9c292023e0d78130d2b7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("47a7abccb85d9c292023e0d78130d2b7","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ node migrate down</span></span></code></pre></div></div></div></div></div><p>There are many more commands available to apply migrations individually and more. Check the <a href="https://github.com/sequelize/umzug/?tab=readme-ov-file#cli" rel=external target=_blank>Umzug Documentation</a> for more details.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=seeds>Seeds</h1><a href="https://www.youtube.com/watch?v=UZTSyvzFjAw">YouTube Video</a><h2 id=database-seeding>Database Seeding</h2><p>Another useful task that <code>umzug</code> can handle is adding some initial data to a new database. This process is known as <em>seeding</em> the database. Thankfully, the process for seeding is nearly identical to the process for migrations - in fact, it uses the same operations in different ways! So, let&rsquo;s explore how to set that up.</p><p>First, we&rsquo;ll create a new configuration file at <code>configs/seeds.js</code> that contains nearly the same content as <code>configs/migrations.js</code> with a couple of important changes on the highlighted lines:</p><div class=tab-panel data-tab-group=c290277c35e65dbc53f460783775dfe6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configsseedsjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c290277c35e65dbc53f460783775dfe6","configsseedsjs")'>
<span class=tab-nav-text>configs/seeds.js</span></button></div><div class=tab-content-container><div data-tab-item=configsseedsjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Configuration information for Umzug seed engine
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports umzug an Umzug instance
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import Libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Umzug</span>, <span style=color:#a6e22e>SequelizeStorage</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;umzug&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import database configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>database</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./database.js&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>logger</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./logger.js&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create Umzug instance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>umzug</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Umzug</span>({
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#a6e22e>migrations</span><span style=color:#f92672>:</span> {<span style=color:#a6e22e>glob</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;seeds/*.js&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>getQueryInterface</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>storage</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SequelizeStorage</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>sequelize</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>database</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>        <span style=color:#a6e22e>modelName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;seeds&#39;</span>
</span></span><span style=display:flex><span>    }),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>logger</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>logger</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>umzug</span>;</span></span></code></pre></div></div></div></div></div><p>All we really have to do is change the folder where the migrations (in this case, the seeds) are stored, and we also change the name of the model, or table, where that information will be kept in the database.</p><p>Next, we&rsquo;ll create a <code>seed.js</code> file that allows us to run the seeds from the command line. Again, this file is nearly identical to the <code>migrate.js</code> file from earlier, with a couple of simple changes:</p><div class=tab-panel data-tab-group=50e82c94c0a7f75a8001cf80af9a0c12><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=seedjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("50e82c94c0a7f75a8001cf80af9a0c12","seedjs")'>
<span class=tab-nav-text>seed.js</span></button></div><div class=tab-content-container><div data-tab-item=seedjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// Load environment (must be first)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#34;@dotenvx/dotenvx/config&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import configurations
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>seeds</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./configs/seeds.js&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Run Umzug as CLI application
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#a6e22e>seeds</span>.<span style=color:#a6e22e>runAsCLI</span>();</span></span></code></pre></div></div></div></div></div><p>Finally, we can create a new folder <code>seeds</code> to store our seeds, and then create the first seed also called <code>00_users.js</code> to add a few default users to our database:</p><div class=tab-panel data-tab-group=f44d1f9769dc72b136cd54762bbd4079><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=seeds00_usersjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f44d1f9769dc72b136cd54762bbd4079","seeds00_usersjs")'>
<span class=tab-nav-text>seeds/00_users.js</span></button></div><div class=tab-content-container><div data-tab-item=seeds00_usersjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Users seed
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports up the Up migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports down the Down migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Timestamp in the appropriate format for the database
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>now</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>toISOString</span>().<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>23</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;T&#34;</span>, <span style=color:#e6db74>&#34; &#34;</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; +00:00&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Array of objects to add to the database
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>users</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;admin&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;contributor&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;manager&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>4</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;user&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Apply the seed
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {queryInterface} context the database context to use 
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>up</span>({<span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>queryInterface</span>}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>bulkInsert</span>(<span style=color:#e6db74>&#39;users&#39;</span>, <span style=color:#a6e22e>users</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Roll back the seed
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {queryInterface} context the database context to use 
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>down</span>({<span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>queryInterface</span>}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>bulkDelete</span>(<span style=color:#e6db74>&#34;users&#34;</span>, {}, { <span style=color:#a6e22e>truncate</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> });
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>This seed will add 4 users to the database. Notice that we are setting both the <code>createdAt</code> and <code>updatedAt</code> fields manually - while the <code>sequelize</code> library will manage those for us in certain situations, we must handle them manually when doing a bulk insert directly to the database.</p><p>At this point we can insert our seeds into the database using the command line interface:</p><div class=tab-panel data-tab-group=e0e210ba52519f5795646c8183282f48><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e0e210ba52519f5795646c8183282f48","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ node seed up</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=00ca0751da8c1de74b3e7be19be98fd7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("00ca0751da8c1de74b3e7be19be98fd7","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0><code>[dotenvx@1.34.0] injecting env (5) from .env
[2025-02-04 02:47:20.702 PM] info:      { event: &#39;migrating&#39;, name: &#39;00_users.js&#39; }
[2025-02-04 02:47:20.716 PM] info:      { event: &#39;migrated&#39;, name: &#39;00_users.js&#39;, durationSeconds: 0.013 }
[2025-02-04 02:47:20.716 PM] info:      applied 1 migrations.</code></pre></div></div></div></div></div><p>Now, once we&rsquo;ve done that, we can go back to the <a href="https://marketplace.visualstudio.com/items?itemName=qwtel.sqlite-viewer" rel=external target=_blank>SQLite Viewer</a> extension in VS Code to confirm that our data was properly inserted into the database.</p><p><a href=#R-image-e14f7a2ee8d4056c15302e9f808f4857 class=lightbox-link><img alt="Seeded Data" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/02/seed_1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e14f7a2ee8d4056c15302e9f808f4857><img alt="Seeded Data" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/02/seed_1.png></a></p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Migrate Before Seeding</summary><div class=box-content><p>One common mistake that is very easy to do is to try and seed the database without first migrating it.</p><div class=tab-panel data-tab-group=4341f4295eeb5d1f6c557d53523dc1aa><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4341f4295eeb5d1f6c557d53523dc1aa","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0><code>[2025-02-04 02:51:39.452 PM] info:      { event: &#39;migrating&#39;, name: &#39;00_users.js&#39; }

Error: Migration 00_users.js (up) failed: Original error: SQLITE_ERROR: no such table: users</code></pre></div></div></div></div></div><p>Thankfully <code>umzug</code> gives a pretty helpful error in this case.</p><p>Another common error is to forget to roll back seeds before rolling back and resetting any migrations. In that case, when you try to apply your seeds again, they will not be applied since the database thinks the data is still present. So, remember to roll back your seeds <em>before</em> rolling back any migrations!</p></div></details><p>We&rsquo;re almost ready to test our app! The last step is to create a model for our data, which we&rsquo;ll cover on the next page.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=models>Models</h1><a href="https://www.youtube.com/watch?v=c4iNYRhqxTs">YouTube Video</a><h2 id=database-models>Database Models</h2><p>Now that we have our database table structure and sample data set up, we can finally configure <code>sequelize</code> to query our database by defining a <a href=https://sequelize.org/docs/v6/core-concepts/model-basics/ rel=external target=_blank>model</a> representing that data. At its core, a model is simply an abstraction that represents the structure of the data in a table of our database. We can equate this to a <code>class</code> in object-oriented programming - each row or <em>record</em> in our database can be thought of as an <em>instance</em> of our model class. You can learn more about models in the <a href=https://sequelize.org/docs/v6/core-concepts/model-basics/ rel=external target=_blank>Sequelize Documentation</a></p><p>To create a model, let&rsquo;s first create a <code>models</code> folder in our app, then we can create a file <code>user.js</code> that contains the schema for the <code>User</code> model, based on the <code>users</code> table.</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Singular vs. Plural</summary><div class=box-content><p>By convention, model names are usually singular like &ldquo;user&rdquo; while table names are typically pluralized like &ldquo;users.&rdquo; This is not a rule that must be followed, but many web frameworks use this convention so we&rsquo;ll also follow it.</p></div></details><p>The <code>User</code> model schema should look very similar to the table definition used in the migration created earlier in this example:</p><div class=tab-panel data-tab-group=ba49b4fdda9a28faa7479832d6024f13><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=modelsuserjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ba49b4fdda9a28faa7479832d6024f13","modelsuserjs")'>
<span class=tab-nav-text>models/user.js</span></button></div><div class=tab-content-container><div data-tab-item=modelsuserjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file User schema
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports UserSchema the schema for the User model
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Sequelize</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;sequelize&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>UserSchema</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>INTEGER</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>primaryKey</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>autoIncrement</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>STRING</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>unique</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>DATE</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>DATE</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>UserSchema</span></span></span></code></pre></div></div></div></div></div><p>At a minimum, a model schema defines the attributes that are stored in the database, but there are many more features that can be added over time, such as additional computed fields (for example, a <code>fullName</code> field that concatenates the <code>giveName</code> and <code>familyName</code> fields stored in the database). We&rsquo;ll explore ways to improve our models in later examples.</p><p>Once we have the model schema created, we&rsquo;ll create a second file named <code>models.js</code> that will pull together all of our schemas and actually build the <code>sequelize</code> models that can be used throughout our application.</p><div class=tab-panel data-tab-group=c3b61b8e622a618323db90a0efbaf068><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=modelsmodelsjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c3b61b8e622a618323db90a0efbaf068","modelsmodelsjs")'>
<span class=tab-nav-text>models/models.js</span></button></div><div class=tab-content-container><div data-tab-item=modelsmodelsjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Database models
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports User a Sequelize User model
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import database connection
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>database</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;../configs/database.js&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import Schemas
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>UserSchema</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./user.js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create User Model
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>User</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>define</span>(
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Model Name
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#e6db74>&#39;User&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Schema
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>UserSchema</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Other options
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tableName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;users&#39;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>User</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>It is also important to note that we can define the name of the table that stores instances of the model in the <code>tableName</code> option.</p><p>We will see why it is important to use this <code>models.js</code> file (instead of just defining the model itself and not just the schema in the <code>users.js</code> file) once we start adding relations between the models. For now, we&rsquo;ll start with this simple scaffold that we can expand upon in the future.</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Models vs. Migrations</summary><div class=box-content><p>One of the more interesting features of <code>sequelize</code> is that it can use just the models themselves to define the structure of the tables in the database. It has features such as <a href=https://sequelize.org/docs/v6/core-concepts/model-basics/#model-synchronization rel=external target=_blank>Model Synchronization</a> to keep the database structure updated to match the given models.</p><p>However, even in the documentation, <code>sequelize</code> recommends using migrations for more complex database structures. So, in our application, the migrations will represent the incremental steps required over time to construct our application&rsquo;s database tables, whereas the models will represent the full structure of the database tables at this point in time. As we add new features to our application, this difference will become more apparent.</p></div></details><h2 id=model-querying>Model Querying</h2><p>Finally, we are at the point where we can actually use our database in our application! So, let&rsquo;s update the route for the <code>users</code> endpoint to actually return a list of the users of our application in a JSON format:</p><div class=tab-panel data-tab-group=475a65d9881ac88970139b3904ad0050><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=routesusersjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("475a65d9881ac88970139b3904ad0050","routesusersjs")'>
<span class=tab-nav-text>routes/users.js</span></button></div><div class=tab-content-container><div data-tab-item=routesusersjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Users router
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports router an Express router
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @swagger
</span></span></span><span style=display:flex><span><span style=color:#75715e> * tags:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *   name: users
</span></span></span><span style=display:flex><span><span style=color:#75715e> *   description: Users Routes
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>express</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;express&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create Express router
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>router</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>.<span style=color:#a6e22e>Router</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Import models
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>User</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../models/models.js&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Gets the list of users
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {Object} req - Express request object
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {Object} res - Express response object
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {Function} next - Express next middleware function
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @swagger
</span></span></span><span style=display:flex><span><span style=color:#75715e> * /users:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *   get: 
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     summary: users list page
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     description: Gets the list of all users in the application
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     tags: [users]
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     responses:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       200: 
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         description: a resource         
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>, <span style=color:#a6e22e>next</span>) {
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>users</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>User</span>.<span style=color:#a6e22e>findAll</span>();
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>(<span style=color:#a6e22e>users</span>)
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>router</span>;</span></span></code></pre></div></div></div></div></div><p>The only change we need to make is to import our <code>User</code> model we just created in the <code>models/models.js</code> file, and then use the <code>User.findAll()</code> query method inside of our first route method. A full list of all the querying functions in <code>sequelize</code> can be found in the <a href=https://sequelize.org/docs/v6/core-concepts/model-querying-basics/ rel=external target=_blank>Sequelize Documentation</a></p><p>Now, let&rsquo;s start our application and see if it works! We should make sure we have migrated and seeded the database recently before starting. If everything works correctly, we should be able to navigate to the <code>/users</code> path and see the following JSON output on the page:</p><div class=tab-panel data-tab-group=f869d3ade741f0e34f78f7bf504294c1><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=route-users class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f869d3ade741f0e34f78f7bf504294c1","route-users")'>
<span class=tab-nav-text>route: /users</span></button></div><div class=tab-content-container><div data-tab-item=route-users class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;username&#34;</span>: <span style=color:#e6db74>&#34;admin&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;createdAt&#34;</span>: <span style=color:#e6db74>&#34;2025-02-04T15:36:32.000Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;updatedAt&#34;</span>: <span style=color:#e6db74>&#34;2025-02-04T15:36:32.000Z&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;username&#34;</span>: <span style=color:#e6db74>&#34;contributor&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;createdAt&#34;</span>: <span style=color:#e6db74>&#34;2025-02-04T15:36:32.000Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;updatedAt&#34;</span>: <span style=color:#e6db74>&#34;2025-02-04T15:36:32.000Z&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;username&#34;</span>: <span style=color:#e6db74>&#34;manager&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;createdAt&#34;</span>: <span style=color:#e6db74>&#34;2025-02-04T15:36:32.000Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;updatedAt&#34;</span>: <span style=color:#e6db74>&#34;2025-02-04T15:36:32.000Z&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#ae81ff>4</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;username&#34;</span>: <span style=color:#e6db74>&#34;user&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;createdAt&#34;</span>: <span style=color:#e6db74>&#34;2025-02-04T15:36:32.000Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;updatedAt&#34;</span>: <span style=color:#e6db74>&#34;2025-02-04T15:36:32.000Z&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]</span></span></code></pre></div></div></div></div></div><p>Awesome! We have now developed a basic web application that is able to query a database and present data to the user in a JSON format. This is the first big step toward actually building a RESTful API application.</p><p>This is a good point to <strong>commit and push</strong> our work!</p><details open class="box cstyle notices warning"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-triangle"></i>
Committing Database Files</summary><div class=box-content><p>One thing we might notice is that our <code>database.sqlite</code> file is in the list of files to be committed to our GitHub repository for this project. In many cases, you may or may not want to do this, depending on what type of data you are storing in the database and how you are using it.</p><p>For this application, and the projects in this course, we&rsquo;ll go ahead and commit our database to GitHub since that is the simplest way to share that information.</p></div></details><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=documenting-models>Documenting Models</h1><a href="https://www.youtube.com/watch?v=ebVJ4R08ZZM">YouTube Video</a><h2 id=documenting-models-with-open-api>Documenting Models with Open API</h2><p>Before we move ahead, let&rsquo;s quickly take a minute to add some documentation to our models using the Open API specification. The details can be found in the <a href=https://swagger.io/specification/ rel=external target=_blank>Open API Specification Document</a></p><p>First, let&rsquo;s update our configuration in the <code>configs/openapi.js</code> file to include the <code>models</code> directory:</p><div class=tab-panel data-tab-group=c6b3132f6ee4202f4b336d9c289f2504><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configsopenapijs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c6b3132f6ee4202f4b336d9c289f2504","configsopenapijs")'>
<span class=tab-nav-text>configs/openapi.js</span></button></div><div class=tab-content-container><div data-tab-item=configsopenapijs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Configure SwaggerJSDoc options
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>options</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>definition</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>openapi</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;3.1.0&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>info</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>title</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Example Project&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;0.0.1&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>description</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Example Project&#34;</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>servers</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>url</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>url</span>(),
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#a6e22e>apis</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;./routes/*.js&#34;</span>, <span style=color:#e6db74>&#34;./models/*.js&#34;</span>],
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>Next, at the top of our <code>models/user.js</code> file, we can add information in an <code>@swagger</code> tag about our newly created <code>User</code> model, usually placed right above the model definition itself:</p><div class=tab-panel data-tab-group=a7089ad4b6c6c9577cb4b119ee487ca3><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=modelsuserjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a7089ad4b6c6c9577cb4b119ee487ca3","modelsuserjs")'>
<span class=tab-nav-text>models/user.js</span></button></div><div class=tab-content-container><div data-tab-item=modelsuserjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @swagger
</span></span></span><span style=display:flex><span><span style=color:#75715e> * components:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *   schemas:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     User:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       type: object
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       required:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         - username
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       properties:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         id:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           type: integer
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           description: autogenerated id
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         username:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           type: string
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           description: username for the user
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         createdAt:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           type: string
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           format: date-time
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           description: when the user was created
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         updatedAt:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           type: string
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           format: date-time
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           description: when the user was last updated
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       example:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           id: 1
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           username: admin
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           createdAt: 2025-02-04T15:36:32.000Z
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           updatedAt: 2025-02-04T15:36:32.000Z
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>UserSchema</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>Finally, we can now update our route in the <code>routes/users.js</code> file to show that it is outputting an array of <code>User</code> objects:</p><div class=tab-panel data-tab-group=baef6fe87cccf3d8664998ce8cc64fdc><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=routesusersjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("baef6fe87cccf3d8664998ce8cc64fdc","routesusersjs")'>
<span class=tab-nav-text>routes/users.js</span></button></div><div class=tab-content-container><div data-tab-item=routesusersjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Gets the list of users
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {Object} req - Express request object
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {Object} res - Express response object
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {Function} next - Express next middleware function
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @swagger
</span></span></span><span style=display:flex><span><span style=color:#75715e> * /users:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *   get: 
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     summary: users list page
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     description: Gets the list of all users in the application
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     tags: [users]
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *     responses:
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *       200:
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *         description: the list of users
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *         content:
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *           application/json:
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *             schema:
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *               type: array
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *               items:
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *                 $ref: &#39;#/components/schemas/User&#39;       
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>, <span style=color:#a6e22e>next</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>users</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>User</span>.<span style=color:#a6e22e>findAll</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>(<span style=color:#a6e22e>users</span>)
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>With all of that in place, we can start our application with the Open API documentation enabled, then navigate to the <code>/docs</code> route to see our updated documentation. We should now see our <code>User</code> model listed as a schema at the bottom of the page:</p><p><a href=#R-image-88beefeab1e7237642d74aa269fde9ba class=lightbox-link><img alt="User Schema" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/02/documenting_1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-88beefeab1e7237642d74aa269fde9ba><img alt="User Schema" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/02/documenting_1.png></a></p><p>In addition, we can see that the <code>/users</code> route has also been updated to show that it returns an array of <code>User</code> objects, along with the relevant data:</p><p><a href=#R-image-d03056fd054d6a50568a44151807cf41 class=lightbox-link><img alt="User Route Documentation" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/02/documenting_2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d03056fd054d6a50568a44151807cf41><img alt="User Route Documentation" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/02/documenting_2.png></a></p><p>As we continue to add models and routes to our application, we should also make sure our Open API documentation is kept up to date with the latest information.</p><p>This is a good point to <strong>commit and push</strong> our work!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=automation>Automation</h1><a href="https://www.youtube.com/watch?v=LMQZ6OXpzGU">YouTube Video</a><h2 id=automating-database-deployment>Automating Database Deployment</h2><p>One very helpful feature we can add to our application is the ability to automatically migrate and seed the database when the application first starts. This can be especially helpful when deploying this application in a container.</p><p>To do this, let&rsquo;s add some additional code to our <code>bin/www</code> file that is executed when our project starts:</p><div class=tab-panel data-tab-group=22dca0a3cecb803622dbdb4461aafd1f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=binwww class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("22dca0a3cecb803622dbdb4461aafd1f","binwww")'>
<span class=tab-nav-text>bin/www</span></button></div><div class=tab-content-container><div data-tab-item=binwww class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Executable entrypoint for the web application
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>http</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;http&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import Express application
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>app</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../app.js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import configurations
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>database</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../configs/database.js&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>logger</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../configs/logger.js&#39;</span>;
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>migrations</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../configs/migrations.js&#39;</span>;
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>seeds</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../configs/seeds.js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Get port from environment and store in Express.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>port</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>normalizePort</span>(<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>PORT</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;3000&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;port&#39;</span>, <span style=color:#a6e22e>port</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create HTTP server.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>server</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>createServer</span>(<span style=color:#a6e22e>app</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Attach event handlers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;error&#39;</span>, <span style=color:#a6e22e>onError</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>on</span>(<span style=color:#e6db74>&#39;listening&#39;</span>, <span style=color:#a6e22e>onListening</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Call startup function
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#a6e22e>startup</span>();
</span></span><span style=display:flex;background-color:#3c3d38><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> * Server startup function
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>startup</span>() {
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#75715e>// Test database connection
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>    <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>authenticate</span>().<span style=color:#a6e22e>then</span>(() =&gt; {
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>&#34;Database connection successful&#34;</span>)
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#75715e>// Run migrations
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>      <span style=color:#a6e22e>migrations</span>.<span style=color:#a6e22e>up</span>().<span style=color:#a6e22e>then</span>(() =&gt; {
</span></span><span style=display:flex;background-color:#3c3d38><span>        <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>&#34;Database migrations complete&#34;</span>)
</span></span><span style=display:flex;background-color:#3c3d38><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>SEED_DATA</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;true&#39;</span>) {
</span></span><span style=display:flex;background-color:#3c3d38><span>          <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>warn</span>(<span style=color:#e6db74>&#34;Database data seeding is enabled!&#34;</span>)
</span></span><span style=display:flex;background-color:#3c3d38><span>          <span style=color:#a6e22e>seeds</span>.<span style=color:#a6e22e>up</span>().<span style=color:#a6e22e>then</span>(() =&gt; {
</span></span><span style=display:flex;background-color:#3c3d38><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>debug</span>(<span style=color:#e6db74>&#34;Database seeding complete&#34;</span>)
</span></span><span style=display:flex;background-color:#3c3d38><span>            <span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>listen</span>(<span style=color:#a6e22e>port</span>)
</span></span><span style=display:flex;background-color:#3c3d38><span>          })
</span></span><span style=display:flex;background-color:#3c3d38><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span>          <span style=color:#75715e>// Listen on provided port, on all network interfaces.
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>          <span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>listen</span>(<span style=color:#a6e22e>port</span>)
</span></span><span style=display:flex;background-color:#3c3d38><span>        }
</span></span><span style=display:flex;background-color:#3c3d38><span>      })
</span></span><span style=display:flex;background-color:#3c3d38><span>    })
</span></span><span style=display:flex;background-color:#3c3d38><span>  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>){
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#a6e22e>error</span>)
</span></span><span style=display:flex;background-color:#3c3d38><span>  }
</span></span><span style=display:flex;background-color:#3c3d38><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>We now have a new <code>startup</code> function that will first test the database connection, then run the migrations, and finally it will seed the database if the <code>SEED_DATA</code> environment variable is set to <code>true</code>. Once all that is done, it will start the application by calling <code>server.listen</code> using the port.</p><p>Notice that this code uses the <code>then()</code> function to resolve promises instead of the <code>async</code> and <code>await</code> keywords. This is because it is running at the top level, and cannot include any <code>await</code> keywords.</p><p>To enable this, let&rsquo;s add the <code>SEED_DATA</code> environment variable to both <code>.env</code> and <code>.env.example</code>:</p><div class=tab-panel data-tab-group=f7900a0ec02ef4ae17fc516c4b78bf32><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=env class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f7900a0ec02ef4ae17fc516c4b78bf32","env")'>
<span class=tab-nav-text>.env</span></button></div><div class=tab-content-container><div data-tab-item=env class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-env data-lang=env><span style=display:flex><span>LOG_LEVEL<span style=color:#f92672>=</span>debug
</span></span><span style=display:flex><span>PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>OPENAPI_HOST<span style=color:#f92672>=</span>https://$CODESPACE_NAME-$PORT.$GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN
</span></span><span style=display:flex><span>OPENAPI_VISIBLE<span style=color:#f92672>=</span>true
</span></span><span style=display:flex><span>DATABASE_FILE<span style=color:#f92672>=</span>database.sqlite
</span></span><span style=display:flex;background-color:#3c3d38><span>SEED_DATA<span style=color:#f92672>=</span>true</span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=2523f409e41002a936887e02314e9421><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=envexample class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2523f409e41002a936887e02314e9421","envexample")'>
<span class=tab-nav-text>.env.example</span></button></div><div class=tab-content-container><div data-tab-item=envexample class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-env data-lang=env><span style=display:flex><span>LOG_LEVEL<span style=color:#f92672>=</span>debug
</span></span><span style=display:flex><span>PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>OPENAPI_HOST<span style=color:#f92672>=</span>http://localhost:3000
</span></span><span style=display:flex><span><span style=color:#75715e># For GitHub Codespaces</span>
</span></span><span style=display:flex><span><span style=color:#75715e># OPENAPI_HOST=https://$CODESPACE_NAME-$PORT.$GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN</span>
</span></span><span style=display:flex><span>OPENAPI_VISIBLE<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>DATABASE_FILE<span style=color:#f92672>=</span>database.sqlite
</span></span><span style=display:flex;background-color:#3c3d38><span>SEED_DATA<span style=color:#f92672>=</span>false</span></span></code></pre></div></div></div></div></div><p>To test this, we can delete the <code>database.sqlite</code> file in our repository, then start our project:</p><div class=tab-panel data-tab-group=4d867f2acf7d05cfb9061aa0e42a76ca><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4d867f2acf7d05cfb9061aa0e42a76ca","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm run dev</span></span></code></pre></div></div></div></div></div><p>If it works correctly, we should see that our application is able to connect to the database, migrate the schema, and add the seed data, before fully starting:</p><div class=tab-panel data-tab-group=7f86752794fff46e3121e866a8dfded0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("7f86752794fff46e3121e866a8dfded0","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto hl_lines=11-23><pre tabindex=0><code>&gt; example-project@0.0.1 dev
&gt; nodemon ./bin/www

[nodemon] 3.1.9
[nodemon] to restart at any time, enter `rs`
[nodemon] watching path(s): *.*
[nodemon] watching extensions: js,mjs,cjs,json
[nodemon] starting `node ./bin/www`
[dotenvx@1.34.0] injecting env (6) from .env
[2025-02-04 06:56:11.823 PM] warn:      OpenAPI documentation visible!
[2025-02-04 06:56:12.163 PM] debug:     Database connection successful
[2025-02-04 06:56:12.208 PM] info:      { event: &#39;migrating&#39;, name: &#39;00_users.js&#39; }
[2025-02-04 06:56:12.265 PM] info:      { event: &#39;migrated&#39;, name: &#39;00_users.js&#39;, durationSeconds: 0.058 }
[2025-02-04 06:56:12.266 PM] debug:     Database migrations complete
[2025-02-04 06:56:12.266 PM] warn:      Database data seeding is enabled!
[2025-02-04 06:56:12.296 PM] info:      { event: &#39;migrating&#39;, name: &#39;00_users.js&#39; }
[2025-02-04 06:56:12.321 PM] info:      { event: &#39;migrated&#39;, name: &#39;00_users.js&#39;, durationSeconds: 0.024 }
[2025-02-04 06:56:12.321 PM] debug:     Database seeding complete
[2025-02-04 06:56:12.323 PM] info:      Listening on port 3000</code></pre></div></div></div></div></div><p>There we go! Our application will now always make sure the database is properly migrated, and optionally seeded, before it starts. Now, when another developer or user starts our application, it will be sure to have a working database.</p><p>This is a good point to <strong>commit and push</strong> our work!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=another-table>Another Table</h1><a href="https://www.youtube.com/watch?v=MWRW1LgN7gI">YouTube Video</a><h2 id=adding-another-table>Adding Another Table</h2><p>Now that we have a working database, let&rsquo;s explore what it takes to add a new table to our application to represent additional models and data in our database.</p><p>We&rsquo;ve already created a <code>users</code> table, which contains information about the users of our application. Now we want to add a <code>roles</code> table to contain all of the possible roles that our users can hold. In addition, we need some way to associate a user with a number of roles. Each user can have multiple roles, and each role can be assigned to multiple users. This is known as a <strong>many to many</strong> database relation, and requires an additional <strong>junction table</strong> to implement it properly. The end goal is to create the database schema represented in this diagram:</p><p><a href=#R-image-dca406a0c855fccc9c86c0b5ded42338 class=lightbox-link><img alt="User Roles Database Diagram" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/02/user_roles.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-dca406a0c855fccc9c86c0b5ded42338><img alt="User Roles Database Diagram" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/02/user_roles.png></a></p><p>To do this, we&rsquo;ll go through three steps:</p><ol><li>Create a migration to modify the database schema</li><li>Create a model for each table</li><li>Add additional seed data for these tables</li></ol><h2 id=migration>Migration</h2><p>First, we need to create a new migration to modify the database schema to include the two new tables. So, we&rsquo;ll create a file named <code>01_roles.js</code> in the <code>migrations</code> folder and add content to it to represent the two new tables we need to create:</p><div class=tab-panel data-tab-group=143bd8fe741561e2e5e13808dcd8d821><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=migrations01_rolesjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("143bd8fe741561e2e5e13808dcd8d821","migrations01_rolesjs")'>
<span class=tab-nav-text>migrations/01_roles.js</span></button></div><div class=tab-content-container><div data-tab-item=migrations01_rolesjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Roles table migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports up the Up migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports down the Down migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import Libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> {<span style=color:#a6e22e>Sequelize</span>} <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;sequelize&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Apply the migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {queryInterface} context the database context to use 
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>up</span>({<span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>queryInterface</span>}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>createTable</span>(<span style=color:#e6db74>&#39;roles&#39;</span>, {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>INTEGER</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>primaryKey</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>autoIncrement</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>STRING</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>DATE</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>DATE</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>createTable</span>(<span style=color:#e6db74>&#39;user_roles&#39;</span>, {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>user_id</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>INTEGER</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>primaryKey</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>references</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>model</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;users&#39;</span>, <span style=color:#a6e22e>key</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;id&#39;</span> },
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>onDelete</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;cascade&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role_id</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>INTEGER</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>primaryKey</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>references</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>model</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;roles&#39;</span>, <span style=color:#a6e22e>key</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;id&#39;</span> },
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>onDelete</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;cascade&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Roll back the migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {queryInterface} context the database context to use 
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>down</span>({<span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>queryInterface</span>}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>dropTable</span>(<span style=color:#e6db74>&#39;user_roles&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>dropTable</span>(<span style=color:#e6db74>&#39;roles&#39;</span>);
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>In this migration, we are creating two tables. The first, named <code>roles</code>, stores the list of roles in the application. The second, named <code>user_roles</code>, is the junction table used for the many-to-many relationship between the <code>users</code> and <code>roles</code> table. Notice that we have to add the tables in the correct order, and also in the <code>down</code> method we have to remove them in reverse order. Finally, it is important to include the <code>onDelete: "cascade"</code> option for each of our reference fields in the <code>user_roles</code> table, as that will handle deleting associated entries in the junction table when a user or role is deleted.</p><p>The <code>user_roles</code> table also includes a great example for adding a foreign key reference between two tables. More information can be found in the <a href=https://sequelize.org/docs/v6/core-concepts/assocs/ rel=external target=_blank>Sequelize Documentation</a>.</p><h2 id=models>Models</h2><p>Next, we need to create two models to represent these tables. The first is the <code>role</code> model schema, stored in <code>models/role.js</code> with the following content:</p><div class=tab-panel data-tab-group=d8f7788cc2e6d6db8440c5296dd2b1dd><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=modelsrolejs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d8f7788cc2e6d6db8440c5296dd2b1dd","modelsrolejs")'>
<span class=tab-nav-text>models/role.js</span></button></div><div class=tab-content-container><div data-tab-item=modelsrolejs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Role model
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports RoleSchema the schema for the Role model
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Sequelize</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;sequelize&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @swagger
</span></span></span><span style=display:flex><span><span style=color:#75715e> * components:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *   schemas:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     Role:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       type: object
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       required:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         - role
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       properties:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         id:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           type: integer
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           description: autogenerated id
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         role:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           type: string
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           description: name of the role
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         createdAt:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           type: string
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           format: date-time
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           description: when the user was created
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         updatedAt:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           type: string
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           format: date-time
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           description: when the user was last updated
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       example:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           id: 1
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           role: manage_users
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           createdAt: 2025-02-04T15:36:32.000Z
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           updatedAt: 2025-02-04T15:36:32.000Z
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>RoleSchema</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>INTEGER</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>primaryKey</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>autoIncrement</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>role</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>STRING</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>DATE</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>DATE</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>RoleSchema</span></span></span></code></pre></div></div></div></div></div><p>Notice that this file is very similar to the <code>models/user.js</code> file created earlier, with a few careful changes made to match the table schema.</p><p>We also need to create a model schema for the <code>user_roles</code> table, which we will store in the <code>models/user_role.js</code> file with the following content:</p><div class=tab-panel data-tab-group=5bcb05279b23ddc0e475e47bc3458295><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=modelsuser_rolejs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5bcb05279b23ddc0e475e47bc3458295","modelsuser_rolejs")'>
<span class=tab-nav-text>models/user_role.js</span></button></div><div class=tab-content-container><div data-tab-item=modelsuser_rolejs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file User role junction model
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports RoleSchema the schema for the UserRole model
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Sequelize</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;sequelize&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>UserRoleSchema</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>userId</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>INTEGER</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>primaryKey</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>references</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>model</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;User&#39;</span>, <span style=color:#a6e22e>key</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;id&#39;</span> },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>onDelete</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;cascade&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>roleId</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>INTEGER</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>primaryKey</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>references</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>model</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Role&#39;</span>, <span style=color:#a6e22e>key</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;id&#39;</span> },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>onDelete</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;cascade&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>UserRoleSchema</span></span></span></code></pre></div></div></div></div></div><p>Finally, we can now update our <code>models/models.js</code> file to create the <code>Role</code> and <code>UserRole</code> models, and also to define the associations between them and the <code>User</code> model.</p><div class=tab-panel data-tab-group=566d7f7c8719b5f25e061c9bc770ab63><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=modelsmodelsjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("566d7f7c8719b5f25e061c9bc770ab63","modelsmodelsjs")'>
<span class=tab-nav-text>models/models.js</span></button></div><div class=tab-content-container><div data-tab-item=modelsmodelsjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Database models
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports User a Sequelize User model
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> * @exports Role a Sequelize Role model
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> * @exports UserRole a Sequelize UserRole model
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import database connection
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>database</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;../configs/database.js&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import Schemas
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>UserSchema</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./user.js&#39;</span>;
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>RoleSchema</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./role.js&#34;</span>;
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>UserRoleSchema</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./user_role.js&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create User Model
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>User</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>define</span>(
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Model Name
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#e6db74>&#39;User&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Schema
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>UserSchema</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Other options
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tableName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;users&#39;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Create Role Model
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Role</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>define</span>(
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#75715e>// Model Name
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>    <span style=color:#e6db74>&#39;Role&#39;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#75715e>// Schema
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>    <span style=color:#a6e22e>RoleSchema</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#75715e>// Other options
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>    {
</span></span><span style=display:flex;background-color:#3c3d38><span>        <span style=color:#a6e22e>tableName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;roles&#39;</span>
</span></span><span style=display:flex;background-color:#3c3d38><span>    }
</span></span><span style=display:flex;background-color:#3c3d38><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Create UserRole Model
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>UserRole</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>define</span>(
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#75715e>// Model Name
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>    <span style=color:#e6db74>&#39;UserRole&#39;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#75715e>// Schema
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>    <span style=color:#a6e22e>UserRoleSchema</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#75715e>// Other options
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span>    {
</span></span><span style=display:flex;background-color:#3c3d38><span>        <span style=color:#a6e22e>tableName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;user_roles&#39;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>        <span style=color:#a6e22e>timestamps</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>        <span style=color:#a6e22e>underscored</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex;background-color:#3c3d38><span>    }
</span></span><span style=display:flex;background-color:#3c3d38><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// Define Associations
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#a6e22e>Role</span>.<span style=color:#a6e22e>belongsToMany</span>(<span style=color:#a6e22e>User</span>, { <span style=color:#a6e22e>through</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>UserRole</span>, <span style=color:#a6e22e>unique</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>as</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;users&#34;</span> })
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#a6e22e>User</span>.<span style=color:#a6e22e>belongsToMany</span>(<span style=color:#a6e22e>Role</span>, { <span style=color:#a6e22e>through</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>UserRole</span>, <span style=color:#a6e22e>unique</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>as</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;roles&#34;</span> })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>User</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#a6e22e>Role</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#a6e22e>UserRole</span>,
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>Notice that this file contains two lines at the bottom to define the associations included as part of this table, so that <code>sequelize</code> will know how to handle it. This will instruct <code>sequelize</code> to add additional attributes and features to the <code>User</code> and <code>Role</code> models for querying the related data, as we&rsquo;ll see shortly.</p><p>We also added the line <code>timestamps: false</code> to the other options for the <code>User_roles</code> table to disable the creation and management of timestamps (the <code>createdAt</code> and <code>updatedAt</code> attributes), since they may not be needed for this relation.</p><p>Finally, we added the <code>underscored: true</code> line to tell <code>sequelize</code> that it should interpret the <code>userId</code> and <code>roleId</code> attributes (written in camel case as preferred by Sequelize) as <code>user_id</code> and <code>role_id</code>, respectively (written in snake case as we did in the migration).</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Camel Case vs. Snake Case</summary><div class=box-content><p>The choice of either CamelCase or snake_case naming for database attributes is a matter of preference. In this example, we show both methods, and it is up to each developer to select their own preferred style.</p></div></details><h2 id=seed>Seed</h2><p>Finally, let&rsquo;s create a new seed file in <code>seeds/01_roles.js</code> to add some default data to the <code>roles</code> and <code>user_roles</code> tables:</p><div class=tab-panel data-tab-group=24824e2e2990ab4693825a536e5cf2e6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=seeds01_rolesjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("24824e2e2990ab4693825a536e5cf2e6","seeds01_rolesjs")'>
<span class=tab-nav-text>seeds/01_roles.js</span></button></div><div class=tab-content-container><div data-tab-item=seeds01_rolesjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Roles seed
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports up the Up migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports down the Down migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Timestamp in the appropriate format for the database
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>now</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>toISOString</span>().<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>23</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;T&#34;</span>, <span style=color:#e6db74>&#34; &#34;</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; +00:00&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Array of objects to add to the database
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>roles</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;manage_users&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;manage_documents&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;add_documents&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>4</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;manage_communities&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;add_communities&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>6</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;view_documents&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>7</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;view_communities&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>now</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>user_roles</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>user_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>user_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>user_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>user_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>user_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>user_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>user_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>user_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>4</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>user_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>4</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>role_id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Apply the migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {queryInterface} context the database context to use 
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>up</span>({<span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>queryInterface</span>}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>bulkInsert</span>(<span style=color:#e6db74>&#39;roles&#39;</span>, <span style=color:#a6e22e>roles</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>bulkInsert</span>(<span style=color:#e6db74>&#39;user_roles&#39;</span>, <span style=color:#a6e22e>user_roles</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Roll back the migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {queryInterface} context the database context to use 
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>down</span>({<span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>queryInterface</span>}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>bulkDelete</span>(<span style=color:#e6db74>&#39;user_roles&#39;</span>, {} , { <span style=color:#a6e22e>truncate</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> });
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>bulkDelete</span>(<span style=color:#e6db74>&#34;roles&#34;</span>, {}, { <span style=color:#a6e22e>truncate</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> });
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>Once again, this seed is very similar to what we&rsquo;ve seen before. Notice that we use the <code>truncate</code> option to remove all entries in the <code>user_roles</code> table when we undo this seed as well as the <code>roles</code> table.</p><details open class="box cstyle notices tip"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Seeding from a CSV File</summary><div class=box-content><p>It is also possible to seed the database from a CSV or other data file using a bit of JavaScript code. Here&rsquo;s an example for seeding a table that contains all of the counties in Kansas using a CSV file with that data that is read with the <a href=https://www.npmjs.com/package/convert-csv-to-json rel=external target=_blank>convert-csv-to-json</a> library:</p><div class=tab-panel data-tab-group=759847ec8ddaeed16b0b0d8b040794fe><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=seeds02_countiesjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("759847ec8ddaeed16b0b0d8b040794fe","seeds02_countiesjs")'>
<span class=tab-nav-text>seeds/02_counties.js</span></button></div><div class=tab-content-container><div data-tab-item=seeds02_countiesjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// Import libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>csvToJson</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>import</span>(<span style=color:#e6db74>&#34;convert-csv-to-json&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Timestamp in the appropriate format for the database
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>now</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Date().<span style=color:#a6e22e>toISOString</span>().<span style=color:#a6e22e>slice</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>23</span>).<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;T&#34;</span>, <span style=color:#e6db74>&#34; &#34;</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; +00:00&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>up</span>({ <span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>queryInterface</span> }) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Read data from CSV file
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// id,name,code,seat,population,est_year
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// 1,Allen,AL,Iola,&#34;12,464&#34;,1855
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>counties</span> <span style=color:#f92672>=</span> (<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>csvToJson</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>formatValueByType</span>()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>supportQuotedField</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>fieldDelimiter</span>(<span style=color:#e6db74>&#34;,&#34;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>getJsonFromCsv</span>(<span style=color:#e6db74>&#34;./seeds/counties.csv&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// append timestamps and parse fields
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>counties</span>.<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// handle parsing numbers with comma separators
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>population</span> <span style=color:#f92672>=</span> parseInt(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>population</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/,/g</span>, <span style=color:#e6db74>&#34;&#34;</span>));
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>createdAt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>now</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>updatedAt</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>now</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>;
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// insert into database
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>bulkInsert</span>(<span style=color:#e6db74>&#34;counties&#34;</span>, <span style=color:#a6e22e>counties</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>down</span>({ <span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>queryInterface</span> }) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>bulkDelete</span>(<span style=color:#e6db74>&#34;counties&#34;</span>, {}, { <span style=color:#a6e22e>truncate</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> });
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div></div></details><h2 id=update-user-model>Update User Model</h2><p>Finally, let&rsquo;s update the <code>User</code> model schema to include related roles. At this point, we just have to update the Open API documentation to match:</p><div class=tab-panel data-tab-group=ddfc6ca3bb0b1e39cf5123767ef040dc><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=modelsuserjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ddfc6ca3bb0b1e39cf5123767ef040dc","modelsuserjs")'>
<span class=tab-nav-text>models/user.js</span></button></div><div class=tab-content-container><div data-tab-item=modelsuserjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @swagger
</span></span></span><span style=display:flex><span><span style=color:#75715e> * components:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *   schemas:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     User:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       type: object
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       required:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         - username
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       properties:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         id:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           type: integer
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           description: autogenerated id
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         username:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           type: string
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           description: username for the user
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         createdAt:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           type: string
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           format: date-time
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           description: when the user was created
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         updatedAt:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           type: string
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           format: date-time
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           description: when the user was last updated
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *         roles:
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *           type: array
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *           items:
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *             $ref: &#39;#/components/schemas/Role&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       example:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           id: 1
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           username: admin
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           createdAt: 2025-02-04T15:36:32.000Z
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           updatedAt: 2025-02-04T15:36:32.000Z
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *           roles:
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *             - id: 1
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *               role: manage_users
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *             - id: 2
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *               role: manage_documents
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *             - id: 4
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e> *               role: manage_communities
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>Now we can modify our route in <code>routes/users.js</code> to include the data from the related <code>Role</code> model in our query:</p><div class=tab-panel data-tab-group=11ed477e1692abd36c73e6a8b557fa5a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=routesusersjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("11ed477e1692abd36c73e6a8b557fa5a","routesusersjs")'>
<span class=tab-nav-text>routes/users.js</span></button></div><div class=tab-content-container><div data-tab-item=routesusersjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Users router
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports router an Express router
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @swagger
</span></span></span><span style=display:flex><span><span style=color:#75715e> * tags:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *   name: users
</span></span></span><span style=display:flex><span><span style=color:#75715e> *   description: Users Routes
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>express</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;express&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create Express router
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>router</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>.<span style=color:#a6e22e>Router</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import models
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>User</span>, <span style=color:#a6e22e>Role</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../models/models.js&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Gets the list of users
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {Object} req - Express request object
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {Object} res - Express response object
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {Function} next - Express next middleware function
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @swagger
</span></span></span><span style=display:flex><span><span style=color:#75715e> * /users:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *   get: 
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     summary: users list page
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     description: Gets the list of all users in the application
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     tags: [users]
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     responses:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       200:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         description: the list of users
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         content:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *           application/json:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *             schema:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *               type: array
</span></span></span><span style=display:flex><span><span style=color:#75715e> *               items:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *                 $ref: &#39;#/components/schemas/User&#39;          
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>, <span style=color:#a6e22e>next</span>) {
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>users</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>User</span>.<span style=color:#a6e22e>findAll</span>({
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#a6e22e>include</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#a6e22e>model</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Role</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#a6e22e>as</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;roles&#34;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#a6e22e>attributes</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;id&#39;</span>, <span style=color:#e6db74>&#39;role&#39;</span>],
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#a6e22e>through</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span>        <span style=color:#a6e22e>attributes</span><span style=color:#f92672>:</span> [],
</span></span><span style=display:flex;background-color:#3c3d38><span>      },
</span></span><span style=display:flex;background-color:#3c3d38><span>    },
</span></span><span style=display:flex;background-color:#3c3d38><span>  });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>json</span>(<span style=color:#a6e22e>users</span>)
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>router</span>;</span></span></code></pre></div></div></div></div></div><p>You can learn more about querying associations in the <a href=https://sequelize.org/docs/v6/core-concepts/assocs/#basics-of-queries-involving-associations rel=external target=_blank>Sequelize Documentation</a>.</p><p>If everything works, we should see our roles now included in our JSON output when we navigate to the <code>/users</code> route:</p><div class=tab-panel data-tab-group=190db5a68f77733b9b7c9b1161ef1dbf><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=route-users class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("190db5a68f77733b9b7c9b1161ef1dbf","route-users")'>
<span class=tab-nav-text>route: /users</span></button></div><div class=tab-content-container><div data-tab-item=route-users class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0><code>[
  {
    &#34;id&#34;: 1,
    &#34;username&#34;: &#34;admin&#34;,
    &#34;createdAt&#34;: &#34;2025-01-28T23:06:01.000Z&#34;,
    &#34;updatedAt&#34;: &#34;2025-01-28T23:06:01.000Z&#34;,
    &#34;roles&#34;: [
      {
        &#34;id&#34;: 1,
        &#34;role&#34;: &#34;manage_users&#34;
      },
      {
        &#34;id&#34;: 2,
        &#34;role&#34;: &#34;manage_documents&#34;
      },
      {
        &#34;id&#34;: 4,
        &#34;role&#34;: &#34;manage_communities&#34;
      }
    ]
  },
  {
    &#34;id&#34;: 2,
    &#34;username&#34;: &#34;contributor&#34;,
    &#34;createdAt&#34;: &#34;2025-01-28T23:06:01.000Z&#34;,
    &#34;updatedAt&#34;: &#34;2025-01-28T23:06:01.000Z&#34;,
    &#34;roles&#34;: [
      {
        &#34;id&#34;: 3,
        &#34;role&#34;: &#34;add_documents&#34;
      },
      {
        &#34;id&#34;: 5,
        &#34;role&#34;: &#34;add_communities&#34;
      }
    ]
  },
  {
    &#34;id&#34;: 3,
    &#34;username&#34;: &#34;manager&#34;,
    &#34;createdAt&#34;: &#34;2025-01-28T23:06:01.000Z&#34;,
    &#34;updatedAt&#34;: &#34;2025-01-28T23:06:01.000Z&#34;,
    &#34;roles&#34;: [
      {
        &#34;id&#34;: 2,
        &#34;role&#34;: &#34;manage_documents&#34;
      },
      {
        &#34;id&#34;: 4,
        &#34;role&#34;: &#34;manage_communities&#34;
      }
    ]
  },
  {
    &#34;id&#34;: 4,
    &#34;username&#34;: &#34;user&#34;,
    &#34;createdAt&#34;: &#34;2025-01-28T23:06:01.000Z&#34;,
    &#34;updatedAt&#34;: &#34;2025-01-28T23:06:01.000Z&#34;,
    &#34;roles&#34;: [
      {
        &#34;id&#34;: 6,
        &#34;role&#34;: &#34;view_documents&#34;
      },
      {
        &#34;id&#34;: 7,
        &#34;role&#34;: &#34;view_communities&#34;
      }
    ]
  }
]</code></pre></div></div></div></div></div><p>That should also exactly match the schema and route information in our Open API documentation provided at the <code>/docs</code> route.</p><p>There we go! That&rsquo;s a quick example of adding an additional table to our application, including a relationship and more.</p><p>As a last step before finalizing our code, we should run the <code>lint</code> and <code>format</code> commands and deal with any errors they find. Finally, we can <strong>commit and push</strong> our work.</p><footer class=footline></footer></article></section></div></main><div class=git-footer><p class=theme-version-footer>8.0.0</p><p>Last modified by:
<i class='fa-fw fas fa-user'></i> Russell Feldhausen
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cis526/commit/abfa6fce3f9ac37e49a25e050e271652415a0dc4>Feb 3, 2025</a></p></div></div><script src=/cis526/js/clipboard/clipboard.min.js?1758047999 defer></script><script src=/cis526/js/perfect-scrollbar/perfect-scrollbar.min.js?1758047999 defer></script><script src=/cis526/js/theme.min.js?1758047999 defer></script></body></html>