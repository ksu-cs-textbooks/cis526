<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.148.1"><meta name=generator content="Relearn 8.0.0"><meta name=description content="YouTube Video Umzug Now that we have a database configured in our application, we need to create some way to actually populate that database with the tables and information our app requires. We could obviously do that manually, but that really makes it difficult (if not impossible) to automatically build, test, and deploy this application.
Thankfully, most database libraries also have a way to automate building the database structure. This is known as schema migration or often just migration. We call it migration because it allows us to update the database schema along with new versions of the application, effectively migrating our data to new versions as we go."><meta name=author content="Nathan Bean & Russell Feldhausen"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta name=twitter:title content="Migrations :: CIS 526 Textbook"><meta name=twitter:description content="YouTube Video Umzug Now that we have a database configured in our application, we need to create some way to actually populate that database with the tables and information our app requires. We could obviously do that manually, but that really makes it difficult (if not impossible) to automatically build, test, and deploy this application.
Thankfully, most database libraries also have a way to automate building the database structure. This is known as schema migration or often just migration. We call it migration because it allows us to update the database schema along with new versions of the application, effectively migrating our data to new versions as we go."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/x-examples/02-database/02-migrations/index.html"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Migrations :: CIS 526 Textbook"><meta property="og:description" content="YouTube Video Umzug Now that we have a database configured in our application, we need to create some way to actually populate that database with the tables and information our app requires. We could obviously do that manually, but that really makes it difficult (if not impossible) to automatically build, test, and deploy this application.
Thankfully, most database libraries also have a way to automate building the database structure. This is known as schema migration or often just migration. We call it migration because it allows us to update the database schema along with new versions of the application, effectively migrating our data to new versions as we go."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="Example Projects"><meta property="article:modified_time" content="2025-04-01T12:31:49-05:00"><meta property="og:image" content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta itemprop=name content="Migrations :: CIS 526 Textbook"><meta itemprop=description content="YouTube Video Umzug Now that we have a database configured in our application, we need to create some way to actually populate that database with the tables and information our app requires. We could obviously do that manually, but that really makes it difficult (if not impossible) to automatically build, test, and deploy this application.
Thankfully, most database libraries also have a way to automate building the database structure. This is known as schema migration or often just migration. We call it migration because it allows us to update the database schema along with new versions of the application, effectively migrating our data to new versions as we go."><meta itemprop=dateModified content="2025-04-01T12:31:49-05:00"><meta itemprop=wordCount content="934"><meta itemprop=image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><title>Migrations :: CIS 526 Textbook</title><link href=https://textbooks.cs.ksu.edu/cis526/x-examples/02-database/02-migrations/index.html rel=canonical type=text/html title="Migrations :: CIS 526 Textbook"><link href=/cis526/x-examples/02-database/02-migrations/index.xml rel=alternate type=application/rss+xml title="Migrations :: CIS 526 Textbook"><link href=/cis526/x-examples/02-database/02-migrations/tele.html rel=alternate type=text/html title="Migrations :: CIS 526 Textbook"><link href=/cis526/x-examples/02-database/02-migrations/embed.html rel=alternate type=text/html title="Migrations :: CIS 526 Textbook"><link href=/cis526/css/auto-complete/auto-complete.min.css?1769118339 rel=stylesheet><script src=/cis526/js/auto-complete/auto-complete.min.js?1769118339 defer></script><script src=/cis526/js/search-lunr.min.js?1769118339 defer></script><script src=/cis526/js/search.min.js?1769118339 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/cis526/searchindex.en.js?1769118339"</script><script src=/cis526/js/lunr/lunr.min.js?1769118339 defer></script><script src=/cis526/js/lunr/lunr.stemmer.support.min.js?1769118339 defer></script><script src=/cis526/js/lunr/lunr.multi.min.js?1769118339 defer></script><script src=/cis526/js/lunr/lunr.en.min.js?1769118339 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1769118339 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1769118339 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar/perfect-scrollbar.min.css?1769118339 rel=stylesheet><link href=/cis526/css/theme.min.css?1769118339 rel=stylesheet><link href=/cis526/css/format-print.min.css?1769118339 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/x-examples/02-database/02-migrations/index.html",window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!1,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["light-theme"],window.relearn.customvariantname="my-custom-variant",window.relearn.writeVariant=!1,window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.writeVariant&&window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><link href=/cis526/css/custom.css?1769118339 rel=stylesheet></head><body class="mobile-support print" data-url=/cis526/x-examples/02-database/02-migrations/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#umzug>Umzug</a></li><li><a href=#setting-up-umzug>Setting up Umzug</a></li><li><a href=#creating-a-migration>Creating a Migration</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement class=a11y-only><a itemprop=item href=/cis526/index.html><span itemprop=name>Web Application Development</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cis526/x-examples/index.html><span itemprop=name>Example Projects</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cis526/x-examples/02-database/index.html><span itemprop=name>Adding a Database</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Migrations</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-edit" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=https://github.com/ksu-cs-textbooks/cis526/edit/main/content/x-examples/02-database/02-migrations.md rel=external target=_blank title="Edit (CTRL+ALT+w)"><i class="fa-fw fas fa-pen"></i></a></div><div class="topbar-button topbar-button-print" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/02-database/02-migrations/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></div><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/02-database/01-sequelize/index.html title="Sequelize (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/02-database/03-seeds/index.html title="Seeds (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more><div class="topbar-button topbar-button-embed" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/02-database/02-migrations/embed.html title="Embeddable Version"><i class="fa-fw fas fa-expand-arrows-alt"></i></a></div><div class="topbar-button topbar-button-tele" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/02-database/02-migrations/tele.html title="Teleprompter View"><i class="fa-fw fas fa-tv"></i></a></div></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable x-examples" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=migrations>Migrations</h1><a href="https://www.youtube.com/watch?v=P-0Iuaj_BAE">YouTube Video</a><h2 id=umzug>Umzug</h2><p>Now that we have a database configured in our application, we need to create some way to actually populate that database with the tables and information our app requires. We could obviously do that manually, but that really makes it difficult (if not impossible) to automatically build, test, and deploy this application.</p><p>Thankfully, most database libraries also have a way to automate building the database structure. This is known as <a href=https://en.wikipedia.org/wiki/Schema_migration rel=external target=_blank>schema migration</a> or often just <strong>migration</strong>. We call it migration because it allows us to update the database schema along with new versions of the application, effectively <em>migrating</em> our data to new versions as we go.</p><p>The <code>sequelize</code> library recommends using another library, named <a href=https://github.com/sequelize/umzug rel=external target=_blank>Umzug</a>, as the preferred way to manage database migrations. It is actually completely framework agnostic, and would even work with ORMs other than Sequelize.</p><h2 id=setting-up-umzug>Setting up Umzug</h2><p>To begin, let&rsquo;s install <code>umzug</code> using <code>npm</code>:</p><div class=tab-panel data-tab-group=e9d337623dff63e13d1e93be44efdca8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e9d337623dff63e13d1e93be44efdca8","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm install umzug</span></span></code></pre></div></div></div></div></div><p>Next, we can create a configuration file to handle our migrations, named <code>configs/migrations.js</code>, with the following content as described in the <a href=https://github.com/sequelize/umzug rel=external target=_blank>Umzug Documentation</a>:</p><div class=tab-panel data-tab-group=e49a71c19d73b85e16375b2ecb30ee70><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configsmigrationsjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e49a71c19d73b85e16375b2ecb30ee70","configsmigrationsjs")'>
<span class=tab-nav-text>configs/migrations.js</span></button></div><div class=tab-content-container><div data-tab-item=configsmigrationsjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Configuration information for Umzug migration engine
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports umzug an Umzug instance
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import Libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Umzug</span>, <span style=color:#a6e22e>SequelizeStorage</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;umzug&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import database configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>database</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./database.js&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>logger</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;./logger.js&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create Umzug instance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>umzug</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Umzug</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>migrations</span><span style=color:#f92672>:</span> {<span style=color:#a6e22e>glob</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;migrations/*.js&#39;</span>},
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>getQueryInterface</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>storage</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SequelizeStorage</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>sequelize</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>database</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>modelName</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;migrations&#39;</span>
</span></span><span style=display:flex><span>    }),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>logger</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>logger</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>umzug</span>;</span></span></code></pre></div></div></div></div></div><p>Notice that this configuration uses our existing <code>sequelize</code> database configuration, and also uses an instance of our <code>logger</code> as well. It is set to look for any migrations stored in the <code>migrations/</code> folder.</p><p>The <code>umzug</code> library also has a very handy way to run migrations directly from the terminal using a simple JavaScript file, so let&rsquo;s create a new file named <code>migrate.js</code> in the root of the <code>server</code> directory as well with this content:</p><div class=tab-panel data-tab-group=fdb0e7723b038f1c3f4769210d64ea38><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=migratejs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("fdb0e7723b038f1c3f4769210d64ea38","migratejs")'>
<span class=tab-nav-text>migrate.js</span></button></div><div class=tab-content-container><div data-tab-item=migratejs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// Load environment (must be first)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#e6db74>&#34;@dotenvx/dotenvx/config&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import configurations
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>migrations</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./configs/migrations.js&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Run Umzug as CLI application
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>migrations</span>.<span style=color:#a6e22e>runAsCLI</span>();</span></span></code></pre></div></div></div></div></div><p>This file will simply load our environment configuration as well as the <code>umzug</code> instance for migrations, and then instruct it to run as a command-line interface (CLI) application. This is very handy, as we&rsquo;ll see shortly.</p><h2 id=creating-a-migration>Creating a Migration</h2><p>Now we can create a new migration to actually start building our database structure for our application. For this simple example, we&rsquo;ll build a <code>users</code> table with four fields:</p><p><a href=#R-image-4c0bd41749f50943fd72498f1d8c6225 class=lightbox-link><img alt="Users ERD" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/02/migration_users.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-4c0bd41749f50943fd72498f1d8c6225><img alt="Users ERD" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/02/migration_users.png></a></p><p>We can refer to both the <a href=https://github.com/sequelize/umzug rel=external target=_blank>Umzug Documentation</a> and <a href=https://github.com/sequelize/umzug/tree/main/examples/1-sequelize-typescript rel=external target=_blank>Examples</a> as well as the <a href=https://sequelize.org/docs/v6/other-topics/migrations/ rel=external target=_blank>Sequelize Documentation</a>. So, let&rsquo;s create a new folder named <code>migrations</code> to match our configuration above, then a new file named <code>00_users.js</code> to hold the migration for our <code>users</code> table:</p><div class=tab-panel data-tab-group=2f0ac3d13237d8b9182ac9973263440e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=migrations00_usersjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2f0ac3d13237d8b9182ac9973263440e","migrations00_usersjs")'>
<span class=tab-nav-text>migrations/00_users.js</span></button></div><div class=tab-content-container><div data-tab-item=migrations00_usersjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Users table migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports up the Up migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports down the Down migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import Libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> {<span style=color:#a6e22e>Sequelize</span>} <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;sequelize&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Apply the migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {queryInterface} context the database context to use 
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>up</span>({<span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>queryInterface</span>}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>createTable</span>(<span style=color:#e6db74>&#39;users&#39;</span>, {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>INTEGER</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>primaryKey</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>autoIncrement</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>STRING</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>unique</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>createdAt</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>DATE</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>updatedAt</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Sequelize</span>.<span style=color:#a6e22e>DATE</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>allowNull</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Roll back the migration
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {queryInterface} context the database context to use 
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>down</span>({<span style=color:#a6e22e>context</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>queryInterface</span>}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>queryInterface</span>.<span style=color:#a6e22e>dropTable</span>(<span style=color:#e6db74>&#39;users&#39;</span>);
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>A migration consists of two functions. First, the <code>up</code> function is called when the migration is applied, and it should define or modify the database structure as desired. In this case, since this is the first migration, we can assume we are starting with a blank database and go from there. The other function, <code>down</code>, is called whenever we want to undo, or <em>rollback</em>, the migration. It should effectively undo any changes made by the <code>up</code> function, leaving the database in the state it was before the migration was applied.</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Sequential File Names</summary><div class=box-content><p>Most migration systems, including <code>umzug</code>, apply the migrations in order according to the filenames of the migrations. Some systems automatically append a timestamp to the name of the migration file when it is created, such as <code>20250203112345_users.js</code>. For our application, we will simply number them sequentially, starting with <code>00</code>.</p></div></details><p>Finally, we can use the <code>migrate.js</code> file we created to run <code>umzug</code> from the command line to apply the migration:</p><div class=tab-panel data-tab-group=a6930e88b698cefea1a2e9bd5a4b1a00><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a6930e88b698cefea1a2e9bd5a4b1a00","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ node migrate up</span></span></code></pre></div></div></div></div></div><p>If everything works correctly, we should receive some output showing that our migration succeeded:</p><div class=tab-panel data-tab-group=937ba688c9fecb725eea8b8448fe12a7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("937ba688c9fecb725eea8b8448fe12a7","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0><code>[dotenvx@1.34.0] injecting env (5) from .env
[2025-02-03 10:59:35.066 PM] info:      { event: &#39;migrating&#39;, name: &#39;00_users.js&#39; }
[2025-02-03 10:59:35.080 PM] info:      { event: &#39;migrated&#39;, name: &#39;00_users.js&#39;, durationSeconds: 0.014 }
[2025-02-03 10:59:35.080 PM] info:      applied 1 migrations.</code></pre></div></div></div></div></div><p>We should also see a file named <code>database.sqlite</code> added to our file structure. If desired, we can install the <a href="https://marketplace.visualstudio.com/items?itemName=qwtel.sqlite-viewer" rel=external target=_blank>SQLite Viewer</a> extension in VS Code to explore the contents of that file to confirm it is working correctly.</p><p><a href=#R-image-216755fbc0371fc5a6d551f5bc40ee99 class=lightbox-link><img alt="Users Table in SQLite" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/02/migrations_3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-216755fbc0371fc5a6d551f5bc40ee99><img alt="Users Table in SQLite" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/02/migrations_3.png></a></p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Add Extension to Dev Container</summary><div class=box-content><p>When installing a VS Code extension, we can also choose to have it added directly to our <code>devcontainer.json</code> file so it is available automatically whenever we close this repository into a new codespace or dev container. Just click the gear icon on the marketplace page and choose &ldquo;Add to devcontainer.json&rdquo; from the menu!</p><p><a href=#R-image-35f5b52fbd4d132e6ab6cd29844b2553 class=lightbox-link><img alt="Add to Dev Container" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/02/migrations_2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-35f5b52fbd4d132e6ab6cd29844b2553><img alt="Add to Dev Container" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/02/migrations_2.png></a></p></div></details><p>If we need to roll back that migration, we can use a similar command:</p><div class=tab-panel data-tab-group=4103c6c8dfb9d2a594f68f09148f6dbf><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4103c6c8dfb9d2a594f68f09148f6dbf","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ node migrate down</span></span></code></pre></div></div></div></div></div><p>There are many more commands available to apply migrations individually and more. Check the <a href="https://github.com/sequelize/umzug/?tab=readme-ov-file#cli" rel=external target=_blank>Umzug Documentation</a> for more details.</p><footer class=footline></footer></article></div></main><div class=git-footer><p class=theme-version-footer>8.0.0</p><p>Last modified by:
<i class='fa-fw fas fa-user'></i> Russell Feldhausen
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cis526/commit/668ef5fd97dfe609732eabeb09c018ed94cc31e3>Apr 1, 2025</a></p></div></div><script src=/cis526/js/clipboard/clipboard.min.js?1769118339 defer></script><script src=/cis526/js/perfect-scrollbar/perfect-scrollbar.min.js?1769118339 defer></script><script src=/cis526/js/theme.min.js?1769118339 defer></script></body></html>