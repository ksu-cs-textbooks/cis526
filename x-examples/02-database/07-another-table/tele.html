<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="YouTube Video Adding Another Table Now that we have a working database, let’s explore what it takes to add a new table to our application to represent additional models and data in our database.
We’ve already created a users table, which contains information about the users of our application. Now we want to add a roles table to contain all of the possible roles that our users can hold. In addition, we need some way to associate a user with a number of roles."><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Another Table :: CIS 526 Textbook"><meta name=twitter:description content="YouTube Video Adding Another Table Now that we have a working database, let’s explore what it takes to add a new table to our application to represent additional models and data in our database.
We’ve already created a users table, which contains information about the users of our application. Now we want to add a roles table to contain all of the possible roles that our users can hold. In addition, we need some way to associate a user with a number of roles."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/x-examples/02-database/07-another-table/"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Another Table :: CIS 526 Textbook"><meta property="og:description" content="YouTube Video Adding Another Table Now that we have a working database, let’s explore what it takes to add a new table to our application to represent additional models and data in our database.
We’ve already created a users table, which contains information about the users of our application. Now we want to add a roles table to contain all of the possible roles that our users can hold. In addition, we need some way to associate a user with a number of roles."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Example Projects"><meta property="article:modified_time" content="2025-03-06T15:49:16-06:00"><meta itemprop=name content="Another Table :: CIS 526 Textbook"><meta itemprop=description content="YouTube Video Adding Another Table Now that we have a working database, let’s explore what it takes to add a new table to our application to represent additional models and data in our database.
We’ve already created a users table, which contains information about the users of our application. Now we want to add a roles table to contain all of the possible roles that our users can hold. In addition, we need some way to associate a user with a number of roles."><meta itemprop=dateModified content="2025-03-06T15:49:16-06:00"><meta itemprop=wordCount content="2193"><title>Another Table :: CIS 526 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis526/x-examples/02-database/07-another-table/ rel=canonical type=text/html title="Another Table :: CIS 526 Textbook"><link href=/cis526/x-examples/02-database/07-another-table/index.xml rel=alternate type=application/rss+xml title="Another Table :: CIS 526 Textbook"><link href=/cis526/x-examples/02-database/07-another-table/index.print.html rel=alternate type=text/html title="Another Table :: CIS 526 Textbook"><link href=/cis526/x-examples/02-database/07-another-table/embed.html rel=alternate type=text/html title="Another Table :: CIS 526 Textbook"><link href=/cis526/css/fontawesome-all.min.css?1744393801 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fontawesome-all.min.css?1744393801 rel=stylesheet></noscript><link href=/cis526/css/nucleus.css?1744393801 rel=stylesheet><link href=/cis526/css/auto-complete.css?1744393801 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/auto-complete.css?1744393801 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar.min.css?1744393801 rel=stylesheet><link href=/cis526/css/fonts.css?1744393801 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fonts.css?1744393801 rel=stylesheet></noscript><link href=/cis526/css/theme.css?1744393801 rel=stylesheet><link href=/cis526/css/theme-auto.css?1744393801 rel=stylesheet id=R-variant-style><link href=/cis526/css/chroma-auto.css?1744393801 rel=stylesheet id=R-variant-chroma-style><link href=/cis526/css/variant.css?1744393801 rel=stylesheet><link href=/cis526/css/print.css?1744393801 rel=stylesheet media=print><script src=/cis526/js/variant.js?1744393801></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.index_js_url="/cis526/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis526/css/custom.css?1744393801 rel=stylesheet></head><body class="mobile-support tele disableInlineCopyToClipboard" data-url=/cis526/x-examples/02-database/07-another-table/><div id=tele class="tele mirror"><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=another-table>Another Table</h1><a href="https://www.youtube.com/watch?v=MWRW1LgN7gI">YouTube Video</a><h2 id=adding-another-table>Adding Another Table</h2><p>Now that we have a working database, let&rsquo;s explore what it takes to add a new table to our application to represent additional models and data in our database.</p><p>We&rsquo;ve already created a <code>users</code> table, which contains information about the users of our application. Now we want to add a <code>roles</code> table to contain all of the possible roles that our users can hold. In addition, we need some way to associate a user with a number of roles. Each user can have multiple roles, and each role can be assigned to multiple users. This is known as a <strong>many to many</strong> database relation, and requires an additional <strong>junction table</strong> to implement it properly. The end goal is to create the database schema represented in this diagram:</p><p><a href=#R-image-903c9f66829221d79dd7930f5fe4df13 class=lightbox-link><img alt="User Roles Database Diagram" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/02/user_roles.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-903c9f66829221d79dd7930f5fe4df13><img alt="User Roles Database Diagram" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/02/user_roles.png></a></p><p>To do this, we&rsquo;ll go through three steps:</p><ol><li>Create a migration to modify the database schema</li><li>Create a model for each table</li><li>Add additional seed data for these tables</li></ol><h2 id=migration>Migration</h2><p>First, we need to create a new migration to modify the database schema to include the two new tables. So, we&rsquo;ll create a file named <code>01_roles.js</code> in the <code>migrations</code> folder and add content to it to represent the two new tables we need to create:</p><div class=tab-panel data-tab-group=d7f1842d2dbb18165517c9f51d6941ca><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=migrations01_rolesjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d7f1842d2dbb18165517c9f51d6941ca","migrations01_rolesjs")'>
<span class=tab-nav-text>migrations/01_roles.js</span></button></div><div class=tab-content-container><div data-tab-item=migrations01_rolesjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @file Roles table migration
</span></span></span><span class=line><span class=cl><span class=cm> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span class=line><span class=cl><span class=cm> * @exports up the Up migration
</span></span></span><span class=line><span class=cl><span class=cm> * @exports down the Down migration
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import Libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span><span class=nx>Sequelize</span><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;sequelize&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Apply the migration
</span></span></span><span class=line><span class=cl><span class=cm> * 
</span></span></span><span class=line><span class=cl><span class=cm> * @param {queryInterface} context the database context to use 
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>up</span><span class=p>({</span><span class=nx>context</span><span class=o>:</span> <span class=nx>queryInterface</span><span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>queryInterface</span><span class=p>.</span><span class=nx>createTable</span><span class=p>(</span><span class=s1>&#39;roles&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>id</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>type</span><span class=o>:</span> <span class=nx>Sequelize</span><span class=p>.</span><span class=nx>INTEGER</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>primaryKey</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>autoIncrement</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>role</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>type</span><span class=o>:</span> <span class=nx>Sequelize</span><span class=p>.</span><span class=nx>STRING</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>allowNull</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>createdAt</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>type</span><span class=o>:</span> <span class=nx>Sequelize</span><span class=p>.</span><span class=nx>DATE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>allowNull</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>updatedAt</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>type</span><span class=o>:</span> <span class=nx>Sequelize</span><span class=p>.</span><span class=nx>DATE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>allowNull</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>queryInterface</span><span class=p>.</span><span class=nx>createTable</span><span class=p>(</span><span class=s1>&#39;user_roles&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>user_id</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>type</span><span class=o>:</span> <span class=nx>Sequelize</span><span class=p>.</span><span class=nx>INTEGER</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>primaryKey</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>references</span><span class=o>:</span> <span class=p>{</span> <span class=nx>model</span><span class=o>:</span> <span class=s1>&#39;users&#39;</span><span class=p>,</span> <span class=nx>key</span><span class=o>:</span> <span class=s1>&#39;id&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=nx>onDelete</span><span class=o>:</span> <span class=s2>&#34;cascade&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>role_id</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>type</span><span class=o>:</span> <span class=nx>Sequelize</span><span class=p>.</span><span class=nx>INTEGER</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>primaryKey</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>references</span><span class=o>:</span> <span class=p>{</span> <span class=nx>model</span><span class=o>:</span> <span class=s1>&#39;roles&#39;</span><span class=p>,</span> <span class=nx>key</span><span class=o>:</span> <span class=s1>&#39;id&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=nx>onDelete</span><span class=o>:</span> <span class=s2>&#34;cascade&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Roll back the migration
</span></span></span><span class=line><span class=cl><span class=cm> * 
</span></span></span><span class=line><span class=cl><span class=cm> * @param {queryInterface} context the database context to use 
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>down</span><span class=p>({</span><span class=nx>context</span><span class=o>:</span> <span class=nx>queryInterface</span><span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>queryInterface</span><span class=p>.</span><span class=nx>dropTable</span><span class=p>(</span><span class=s1>&#39;user_roles&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>queryInterface</span><span class=p>.</span><span class=nx>dropTable</span><span class=p>(</span><span class=s1>&#39;roles&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>In this migration, we are creating two tables. The first, named <code>roles</code>, stores the list of roles in the application. The second, named <code>user_roles</code>, is the junction table used for the many-to-many relationship between the <code>users</code> and <code>roles</code> table. Notice that we have to add the tables in the correct order, and also in the <code>down</code> method we have to remove them in reverse order. Finally, it is important to include the <code>onDelete: "cascade"</code> option for each of our reference fields in the <code>user_roles</code> table, as that will handle deleting associated entries in the junction table when a user or role is deleted.</p><p>The <code>user_roles</code> table also includes a great example for adding a foreign key reference between two tables. More information can be found in the <a href=https://sequelize.org/docs/v6/core-concepts/assocs/ rel=external target=_blank>Sequelize Documentation</a>.</p><h2 id=models>Models</h2><p>Next, we need to create two models to represent these tables. The first is the <code>role</code> model schema, stored in <code>models/role.js</code> with the following content:</p><div class=tab-panel data-tab-group=3b28411689a111eb02e355c5485b0483><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=modelsrolejs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("3b28411689a111eb02e355c5485b0483","modelsrolejs")'>
<span class=tab-nav-text>models/role.js</span></button></div><div class=tab-content-container><div data-tab-item=modelsrolejs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @file Role model
</span></span></span><span class=line><span class=cl><span class=cm> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span class=line><span class=cl><span class=cm> * @exports RoleSchema the schema for the Role model
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>Sequelize</span> <span class=nx>from</span> <span class=s1>&#39;sequelize&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @swagger
</span></span></span><span class=line><span class=cl><span class=cm> * components:
</span></span></span><span class=line><span class=cl><span class=cm> *   schemas:
</span></span></span><span class=line><span class=cl><span class=cm> *     Role:
</span></span></span><span class=line><span class=cl><span class=cm> *       type: object
</span></span></span><span class=line><span class=cl><span class=cm> *       required:
</span></span></span><span class=line><span class=cl><span class=cm> *         - role
</span></span></span><span class=line><span class=cl><span class=cm> *       properties:
</span></span></span><span class=line><span class=cl><span class=cm> *         id:
</span></span></span><span class=line><span class=cl><span class=cm> *           type: integer
</span></span></span><span class=line><span class=cl><span class=cm> *           description: autogenerated id
</span></span></span><span class=line><span class=cl><span class=cm> *         role:
</span></span></span><span class=line><span class=cl><span class=cm> *           type: string
</span></span></span><span class=line><span class=cl><span class=cm> *           description: name of the role
</span></span></span><span class=line><span class=cl><span class=cm> *         createdAt:
</span></span></span><span class=line><span class=cl><span class=cm> *           type: string
</span></span></span><span class=line><span class=cl><span class=cm> *           format: date-time
</span></span></span><span class=line><span class=cl><span class=cm> *           description: when the user was created
</span></span></span><span class=line><span class=cl><span class=cm> *         updatedAt:
</span></span></span><span class=line><span class=cl><span class=cm> *           type: string
</span></span></span><span class=line><span class=cl><span class=cm> *           format: date-time
</span></span></span><span class=line><span class=cl><span class=cm> *           description: when the user was last updated
</span></span></span><span class=line><span class=cl><span class=cm> *       example:
</span></span></span><span class=line><span class=cl><span class=cm> *           id: 1
</span></span></span><span class=line><span class=cl><span class=cm> *           role: manage_users
</span></span></span><span class=line><span class=cl><span class=cm> *           createdAt: 2025-02-04T15:36:32.000Z
</span></span></span><span class=line><span class=cl><span class=cm> *           updatedAt: 2025-02-04T15:36:32.000Z
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>RoleSchema</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nx>Sequelize</span><span class=p>.</span><span class=nx>INTEGER</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>primaryKey</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>autoIncrement</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>role</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nx>Sequelize</span><span class=p>.</span><span class=nx>STRING</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>allowNull</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>createdAt</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nx>Sequelize</span><span class=p>.</span><span class=nx>DATE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>allowNull</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>updatedAt</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nx>Sequelize</span><span class=p>.</span><span class=nx>DATE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>allowNull</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>RoleSchema</span></span></span></code></pre></div></div></div></div></div><p>Notice that this file is very similar to the <code>models/user.js</code> file created earlier, with a few careful changes made to match the table schema.</p><p>We also need to create a model schema for the <code>user_roles</code> table, which we will store in the <code>models/user_role.js</code> file with the following content:</p><div class=tab-panel data-tab-group=2a18aca91fe2849f088d2fd4b11e4038><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=modelsuser_rolejs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2a18aca91fe2849f088d2fd4b11e4038","modelsuser_rolejs")'>
<span class=tab-nav-text>models/user_role.js</span></button></div><div class=tab-content-container><div data-tab-item=modelsuser_rolejs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @file User role junction model
</span></span></span><span class=line><span class=cl><span class=cm> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span class=line><span class=cl><span class=cm> * @exports RoleSchema the schema for the UserRole model
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>Sequelize</span> <span class=nx>from</span> <span class=s1>&#39;sequelize&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>UserRoleSchema</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>userId</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nx>Sequelize</span><span class=p>.</span><span class=nx>INTEGER</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>primaryKey</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>references</span><span class=o>:</span> <span class=p>{</span> <span class=nx>model</span><span class=o>:</span> <span class=s1>&#39;User&#39;</span><span class=p>,</span> <span class=nx>key</span><span class=o>:</span> <span class=s1>&#39;id&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>onDelete</span><span class=o>:</span> <span class=s2>&#34;cascade&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>roleId</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=nx>Sequelize</span><span class=p>.</span><span class=nx>INTEGER</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>primaryKey</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>references</span><span class=o>:</span> <span class=p>{</span> <span class=nx>model</span><span class=o>:</span> <span class=s1>&#39;Role&#39;</span><span class=p>,</span> <span class=nx>key</span><span class=o>:</span> <span class=s1>&#39;id&#39;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=nx>onDelete</span><span class=o>:</span> <span class=s2>&#34;cascade&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>UserRoleSchema</span></span></span></code></pre></div></div></div></div></div><p>Finally, we can now update our <code>models/models.js</code> file to create the <code>Role</code> and <code>UserRole</code> models, and also to define the associations between them and the <code>User</code> model.</p><div class=tab-panel data-tab-group=8f25864bd74ef626ae5772591d7db5b3><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=modelsmodelsjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("8f25864bd74ef626ae5772591d7db5b3","modelsmodelsjs")'>
<span class=tab-nav-text>models/models.js</span></button></div><div class=tab-content-container><div data-tab-item=modelsmodelsjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @file Database models
</span></span></span><span class=line><span class=cl><span class=cm> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span class=line><span class=cl><span class=cm> * @exports User a Sequelize User model
</span></span></span><span class="line hl"><span class=cl><span class=cm> * @exports Role a Sequelize Role model
</span></span></span><span class="line hl"><span class=cl><span class=cm> * @exports UserRole a Sequelize UserRole model
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import database connection
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>database</span> <span class=nx>from</span> <span class=s2>&#34;../configs/database.js&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import Schemas
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>UserSchema</span> <span class=nx>from</span> <span class=s1>&#39;./user.js&#39;</span><span class=p>;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>import</span> <span class=nx>RoleSchema</span> <span class=nx>from</span> <span class=s2>&#34;./role.js&#34;</span><span class=p>;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>import</span> <span class=nx>UserRoleSchema</span> <span class=nx>from</span> <span class=s2>&#34;./user_role.js&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create User Model
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>User</span> <span class=o>=</span> <span class=nx>database</span><span class=p>.</span><span class=nx>define</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Model Name
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=s1>&#39;User&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Schema
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>UserSchema</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Other options
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>tableName</span><span class=o>:</span> <span class=s1>&#39;users&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=c1>// Create Role Model
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>Role</span> <span class=o>=</span> <span class=nx>database</span><span class=p>.</span><span class=nx>define</span><span class=p>(</span>
</span></span><span class="line hl"><span class=cl>    <span class=c1>// Model Name
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>    <span class=s1>&#39;Role&#39;</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>    <span class=c1>// Schema
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>    <span class=nx>RoleSchema</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>    <span class=c1>// Other options
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>        <span class=nx>tableName</span><span class=o>:</span> <span class=s1>&#39;roles&#39;</span>
</span></span><span class="line hl"><span class=cl>    <span class=p>}</span>
</span></span><span class="line hl"><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=c1>// Create UserRole Model
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>UserRole</span> <span class=o>=</span> <span class=nx>database</span><span class=p>.</span><span class=nx>define</span><span class=p>(</span>
</span></span><span class="line hl"><span class=cl>    <span class=c1>// Model Name
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>    <span class=s1>&#39;UserRole&#39;</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>    <span class=c1>// Schema
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>    <span class=nx>UserRoleSchema</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>    <span class=c1>// Other options
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>        <span class=nx>tableName</span><span class=o>:</span> <span class=s1>&#39;user_roles&#39;</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>        <span class=nx>timestamps</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>        <span class=nx>underscored</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class="line hl"><span class=cl>    <span class=p>}</span>
</span></span><span class="line hl"><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=c1>// Define Associations
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=nx>Role</span><span class=p>.</span><span class=nx>belongsToMany</span><span class=p>(</span><span class=nx>User</span><span class=p>,</span> <span class=p>{</span> <span class=nx>through</span><span class=o>:</span> <span class=nx>UserRole</span><span class=p>,</span> <span class=nx>unique</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>as</span><span class=o>:</span> <span class=s2>&#34;users&#34;</span> <span class=p>})</span>
</span></span><span class="line hl"><span class=cl><span class=nx>User</span><span class=p>.</span><span class=nx>belongsToMany</span><span class=p>(</span><span class=nx>Role</span><span class=p>,</span> <span class=p>{</span> <span class=nx>through</span><span class=o>:</span> <span class=nx>UserRole</span><span class=p>,</span> <span class=nx>unique</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>as</span><span class=o>:</span> <span class=s2>&#34;roles&#34;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>User</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>    <span class=nx>Role</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>    <span class=nx>UserRole</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Notice that this file contains two lines at the bottom to define the associations included as part of this table, so that <code>sequelize</code> will know how to handle it. This will instruct <code>sequelize</code> to add additional attributes and features to the <code>User</code> and <code>Role</code> models for querying the related data, as we&rsquo;ll see shortly.</p><p>We also added the line <code>timestamps: false</code> to the other options for the <code>User_roles</code> table to disable the creation and management of timestamps (the <code>createdAt</code> and <code>updatedAt</code> attributes), since they may not be needed for this relation.</p><p>Finally, we added the <code>underscored: true</code> line to tell <code>sequelize</code> that it should interpret the <code>userId</code> and <code>roleId</code> attributes (written in camel case as preferred by Sequelize) as <code>user_id</code> and <code>role_id</code>, respectively (written in snake case as we did in the migration).</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Camel Case vs. Snake Case</div><div class=box-content><p>The choice of either CamelCase or snake_case naming for database attributes is a matter of preference. In this example, we show both methods, and it is up to each developer to select their own preferred style.</p></div></div><h2 id=seed>Seed</h2><p>Finally, let&rsquo;s create a new seed file in <code>seeds/01_roles.js</code> to add some default data to the <code>roles</code> and <code>user_roles</code> tables:</p><div class=tab-panel data-tab-group=3129360163b02faef09695540eb5d661><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=seeds01_rolesjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("3129360163b02faef09695540eb5d661","seeds01_rolesjs")'>
<span class=tab-nav-text>seeds/01_roles.js</span></button></div><div class=tab-content-container><div data-tab-item=seeds01_rolesjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @file Roles seed
</span></span></span><span class=line><span class=cl><span class=cm> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span class=line><span class=cl><span class=cm> * @exports up the Up migration
</span></span></span><span class=line><span class=cl><span class=cm> * @exports down the Down migration
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Timestamp in the appropriate format for the database
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>now</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>().</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>23</span><span class=p>).</span><span class=nx>replace</span><span class=p>(</span><span class=s2>&#34;T&#34;</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34; +00:00&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Array of objects to add to the database
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>roles</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>id</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role</span><span class=o>:</span> <span class=s1>&#39;manage_users&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>createdAt</span><span class=o>:</span> <span class=nx>now</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>updatedAt</span><span class=o>:</span> <span class=nx>now</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>id</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role</span><span class=o>:</span> <span class=s1>&#39;manage_documents&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>createdAt</span><span class=o>:</span> <span class=nx>now</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>updatedAt</span><span class=o>:</span> <span class=nx>now</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>id</span><span class=o>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role</span><span class=o>:</span> <span class=s1>&#39;add_documents&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>createdAt</span><span class=o>:</span> <span class=nx>now</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>updatedAt</span><span class=o>:</span> <span class=nx>now</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>id</span><span class=o>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role</span><span class=o>:</span> <span class=s1>&#39;manage_communities&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>createdAt</span><span class=o>:</span> <span class=nx>now</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>updatedAt</span><span class=o>:</span> <span class=nx>now</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>id</span><span class=o>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role</span><span class=o>:</span> <span class=s1>&#39;add_communities&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>createdAt</span><span class=o>:</span> <span class=nx>now</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>updatedAt</span><span class=o>:</span> <span class=nx>now</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>id</span><span class=o>:</span> <span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role</span><span class=o>:</span> <span class=s1>&#39;view_documents&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>createdAt</span><span class=o>:</span> <span class=nx>now</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>updatedAt</span><span class=o>:</span> <span class=nx>now</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>id</span><span class=o>:</span> <span class=mi>7</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role</span><span class=o>:</span> <span class=s1>&#39;view_communities&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>createdAt</span><span class=o>:</span> <span class=nx>now</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>updatedAt</span><span class=o>:</span> <span class=nx>now</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>user_roles</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>user_id</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role_id</span><span class=o>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>user_id</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role_id</span><span class=o>:</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>user_id</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role_id</span><span class=o>:</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>user_id</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role_id</span><span class=o>:</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>user_id</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role_id</span><span class=o>:</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>user_id</span><span class=o>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role_id</span><span class=o>:</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>user_id</span><span class=o>:</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role_id</span><span class=o>:</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>user_id</span><span class=o>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role_id</span><span class=o>:</span> <span class=mi>6</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>user_id</span><span class=o>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>role_id</span><span class=o>:</span> <span class=mi>7</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Apply the migration
</span></span></span><span class=line><span class=cl><span class=cm> * 
</span></span></span><span class=line><span class=cl><span class=cm> * @param {queryInterface} context the database context to use 
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>up</span><span class=p>({</span><span class=nx>context</span><span class=o>:</span> <span class=nx>queryInterface</span><span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>queryInterface</span><span class=p>.</span><span class=nx>bulkInsert</span><span class=p>(</span><span class=s1>&#39;roles&#39;</span><span class=p>,</span> <span class=nx>roles</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>queryInterface</span><span class=p>.</span><span class=nx>bulkInsert</span><span class=p>(</span><span class=s1>&#39;user_roles&#39;</span><span class=p>,</span> <span class=nx>user_roles</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Roll back the migration
</span></span></span><span class=line><span class=cl><span class=cm> * 
</span></span></span><span class=line><span class=cl><span class=cm> * @param {queryInterface} context the database context to use 
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>down</span><span class=p>({</span><span class=nx>context</span><span class=o>:</span> <span class=nx>queryInterface</span><span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>queryInterface</span><span class=p>.</span><span class=nx>bulkDelete</span><span class=p>(</span><span class=s1>&#39;user_roles&#39;</span><span class=p>,</span> <span class=p>{}</span> <span class=p>,</span> <span class=p>{</span> <span class=nx>truncate</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>queryInterface</span><span class=p>.</span><span class=nx>bulkDelete</span><span class=p>(</span><span class=s2>&#34;roles&#34;</span><span class=p>,</span> <span class=p>{},</span> <span class=p>{</span> <span class=nx>truncate</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Once again, this seed is very similar to what we&rsquo;ve seen before. Notice that we use the <code>truncate</code> option to remove all entries in the <code>user_roles</code> table when we undo this seed as well as the <code>roles</code> table.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Seeding from a CSV File</div><div class=box-content><p>It is also possible to seed the database from a CSV or other data file using a bit of JavaScript code. Here&rsquo;s an example for seeding a table that contains all of the counties in Kansas using a CSV file with that data that is read with the <a href=https://www.npmjs.com/package/convert-csv-to-json rel=external target=_blank>convert-csv-to-json</a> library:</p><div class=tab-panel data-tab-group=a3fa47ab3677d054f8e96c5383d1f879><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=seeds02_countiesjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a3fa47ab3677d054f8e96c5383d1f879","seeds02_countiesjs")'>
<span class=tab-nav-text>seeds/02_counties.js</span></button></div><div class=tab-content-container><div data-tab-item=seeds02_countiesjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// Import libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>csvToJson</span> <span class=o>=</span> <span class=kr>import</span><span class=p>(</span><span class=s2>&#34;convert-csv-to-json&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Timestamp in the appropriate format for the database
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>now</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>().</span><span class=nx>toISOString</span><span class=p>().</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>23</span><span class=p>).</span><span class=nx>replace</span><span class=p>(</span><span class=s2>&#34;T&#34;</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34; +00:00&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>up</span><span class=p>({</span> <span class=nx>context</span><span class=o>:</span> <span class=nx>queryInterface</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Read data from CSV file
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// id,name,code,seat,population,est_year
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// 1,Allen,AL,Iola,&#34;12,464&#34;,1855
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>let</span> <span class=nx>counties</span> <span class=o>=</span> <span class=p>(</span><span class=kr>await</span> <span class=nx>csvToJson</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>formatValueByType</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>supportQuotedField</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>fieldDelimiter</span><span class=p>(</span><span class=s2>&#34;,&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>getJsonFromCsv</span><span class=p>(</span><span class=s2>&#34;./seeds/counties.csv&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// append timestamps and parse fields
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>counties</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>c</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// handle parsing numbers with comma separators
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>c</span><span class=p>.</span><span class=nx>population</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>population</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/,/g</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>createdAt</span> <span class=o>=</span> <span class=nx>now</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>.</span><span class=nx>updatedAt</span> <span class=o>=</span> <span class=nx>now</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// insert into database
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>await</span> <span class=nx>queryInterface</span><span class=p>.</span><span class=nx>bulkInsert</span><span class=p>(</span><span class=s2>&#34;counties&#34;</span><span class=p>,</span> <span class=nx>counties</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>down</span><span class=p>({</span> <span class=nx>context</span><span class=o>:</span> <span class=nx>queryInterface</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>queryInterface</span><span class=p>.</span><span class=nx>bulkDelete</span><span class=p>(</span><span class=s2>&#34;counties&#34;</span><span class=p>,</span> <span class=p>{},</span> <span class=p>{</span> <span class=nx>truncate</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div></div></div><h2 id=update-user-model>Update User Model</h2><p>Finally, let&rsquo;s update the <code>User</code> model schema to include related roles. At this point, we just have to update the Open API documentation to match:</p><div class=tab-panel data-tab-group=0a0e110b4c7c88b21ff1ef6c2abb7208><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=modelsuserjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0a0e110b4c7c88b21ff1ef6c2abb7208","modelsuserjs")'>
<span class=tab-nav-text>models/user.js</span></button></div><div class=tab-content-container><div data-tab-item=modelsuserjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @swagger
</span></span></span><span class=line><span class=cl><span class=cm> * components:
</span></span></span><span class=line><span class=cl><span class=cm> *   schemas:
</span></span></span><span class=line><span class=cl><span class=cm> *     User:
</span></span></span><span class=line><span class=cl><span class=cm> *       type: object
</span></span></span><span class=line><span class=cl><span class=cm> *       required:
</span></span></span><span class=line><span class=cl><span class=cm> *         - username
</span></span></span><span class=line><span class=cl><span class=cm> *       properties:
</span></span></span><span class=line><span class=cl><span class=cm> *         id:
</span></span></span><span class=line><span class=cl><span class=cm> *           type: integer
</span></span></span><span class=line><span class=cl><span class=cm> *           description: autogenerated id
</span></span></span><span class=line><span class=cl><span class=cm> *         username:
</span></span></span><span class=line><span class=cl><span class=cm> *           type: string
</span></span></span><span class=line><span class=cl><span class=cm> *           description: username for the user
</span></span></span><span class=line><span class=cl><span class=cm> *         createdAt:
</span></span></span><span class=line><span class=cl><span class=cm> *           type: string
</span></span></span><span class=line><span class=cl><span class=cm> *           format: date-time
</span></span></span><span class=line><span class=cl><span class=cm> *           description: when the user was created
</span></span></span><span class=line><span class=cl><span class=cm> *         updatedAt:
</span></span></span><span class=line><span class=cl><span class=cm> *           type: string
</span></span></span><span class=line><span class=cl><span class=cm> *           format: date-time
</span></span></span><span class=line><span class=cl><span class=cm> *           description: when the user was last updated
</span></span></span><span class="line hl"><span class=cl><span class=cm> *         roles:
</span></span></span><span class="line hl"><span class=cl><span class=cm> *           type: array
</span></span></span><span class="line hl"><span class=cl><span class=cm> *           items:
</span></span></span><span class="line hl"><span class=cl><span class=cm> *             $ref: &#39;#/components/schemas/Role&#39;
</span></span></span><span class=line><span class=cl><span class=cm> *       example:
</span></span></span><span class=line><span class=cl><span class=cm> *           id: 1
</span></span></span><span class=line><span class=cl><span class=cm> *           username: admin
</span></span></span><span class=line><span class=cl><span class=cm> *           createdAt: 2025-02-04T15:36:32.000Z
</span></span></span><span class=line><span class=cl><span class=cm> *           updatedAt: 2025-02-04T15:36:32.000Z
</span></span></span><span class="line hl"><span class=cl><span class=cm> *           roles:
</span></span></span><span class="line hl"><span class=cl><span class=cm> *             - id: 1
</span></span></span><span class="line hl"><span class=cl><span class=cm> *               role: manage_users
</span></span></span><span class="line hl"><span class=cl><span class=cm> *             - id: 2
</span></span></span><span class="line hl"><span class=cl><span class=cm> *               role: manage_documents
</span></span></span><span class="line hl"><span class=cl><span class=cm> *             - id: 4
</span></span></span><span class="line hl"><span class=cl><span class=cm> *               role: manage_communities
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>Now we can modify our route in <code>routes/users.js</code> to include the data from the related <code>Role</code> model in our query:</p><div class=tab-panel data-tab-group=b006ecce51fa36786fbb3fc1e623d42f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=routesusersjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("b006ecce51fa36786fbb3fc1e623d42f","routesusersjs")'>
<span class=tab-nav-text>routes/users.js</span></button></div><div class=tab-content-container><div data-tab-item=routesusersjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @file Users router
</span></span></span><span class=line><span class=cl><span class=cm> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span class=line><span class=cl><span class=cm> * @exports router an Express router
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @swagger
</span></span></span><span class=line><span class=cl><span class=cm> * tags:
</span></span></span><span class=line><span class=cl><span class=cm> *   name: users
</span></span></span><span class=line><span class=cl><span class=cm> *   description: Users Routes
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>express</span> <span class=nx>from</span> <span class=s2>&#34;express&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create Express router
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>express</span><span class=p>.</span><span class=nx>Router</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import models
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>User</span><span class=p>,</span> <span class=nx>Role</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;../models/models.js&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Gets the list of users
</span></span></span><span class=line><span class=cl><span class=cm> * 
</span></span></span><span class=line><span class=cl><span class=cm> * @param {Object} req - Express request object
</span></span></span><span class=line><span class=cl><span class=cm> * @param {Object} res - Express response object
</span></span></span><span class=line><span class=cl><span class=cm> * @param {Function} next - Express next middleware function
</span></span></span><span class=line><span class=cl><span class=cm> * 
</span></span></span><span class=line><span class=cl><span class=cm> * @swagger
</span></span></span><span class=line><span class=cl><span class=cm> * /users:
</span></span></span><span class=line><span class=cl><span class=cm> *   get: 
</span></span></span><span class=line><span class=cl><span class=cm> *     summary: users list page
</span></span></span><span class=line><span class=cl><span class=cm> *     description: Gets the list of all users in the application
</span></span></span><span class=line><span class=cl><span class=cm> *     tags: [users]
</span></span></span><span class=line><span class=cl><span class=cm> *     responses:
</span></span></span><span class=line><span class=cl><span class=cm> *       200:
</span></span></span><span class=line><span class=cl><span class=cm> *         description: the list of users
</span></span></span><span class=line><span class=cl><span class=cm> *         content:
</span></span></span><span class=line><span class=cl><span class=cm> *           application/json:
</span></span></span><span class=line><span class=cl><span class=cm> *             schema:
</span></span></span><span class=line><span class=cl><span class=cm> *               type: array
</span></span></span><span class=line><span class=cl><span class=cm> *               items:
</span></span></span><span class=line><span class=cl><span class=cm> *                 $ref: &#39;#/components/schemas/User&#39;          
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>,</span> <span class=kr>async</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>  <span class=kr>const</span> <span class=nx>users</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>User</span><span class=p>.</span><span class=nx>findAll</span><span class=p>({</span>
</span></span><span class="line hl"><span class=cl>    <span class=nx>include</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>      <span class=nx>model</span><span class=o>:</span> <span class=nx>Role</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>      <span class=nx>as</span><span class=o>:</span> <span class=s2>&#34;roles&#34;</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>      <span class=nx>attributes</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>,</span> <span class=s1>&#39;role&#39;</span><span class=p>],</span>
</span></span><span class="line hl"><span class=cl>      <span class=nx>through</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>        <span class=nx>attributes</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class="line hl"><span class=cl>      <span class=p>},</span>
</span></span><span class="line hl"><span class=cl>    <span class=p>},</span>
</span></span><span class="line hl"><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span><span class=nx>users</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>router</span><span class=p>;</span></span></span></code></pre></div></div></div></div></div><p>You can learn more about querying associations in the <a href=https://sequelize.org/docs/v6/core-concepts/assocs/#basics-of-queries-involving-associations rel=external target=_blank>Sequelize Documentation</a>.</p><p>If everything works, we should see our roles now included in our JSON output when we navigate to the <code>/users</code> route:</p><div class=tab-panel data-tab-group=b42deffdac50c13474de806f87feecea><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=route-users class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("b42deffdac50c13474de806f87feecea","route-users")'>
<span class=tab-nav-text>route: /users</span></button></div><div class=tab-content-container><div data-tab-item=route-users class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>[
  {
    &#34;id&#34;: 1,
    &#34;username&#34;: &#34;admin&#34;,
    &#34;createdAt&#34;: &#34;2025-01-28T23:06:01.000Z&#34;,
    &#34;updatedAt&#34;: &#34;2025-01-28T23:06:01.000Z&#34;,
    &#34;roles&#34;: [
      {
        &#34;id&#34;: 1,
        &#34;role&#34;: &#34;manage_users&#34;
      },
      {
        &#34;id&#34;: 2,
        &#34;role&#34;: &#34;manage_documents&#34;
      },
      {
        &#34;id&#34;: 4,
        &#34;role&#34;: &#34;manage_communities&#34;
      }
    ]
  },
  {
    &#34;id&#34;: 2,
    &#34;username&#34;: &#34;contributor&#34;,
    &#34;createdAt&#34;: &#34;2025-01-28T23:06:01.000Z&#34;,
    &#34;updatedAt&#34;: &#34;2025-01-28T23:06:01.000Z&#34;,
    &#34;roles&#34;: [
      {
        &#34;id&#34;: 3,
        &#34;role&#34;: &#34;add_documents&#34;
      },
      {
        &#34;id&#34;: 5,
        &#34;role&#34;: &#34;add_communities&#34;
      }
    ]
  },
  {
    &#34;id&#34;: 3,
    &#34;username&#34;: &#34;manager&#34;,
    &#34;createdAt&#34;: &#34;2025-01-28T23:06:01.000Z&#34;,
    &#34;updatedAt&#34;: &#34;2025-01-28T23:06:01.000Z&#34;,
    &#34;roles&#34;: [
      {
        &#34;id&#34;: 2,
        &#34;role&#34;: &#34;manage_documents&#34;
      },
      {
        &#34;id&#34;: 4,
        &#34;role&#34;: &#34;manage_communities&#34;
      }
    ]
  },
  {
    &#34;id&#34;: 4,
    &#34;username&#34;: &#34;user&#34;,
    &#34;createdAt&#34;: &#34;2025-01-28T23:06:01.000Z&#34;,
    &#34;updatedAt&#34;: &#34;2025-01-28T23:06:01.000Z&#34;,
    &#34;roles&#34;: [
      {
        &#34;id&#34;: 6,
        &#34;role&#34;: &#34;view_documents&#34;
      },
      {
        &#34;id&#34;: 7,
        &#34;role&#34;: &#34;view_communities&#34;
      }
    ]
  }
]</code></pre></div></div></div></div></div><p>That should also exactly match the schema and route information in our Open API documentation provided at the <code>/docs</code> route.</p><p>There we go! That&rsquo;s a quick example of adding an additional table to our application, including a relationship and more.</p><p>As a last step before finalizing our code, we should run the <code>lint</code> and <code>format</code> commands and deal with any errors they find. Finally, we can <strong>commit and push</strong> our work.</p><footer class=footline></footer></article></div></main></div></div><script src=/cis526/js/clipboard.min.js?1744393801 defer></script><script src=/cis526/js/perfect-scrollbar.min.js?1744393801 defer></script><script src=/cis526/js/theme.js?1744393801 defer></script><script src=/cis526/js/tele-scroll.js?1744393801 defer></script></body></html>