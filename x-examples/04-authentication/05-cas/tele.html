<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.148.1"><meta name=generator content="Relearn 8.0.0"><meta name=description content="YouTube Video CAS Authentication We’ve already studied Central Authentication Service (CAS) as one method for authenticating users through a third party service. In this case, CAS is the service commonly used at K-State for authentication, which is why we like to cover it in our examples. So, let’s look at how to add CAS authentication to our application through Passport.
Installing a Passport Strategy First, we’ll need to install a new Passport.js strategy for dealing with CAS authentication. Thankfully, the ALT+CS lab at K-State maintains an updated library for this, which can be installed as shown below:"><meta name=author content="Nathan Bean & Russell Feldhausen"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta name=twitter:title content="CAS Authentication :: CIS 526 Textbook"><meta name=twitter:description content="YouTube Video CAS Authentication We’ve already studied Central Authentication Service (CAS) as one method for authenticating users through a third party service. In this case, CAS is the service commonly used at K-State for authentication, which is why we like to cover it in our examples. So, let’s look at how to add CAS authentication to our application through Passport.
Installing a Passport Strategy First, we’ll need to install a new Passport.js strategy for dealing with CAS authentication. Thankfully, the ALT+CS lab at K-State maintains an updated library for this, which can be installed as shown below:"><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/x-examples/04-authentication/05-cas/index.html"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="CAS Authentication :: CIS 526 Textbook"><meta property="og:description" content="YouTube Video CAS Authentication We’ve already studied Central Authentication Service (CAS) as one method for authenticating users through a third party service. In this case, CAS is the service commonly used at K-State for authentication, which is why we like to cover it in our examples. So, let’s look at how to add CAS authentication to our application through Passport.
Installing a Passport Strategy First, we’ll need to install a new Passport.js strategy for dealing with CAS authentication. Thankfully, the ALT+CS lab at K-State maintains an updated library for this, which can be installed as shown below:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="Example Projects"><meta property="article:modified_time" content="2025-04-07T13:45:28-05:00"><meta property="og:image" content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta itemprop=name content="CAS Authentication :: CIS 526 Textbook"><meta itemprop=description content="YouTube Video CAS Authentication We’ve already studied Central Authentication Service (CAS) as one method for authenticating users through a third party service. In this case, CAS is the service commonly used at K-State for authentication, which is why we like to cover it in our examples. So, let’s look at how to add CAS authentication to our application through Passport.
Installing a Passport Strategy First, we’ll need to install a new Passport.js strategy for dealing with CAS authentication. Thankfully, the ALT+CS lab at K-State maintains an updated library for this, which can be installed as shown below:"><meta itemprop=dateModified content="2025-04-07T13:45:28-05:00"><meta itemprop=wordCount content="887"><meta itemprop=image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><title>CAS Authentication :: CIS 526 Textbook</title><link href=https://textbooks.cs.ksu.edu/cis526/x-examples/04-authentication/05-cas/index.html rel=canonical type=text/html title="CAS Authentication :: CIS 526 Textbook"><link href=/cis526/x-examples/04-authentication/05-cas/index.xml rel=alternate type=application/rss+xml title="CAS Authentication :: CIS 526 Textbook"><link href=/cis526/x-examples/04-authentication/05-cas/index.print.html rel=alternate type=text/html title="CAS Authentication :: CIS 526 Textbook"><link href=/cis526/x-examples/04-authentication/05-cas/embed.html rel=alternate type=text/html title="CAS Authentication :: CIS 526 Textbook"><link href=/cis526/css/auto-complete/auto-complete.min.css?1769640562 rel=stylesheet><script src=/cis526/js/auto-complete/auto-complete.min.js?1769640562 defer></script><script src=/cis526/js/search-lunr.min.js?1769640562 defer></script><script src=/cis526/js/search.min.js?1769640562 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/cis526/searchindex.en.js?1769640562"</script><script src=/cis526/js/lunr/lunr.min.js?1769640562 defer></script><script src=/cis526/js/lunr/lunr.stemmer.support.min.js?1769640562 defer></script><script src=/cis526/js/lunr/lunr.multi.min.js?1769640562 defer></script><script src=/cis526/js/lunr/lunr.en.min.js?1769640562 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1769640562 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1769640562 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar/perfect-scrollbar.min.css?1769640562 rel=stylesheet><link href=/cis526/css/theme.min.css?1769640562 rel=stylesheet><link href=/cis526/css/format-html.min.css?1769640562 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/x-examples/04-authentication/05-cas/index.html",window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!1,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["light-theme"],window.relearn.customvariantname="my-custom-variant",window.relearn.writeVariant=!1,window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.writeVariant&&window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><link href=/cis526/css/custom.css?1769640562 rel=stylesheet></head><body class="mobile-support html" data-url=/cis526/x-examples/04-authentication/05-cas/index.html><div id=tele class="tele mirror"><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable x-examples" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=cas-authentication>CAS Authentication</h1><a href="https://www.youtube.com/watch?v=fnsW2-iKliE">YouTube Video</a><h2 id=cas-authentication>CAS Authentication</h2><p>We&rsquo;ve already studied <a href=https://apereo.github.io/cas/7.1.x/index.html rel=external target=_blank>Central Authentication Service (CAS)</a> as one method for authenticating users through a third party service. In this case, CAS is the service commonly used at K-State for authentication, which is why we like to cover it in our examples. So, let&rsquo;s look at how to add CAS authentication to our application through Passport.</p><h2 id=installing-a-passport-strategy>Installing a Passport Strategy</h2><p>First, we&rsquo;ll need to install a new Passport.js strategy for dealing with CAS authentication. Thankfully, the ALT+CS lab at K-State maintains an updated library for this, which can be installed as shown below:</p><div class=tab-panel data-tab-group=f2a41a033ba977f3180f91b28bbdfa5c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f2a41a033ba977f3180f91b28bbdfa5c","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm install https://github.com/alt-cs-lab/passport-cas</span></span></code></pre></div></div></div></div></div><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Finding a Good Strategy</summary><div class=box-content><p>Unfortunately, it is very difficult to find an updated Passport.js strategy for CAS authentication. This is partially due to the fact the CAS is not commonly used, and partially because many existing strategies have been written once and then abandoned by the developers. For this class, we sought out the most updated strategy available, then did our best to fix any known/existing bugs.</p></div></details><h2 id=configuring-cas-strategy>Configuring CAS Strategy</h2><p>Next, we can configure our authentication strategy by adding a few items to the <code>configs/auth.js</code> file for our new CAS strategy:</p><div class=tab-panel data-tab-group=b8a8ae256f5337acc04736da308967c0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configsauthjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("b8a8ae256f5337acc04736da308967c0","configsauthjs")'>
<span class=tab-nav-text>configs/auth.js</span></button></div><div class=tab-content-container><div data-tab-item=configsauthjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>passport</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;passport&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>UniqueTokenStrategy</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;passport-unique-token&#34;</span>;
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Strategy</span> <span style=color:#a6e22e>as</span> <span style=color:#a6e22e>CasStrategy</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@alt-cs-lab/passport-cas&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// CAS authentication
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>passport</span>.<span style=color:#a6e22e>use</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CasStrategy</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>version</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;CAS2.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ssoBaseURL</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>CAS_URL</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>serverBaseURL</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>CAS_SERVICE_URL</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;/auth/cas&#39;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>profile</span>, <span style=color:#a6e22e>next</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>profile</span>.<span style=color:#a6e22e>user</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>authenticateUser</span>(<span style=color:#a6e22e>profile</span>.<span style=color:#a6e22e>user</span>, <span style=color:#a6e22e>next</span>)
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>warn</span>(<span style=color:#e6db74>&#34;CAS authentication succeeded but no user returned: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>profile</span>));
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>next</span>(<span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>In this file, we are importing our new CAS authentication strategy, then using <code>passport.use</code> to tell Passport.js to use this authentication strategy when requested. Inside, we set up the various settings for our strategy, as well as the callback function when a user successfully authenticates. In this case, the CAS server will give us a <code>profile</code> object that should contain the <code>user</code> attribute with the user&rsquo;s username, which we can send to our <code>authenticateUser</code> method we&rsquo;ve already created. Finally, we also include a short catch to log any errors where the user is able to log in but a username is not provided.</p><p>In our <code>.env</code> file, we&rsquo;ll need to add two more settings. The <code>CAS_URL</code> is the base URL for the CAS server itself, and the <code>CAS_SERVICE_URL</code> is the URL that users should be sent back to, along with a ticket, to complete the log in process. Since we are working in GitHub Codespaces, our <code>CAS_SERVICE_URL</code> will be the same as our <code>OPENAPI_HOST</code>.</p><div class=tab-panel data-tab-group=a5401afbca2e098f3b667714bccbb706><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=env class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a5401afbca2e098f3b667714bccbb706","env")'>
<span class=tab-nav-text>.env</span></button></div><div class=tab-content-container><div data-tab-item=env class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-env data-lang=env><span style=display:flex><span><span style=color:#75715e># -=-=- other settings omitted here -=-=-</span>
</span></span><span style=display:flex><span>CAS_URL<span style=color:#f92672>=</span>https://testcas.cs.ksu.edu
</span></span><span style=display:flex><span>CAS_SERVICE_URL<span style=color:#f92672>=</span>https://$CODESPACE_NAME-$PORT.$GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN</span></span></code></pre></div></div></div></div></div><p>Notice that we already add the <code>/auth/cas</code> route to the end of the <code>CAS_SERVICE_URL</code> in the configuration above - since that path won&rsquo;t change, it makes sense to just include it there instead of having to remember to add it to the path in the <code>.env</code> file. We should also put sensible defaults in our <code>.env.example</code> and <code>.env.test</code> files as well.</p><p>Now, to use this authentication method, all we have to do is update our <code>/auth/cas</code> route in <code>routes/auth.js</code> to use this strategy:</p><div class=tab-panel data-tab-group=24afdb5cd8968ebfbbb143c79a28a9a5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=routesauthjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("24afdb5cd8968ebfbbb143c79a28a9a5","routesauthjs")'>
<span class=tab-nav-text>routes/auth.js</span></button></div><div class=tab-content-container><div data-tab-item=routesauthjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * CAS Authentication
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {Object} req - Express request object
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {Object} res - Express response object
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @param {Function} next - Express next middleware function
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @swagger
</span></span></span><span style=display:flex><span><span style=color:#75715e> * /auth/cas:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *   get:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     summary: CAS authentication
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     description:  CAS authentication for deployment
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     tags: [auth]
</span></span></span><span style=display:flex><span><span style=color:#75715e> *     responses:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *       200:
</span></span></span><span style=display:flex><span><span style=color:#75715e> *         description: success
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;/cas&#34;</span>, <span style=color:#a6e22e>passport</span>.<span style=color:#a6e22e>authenticate</span>(<span style=color:#e6db74>&#39;cas&#39;</span>), <span style=color:#a6e22e>authSuccess</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>With that in place, we can start our application and test it by navigating to the <code>/auth/cas</code> route to see if our login attempt works:</p><div class=tab-panel data-tab-group=2ca45bdf3398dddafa5d370006177c40><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2ca45bdf3398dddafa5d370006177c40","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm run dev</span></span></code></pre></div></div></div></div></div><p>If everything works correctly, we should be directed to our CAS server to authenticate, then we&rsquo;ll be sent back to our own server with a ticket to validate our authentication. Finally, once the ticket is validated, we&rsquo;ll be redirected back to our home page with a session cookie set:</p><p><a href=#R-image-451053e91abb11046ab180654bea8cb5 class=lightbox-link><img alt="CAS Login with Cookie Set" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/04/auth_9.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-451053e91abb11046ab180654bea8cb5><img alt="CAS Login with Cookie Set" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/04/auth_9.png></a></p><h2 id=cas-logout>CAS Logout</h2><p>Finally, we&rsquo;ll need to add a bit more logic to our logout process to properly log users out of both our application and the CAS server they originally logged in through. So, let&rsquo;s update our <code>/auth/logout</code> route to include that:</p><div class=tab-panel data-tab-group=d4fae7247d049ec28c6a315e6aa843f0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=routesauthjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d4fae7247d049ec28c6a315e6aa843f0","routesauthjs")'>
<span class=tab-nav-text>routes/auth.js</span></button></div><div class=tab-content-container><div data-tab-item=routesauthjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/logout&#39;</span>, <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>res</span>, <span style=color:#a6e22e>next</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>clearCookie</span>(<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>SESSION_NAME</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;connect.sid&#39;</span>);  <span style=color:#75715e>// clear the session cookie
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>logout</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>err</span>) {       <span style=color:#75715e>// logout of passport
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#a6e22e>err</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>session</span>.<span style=color:#a6e22e>destroy</span>(<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>err</span>) {  <span style=color:#75715e>// destroy the session
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>error</span>(<span style=color:#a6e22e>err</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>redirectURL</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>CAS_URL</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/logout?service=&#34;</span> <span style=color:#f92672>+</span> encodeURIComponent(<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>CAS_SERVICE_URL</span>)
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>redirect</span>(<span style=color:#a6e22e>redirectURL</span>);
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>Most CAS servers will automatically redirect the user back to the <code>service</code> request parameter, but not all of them. However, this will ensure that the CAS server knows the user has logged out and will invalidate any tickets for that user.</p><details open class="box cstyle notices note"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-exclamation-circle"></i>
Test CAS Server Updated</summary><div class=box-content><p>The test CAS server was updated recently to properly redirect users back to the <code>service</code> request parameter, so you will probably no longer see the Logout page from that server in your testing. This should make developing and testing with that server a bit more straightforward</p></div></details><footer class=footline></footer></article></div></main></div><script src=/cis526/js/clipboard/clipboard.min.js?1769640562 defer></script><script src=/cis526/js/perfect-scrollbar/perfect-scrollbar.min.js?1769640562 defer></script><script src=/cis526/js/theme.min.js?1769640562 defer></script></div><script src=/cis526/js/tele-scroll.min.js?1769640562 defer></script></body></html>