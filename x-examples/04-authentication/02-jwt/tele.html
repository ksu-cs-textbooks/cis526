<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="YouTube Video JSON Web Tokens (JWT) Now that we have a working authentication system, the next step is to configure our authentication response to include a valid JSON Web Token, or JWT, that contains information about the authenticated user. We’ve already learned a bit about JWTs in this course, so we won’t cover too many of the details here.
To work with JWTs, we’ll need to install the jsonwebtoken package from NPM:"><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="JSON Web Token :: CIS 526 Textbook"><meta name=twitter:description content="YouTube Video JSON Web Tokens (JWT) Now that we have a working authentication system, the next step is to configure our authentication response to include a valid JSON Web Token, or JWT, that contains information about the authenticated user. We’ve already learned a bit about JWTs in this course, so we won’t cover too many of the details here.
To work with JWTs, we’ll need to install the jsonwebtoken package from NPM:"><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/x-examples/04-authentication/02-jwt/"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="JSON Web Token :: CIS 526 Textbook"><meta property="og:description" content="YouTube Video JSON Web Tokens (JWT) Now that we have a working authentication system, the next step is to configure our authentication response to include a valid JSON Web Token, or JWT, that contains information about the authenticated user. We’ve already learned a bit about JWTs in this course, so we won’t cover too many of the details here.
To work with JWTs, we’ll need to install the jsonwebtoken package from NPM:"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Example Projects"><meta property="article:modified_time" content="2025-03-04T21:42:32-06:00"><meta itemprop=name content="JSON Web Token :: CIS 526 Textbook"><meta itemprop=description content="YouTube Video JSON Web Tokens (JWT) Now that we have a working authentication system, the next step is to configure our authentication response to include a valid JSON Web Token, or JWT, that contains information about the authenticated user. We’ve already learned a bit about JWTs in this course, so we won’t cover too many of the details here.
To work with JWTs, we’ll need to install the jsonwebtoken package from NPM:"><meta itemprop=dateModified content="2025-03-04T21:42:32-06:00"><meta itemprop=wordCount content="672"><title>JSON Web Token :: CIS 526 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis526/x-examples/04-authentication/02-jwt/ rel=canonical type=text/html title="JSON Web Token :: CIS 526 Textbook"><link href=/cis526/x-examples/04-authentication/02-jwt/index.xml rel=alternate type=application/rss+xml title="JSON Web Token :: CIS 526 Textbook"><link href=/cis526/x-examples/04-authentication/02-jwt/index.print.html rel=alternate type=text/html title="JSON Web Token :: CIS 526 Textbook"><link href=/cis526/x-examples/04-authentication/02-jwt/embed.html rel=alternate type=text/html title="JSON Web Token :: CIS 526 Textbook"><link href=/cis526/css/fontawesome-all.min.css?1741297800 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fontawesome-all.min.css?1741297800 rel=stylesheet></noscript><link href=/cis526/css/nucleus.css?1741297800 rel=stylesheet><link href=/cis526/css/auto-complete.css?1741297800 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/auto-complete.css?1741297800 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar.min.css?1741297800 rel=stylesheet><link href=/cis526/css/fonts.css?1741297800 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fonts.css?1741297800 rel=stylesheet></noscript><link href=/cis526/css/theme.css?1741297800 rel=stylesheet><link href=/cis526/css/theme-auto.css?1741297800 rel=stylesheet id=R-variant-style><link href=/cis526/css/chroma-auto.css?1741297800 rel=stylesheet id=R-variant-chroma-style><link href=/cis526/css/variant.css?1741297800 rel=stylesheet><link href=/cis526/css/print.css?1741297800 rel=stylesheet media=print><script src=/cis526/js/variant.js?1741297800></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.index_js_url="/cis526/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis526/css/custom.css?1741297800 rel=stylesheet></head><body class="mobile-support tele disableInlineCopyToClipboard" data-url=/cis526/x-examples/04-authentication/02-jwt/><div id=tele class="tele mirror"><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=json-web-token>JSON Web Token</h1><a href="https://www.youtube.com/watch?v=id">YouTube Video</a><h2 id=json-web-tokens-jwt>JSON Web Tokens (JWT)</h2><p>Now that we have a working authentication system, the next step is to configure our authentication response to include a valid JSON Web Token, or JWT, that contains information about the authenticated user. We&rsquo;ve already learned a bit about JWTs in this course, so we won&rsquo;t cover too many of the details here.</p><p>To work with JWTs, we&rsquo;ll need to install the <a href=https://www.npmjs.com/package/jsonwebtoken rel=external target=_blank>jsonwebtoken</a> package from NPM:</p><div class=tab-panel data-tab-group=e87275f38b5b0dcfa55c90e939de43e7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e87275f38b5b0dcfa55c90e939de43e7","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm install jsonwebtoken</span></span></code></pre></div></div></div></div></div><p>Next, we&rsquo;ll need to create a secret key that we can use to sign our tokens. We&rsquo;ll add this as the <code>JWT_SECRET_KEY</code> setting in our <code>.env</code>, <code>.env.test</code> and <code>.env.example</code> files.</p><p>There are many ways to generate a secret key, but one of the simplest is to just use the built in functions in Node.js itself. We can launch the Node.js <a href=https://nodejs.org/en/learn/command-line/how-to-use-the-nodejs-repl rel=external target=_blank>REPL</a> environment by just running the <code>node</code> command in the terminal:</p><div class=tab-panel data-tab-group=443bb921e914c80e3f7d5befc6908cb7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("443bb921e914c80e3f7d5befc6908cb7","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ node</span></span></code></pre></div></div></div></div></div><p>From there, we can use this line to get a random secret key:</p><div class=tab-panel data-tab-group=4e810b79cefb06e46baf07f94de27202><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=node class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4e810b79cefb06e46baf07f94de27202","node")'>
<span class=tab-nav-text>node</span></button></div><div class=tab-content-container><div data-tab-item=node class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>&gt;</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;crypto&#39;</span><span class=p>).</span><span class=nx>randomBytes</span><span class=p>(</span><span class=mi>64</span><span class=p>).</span><span class=nx>toString</span><span class=p>(</span><span class=s1>&#39;hex&#39;</span><span class=p>)</span></span></span></code></pre></div></div></div></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Documenting Terminal Commands</div><div class=box-content><p>Just like we use <code>$</code> as the prompt for Linux terminal commands, the Node.js REPL environment uses <code>></code> so we will include that in our documentation. You should not include that character in your command.</p></div></div><p>If done correctly, we&rsquo;ll get a random string that you can use as your secret key!</p><p><a href=#R-image-0874b2cc224899a99313dfab927a3162 class=lightbox-link><img alt="Disabled Authentication" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/04/auth_3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0874b2cc224899a99313dfab927a3162><img alt="Disabled Authentication" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/04/auth_3.png></a></p><p>We can include that key in our <code>.env</code> file. To help remember how to do this in the future, we can even include the Node.js command as a comment above that line:</p><div class=tab-panel data-tab-group=53377a1250814d5aa41036ccde28c72f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=env class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("53377a1250814d5aa41036ccde28c72f","env")'>
<span class=tab-nav-text>.env</span></button></div><div class=tab-content-container><div data-tab-item=env class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=c1># -=-=- other settings omitted here -=-=-</span>
</span></span><span class=line><span class=cl><span class=c1># require(&#39;crypto&#39;).randomBytes(64).toString(&#39;hex&#39;)</span>
</span></span><span class=line><span class=cl><span class=nv>JWT_SECRET_KEY</span><span class=o>=</span><span class=s1>&#39;46a5fdfe16fa710867102d1f0dbd2329f2eae69be3ed56ca084d9e0ad....&#39;</span></span></span></code></pre></div></div></div></div></div><p>Once we have the library and a key, we can easily sign our JWT by updating the content of our <code>sendSuccess</code> method in the <code>routes/auth.js</code> file:</p><div class=tab-panel data-tab-group=823d1f348adb09666f5151a662edfbe8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=routesauthjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("823d1f348adb09666f5151a662edfbe8","routesauthjs")'>
<span class=tab-nav-text>routes/auth.js</span></button></div><div class=tab-content-container><div data-tab-item=routesauthjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Import libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>express</span> <span class=nx>from</span> <span class=s2>&#34;express&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>passport</span> <span class=nx>from</span> <span class=s2>&#34;passport&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>jsonwebtoken</span> <span class=nx>from</span> <span class=s2>&#34;jsonwebtoken&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>authSuccess</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>token</span> <span class=o>=</span> <span class=nx>jsonwebtoken</span><span class=p>.</span><span class=nx>sign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Hack to convert Sequelize object to plain JavaScript object
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>JWT_SECRET_KEY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>expiresIn</span><span class=o>:</span> <span class=s1>&#39;6h&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>token</span><span class=o>:</span> <span class=nx>token</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></div></div></div></div></div><p>Now, when we visit the <code>/auth/bypass?token=admin</code> URL on our working website, we should receive a JWT as a response:</p><p><a href=#R-image-45555115a5eb4b8630ad448c4d7c74ab class=lightbox-link><img alt="JWT Response" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/04/auth_4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-45555115a5eb4b8630ad448c4d7c74ab><img alt="JWT Response" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/04/auth_4.png></a></p><p>Of course, while that data may seem unreadable, we already know that JWTs are Base64 encoded, so we can easily view the content of the token. Thankfully, there are many great tools we can use to debug our tokens, such as <a href=https://token.dev/ rel=external target=_blank>Token.dev</a>, to confirm that they are working correctly.</p><p><a href=#R-image-ea1bd5c6ab842fee65af2d645d808ef6 class=lightbox-link><img alt="JWT Debugger" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/04/auth_5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ea1bd5c6ab842fee65af2d645d808ef6><img alt="JWT Debugger" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/04/auth_5.png></a></p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Do Not Share Live Keys!</div><div class=box-content><p>While sites like this will also help you confirm that your JWTs are properly signed by asking for your secret key, you <strong>SHOULD NOT</strong> share a secret key for a live production application with these sites. There is always a chance it has been compromised!</p></div></div><h2 id=sending-jwt-in-a-cookie>Sending JWT in a Cookie</h2><p>To fully implement our authentication strategy, we want to send this JWT as both a cookie for the user to provide with future web requests, and also as an authorization header to API requests. So, let&rsquo;s modify our <code>authSuccess</code> method to send that JWT as a cookie, then redirect the user back to the index page:</p><div class=tab-panel data-tab-group=a672893e70ade6a87c029cb041eef022><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=routesauthjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a672893e70ade6a87c029cb041eef022","routesauthjs")'>
<span class=tab-nav-text>routes/auth.js</span></button></div><div class=tab-content-container><div data-tab-item=routesauthjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>authSuccess</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>token</span> <span class=o>=</span> <span class=nx>jsonwebtoken</span><span class=p>.</span><span class=nx>sign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Hack to convert Sequelize object to plain JavaScript object
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>user</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>JWT_SECRET_KEY</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>expiresIn</span><span class=o>:</span> <span class=s1>&#39;6h&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>// send JWt as cookie
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>res</span><span class=p>.</span><span class=nx>cookie</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;jwt&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>token</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>httpOnly</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>sameSite</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>secure</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>redirect</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></div></div></div></div></div><p>Now, when we navigate to our <code>/auth/bypass?token=admin</code> URL, we should immediately be redirected back to our index page if everything is working correctly. However, this time it should also set a <code>jwt</code> cookie, which we can see in the developer tools of our web browser:</p><p><a href=#R-image-a908de2ddf5f7eff3e9639fca44126b1 class=lightbox-link><img alt="JWT Debugger" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/04/auth_6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a908de2ddf5f7eff3e9639fca44126b1><img alt="JWT Debugger" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/04/auth_6.png></a></p><h2 id=exchanging-a-cookie-for-a-jwt>Exchanging a Cookie for a JWT</h2><p>There we go! Now we have a working JSON Web Token in our application! Next, we&rsquo;ll discuss how to use that in an overall authentication strategy.</p><footer class=footline></footer></article></div></main></div></div><script src=/cis526/js/clipboard.min.js?1741297800 defer></script><script src=/cis526/js/perfect-scrollbar.min.js?1741297800 defer></script><script src=/cis526/js/theme.js?1741297800 defer></script><script src=/cis526/js/tele-scroll.js?1741297800 defer></script></body></html>