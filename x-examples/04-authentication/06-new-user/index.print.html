<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="YouTube Video Handling New Users What if a user logs in to our application through CAS, but we donâ€™t have them in our database of users? Do we want to deny them access to the application? Or should we somehow gracefully add them to the list of users and give them some basic access to our application?
Since we are building a website meant to be open to a number of users, letâ€™s go ahead and implement a strategy where a new user can be created in the event that a user logs on through one of our authentication strategies but isnâ€™t found in the database."><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="New Users :: CIS 526 Textbook"><meta name=twitter:description content="YouTube Video Handling New Users What if a user logs in to our application through CAS, but we donâ€™t have them in our database of users? Do we want to deny them access to the application? Or should we somehow gracefully add them to the list of users and give them some basic access to our application?
Since we are building a website meant to be open to a number of users, letâ€™s go ahead and implement a strategy where a new user can be created in the event that a user logs on through one of our authentication strategies but isnâ€™t found in the database."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/x-examples/04-authentication/06-new-user/"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="New Users :: CIS 526 Textbook"><meta property="og:description" content="YouTube Video Handling New Users What if a user logs in to our application through CAS, but we donâ€™t have them in our database of users? Do we want to deny them access to the application? Or should we somehow gracefully add them to the list of users and give them some basic access to our application?
Since we are building a website meant to be open to a number of users, letâ€™s go ahead and implement a strategy where a new user can be created in the event that a user logs on through one of our authentication strategies but isnâ€™t found in the database."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Example Projects"><meta property="article:modified_time" content="2025-04-05T18:31:19-05:00"><meta itemprop=name content="New Users :: CIS 526 Textbook"><meta itemprop=description content="YouTube Video Handling New Users What if a user logs in to our application through CAS, but we donâ€™t have them in our database of users? Do we want to deny them access to the application? Or should we somehow gracefully add them to the list of users and give them some basic access to our application?
Since we are building a website meant to be open to a number of users, letâ€™s go ahead and implement a strategy where a new user can be created in the event that a user logs on through one of our authentication strategies but isnâ€™t found in the database."><meta itemprop=dateModified content="2025-04-05T18:31:19-05:00"><meta itemprop=wordCount content="370"><title>New Users :: CIS 526 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis526/x-examples/04-authentication/06-new-user/ rel=canonical type=text/html title="New Users :: CIS 526 Textbook"><link href=/cis526/x-examples/04-authentication/06-new-user/index.xml rel=alternate type=application/rss+xml title="New Users :: CIS 526 Textbook"><link href=/cis526/x-examples/04-authentication/06-new-user/tele.html rel=alternate type=text/html title="New Users :: CIS 526 Textbook"><link href=/cis526/x-examples/04-authentication/06-new-user/embed.html rel=alternate type=text/html title="New Users :: CIS 526 Textbook"><link href=/cis526/css/fontawesome-all.min.css?1745942389 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fontawesome-all.min.css?1745942389 rel=stylesheet></noscript><link href=/cis526/css/nucleus.css?1745942389 rel=stylesheet><link href=/cis526/css/auto-complete.css?1745942389 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/auto-complete.css?1745942389 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar.min.css?1745942389 rel=stylesheet><link href=/cis526/css/fonts.css?1745942389 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fonts.css?1745942389 rel=stylesheet></noscript><link href=/cis526/css/theme.css?1745942389 rel=stylesheet><link href=/cis526/css/theme-auto.css?1745942389 rel=stylesheet id=R-variant-style><link href=/cis526/css/chroma-auto.css?1745942389 rel=stylesheet id=R-variant-chroma-style><link href=/cis526/css/variant.css?1745942389 rel=stylesheet><link href=/cis526/css/print.css?1745942389 rel=stylesheet media=print><link href=/cis526/css/format-print.css?1745942389 rel=stylesheet><script src=/cis526/js/variant.js?1745942389></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.index_js_url="/cis526/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis526/css/custom.css?1745942389 rel=stylesheet></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/cis526/x-examples/04-authentication/06-new-user/><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cis526/x-examples/><span itemprop=name>Example Projects</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cis526/x-examples/04-authentication/><span itemprop=name>Authentication</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>New Users</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/04-authentication/05-cas/ title="CAS Authentication (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/04-authentication/07-testing-auth/ title="Testing Authentication (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=new-users>New Users</h1><a href="https://www.youtube.com/watch?v=53odl8cktpI">YouTube Video</a><h2 id=handling-new-users>Handling New Users</h2><p>What if a user logs in to our application through CAS, but we don&rsquo;t have them in our database of users? Do we want to deny them access to the application? Or should we somehow gracefully add them to the list of users and give them some basic access to our application?</p><p>Since we are building a website meant to be open to a number of users, let&rsquo;s go ahead and implement a strategy where a new user can be created in the event that a user logs on through one of our authentication strategies but isn&rsquo;t found in the database.</p><p>Thankfully, to do this is really simple - all we must do is add a few additional lines to our <code>authenticateUser</code> function in the <code>configs/auth.js</code> file:</p><div class=tab-panel data-tab-group=4f12e1eb2f0256e89b6deea0d6ffd3e6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configsauthjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4f12e1eb2f0256e89b6deea0d6ffd3e6","configsauthjs")'>
<span class=tab-nav-text>configs/auth.js</span></button></div><div class=tab-content-container><div data-tab-item=configsauthjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>authenticateUser</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>username</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Find user with the username
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>User</span><span class=p>.</span><span class=nx>findOne</span><span class=p>({</span> 
</span></span><span class=line><span class=cl>    <span class=nx>attributes</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;id&#34;</span><span class=p>,</span> <span class=s2>&#34;username&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nx>include</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>model</span><span class=o>:</span> <span class=nx>Role</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>as</span><span class=o>:</span> <span class=s2>&#34;roles&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>attributes</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;id&#34;</span><span class=p>,</span> <span class=s2>&#34;role&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nx>through</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>attributes</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>where</span><span class=o>:</span> <span class=p>{</span> <span class=nx>username</span><span class=o>:</span> <span class=nx>username</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>user</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>    <span class=c1>// User not found
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>user</span> <span class=o>===</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>      <span class=c1>// Create new user
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>      <span class=nx>User</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span> <span class=nx>username</span><span class=o>:</span> <span class=nx>username</span><span class=p>}).</span><span class=nx>then</span><span class=p>((</span><span class=nx>user</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>        <span class=nx>logger</span><span class=p>.</span><span class=nx>debug</span><span class=p>(</span><span class=s2>&#34;New user created via login: &#34;</span> <span class=o>+</span> <span class=nx>user</span><span class=p>.</span><span class=nx>username</span><span class=p>);</span>
</span></span><span class="line hl"><span class=cl>        
</span></span><span class="line hl"><span class=cl>        <span class=c1>// Convert Sequelize object to plain JavaScript object
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>        <span class=nx>user</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>user</span><span class=p>))</span>
</span></span><span class="line hl"><span class=cl>        <span class=k>return</span> <span class=nx>next</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=nx>user</span><span class=p>);</span>
</span></span><span class="line hl"><span class=cl>      <span class=p>})</span>
</span></span><span class="line hl"><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>      <span class=c1>// User authenticated
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>      <span class=nx>logger</span><span class=p>.</span><span class=nx>debug</span><span class=p>(</span><span class=s2>&#34;Login succeeded for user: &#34;</span> <span class=o>+</span> <span class=nx>user</span><span class=p>.</span><span class=nx>username</span><span class=p>);</span>
</span></span><span class="line hl"><span class=cl>      
</span></span><span class="line hl"><span class=cl>      <span class=c1>// Convert Sequelize object to plain JavaScript object
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>      <span class=nx>user</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>user</span><span class=p>))</span>
</span></span><span class="line hl"><span class=cl>      <span class=k>return</span> <span class=nx>next</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=nx>user</span><span class=p>);</span>
</span></span><span class="line hl"><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>Now, when we try to log in using any username, we&rsquo;ll either be logged in as an existing user, or a new user will be created. We can see this in our log output:</p><div class=tab-panel data-tab-group=da7b1c257ff1ebdc460168ad8033ddd9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("da7b1c257ff1ebdc460168ad8033ddd9","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>[2025-03-20 07:15:17.256 PM] http:      GET /auth/cas 302 0.697 ms - 0
[2025-03-20 07:15:23.525 PM] debug:     New user created via login: russfeld
[2025-03-20 07:15:23.564 PM] http:      GET /auth/cas?ticket=aac12881-9bea-449c-bf13-b981525cc8db 302 218.923 ms - 30
[2025-03-20 07:15:23.721 PM] http:      GET / 200 1.299 ms - -</code></pre></div></div></div></div></div><p>That&rsquo;s all there is to it! Of course, we can also configure this process to automatically assign roles to our newly created user, but for right now we won&rsquo;t worry about that.</p><footer class=footline></footer></article></div></main><div class=git-footer><p class=theme-version-footer>6.0.0</p><p>Last modified by:
<i class='fas fa-user'></i> Russell Feldhausen
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cis526/commit/afd035a8f2cc9f8006f8fff543a247a17e0015fb>Apr 5, 2025</a></p></div></div><script src=/cis526/js/clipboard.min.js?1745942389 defer></script><script src=/cis526/js/perfect-scrollbar.min.js?1745942389 defer></script><script src=/cis526/js/theme.js?1745942389 defer></script></body></html>