<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="YouTube Video Routing after Authentication The last step we should take in our authentication system is to properly route users back to the index page after a successful login attempt. Since we will eventually be building a single-page application in Vue.js as our frontend for this application, we only need to worry about directing users back to the index page, which will load our frontend.
So, in our authSuccess method in routes/auth."><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Auth Routing :: CIS 526 Textbook"><meta name=twitter:description content="YouTube Video Routing after Authentication The last step we should take in our authentication system is to properly route users back to the index page after a successful login attempt. Since we will eventually be building a single-page application in Vue.js as our frontend for this application, we only need to worry about directing users back to the index page, which will load our frontend.
So, in our authSuccess method in routes/auth."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/x-examples/04-authentication/04-routing/"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Auth Routing :: CIS 526 Textbook"><meta property="og:description" content="YouTube Video Routing after Authentication The last step we should take in our authentication system is to properly route users back to the index page after a successful login attempt. Since we will eventually be building a single-page application in Vue.js as our frontend for this application, we only need to worry about directing users back to the index page, which will load our frontend.
So, in our authSuccess method in routes/auth."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="Example Projects"><meta property="article:modified_time" content="2025-03-20T17:37:07-05:00"><meta itemprop=name content="Auth Routing :: CIS 526 Textbook"><meta itemprop=description content="YouTube Video Routing after Authentication The last step we should take in our authentication system is to properly route users back to the index page after a successful login attempt. Since we will eventually be building a single-page application in Vue.js as our frontend for this application, we only need to worry about directing users back to the index page, which will load our frontend.
So, in our authSuccess method in routes/auth."><meta itemprop=dateModified content="2025-03-20T17:37:07-05:00"><meta itemprop=wordCount content="729"><title>Auth Routing :: CIS 526 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis526/x-examples/04-authentication/04-routing/ rel=canonical type=text/html title="Auth Routing :: CIS 526 Textbook"><link href=/cis526/x-examples/04-authentication/04-routing/index.xml rel=alternate type=application/rss+xml title="Auth Routing :: CIS 526 Textbook"><link href=/cis526/x-examples/04-authentication/04-routing/index.print.html rel=alternate type=text/html title="Auth Routing :: CIS 526 Textbook"><link href=/cis526/x-examples/04-authentication/04-routing/embed.html rel=alternate type=text/html title="Auth Routing :: CIS 526 Textbook"><link href=/cis526/css/fontawesome-all.min.css?1743522175 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fontawesome-all.min.css?1743522175 rel=stylesheet></noscript><link href=/cis526/css/nucleus.css?1743522175 rel=stylesheet><link href=/cis526/css/auto-complete.css?1743522175 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/auto-complete.css?1743522175 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar.min.css?1743522175 rel=stylesheet><link href=/cis526/css/fonts.css?1743522175 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fonts.css?1743522175 rel=stylesheet></noscript><link href=/cis526/css/theme.css?1743522175 rel=stylesheet><link href=/cis526/css/theme-auto.css?1743522175 rel=stylesheet id=R-variant-style><link href=/cis526/css/chroma-auto.css?1743522175 rel=stylesheet id=R-variant-chroma-style><link href=/cis526/css/variant.css?1743522175 rel=stylesheet><link href=/cis526/css/print.css?1743522175 rel=stylesheet media=print><script src=/cis526/js/variant.js?1743522175></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.index_js_url="/cis526/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis526/css/custom.css?1743522175 rel=stylesheet></head><body class="mobile-support tele disableInlineCopyToClipboard" data-url=/cis526/x-examples/04-authentication/04-routing/><div id=tele class="tele mirror"><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=auth-routing>Auth Routing</h1><a href="https://www.youtube.com/watch?v=id">YouTube Video</a><h2 id=routing-after-authentication>Routing after Authentication</h2><p>The last step we should take in our authentication system is to properly route users back to the index page after a successful login attempt. Since we will eventually be building a single-page application in Vue.js as our frontend for this application, we only need to worry about directing users back to the index page, which will load our frontend.</p><p>So, in our <code>authSuccess</code> method in <code>routes/auth.js</code>, we can update the response to redirect our users back to the index page:</p><div class=tab-panel data-tab-group=209b7be3431a35fcac0aa0e11f1e769e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=authroutesjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("209b7be3431a35fcac0aa0e11f1e769e","authroutesjs")'>
<span class=tab-nav-text>auth/routes.js</span></button></div><div class=tab-content-container><div data-tab-item=authroutesjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>authSuccess</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>redirect</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>The <code>res.redirect</code> method will sent an HTTP 302 <code>Found</code> response back to the browser with a new location to navigate to. However, by that point, the authentication process will also send a cookie to the browser with the session ID, so the user will be logged in correctly:</p><p><a href=#R-image-b6ffaeaf9633273b4bb0962f1f5e4c98 class=lightbox-link><img alt="Session Login with Cookie Set" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/04/auth_9.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b6ffaeaf9633273b4bb0962f1f5e4c98><img alt="Session Login with Cookie Set" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/04/auth_9.png></a></p><h2 id=logout-route>Logout Route</h2><p>Finally, we should also add a logout route. This route will end any sessions created through Passport.js by removing the session from the database and also telling the browser to delete the session cookie. It uses the special <code>req.logout()</code> method that is added to each request by Passport.js. We&rsquo;ll add our logout route to the bottom of the <code>routes/auth.js</code> file:</p><div class=tab-panel data-tab-group=15a693cfa65538b9b5615508eeefb19f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=routesauthjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("15a693cfa65538b9b5615508eeefb19f","routesauthjs")'>
<span class=tab-nav-text>routes/auth.js</span></button></div><div class=tab-content-container><div data-tab-item=routesauthjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Import configurations
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=s2>&#34;../configs/auth.js&#34;</span><span class=p>;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>import</span> <span class=nx>logger</span> <span class=nx>from</span> <span class=s2>&#34;../configs/logger.js&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Logout of a Passport.js session
</span></span></span><span class=line><span class=cl><span class=cm> * 
</span></span></span><span class=line><span class=cl><span class=cm> * See https://www.initialapps.com/properly-logout-passportjs-express-session-for-single-page-app/
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @param {Object} req - Express request object
</span></span></span><span class=line><span class=cl><span class=cm> * @param {Object} res - Express response object
</span></span></span><span class=line><span class=cl><span class=cm> * @param {Function} next - Express next middleware function
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @swagger
</span></span></span><span class=line><span class=cl><span class=cm> * /auth/logout:
</span></span></span><span class=line><span class=cl><span class=cm> *   get:
</span></span></span><span class=line><span class=cl><span class=cm> *     summary: logout current user
</span></span></span><span class=line><span class=cl><span class=cm> *     description:  logout current user and end session
</span></span></span><span class=line><span class=cl><span class=cm> *     tags: [auth]
</span></span></span><span class=line><span class=cl><span class=cm> *     responses:
</span></span></span><span class=line><span class=cl><span class=cm> *       200:
</span></span></span><span class=line><span class=cl><span class=cm> *         description: success
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/logout&#39;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>clearCookie</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SESSION_NAME</span> <span class=o>||</span> <span class=s1>&#39;connect.sid&#39;</span><span class=p>);</span>  <span class=c1>// clear the session cookie
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>req</span><span class=p>.</span><span class=nx>logout</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>       <span class=c1>// logout of passport
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>req</span><span class=p>.</span><span class=nx>session</span><span class=p>.</span><span class=nx>destroy</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>  <span class=c1>// destroy the session
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>redirect</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>Now, when we access this route with a valid session, we&rsquo;ll see that the user is properly logged out.</p><p>We&rsquo;ll also no longer be able to access the <code>/auth/token</code> route without logging in again.</p><p>However, this route <strong>WILL NOT</strong> invalidate any existing JWTs already issued to that user - they will still be valid until they expire. In our earlier example, we set the JWTs to have a 6 hour lifetime, so in theory a user could still access the application using a valid JWT up to 6 hours after logging out!</p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Invalidating JWTs</div><div class=box-content><p>JSON Web Tokens (JWTs) are a very powerful authentication method for web APIs because they allow users to send requests without worrying about the need for a cookie session. In theory, a JWT issued by any instance of our API can be validated anywhere, making it much easier to horizontally scale this application in the future.</p><p>In addition, requests with a JWT generally don&rsquo;t require a database access with each request to validate the session. Our current cookie sessions store the session data in the database, so now each incoming request containing a session cookie requires a database lookup to get information about the user before any work can be done.</p><p>However, this means that any user with a valid JWT will be able to access our application even if they have logged out. This may present a security issue for some applications.</p><p>There are some strategies to mitigate this risk:</p><ol><li>Use JWTs with a short expiration - this means users may have to log in again and/or request new tokens more often, which could be frustrating.</li><li>Add a database session to each JWT - this would mean that each incoming request with a JWT would now result in a database lookup, which could slow things down. Alternatively, sessions could be stored in a faster cache mechanism such as <a href=https://redis.io/ rel=external target=_blank>Redis</a> or <a href=https://valkey.io/ rel=external target=_blank>Valkey</a>.</li><li>To permanently invalidate all existing JWT sessions (in case of a security compromise or other concern), simply change the key used to sign the JWTs to a new secure key. This is a method of last resort, but it is always important to know that it is available if needed.</li></ol></div></div><footer class=footline></footer></article></div></main></div></div><script src=/cis526/js/clipboard.min.js?1743522175 defer></script><script src=/cis526/js/perfect-scrollbar.min.js?1743522175 defer></script><script src=/cis526/js/theme.js?1743522175 defer></script><script src=/cis526/js/tele-scroll.js?1743522175 defer></script></body></html>