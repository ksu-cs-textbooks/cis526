<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Update :: CIS 526 Textbook</title><link>https://textbooks.cs.ksu.edu/cis526/x-examples/03-rest-api/10-update/index.html</link><description>Update Route Next, let’s look at adding an additional route in our application that allows us to update a User model. This route is very similar to the route used to create a user, but there are a few key differences as well.
​ routes/api/v1/users.js // -=-=- other code omitted here -=-=- /** * Update a user * * @param {Object} req - Express request object * @param {Object} res - Express response object * @param {Function} next - Express next middleware function * * @swagger * /api/v1/users/{id}: * put: * summary: update user * tags: [users] * parameters: * - in: path * name: id * required: true * schema: * type: integer * description: user ID * requestBody: * description: user * required: true * content: * application/json: * schema: * $ref: '#/components/schemas/User' * example: * username: updateduser * roles: * - id: 6 * - id: 7 * responses: * 201: * $ref: '#/components/responses/Success' * 422: * $ref: '#/components/responses/ValidationError' */ router.put("/:id", async function (req, res, next) { try { const user = await User.findByPk(req.params.id) // if the user is not found, return an HTTP 404 not found status code if (user === null) { res.status(404).end(); } else { await database.transaction(async (t) => { await user.update( // Update the user object using body attributes { username: req.body.username, }, // Assign to a database transaction { transaction: t, }, ); // If roles are included in the body if (req.body.roles) { // Find all roles listed const roles = await Promise.all( req.body.roles.map(({ id, ...next }) => { return Role.findByPk(id); }), ); // Attach roles to user await user.setRoles(roles, { transaction: t }); } else { // Remove all roles await user.setRoles([], { transaction: t }); } // Send the success message sendSuccess("User saved!", user.id, 201, res); }); } } catch (error) { if (error instanceof ValidationError) { handleValidationError(error, res); } else { logger.error(error); res.status(500).end(); } } }); // -=-=- other code omitted here -=-=- As we can see, overall this route is very similar to the create route. The only major difference is that we must first find the user we want to update based on the query parameter, and then we use the update database method to update the existing values in the database. The rest of the work updating the related Roles models is exactly the same. We can also reuse the utility functions we created for the previous route.</description><generator>Hugo</generator><language>en-us</language><atom:link href="https://textbooks.cs.ksu.edu/cis526/x-examples/03-rest-api/10-update/index.xml" rel="self" type="application/rss+xml"/></channel></rss>