<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.148.1"><meta name=generator content="Relearn 8.0.0"><meta name=description content="YouTube Video Testing Web APIs Now that we have created our first route in our RESTful API, we can start to write unit tests that will confirm our API works as intended. Adding unit testing early in the development process makes it much easier to keep up with unit tests as new features are added or even explore test-driven development!
There are many libraries that can be used to unit test a RESTful API using Node.js and Express. For this project, we’re going to use a number of testing libraries:"><meta name=author content="Nathan Bean & Russell Feldhausen"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta name=twitter:title content="Unit Testing :: CIS 526 Textbook"><meta name=twitter:description content="YouTube Video Testing Web APIs Now that we have created our first route in our RESTful API, we can start to write unit tests that will confirm our API works as intended. Adding unit testing early in the development process makes it much easier to keep up with unit tests as new features are added or even explore test-driven development!
There are many libraries that can be used to unit test a RESTful API using Node.js and Express. For this project, we’re going to use a number of testing libraries:"><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/x-examples/03-rest-api/02-unit-testing/index.html"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Unit Testing :: CIS 526 Textbook"><meta property="og:description" content="YouTube Video Testing Web APIs Now that we have created our first route in our RESTful API, we can start to write unit tests that will confirm our API works as intended. Adding unit testing early in the development process makes it much easier to keep up with unit tests as new features are added or even explore test-driven development!
There are many libraries that can be used to unit test a RESTful API using Node.js and Express. For this project, we’re going to use a number of testing libraries:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="Example Projects"><meta property="article:modified_time" content="2025-03-07T15:34:34-06:00"><meta property="og:image" content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta itemprop=name content="Unit Testing :: CIS 526 Textbook"><meta itemprop=description content="YouTube Video Testing Web APIs Now that we have created our first route in our RESTful API, we can start to write unit tests that will confirm our API works as intended. Adding unit testing early in the development process makes it much easier to keep up with unit tests as new features are added or even explore test-driven development!
There are many libraries that can be used to unit test a RESTful API using Node.js and Express. For this project, we’re going to use a number of testing libraries:"><meta itemprop=dateModified content="2025-03-07T15:34:34-06:00"><meta itemprop=wordCount content="1684"><meta itemprop=image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><title>Unit Testing :: CIS 526 Textbook</title><link href=https://textbooks.cs.ksu.edu/cis526/x-examples/03-rest-api/02-unit-testing/index.html rel=canonical type=text/html title="Unit Testing :: CIS 526 Textbook"><link href=/cis526/x-examples/03-rest-api/02-unit-testing/index.xml rel=alternate type=application/rss+xml title="Unit Testing :: CIS 526 Textbook"><link href=/cis526/x-examples/03-rest-api/02-unit-testing/index.print.html rel=alternate type=text/html title="Unit Testing :: CIS 526 Textbook"><link href=/cis526/x-examples/03-rest-api/02-unit-testing/embed.html rel=alternate type=text/html title="Unit Testing :: CIS 526 Textbook"><link href=/cis526/css/auto-complete/auto-complete.min.css?1753540871 rel=stylesheet><script src=/cis526/js/auto-complete/auto-complete.min.js?1753540871 defer></script><script src=/cis526/js/search-lunr.min.js?1753540871 defer></script><script src=/cis526/js/search.min.js?1753540871 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/cis526/searchindex.en.js?1753540871"</script><script src=/cis526/js/lunr/lunr.min.js?1753540871 defer></script><script src=/cis526/js/lunr/lunr.stemmer.support.min.js?1753540871 defer></script><script src=/cis526/js/lunr/lunr.multi.min.js?1753540871 defer></script><script src=/cis526/js/lunr/lunr.en.min.js?1753540871 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1753540871 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1753540871 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar/perfect-scrollbar.min.css?1753540871 rel=stylesheet><link href=/cis526/css/theme.min.css?1753540871 rel=stylesheet><link href=/cis526/css/format-html.min.css?1753540871 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/x-examples/03-rest-api/02-unit-testing/index.html",window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!1,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["light-theme"],window.relearn.customvariantname="my-custom-variant",window.relearn.writeVariant=!1,window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.writeVariant&&window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><link href=/cis526/css/custom.css?1753540871 rel=stylesheet></head><body class="mobile-support html" data-url=/cis526/x-examples/03-rest-api/02-unit-testing/index.html><div id=tele class="tele mirror"><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable x-examples" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=unit-testing>Unit Testing</h1><a href="https://www.youtube.com/watch?v=0jqhrmsuny0">YouTube Video</a><h2 id=testing-web-apis>Testing Web APIs</h2><p>Now that we have created our first route in our RESTful API, we can start to write unit tests that will confirm our API works as intended. Adding unit testing early in the development process makes it much easier to keep up with unit tests as new features are added or even explore <a href=https://en.wikipedia.org/wiki/Test-driven_development rel=external target=_blank>test-driven development</a>!</p><p>There are many libraries that can be used to unit test a RESTful API using Node.js and Express. For this project, we&rsquo;re going to use a number of testing libraries:</p><ul><li><a href=https://www.npmjs.com/package/mocha rel=external target=_blank>mocha</a> - Node.js testing framework</li><li><a href=https://www.npmjs.com/package/chai rel=external target=_blank>chai</a> - assertion library</li><li><a href=https://www.npmjs.com/package/supertest rel=external target=_blank>supertest</a> - HTTP request testing framework</li><li><a href=https://www.npmjs.com/package/ajv rel=external target=_blank>ajv</a> - JSON schema validator</li><li><a href=https://www.npmjs.com/package/chai-json-schema-ajv rel=external target=_blank>chai-json-schema-ajv</a> - chai plugin for AJV</li><li><a href=https://www.npmjs.com/package/chai-shallow-deep-equal rel=external target=_blank>chai-shallow-deep-equal</a> - chai plugin for deep equal assertion</li></ul><p>To begin, let&rsquo;s install these libraries as development dependencies in our project using <code>npm</code>:</p><div class=tab-panel data-tab-group=8ccee9ec4efadd274d3a29cbe7b3e3ec><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("8ccee9ec4efadd274d3a29cbe7b3e3ec","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm install --save-dev mocha chai supertest ajv chai-json-schema-ajv chai-shallow-deep-equal</span></span></code></pre></div></div></div></div></div><p>Now that we have those libraries in place, let&rsquo;s make a few modifications to our project configuration to make testing more convenient.</p><details open class="box cstyle notices tip"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
ESLint Plugin</summary><div class=box-content><p>To help with formatting and highlighting of our unit tests, we should update the content of our <code>eslint.config.js</code> to recognize items from <code>mocha</code> as follows:</p><div class=tab-panel data-tab-group=0d38002a117613c9e88b6d19015fa16d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=eslintconfigjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0d38002a117613c9e88b6d19015fa16d","eslintconfigjs")'>
<span class=tab-nav-text>eslint.config.js</span></button></div><div class=tab-content-container><div data-tab-item=eslintconfigjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>globals</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;globals&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>pluginJs</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;@eslint/js&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @type {import(&#39;eslint&#39;).Linter.Config[]} */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> [
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#a6e22e>languageOptions</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#a6e22e>globals</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex;background-color:#3c3d38><span>        ...<span style=color:#a6e22e>globals</span>.<span style=color:#a6e22e>node</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>        ...<span style=color:#a6e22e>globals</span>.<span style=color:#a6e22e>mocha</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>      },
</span></span><span style=display:flex;background-color:#3c3d38><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rules</span><span style=color:#f92672>:</span> { <span style=color:#e6db74>&#34;no-unused-vars&#34;</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;error&#34;</span>, { <span style=color:#a6e22e>argsIgnorePattern</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;next&#34;</span> }] },
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>pluginJs</span>.<span style=color:#a6e22e>configs</span>.<span style=color:#a6e22e>recommended</span>,
</span></span><span style=display:flex><span>];</span></span></code></pre></div></div></div></div></div><p>If working properly, this should also fix any errors visible in VS Code using the ESLint plugin!</p></div></details><h2 id=mocha-root-hooks>Mocha Root Hooks</h2><p>In testing frameworks such as <code>mocha</code>, we can create <code>hooks</code> that contain actions that should be taken before each test is executed in a file. The <code>mocha</code> framework also has <a href=https://mochajs.org/#root-hook-plugins rel=external target=_blank>root-level hooks</a> that are actions to be taken before each and every test in every file. We can use a root-level hook to manage setting up a simple database for unit testing, as well as configuring other aspects of our application for testing.</p><p>First, let&rsquo;s create a new <code>test</code> directory in our <code>server</code> folder, and inside of that we&rsquo;ll create a file <code>hooks.js</code> to contain the testing hooks for our application.</p><div class=tab-panel data-tab-group=4635313b4edcb81717080d1ae504cba5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=testhooksjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4635313b4edcb81717080d1ae504cba5","testhooksjs")'>
<span class=tab-nav-text>test/hooks.js</span></button></div><div class=tab-content-container><div data-tab-item=testhooksjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file Root Mocha Hooks
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @exports mochaHooks A Mocha Root Hooks Object
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Load environment (must be first)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>dotenvx</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;@dotenvx/dotenvx&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>dotenvx</span>.<span style=color:#a6e22e>config</span>({<span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;.env.test&#34;</span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import configuration
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>database</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;../configs/database.js&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>migrations</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../configs/migrations.js&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>seeds</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../configs/seeds.js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Root Hook Runs Before Each Test
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>mochaHooks</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Hook runs once before any tests are executed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>beforeAll</span>(<span style=color:#a6e22e>done</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Test database connection
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>database</span>.<span style=color:#a6e22e>authenticate</span>().<span style=color:#a6e22e>then</span>(() =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Run migrations
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>migrations</span>.<span style=color:#a6e22e>up</span>().<span style=color:#a6e22e>then</span>(() =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>done</span>() 
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Hook runs before each individual test
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>beforeEach</span>(<span style=color:#a6e22e>done</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Seed the database
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>seeds</span>.<span style=color:#a6e22e>up</span>().<span style=color:#a6e22e>then</span>(() =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>done</span>();
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Hook runs after each individual test
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>afterEach</span>(<span style=color:#a6e22e>done</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Remove all data from the database
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>seeds</span>.<span style=color:#a6e22e>down</span>({<span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>}).<span style=color:#a6e22e>then</span>(() =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>done</span>();
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>This file contains three hooks. First, the <code>beforeAll</code> hook, which is executed once before any tests are executed, is used to migrate the database. Then, we have the <code>beforeEach()</code> hook, which is executed before each individual test, which will seed the database with some sample data for us to use in our unit tests. Finally, we have an <code>afterEach()</code> hook that will remove any data from the database by undoing all of the seeds, which will truncate each table in the database.</p><p>Notice at the top that we are also loading our environment from a new environment file, <code>.env.test</code>. This allows us to use a different environment configuration when we perform testing. So, let&rsquo;s create that file and populate it with the following content:</p><div class=tab-panel data-tab-group=6efc5e8ffb9150a567190ec3f6d427a5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=envtest class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6efc5e8ffb9150a567190ec3f6d427a5","envtest")'>
<span class=tab-nav-text>.env.test</span></button></div><div class=tab-content-container><div data-tab-item=envtest class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-env data-lang=env><span style=display:flex><span>LOG_LEVEL<span style=color:#f92672>=</span>error
</span></span><span style=display:flex><span>PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>OPENAPI_HOST<span style=color:#f92672>=</span>http://localhost:3000
</span></span><span style=display:flex><span>OPENAPI_VISIBLE<span style=color:#f92672>=</span>false
</span></span><span style=display:flex><span>DATABASE_FILE<span style=color:#f92672>=</span>:memory:
</span></span><span style=display:flex><span>SEED_DATA<span style=color:#f92672>=</span>false</span></span></code></pre></div></div></div></div></div><p>Here, the two major changes are to switch the log level to <code>error</code> so that we only see errors in the log output, and also to switch the database file to <code>:memory:</code> - a special filename that tells SQLite to create an in-memory database that is excellent for testing.</p><p>At this point, we can start writing our unit tests.</p><h2 id=writing-basic-unit-tests>Writing Basic Unit Tests</h2><p>Let&rsquo;s start with a very simple case - the <code>/api</code> route we created earlier. This is a simple route that only has a single method and outputs a single item, but it already clearly demonstrates how complex unit testing can become.</p><p>For these unit tests, we can create a file <code>api.js</code> in the <code>test</code> folder with the following content:</p><div class=tab-panel data-tab-group=d6821a19ac623c641e0a2921d298c963><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=testapijs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d6821a19ac623c641e0a2921d298c963","testapijs")'>
<span class=tab-nav-text>test/api.js</span></button></div><div class=tab-content-container><div data-tab-item=testapijs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @file /api Route Tests
</span></span></span><span style=display:flex><span><span style=color:#75715e> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Load Libraries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>request</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;supertest&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>use</span>, <span style=color:#a6e22e>should</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;chai&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>chaiJsonSchemaAjv</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;chai-json-schema-ajv&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>chaiShallowDeepEqual</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;chai-shallow-deep-equal&#39;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>chaiJsonSchemaAjv</span>.<span style=color:#a6e22e>create</span>({ <span style=color:#a6e22e>verbose</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> }))
</span></span><span style=display:flex><span><span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>chaiShallowDeepEqual</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Import Express application
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>app</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../app.js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Modify Object.prototype for BDD style assertions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>should</span>()</span></span></code></pre></div></div></div></div></div><p>These lines will import the various libraries required for these unit tests. We&rsquo;ll explore how they work as we build the unit tests, but it is also recommended to read the documentation for each library (linked above) to better understand how each one works together in the various unit tests.</p><p>Now, let&rsquo;s write our first unit test, which can be placed right below those lines in the same file:</p><div class=tab-panel data-tab-group=4a19e732042745f3438c2f7178496178><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=testapijs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4a19e732042745f3438c2f7178496178","testapijs")'>
<span class=tab-nav-text>test/api.js</span></button></div><div class=tab-content-container><div data-tab-item=testapijs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Get all API versions
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getAllVersions</span> <span style=color:#f92672>=</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>it</span>(<span style=color:#e6db74>&#39;should list all API versions&#39;</span>, (<span style=color:#a6e22e>done</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>request</span>(<span style=color:#a6e22e>app</span>)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/api/&#39;</span>)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>expect</span>(<span style=color:#ae81ff>200</span>)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>end</span>((<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>res</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span>) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>done</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>should</span>.<span style=color:#a6e22e>be</span>.<span style=color:#a6e22e>an</span>(<span style=color:#e6db74>&#39;array&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>should</span>.<span style=color:#a6e22e>have</span>.<span style=color:#a6e22e>lengthOf</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>done</span>()
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Test /api route
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>describe</span>(<span style=color:#e6db74>&#39;/api&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>describe</span>(<span style=color:#e6db74>&#39;GET /&#39;</span>, () =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>getAllVersions</span>()
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>})</span></span></code></pre></div></div></div></div></div><p>This code looks quite a bit different than the code we&rsquo;ve been writing so far. This is because the <code>mocha</code> and <code>chai</code> libraries use the <a href=https://en.wikipedia.org/wiki/Behavior-driven_development rel=external target=_blank>Behavior-Driven Development</a>, or BDD, style for writing unit tests. The core idea is that the unit tests should be somewhat &ldquo;readable&rdquo; by anyone looking at the code. So, it defines functions such as <code>it</code> and <code>describe</code> that are used to structure the unit tests.</p><p>In this example, the <code>getAllVersions</code> function is a unit test function that uses the <code>request</code> library to send a request to our Express <code>app</code> at the <code>/api/</code> path. When the response is received from that request, we expect the HTTP status code to be 200, and the body of that request should be an array with a length of 1. Hopefully it is clear to see all of that just by reading the code in that function.</p><p>The other important concept is the special <code>done</code> function, which is provided as an argument to any unit test function that is testing <a href=https://mochajs.org/#asynchronous-code rel=external target=_blank>asynchronous code</a>. Because of the way asynchronous code is handled, the system cannot automatically determine when all promises have been returned. So, once we are done with the unit test and are not waiting for any further async responses, we need to call the <code>done()</code> method. Notice that we call that both at the end of the function, but also in the <code>if</code> statement that checks for any errors returned from the HTTP request.</p><p>Finally, at the bottom of the file, we have a few <code>describe</code> statements that actually build the structure that runs each unit test. When the tests are executed, only functions called inside of the <code>describe</code> statements will be executed.</p><h2 id=running-unit-tests>Running Unit Tests</h2><p>Now that we have created a simple unit test, let&rsquo;s run it using the <code>mocha</code> test framework. To do this, we&rsquo;ll add a new script to the <code>package.json</code> file with all of the appropriate options:</p><div class=tab-panel data-tab-group=01f485b9fbae2cca2bf3de708fdca647><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=packagejson class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("01f485b9fbae2cca2bf3de708fdca647","packagejson")'>
<span class=tab-nav-text>package.json</span></button></div><div class=tab-content-container><div data-tab-item=packagejson class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>...</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;scripts&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;start&#34;</span>: <span style=color:#e6db74>&#34;LOG_LEVEL=http node ./bin/www&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;dev&#34;</span>: <span style=color:#e6db74>&#34;nodemon ./bin/www&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;lint&#34;</span>: <span style=color:#e6db74>&#34;npx eslint --fix .&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;format&#34;</span>: <span style=color:#e6db74>&#34;npx prettier . --write&#34;</span>,
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#f92672>&#34;test&#34;</span>: <span style=color:#e6db74>&#34;mocha --require test/hooks.js --recursive --parallel --timeout 2000 --exit&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>...</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>Here, we are using the <code>mocha</code> command with many options:</p><ul><li><code>--require test/hooks.js</code> - this requires the global hooks file to be used before each test</li><li><code>--recursive</code> - this will recursively look for any tests in subdirectories</li><li><code>--parallel</code> - this allows tests to run in parallel (this requires the SQLite in-memory database)</li><li><code>--timeout 2000</code> - this will stop any test if it runs for more than 2 seconds</li><li><code>--exit</code> - this forces Mocha to stop after all tests have finished</li></ul><p>So, now let&rsquo;s run our tests using that script:</p><div class=tab-panel data-tab-group=041794d2e56f628bf4516498d6a5b746><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("041794d2e56f628bf4516498d6a5b746","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm run test</span></span></code></pre></div></div></div></div></div><p>If everything is working correctly, we should get the following output:</p><div class=tab-panel data-tab-group=ab3054223d459c14f7bb2520b11d099f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ab3054223d459c14f7bb2520b11d099f","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0><code>&gt; lost-communities-solution@0.0.1 test
&gt; mocha --require test/hooks.js --recursive --parallel --timeout 2000 --exit

[dotenvx@1.34.0] injecting env (6) from .env.test

[dotenvx@1.34.0] injecting env (0) from .env.test
[dotenvx@1.34.0] injecting env (0) from .env

  /api
    GET /
      ✔ should list all API versions


  1 passing (880ms)</code></pre></div></div></div></div></div><p>Great! It looks like our test already passed!</p><p>Just to be sure, let&rsquo;s quickly modify our test to look for an array of size <code>2</code> so that it should fail:</p><div class=tab-panel data-tab-group=2b0c61ae105e90102b5d5ef404f735de><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=testapijs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2b0c61ae105e90102b5d5ef404f735de","testapijs")'>
<span class=tab-nav-text>test/api.js</span></button></div><div class=tab-content-container><div data-tab-item=testapijs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Get all API versions
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getAllVersions</span> <span style=color:#f92672>=</span> () =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>it</span>(<span style=color:#e6db74>&#39;should list all API versions&#39;</span>, (<span style=color:#a6e22e>done</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>request</span>(<span style=color:#a6e22e>app</span>)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/api/&#39;</span>)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>expect</span>(<span style=color:#ae81ff>200</span>)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>end</span>((<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>res</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span>) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>done</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>should</span>.<span style=color:#a6e22e>be</span>.<span style=color:#a6e22e>an</span>(<span style=color:#e6db74>&#39;array&#39;</span>)
</span></span><span style=display:flex;background-color:#3c3d38><span>        <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>should</span>.<span style=color:#a6e22e>have</span>.<span style=color:#a6e22e>lengthOf</span>(<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>done</span>()
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>Now, when we run the tests, we should clearly see a failure report instead:</p><div class=tab-panel data-tab-group=e410da18033910702ed98f584004d877><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e410da18033910702ed98f584004d877","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0><code>&gt; lost-communities-solution@0.0.1 test
&gt; mocha --require test/hooks.js --recursive --parallel --timeout 2000 --exit

[dotenvx@1.34.0] injecting env (6) from .env.test

[dotenvx@1.34.0] injecting env (0) from .env.test
[dotenvx@1.34.0] injecting env (0) from .env

  /api
    GET /
      1) should list all API versions


  0 passing (910ms)
  1 failing

  1) /api
       GET /
         should list all API versions:

      Uncaught AssertionError: expected [ { version: &#39;1.0&#39;, url: &#39;/api/v1/&#39; } ] to have a length of 2 but got 1
      + expected - actual

      -1
      +2
      
      at Test.&lt;anonymous&gt; (file:///workspaces/lost-communities-solution/server/test/api.js:31:30)
      at Test.assert (node_modules/supertest/lib/test.js:172:8)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)
      at Object.onceWrapper (node:events:638:28)
      at Server.emit (node:events:524:28)
      at emitCloseNT (node:net:2383:8)
      at process.processTicksAndRejections (node:internal/process/task_queues:89:21)</code></pre></div></div></div></div></div><p>Thankfully, anytime a test fails, we get a very clear and easy to follow error report that pinpoints exactly which line in the test failed, and how the assertion was not met.</p><p>Before moving on, let&rsquo;s update our test so that it should pass again.</p><footer class=footline></footer></article></div></main></div><script src=/cis526/js/clipboard/clipboard.min.js?1753540871 defer></script><script src=/cis526/js/perfect-scrollbar/perfect-scrollbar.min.js?1753540871 defer></script><script src=/cis526/js/theme.min.js?1753540871 defer></script></div><script src=/cis526/js/tele-scroll.min.js?1753540871 defer></script></body></html>