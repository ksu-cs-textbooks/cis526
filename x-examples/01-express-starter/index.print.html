<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="This example project is the first in a series toward building a complete full-stack web application using Node.js and Express to create a RESTful API on the backend that connects to a database, and then a Vue single page application on the frontend.
In doing so, we’ll explore some of the standard ways web developers use existing tools, frameworks, and libraries to perform many of the operations we’ve learned how to do manually throughout this course."><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Express Starter Project :: CIS 526 Textbook"><meta name=twitter:description content="This example project is the first in a series toward building a complete full-stack web application using Node.js and Express to create a RESTful API on the backend that connects to a database, and then a Vue single page application on the frontend.
In doing so, we’ll explore some of the standard ways web developers use existing tools, frameworks, and libraries to perform many of the operations we’ve learned how to do manually throughout this course."><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/x-examples/01-express-starter/"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Express Starter Project :: CIS 526 Textbook"><meta property="og:description" content="This example project is the first in a series toward building a complete full-stack web application using Node.js and Express to create a RESTful API on the backend that connects to a database, and then a Vue single page application on the frontend.
In doing so, we’ll explore some of the standard ways web developers use existing tools, frameworks, and libraries to perform many of the operations we’ve learned how to do manually throughout this course."><meta property="og:locale" content="en-us"><meta property="og:type" content="website"><meta itemprop=name content="Express Starter Project :: CIS 526 Textbook"><meta itemprop=description content="This example project is the first in a series toward building a complete full-stack web application using Node.js and Express to create a RESTful API on the backend that connects to a database, and then a Vue single page application on the frontend.
In doing so, we’ll explore some of the standard ways web developers use existing tools, frameworks, and libraries to perform many of the operations we’ve learned how to do manually throughout this course."><meta itemprop=dateModified content="2025-01-25T16:48:54-06:00"><meta itemprop=wordCount content="243"><title>Express Starter Project :: CIS 526 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis526/x-examples/01-express-starter/ rel=canonical type=text/html title="Express Starter Project :: CIS 526 Textbook"><link href=/cis526/x-examples/01-express-starter/index.xml rel=alternate type=application/rss+xml title="Express Starter Project :: CIS 526 Textbook"><link href=/cis526/x-examples/01-express-starter/tele.html rel=alternate type=text/html title="Express Starter Project :: CIS 526 Textbook"><link href=/cis526/x-examples/01-express-starter/embed.html rel=alternate type=text/html title="Express Starter Project :: CIS 526 Textbook"><link href=/cis526/css/fontawesome-all.min.css?1741029263 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fontawesome-all.min.css?1741029263 rel=stylesheet></noscript><link href=/cis526/css/nucleus.css?1741029263 rel=stylesheet><link href=/cis526/css/auto-complete.css?1741029263 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/auto-complete.css?1741029263 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar.min.css?1741029263 rel=stylesheet><link href=/cis526/css/fonts.css?1741029263 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fonts.css?1741029263 rel=stylesheet></noscript><link href=/cis526/css/theme.css?1741029263 rel=stylesheet><link href=/cis526/css/theme-auto.css?1741029263 rel=stylesheet id=R-variant-style><link href=/cis526/css/chroma-auto.css?1741029263 rel=stylesheet id=R-variant-chroma-style><link href=/cis526/css/variant.css?1741029263 rel=stylesheet><link href=/cis526/css/print.css?1741029263 rel=stylesheet media=print><link href=/cis526/css/format-print.css?1741029263 rel=stylesheet><script src=/cis526/js/variant.js?1741029263></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.index_js_url="/cis526/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis526/css/custom.css?1741029263 rel=stylesheet></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/cis526/x-examples/01-express-starter/><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/cis526/x-examples/><span itemprop=name>Example Projects</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Express Starter Project</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/ title="Example Projects (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/x-examples/01-express-starter/01-codespace/ title="GitHub Codespace (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=express-starter-project>Express Starter Project</h1><p>This example project is the first in a series toward building a complete full-stack web application using <a href=https://nodejs.org/en rel=external target=_blank>Node.js</a> and <a href=https://expressjs.com/ rel=external target=_blank>Express</a> to create a RESTful API on the backend that connects to a database, and then a <a href=https://vuejs.org/ rel=external target=_blank>Vue</a> single page application on the frontend.</p><p>In doing so, we&rsquo;ll explore some of the standard ways web developers use existing tools, frameworks, and libraries to perform many of the operations we&rsquo;ve learned how to do manually throughout this course. In essence, you&rsquo;ve already learned how to build these things <em>from scratch</em>, but now we&rsquo;ll look at how professionals use <em>dependencies</em> to accomplish many of the same things.</p><p>We&rsquo;ll also explore techniques for writing good, clean JavaScript code that includes documentation and API information, unit testing, and more.</p><p>Finally, we&rsquo;ll learn how to do all of this using <a href=https://github.com/features/codespaces rel=external target=_blank>GitHub Codespaces</a>, so everything runs directly in the web browser with no additional software or hardware needed. Of course, you can also do everything locally using <a href=https://www.docker.com/products/docker-desktop/ rel=external target=_blank>Docker Desktop</a> and <a href=https://code.visualstudio.com/ rel=external target=_blank>Visual Studio Code</a> as well.</p><h2 id=project-deliverables>Project Deliverables</h2><p>At the end of this example, we will have a project with the following features:</p><ol><li>A working GitHub Codespace containing Node.js</li><li>A bare-bones Express application</li><li>Update Express application from CommonJS to ES Modules</li><li>Application logs with Winston and Morgan</li><li>Install other useful Express libraries</li><li>A better development server using Nodemon</li><li>A tool for managing environment variables</li><li>Code documentation with JSDoc and OpenAPI comments</li><li>Linting and Formatting with ESLint and Prettier</li></ol><p>Let&rsquo;s get started!</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Express Starter Project</h1><article class=default><header class=headline></header><h1 id=github-codespace>GitHub Codespace</h1><a href="https://www.youtube.com/watch?v=id">YouTube Video</a><h2 id=creating-a-codespace>Creating a Codespace</h2><p>To begin, we will start with an empty GitHub repository. You can either create one yourself, or you may be working from a repository provided through GitHub Classroom.</p><p>At the top of the page, you may see either a <strong>Create a Codespace</strong> button in an empty repository, or a <strong>Code</strong> button that opens a panel with a <strong>Codespaces</strong> tab and a <strong>Create Codespace on main</strong> button in an initialized repository. Go ahead and click that button.</p><p><a href=#R-image-c7f982d6b6b4637ed1c169b2a4962982 class=lightbox-link><img alt="Codespace in Empty Repository" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/codespace_1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-c7f982d6b6b4637ed1c169b2a4962982><img alt="Codespace in Empty Repository" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/codespace_1.png></a></p><p><a href=#R-image-7ce9a80f41614c391368cb9431e79703 class=lightbox-link><img alt="Codespace in Initialized Repository" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/codespace_2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7ce9a80f41614c391368cb9431e79703><img alt="Codespace in Initialized Repository" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/codespace_2.png></a></p><p>Once you do, GitHub will start creating a new <a href=https://github.com/features/codespaces rel=external target=_blank>GitHub Codespace</a> for your project. This process may take a few moments.</p><p>Once it is done, you&rsquo;ll be presented with a window that looks very similar to Visual Studio Code&rsquo;s main interface. In fact - it is! It is just a version of Visual Studio Code running directly in a web browser. Pretty neat!</p><p>For the rest of this project, we&rsquo;ll do all of our work here in GitHub Codespaces directly in our web browser.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Working Locally?</div><div class=box-content><p>If you would rather do this work on your own computer, you&rsquo;ll need to install the following prerequisites:</p><ul><li><a href=https://code.visualstudio.com/ rel=external target=_blank>Visual Studio Code</a></li><li><a href=https://www.docker.com/products/docker-desktop/ rel=external target=_blank>Docker Desktop</a></li><li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers" rel=external target=_blank>Dev Containers Extension</a></li></ul><p>For now, you&rsquo;ll start by cloning your GitHub repository to your local computer, and opening it in Visual Studio Code. We&rsquo;ll create some configuration files, and then reopen the project using a Dev Container in Docker. When looking in the Command Palette, just swap the &ldquo;Codespaces&rdquo; prefix with the &ldquo;Dev Containers&rdquo; prefix in the command names.</p></div></div><p>Once you&rsquo;ve created your GitHub Codespace, you can always find it again by visiting the repository in your web browser, clicking the <strong>Code</strong> button and choosing the <strong>Codespaces</strong> tab.</p><p><a href=#R-image-6bc49d258e523198164ae756f2b87b1c class=lightbox-link><img alt="Existing Codespace" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/codespace_3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-6bc49d258e523198164ae756f2b87b1c><img alt="Existing Codespace" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/codespace_3.png></a></p><h2 id=configuring-the-codespace>Configuring the Codespace</h2><p>When we first create a GitHub Codespace, GitHub will use a <a href=https://docs.github.com/en/codespaces/setting-up-your-project-for-codespaces/adding-a-dev-container-configuration/introduction-to-dev-containers#using-the-default-dev-container-configuration rel=external target=_blank>default dev container</a> configuration. It includes many tools that are preinstalled for working on a wide variety of projects. Inside of the Codespace, you can run the following command in the terminal to get a URL that contains a list of all tools installed and their versions:</p><div class=tab-panel data-tab-group=21ea4b8437492a42c724985969e006c4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("21ea4b8437492a42c724985969e006c4","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ devcontainer-info content-url</span></span></code></pre></div></div></div></div></div><p>The current default configuration as of this writing can be found <a href=https://github.com/devcontainers/images/blob/main/src/universal/history/2.12.6.md rel=external target=_blank>here</a>.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Documenting Terminal Commands</div><div class=box-content><p>In these example projects, we&rsquo;ll prefix any terminal commands with a dollar sign <code>$</code> symbol, representing the standard Linux terminal command prompt. You <strong>should not</strong> enter this character into the terminal, just the content after it. This makes it easy to see individual commands in the documentation, and also makes it easy to tell the difference between commands to be executed and the output produced by that command.</p><p>You can learn more in the <a href=https://developers.google.com/style/code-syntax rel=external target=_blank>Google Developer Documentation Style Guide</a>.</p></div></div><p>For this project, we are going to configure our own <a href=https://containers.dev/ rel=external target=_blank>dev container</a> that just contains the tools we need for this project. This also allows us to use the same configuration both in GitHub Codespaces as well as locally on our own systems using Docker.</p><p>To configure our own dev container, we first must open the <a href=https://code.visualstudio.com/docs/getstarted/userinterface#_command-palette rel=external target=_blank>Visual Studio Code Command Palette</a>. We can do this by pressing <kbd>CTRL</kbd>+<kbd>SHIFT</kbd>+<kbd>P</kbd>, or by clicking the top search bar on the page and choosing <strong>Show and Run Commands ></strong>.</p><p>In the Command Palette, search for and choose the <strong>Codespaces: Add Dev Container Configuration Files&mldr;</strong> option, then choose <strong>Create a new configuration&mldr;</strong>. In the list that appears, search for &ldquo;node&rdquo; to find the container titled &ldquo;Node.js & TypeScript&rdquo; and choose that option.</p><p><a href=#R-image-9dd6628d2ee647733aef1c07f5a4a675 class=lightbox-link><img alt="Choosing a Dev Container Configuration" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/codespace_4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-9dd6628d2ee647733aef1c07f5a4a675><img alt="Choosing a Dev Container Configuration" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/codespace_4.png></a></p><p>You&rsquo;ll then be prompted to choose a version to use. We&rsquo;ll use <code>22-bookworm</code> for this project. That refers to <a href=https://nodejs.org/en/blog/release/v22.11.0 rel=external target=_blank>Node version 22 LTS</a> running on a <a href=https://www.debian.org/releases/bookworm/ rel=external target=_blank>Debian Bookworm LTS</a> Linux image. Both of these are current, long term supported (LTS) versions of the software, making them an excellent choice for a new project.</p><p>Finally, the last question will ask if we&rsquo;d like to add any additional features to our dev container configuration. We&rsquo;ll leave this blank for now, but in the future you may find some of these additional features useful and choose to add them here.</p><p>Once that is done, a <code>.devcontainer</code> folder will be created, with a <code>devcontainer.json</code> file inside of it. The content of that file should match what is shown below:</p><div class=tab-panel data-tab-group=e01a9e805cfe8428d7c021e7af884609><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=devcontainerdevcontainerjson class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e01a9e805cfe8428d7c021e7af884609","devcontainerdevcontainerjson")'>
<span class=tab-nav-text>.devcontainer/devcontainer.json</span></button></div><div class=tab-content-container><div data-tab-item=devcontainerdevcontainerjson class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// For format details, see https://aka.ms/devcontainer.json. For config options, see the
</span></span></span><span class=line><span class=cl><span class=c1>// README at: https://github.com/devcontainers/templates/tree/main/src/typescript-node
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;name&#34;</span><span class=o>:</span> <span class=s2>&#34;Node.js &amp; TypeScript&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Or use a Dockerfile or Docker Compose file. More info: https://containers.dev/guide/dockerfile
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=s2>&#34;image&#34;</span><span class=o>:</span> <span class=s2>&#34;mcr.microsoft.com/devcontainers/typescript-node:1-22-bookworm&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Features to add to the dev container. More info: https://containers.dev/features.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// &#34;features&#34;: {},
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=c1>// Use &#39;forwardPorts&#39; to make a list of ports inside the container available locally.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// &#34;forwardPorts&#34;: [],
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=c1>// Use &#39;postCreateCommand&#39; to run commands after the container is created.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// &#34;postCreateCommand&#34;: &#34;yarn install&#34;,
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=c1>// Configure tool-specific properties.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// &#34;customizations&#34;: {},
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=c1>// Uncomment to connect as root instead. More info: https://aka.ms/dev-containers-non-root.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// &#34;remoteUser&#34;: &#34;root&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Over time, we&rsquo;ll come back to this file to add additional features to our dev container. For now, we&rsquo;ll just leave it as-is.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Dependabot</div><div class=box-content><p>You may also see a second file, <code>.github/dependabot.yml</code> that is also created. This file is used by the <a href=https://docs.github.com/en/code-security/getting-started/dependabot-quickstart-guide rel=external target=_blank>GitHub Dependabot</a> to keep your dev container configuration up to date. You may get occasional notices from GitHub in the future if there are any updates to software included in your dev container configuration.</p></div></div><p>At this point, we are ready to rebuilt our GitHub Codespace to use our new dev container configuration. To do this, open the Command Palette once again and look for the <strong>Codespaces: Rebuild Container</strong> option. Click that option, then select the <strong>Full Rebuild</strong> option in the popup window since we have completely changed our dev container configuration.</p><p>Now, we can sit back and be patient while GitHub Codespaces rebuilds our environment using the new configuration. This may take several minutes.</p><p>Once it is complete, we can confirm that Node.js is installed and running the correct version by running the following command and checking the output matches our expected version of Node.js:</p><div class=tab-panel data-tab-group=332a0a71159dc58fffe5f828e652a635><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("332a0a71159dc58fffe5f828e652a635","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ node --version
</span></span><span class=line><span class=cl>v22.12.0</span></span></code></pre></div></div></div></div></div><p>If that works, then our dev container environment in GitHub Codespaces should be set up and ready to go!</p><p>Now is a good time to commit our current work to git and push it to GitHub. Even though we are working in a GitHub Codespace, we still have to <strong>commit and push</strong> our work to get it saved. You can do this using the Source Control sidebar tab on the page, or using the classic terminal commands as shown below.</p><div class=tab-panel data-tab-group=d65360a04a0640612d5441a9537da49a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d65360a04a0640612d5441a9537da49a","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ git add .
</span></span><span class=line><span class=cl>$ git commit -m <span class=s2>&#34;Dev Container&#34;</span>
</span></span><span class=line><span class=cl>$ git push -u origin main</span></span></code></pre></div></div></div></div></div><p>For the rest of this exercise, we&rsquo;ll assume that you are comfortable with git and GitHub and can take care of committing and pushing your work yourself, but we&rsquo;ll give you several hints showing when we hit a good opportunity to save your work.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=express-starter>Express Starter</h1><a href="https://www.youtube.com/watch?v=id">YouTube Video</a><h2 id=generating-an-express-application>Generating an Express Application</h2><p>Now that we have our dev container configured, we can start setting up an Express application. The recommended method in the documentation is to use the <a href=https://expressjs.com/en/starter/generator.html rel=external target=_blank>Express application generator</a>, so we&rsquo;ll use that method. You may want to refer to the documentation for this command to see what options are available.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Express Documentation</div><div class=box-content><p>You may also want to bookmark the <a href=https://expressjs.com/ rel=external target=_blank>Express Documentation</a> website as well, since it contains lots of helpful information about how Express works that may not be covered in this tutorial.</p></div></div><p>For this project, we&rsquo;ll use the following command to build our application:</p><div class=tab-panel data-tab-group=7d91316ff1b6563546a33a8c1b9994f8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("7d91316ff1b6563546a33a8c1b9994f8","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npx express-generator --no-view --git server</span></span></code></pre></div></div></div></div></div><p>Let&rsquo;s break down that command to see what it is doing:</p><ul><li><code>npx</code> - The [npx] command is included with Node.js and <code>npm</code> and allows us to run a command from an <code>npm</code> package, including packages that <em>aren&rsquo;t currently installed!</em>. This is the preferred way to run commands that are available in any <code>npm</code> packages.</li><li><code>express-generator</code> - This is the <a href=https://www.npmjs.com/package/express-generator rel=external target=_blank>express-generator</a> package in <code>npm</code> that contains the command we are using to build our Express application.</li><li><code>--no-view</code> - This option will generate a project without a built-in view engine.</li><li><code>--git</code> - This option will add a <code>.gitignore</code> file to our project</li><li><code>server</code> - This is the name of the directory where we would like to create our application.</li></ul><p>When we run that command, we may be prompted to install the <code>express-generator</code> package, so we can press <code>y</code> to install it.</p><p>That command will produce a large amount of output, similar to what is shown below:</p><div class=tab-panel data-tab-group=45ac2f31258a7c3a6c4ed52305e2a605><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("45ac2f31258a7c3a6c4ed52305e2a605","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>Need to install the following packages:
express-generator@4.16.1
Ok to proceed? (y) y

npm warn deprecated mkdirp@0.5.1: Legacy versions of mkdirp are no longer supported. Please update to mkdirp 1.x. (Note that the API surface has changed to use Promises in 1.x.)

   create : server/
   create : server/public/
   create : server/public/javascripts/
   create : server/public/images/
   create : server/public/stylesheets/
   create : server/public/stylesheets/style.css
   create : server/routes/
   create : server/routes/index.js
   create : server/routes/users.js
   create : server/public/index.html
   create : server/.gitignore
   create : server/app.js
   create : server/package.json
   create : server/bin/
   create : server/bin/www

   change directory:
     $ cd server

   install dependencies:
     $ npm install

   run the app:
     $ DEBUG=server:* npm start</code></pre></div></div></div></div></div><p>As we can see, it created quite a few files for us! Let&rsquo;s briefly review what each of these files and folders are for:</p><ul><li><code>public</code> - this folder contains the static HTML, CSS, and JavaScript files that will be served from our application. Much later down the road, we&rsquo;ll place the compiled version of our Vue frontend application in this folder. For now, it just serves as a placeholder for where those files will be placed.</li><li><code>routes</code> - this folder contains the Express application routers for our application. There are currently only two routers, the <code>index.js</code> router connected to the <code>/</code> path, and the <code>users.js</code> router connected to the <code>/users</code> path.</li><li><code>.gitignore</code> - this file tells git which files or folders can be ignored when committing to the repository. We&rsquo;ll discuss this file in detail below.</li><li><code>app.js</code> - this is the main file for our Express application. It loads all of the libraries, configurations, and routers and puts them all together into a single Express application.</li><li><code>package.json</code> - this file contains information about the project, including some metadata, scripts, and the list of external dependencies. More information on the structure and content of that file can be found in the <a href=https://docs.npmjs.com/cli/v11/configuring-npm/package-json rel=external target=_blank>documentation</a>.</li><li><code>bin/www</code> - this file is the actual entrypoint for our web application. It loads the Express application defined in <code>app.js</code>, and then creates an <code>http</code> server to listen for incoming connections and sends them to the Express application. It also handles figuring out which port the application should listen on, as well as some common errors.</li></ul><p>Since we are only building a RESTful API application, there are a few files that we can delete or quickly modify:</p><ul><li>Delete everything in the <code>public</code> folder <strong>except</strong> the file <code>index.html</code></li><li>Inside of the <code>public/index.html</code> file, remove the line referencing the stylesheet: <code>&lt;link rel="stylesheet" href="/stylesheets/style.css"></code> since it has been deleted.</li></ul><p>At this point, we should also update the contents of the <code>package.json</code> file to describe our project. It currently contains information similar to this:</p><div class=tab-panel data-tab-group=baeaed6245ba271f8ca48e9a0b89274d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=packagejson class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("baeaed6245ba271f8ca48e9a0b89274d","packagejson")'>
<span class=tab-nav-text>package.json</span></button></div><div class=tab-content-container><div data-tab-item=packagejson class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;server&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;private&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;node ./bin/www&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;cookie-parser&#34;</span><span class=p>:</span> <span class=s2>&#34;~1.4.4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;debug&#34;</span><span class=p>:</span> <span class=s2>&#34;~2.6.9&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;express&#34;</span><span class=p>:</span> <span class=s2>&#34;~4.16.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;morgan&#34;</span><span class=p>:</span> <span class=s2>&#34;~1.9.1&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>For now, let&rsquo;s update the <code>name</code> and <code>version</code> entries to match our project:</p><div class=tab-panel data-tab-group=7a6c3fea2f58ccdf7a330afc71ebe217><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=packagejson class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("7a6c3fea2f58ccdf7a330afc71ebe217","packagejson")'>
<span class=tab-nav-text>package.json</span></button></div><div class=tab-content-container><div data-tab-item=packagejson class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;example-project&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;private&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;node ./bin/www&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;cookie-parser&#34;</span><span class=p>:</span> <span class=s2>&#34;~1.4.4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;debug&#34;</span><span class=p>:</span> <span class=s2>&#34;~2.6.9&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;express&#34;</span><span class=p>:</span> <span class=s2>&#34;~4.16.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;morgan&#34;</span><span class=p>:</span> <span class=s2>&#34;~1.9.1&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>In a stand-alone application like ours, these values really don&rsquo;t matter, but if we do decide to publish this application as an <code>npm</code> module in the future, these values will be used to build the module itself.</p><h2 id=exploring-appjs>Exploring App.js</h2><p>Let&rsquo;s quickly take a look at the contents of the <code>app.js</code> file to get an idea of what this application does:</p><div class=tab-panel data-tab-group=2e8d7401866232e986451fa3805da693><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=appjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2e8d7401866232e986451fa3805da693","appjs")'>
<span class=tab-nav-text>app.js</span></button></div><div class=tab-content-container><div data-tab-item=appjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>path</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>cookieParser</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;cookie-parser&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>logger</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;morgan&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>indexRouter</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./routes/index&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>usersRouter</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./routes/users&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>logger</span><span class=p>(</span><span class=s1>&#39;dev&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>urlencoded</span><span class=p>({</span> <span class=nx>extended</span><span class=o>:</span> <span class=kc>false</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>cookieParser</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=kr>static</span><span class=p>(</span><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s1>&#39;public&#39;</span><span class=p>)));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=nx>indexRouter</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/users&#39;</span><span class=p>,</span> <span class=nx>usersRouter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>app</span><span class=p>;</span></span></span></code></pre></div></div></div></div></div><p>At the top, the file loads several libraries, including <a href=https://www.npmjs.com/package/cookie-parser rel=external target=_blank>cookie-parser</a> for parsing cookies sent from the browser, and <a href=https://www.npmjs.com/package/morgan rel=external target=_blank>morgan</a> for logging requests. It then also loads the two routers, <code>index</code> and <code>users</code>.</p><p>Next, we see the line <code>var app = express()</code> - this line actually creates the Express application and stores a reference to it in the <code>app</code> variable.</p><p>The next few lines add various middlewares to the Express application using the <code>app.use()</code> function. Each of these is effectively a function that is called each time the application receives a request, one after the other, until a response is generated and sent. See <a href=https://expressjs.com/en/guide/using-middleware.html rel=external target=_blank>Using middleware</a> in the Express documentation for more details.</p><p>The last line of that group uses the <code>express.static</code> middleware to serve static files from the <code>public</code> directory (it uses the <code>path</code> library and the <code>__dirname</code> global variable to construct the correct absolute path to those files). So, if the user requests any path that matches a static file, that file will be sent to the user. This will happen even if a static file matches an existing route, since this middleware is added to the application before the routes. So, there are some instances where we may want to connect this middleware to the application <em>after</em> adding some important routes - we&rsquo;ll discuss that in the future as we continue to build this application.</p><p>After that, the two routers are added as well. Each router is given a base path - the <code>index</code> router is given the <code>/</code> path, then the <code>users</code> router is given the <code>/users</code> path. These are the URL paths that are used to determine where each incoming request should be sent in the application. See <a href=https://expressjs.com/en/guide/routing.html rel=external target=_blank>routing</a> in the Express documentation for more details.</p><p>Finally, the Express application referenced in <code>app</code> is exported from this file. It is used by the <code>bin/www</code> file and attached to an <code>http</code> server to listen for incoming requests.</p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Order Matters</div><div class=box-content><p>Because Express is a routing and middleware framework, the order in which you add middlewares and routers determines how the application functions. So, we must be very thoughtful about the order in which we add middlewares and routers to our application. In this example, notice, that we add the logger first, then parse any incoming JSON requests, then decode any URL encoded requests, then parse any cookies, before doing anything else.</p><p>This is a common error that trips up many first-time Express developers, so be mindful as you add and adjust content in this file!</p></div></div><h2 id=installing-dependencies>Installing Dependencies</h2><p>Now that we&rsquo;ve generated a basic Express web application, we need to install all of the dependencies. This is also the first step we&rsquo;ll need to do anytime we clone this project for the first time or if we rebuild our GitHub codespace or dev container.</p><p>To do this, we need to go to the terminal and change directory to the <code>server</code> folder:</p><div class=tab-panel data-tab-group=6bf28b04eefd1209233e1a4266786b19><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6bf28b04eefd1209233e1a4266786b19","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> server</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Working Directory</div><div class=box-content><p>Remember that we can always see the current working directory by looking at the command prompt in the terminal, or by typing the <code>pwd</code> command:</p><p><a href=#R-image-a6bced81dcc3519108e3a5399b87c4b5 class=lightbox-link><img alt="Working Directory in Terminal" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/express_1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a6bced81dcc3519108e3a5399b87c4b5><img alt="Working Directory in Terminal" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/express_1.png></a></p><p><a href=#R-image-7325bd561f0a93a12f225b48cc25c7ea class=lightbox-link><img alt="Present Working Directory" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/express_2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7325bd561f0a93a12f225b48cc25c7ea><img alt="Present Working Directory" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/express_2.png></a></p></div></div><p>Once inside of the <code>server</code> folder, we can install all our dependencies using the following command:</p><div class=tab-panel data-tab-group=a3205d6df4ed9f8f0a91b4ae0851339d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a3205d6df4ed9f8f0a91b4ae0851339d","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm install</span></span></code></pre></div></div></div></div></div><p>When we run that command, we&rsquo;ll see output similar to the following:</p><div class=tab-panel data-tab-group=229701099ab66f739bd4aa0e8897bbc0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("229701099ab66f739bd4aa0e8897bbc0","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>added 53 packages, and audited 54 packages in 4s

7 vulnerabilities (3 low, 4 high)

To address all issues, run:
  npm audit fix --force

Run `npm audit` for details.</code></pre></div></div></div></div></div><p>It looks like we have some out of date packages and vulnerabilities to fix!</p><h2 id=updating-dependencies>Updating Dependencies</h2><p>Thankfully, there is a very useful command called <a href=https://www.npmjs.com/package/npm-check-updates rel=external target=_blank>npm-check-updates</a> that we can use to update our dependencies anytime there is a problem. We can run that package&rsquo;s command using <code>npx</code> as we saw earlier:</p><div class=tab-panel data-tab-group=9618381f54e05dd40bf6fb44e577d749><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9618381f54e05dd40bf6fb44e577d749","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npx npm-check-updates</span></span></code></pre></div></div></div></div></div><p>As before, we&rsquo;ll be prompted to install the package if it isn&rsquo;t installed already. Once it is done, we&rsquo;ll see output like this:</p><div class=tab-panel data-tab-group=467689df1e89699a3786b491233d5760><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("467689df1e89699a3786b491233d5760","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>Need to install the following packages:
npm-check-updates@17.1.14
Ok to proceed? (y) y

Checking /workspaces/example-project/server/package.json
[====================] 4/4 100%

 cookie-parser   ~1.4.4  →   ~1.4.7
 debug           ~2.6.9  →   ~4.4.0
 express        ~4.16.1  →  ~4.21.2
 morgan          ~1.9.1  →  ~1.10.0

Run npx npm-check-updates -u to upgrade package.json</code></pre></div></div></div></div></div><p>When we run the command, it tells us which packages are out of date and lists a newer version of the package we can install.</p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Tread Carefully!</div><div class=box-content><p>In an actual production application, it is important to make sure your dependencies are kept up to date. At the same time, you&rsquo;ll want to carefully read the documentation for these dependencies and test your project after any dependency updates, just to ensure that your application works correctly using the new versions.</p><p>For example, in the output above, we see this:</p><div class=highlight><pre tabindex=0><code> debug           ~2.6.9  →   ~4.4.0</code></pre></div><p>This means that the <code>debug</code> library is <strong>two major versions</strong> out of date (see <a href=https://semver.org/ rel=external target=_blank>Semantic Versioning</a> for more information on how to interpret version numbers)! If we check the <a href="https://www.npmjs.com/package/debug?activeTab=versions" rel=external target=_blank><code>debug</code> versions list</a> on npm, we can see that version <code>2.6.9</code> was released in September 2017 - a very long time ago.</p><p>When a package undergoes a major version change, it often comes with incompatible API changes. So, we may want to consult the documentation for each major version or find release notes or upgrade guides to refer to. In this case, we can refer to the release notes for each version on GitHub:</p><ul><li>3.0.0: <a href=https://github.com/debug-js/debug/releases/tag/3.0.0 rel=external target=_blank>https://github.com/debug-js/debug/releases/tag/3.0.0</a></li><li>4.0.0: <a href=https://github.com/debug-js/debug/releases/tag/4.0.0 rel=external target=_blank>https://github.com/debug-js/debug/releases/tag/4.0.0</a></li></ul><p>We may even need to check some of the release notes for minor releases as well.</p><p>Thankfully, the latest version of the <code>debug</code> library is compatible with our existing code, and later in this project we&rsquo;ll replace it with a better logging infrastructure anyway.</p></div></div><p>Now that we know which dependencies can be updated, we can use the same command with the <code>-u</code> option to update our <code>package.json</code> file easily:</p><div class=tab-panel data-tab-group=33178cd28dd1bbfb4ca85bcb1cd5bdda><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("33178cd28dd1bbfb4ca85bcb1cd5bdda","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npx npm-check-updates -u</span></span></code></pre></div></div></div></div></div><p>We should see output similar to this:</p><div class=tab-panel data-tab-group=91654357bcc95c64a415740174a99c55><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("91654357bcc95c64a415740174a99c55","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>Upgrading /workspaces/example-project/server/package.json
[====================] 4/4 100%

 cookie-parser   ~1.4.4  →   ~1.4.7
 debug           ~2.6.9  →   ~4.4.0
 express        ~4.16.1  →  ~4.21.2
 morgan          ~1.9.1  →  ~1.10.0

Run npm install to install new versions.</code></pre></div></div></div></div></div><p>We can also check our <code>package.json</code> file to see the changes:</p><div class=tab-panel data-tab-group=f608b16c0ff09b5fdf1ab4d5d7e5af69><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=packagejson class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f608b16c0ff09b5fdf1ab4d5d7e5af69","packagejson")'>
<span class=tab-nav-text>package.json</span></button></div><div class=tab-content-container><div data-tab-item=packagejson class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;example-project&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;private&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;node ./bin/www&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;cookie-parser&#34;</span><span class=p>:</span> <span class=s2>&#34;~1.4.7&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;debug&#34;</span><span class=p>:</span> <span class=s2>&#34;~4.4.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;express&#34;</span><span class=p>:</span> <span class=s2>&#34;~4.21.2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;morgan&#34;</span><span class=p>:</span> <span class=s2>&#34;~1.10.0&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Finally, we can install those dependencies:</p><div class=tab-panel data-tab-group=59a8f94c273644633df7dc3b0842b708><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("59a8f94c273644633df7dc3b0842b708","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm install</span></span></code></pre></div></div></div></div></div><p>Now when we run that command, we should see that everything is up to date!</p><div class=tab-panel data-tab-group=ea163f5932ba5e6b56258bb1faa83090><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ea163f5932ba5e6b56258bb1faa83090","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>added 36 packages, changed 24 packages, and audited 90 packages in 4s

14 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities</code></pre></div></div></div></div></div><p>There we go! We now have a sample Express application configured with updated dependencies.</p><h2 id=testing-the-application>Testing the Application</h2><p>At this point, we are ready to actually test our application. To do this, we can run the following command from within the <code>server</code> directory in our project:</p><div class=tab-panel data-tab-group=c3f83cfd2a3e0c21c48fa299e1b7740a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c3f83cfd2a3e0c21c48fa299e1b7740a","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm start</span></span></code></pre></div></div></div></div></div><p>When we do, we&rsquo;ll see a bit of information on the terminal:</p><div class=tab-panel data-tab-group=3526789c451801f2ababea2d55429093><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("3526789c451801f2ababea2d55429093","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>&gt; example-project@0.0.1 start
&gt; node ./bin/www</code></pre></div></div></div></div></div><p>We&rsquo;ll also see a small popup in the bottom right corner of the screen, telling us that it has detected that our application is listening on port <code>3000</code>.</p><p><a href=#R-image-dc33fa1e573d1300739de471b4e6c7ac class=lightbox-link><img alt="Listening Port Popup" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/express_3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-dc33fa1e573d1300739de471b4e6c7ac><img alt="Listening Port Popup" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/express_3.png></a></p><p>So, to access our application, we can click on the <strong>Open in Browser</strong> button on that popup. If everything works correctly, we should be able to see our application running in our web browser:</p><p><a href=#R-image-dbc80699fa5600f6488dc83133d6d436 class=lightbox-link><img alt="Running Example Application" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/express_4.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-dbc80699fa5600f6488dc83133d6d436><img alt="Running Example Application" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/express_4.png></a></p><p>Take a look at the long URL in the browser - that URL includes the name of the GitHub Codespace (<code>laughing-computing-machine</code> in this example), followed by a random Codespace ID (<code>jj5j9p97vx435jqj</code>), followed by the port our application is listening on (<code>3000</code>). We&rsquo;ll look at ways we can build this URL inside of our application in the future, but for now it is just worth noting.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Finding Listening Ports</div><div class=box-content><p>If you didn&rsquo;t see the popup appear, or you cannot find where your application is running, check the <strong>PORTS</strong> tab above the console in GitHub Codespaces:</p><p><a href=#R-image-d99cd9bbacb74b7422e46b466c8ce203 class=lightbox-link><img alt="Listening Port List" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/express_5.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d99cd9bbacb74b7422e46b466c8ce203><img alt="Listening Port List" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/express_5.png></a></p><p>We can click on the URL under the <strong>Forwarded Addresses</strong> heading to access the port in our web browser. We can also use this interface to configure additional ports that we want to be able to access outside of the GitHub Codespace.</p></div></div><p>We can also access any routes that are configured in our application. For example, the default Express application includes a <code>/users</code> route, so we can just add <code>/users</code> to the end of the URL in our web browser to access it. We should see this page when we do:</p><p><a href=#R-image-bc413ccf8eb658483327eb6b6044ad17 class=lightbox-link><img alt="Running Example Users Path" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/express_6.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-bc413ccf8eb658483327eb6b6044ad17><img alt="Running Example Users Path" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/express_6.png></a></p><p>Great! It looks like our example application in running correctly.</p><h2 id=committing-to-github>Committing to GitHub</h2><p>Now is a great time to commit and push our project to GitHub. Before we do, however, we should double-check that our project has a proper <code>server/.gitignore</code> file. It should have been created by the Express application generator if we used the <code>--git</code> option, but it is always important to double-check that it is there before trying to commit a new project.</p><p><a href=#R-image-f22768484ec5aca43a6364af5ea33933 class=lightbox-link><img alt="Gitignore File" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/express_7.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-f22768484ec5aca43a6364af5ea33933><img alt="Gitignore File" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/express_7.png></a></p><p>A <a href=https://docs.github.com/en/get-started/getting-started-with-git/ignoring-files rel=external target=_blank>.gitignore</a> file is used to tell git which files should not be committed to a repository. For a project using Node.js, we especially don&rsquo;t want to commit our <code>node_modules</code> folder. This folder contains all of the dependencies for our project, and can often be very large.</p><p>Why don&rsquo;t we want to commit it? Because it contains lots of code that isn&rsquo;t ours, and it is much better to just install the dependencies locally whenever we develop or use our application. That is the whole function of the <code>package.json</code> file and the <code>npm</code> command - it lets us focus on only developing our own code, and it will find and manage all other external dependencies for us.</p><p>So, as a general rule of thumb, we should <strong>NEVER</strong> commit the <code>node_modules</code> folder to our repository.</p><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Missing gitignore file?</div><div class=box-content><p>If your project does not have a <code>.gitignore</code> file, you can usually find one for the language or framework you are using in the excellent <a href=https://github.com/github/gitignore rel=external target=_blank>gitignore GitHub Repository</a>. Just look for the appropriate file and add the contents to a <code>.gitignore</code> file in your project. For example, you can find a <a href=https://github.com/github/gitignore/blob/main/Node.gitignore rel=external target=_blank>Node.gitignore</a> file to use in this project.</p></div></div><p>At long last, we are ready to <strong>commit and push</strong> all of our changes to this project. If it works correctly, it should only commit the code files we&rsquo;ve created, but none of the files that are ignored in the <code>.gitignore</code> file.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=convert-to-es-modules>Convert to ES Modules</h1><a href="https://www.youtube.com/watch?v=id">YouTube Video</a><h2 id=commonjs-vs-es-modules>CommonJS vs ES Modules</h2><p>By default, the Express application generator creates an application using the <a href=https://nodejs.org/api/modules.html#modules-commonjs-modules rel=external target=_blank>CommonJS module format</a>. This is the original way that JavaScript modules were packaged. However, many libraries and frameworks have been moving to the new <a href=https://nodejs.org/api/esm.html rel=external target=_blank>ECMAScript module format</a> (commonly referred to as ES modules), which is current official standard way of packaging JavaScript modules.</p><p>Since we want to build an industry-grade application, it would be best to update our application to use the new ES module format. This format will become more and more common over time, and many dependencies on npm have already started to shift to only supporting the ES module format. So, let&rsquo;s take the time now to update our application to use that new format before we go any further.</p><h2 id=enabling-es-module-support>Enabling ES Module Support</h2><p>To enable ES module support in our application, we must simply add <code>"type": "module",</code> to the <code>package.json</code> file:</p><div class=tab-panel data-tab-group=b873455fbccc7f71609f3c10c3822315><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=packagejson class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("b873455fbccc7f71609f3c10c3822315","packagejson")'>
<span class=tab-nav-text>package.json</span></button></div><div class=tab-content-container><div data-tab-item=packagejson class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;example-project&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.1&#34;</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;module&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;private&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;node ./bin/www&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;cookie-parser&#34;</span><span class=p>:</span> <span class=s2>&#34;~1.4.7&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;debug&#34;</span><span class=p>:</span> <span class=s2>&#34;~4.4.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;express&#34;</span><span class=p>:</span> <span class=s2>&#34;~4.21.2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;morgan&#34;</span><span class=p>:</span> <span class=s2>&#34;~1.10.0&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Now, let&rsquo;s try to run our application:</p><div class=tab-panel data-tab-group=1524290c252884dd357e9e12c115a8ca><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("1524290c252884dd357e9e12c115a8ca","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm start</span></span></code></pre></div></div></div></div></div><p>When we do, we&rsquo;ll get some errors:</p><div class=tab-panel data-tab-group=c1a1ba0d7b2241969190635094e4a8d2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c1a1ba0d7b2241969190635094e4a8d2","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>&gt; example-project@0.0.1 start
&gt; node ./bin/www

file:///workspaces/example-project/server/bin/www:7
var app = require(&#39;../app&#39;);
          ^

ReferenceError: require is not defined in ES module scope, you can use import instead
    at file:///workspaces/example-project/server/bin/www:7:11
    at ModuleJob.run (node:internal/modules/esm/module_job:271:25)
    at async onImport.tracePromise.__proto__ (node:internal/modules/esm/loader:547:26)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5)

Node.js v22.12.0</code></pre></div></div></div></div></div><p>By changing that one line in <code>package.json</code>, the Node.js runtime is trying to load our project using ES modules instead of CommonJS modules, and it causes all sorts of errors. Thankfully, most of them are easy to fix! In most cases, we are simply making two updates:</p><ol><li>Replacing <code>require</code> statements with <code>import</code> statements</li><li>Replacing <code>module.exports</code> statements with <code>export default</code> statements.</li></ol><p>Let&rsquo;s go file by file and make these updates. We&rsquo;ll only show the lines that are commented out and their replacements directly below - you&rsquo;ll need to look carefully at each file, find the commented line, and replace it with the new line.</p><ul><li><code>bin/www</code></li></ul><div class=tab-panel data-tab-group=5781c8698d433ff1816fbd37385259e0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=binwww class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5781c8698d433ff1816fbd37385259e0","binwww")'>
<span class=tab-nav-text>bin/www</span></button></div><div class=tab-content-container><div data-tab-item=binwww class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// var app = require(&#39;../app&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>app</span> <span class=nx>from</span> <span class=s1>&#39;../app.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// var debug = require(&#39;debug&#39;)(&#39;server:server&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>debugLibrary</span> <span class=nx>from</span> <span class=s1>&#39;debug&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>debug</span> <span class=o>=</span> <span class=nx>debugLibrary</span><span class=p>(</span><span class=s1>&#39;server:server&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// var http = require(&#39;http&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>http</span> <span class=nx>from</span> <span class=s1>&#39;http&#39;</span><span class=p>;</span></span></span></code></pre></div></div></div></div></div><ul><li><code>app.js</code></li></ul><div class=tab-panel data-tab-group=190c7535b44b271757aa0d2d31683b95><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=appjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("190c7535b44b271757aa0d2d31683b95","appjs")'>
<span class=tab-nav-text>app.js</span></button></div><div class=tab-content-container><div data-tab-item=appjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// var express = require(&#39;express&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>express</span> <span class=nx>from</span> <span class=s1>&#39;express&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// var path = require(&#39;path&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>path</span> <span class=nx>from</span> <span class=s1>&#39;path&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// var cookieParser = require(&#39;cookie-parser&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>cookieParser</span> <span class=nx>from</span> <span class=s1>&#39;cookie-parser&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// var logger = require(&#39;morgan&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>logger</span> <span class=nx>from</span> <span class=s1>&#39;morgan&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// var indexRouter = require(&#39;./routes/index&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>indexRouter</span> <span class=nx>from</span> <span class=s1>&#39;./routes/index.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// var usersRouter = require(&#39;./routes/users&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>usersRouter</span> <span class=nx>from</span> <span class=s1>&#39;./routes/users.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>//module.exports = app;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=k>default</span> <span class=nx>app</span><span class=p>;</span></span></span></code></pre></div></div></div></div></div><ul><li><code>routes/index.js</code> and <code>routes/users.js</code></li></ul><div class=tab-panel data-tab-group=6cac72e11b79501b4dcce56ff0024097><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=routesindexjs-amp-routesusersjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6cac72e11b79501b4dcce56ff0024097","routesindexjs-amp-routesusersjs")'>
<span class=tab-nav-text>routes/index.js & routes/users.js</span></button></div><div class=tab-content-container><div data-tab-item=routesindexjs-amp-routesusersjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// var express = require(&#39;express&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>express</span> <span class=nx>from</span> <span class=s1>&#39;express&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// var router = express.Router();
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>express</span><span class=p>.</span><span class=nx>Router</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// module.exports = router;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=k>default</span> <span class=nx>router</span><span class=p>;</span></span></span></code></pre></div></div></div></div></div><p>At this point, let&rsquo;s test our application again to see if we&rsquo;ve updated everything correctly:</p><div class=tab-panel data-tab-group=39dfbd590f2c7608f70eb392b59ad464><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("39dfbd590f2c7608f70eb392b59ad464","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm start</span></span></code></pre></div></div></div></div></div><p>Now, we should get an error message similar to this:</p><div class=tab-panel data-tab-group=21ab9f9989c2da90f4cb51e953d538fc><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("21ab9f9989c2da90f4cb51e953d538fc","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>file:///workspaces/example-project/server/app.js:25
app.use(express.static(path.join(__dirname, &#39;public&#39;)));
                                 ^

ReferenceError: __dirname is not defined in ES module scope
    at file:///workspaces/example-project/server/app.js:25:34
    at ModuleJob.run (node:internal/modules/esm/module_job:271:25)
    at async onImport.tracePromise.__proto__ (node:internal/modules/esm/loader:547:26)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5)

Node.js v22.12.0</code></pre></div></div></div></div></div><p>This is a bit trickier to debug, but a quick Google search usually leads to the correct answer. In this case, the <code>__dirname</code> variable is a global variable that is defined when Node.js is running a CommonJS module, as discussed in the <a href=https://nodejs.org/docs/latest/api/modules.html#__dirname rel=external target=_blank>documentation</a>. However, when Node.js is running an ES module, many of these global variables have been relocated to the <code>import.meta</code> property, as shown in the <a href=https://nodejs.org/api/esm.html#importmetadirname rel=external target=_blank>documentation</a>. So, we can just replace <code>__dirname</code> with the <code>import.meta.dirname</code> variable in <code>app.js</code>:</p><div class=tab-panel data-tab-group=48fb324befc54c4e3d273ebb408ed7ca><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=appjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("48fb324befc54c4e3d273ebb408ed7ca","appjs")'>
<span class=tab-nav-text>app.js</span></button></div><div class=tab-content-container><div data-tab-item=appjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>//app.use(express.static(path.join(__dirname, &#39;public&#39;)));
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=kr>static</span><span class=p>(</span><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=kr>import</span><span class=p>.</span><span class=nx>meta</span><span class=p>.</span><span class=nx>dirname</span><span class=p>,</span> <span class=s1>&#39;public&#39;</span><span class=p>)));</span></span></span></code></pre></div></div></div></div></div><p>Let&rsquo;s try to run our application again - it should be able to start this time:</p><div class=tab-panel data-tab-group=9241137b93ffd2cb3722632e38e5e5d4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9241137b93ffd2cb3722632e38e5e5d4","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm start</span></span></code></pre></div></div></div></div></div><p>Updating a Node.js application to use ES modules is not terribly difficult, especially if it is done early in development. However, since we&rsquo;ve made this change, we&rsquo;ll have to be careful as we continue to develop our application. Many online tutorials, documentation, and references assume that any Node.js and Express application is still using CommonJS modules, so we may have to translate any code we find to match our new ES module setup.</p><p>This is a good point to <strong>commit and push</strong> our work!</p><h2 id=references>References</h2><ul><li><a href=https://electerious.medium.com/from-commonjs-to-es-modules-how-to-modernize-your-node-js-app-ad8cdd4fb662 rel=external target=_blank>From CommonJS to ES Modules: How to modernize your Node.js app</a></li></ul><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=debugging--logging>Debugging & Logging</h1><a href="https://www.youtube.com/watch?v=id">YouTube Video</a><h2 id=debugging-with-the-debug-utility>Debugging with the Debug Utility</h2><p>Now that we have a basic Express application, let&rsquo;s add some helpful tools for developers to make our application easier to work with and debug in the future. These are some great quality of life tweaks that many professional web applications include, but often new developers fail to add them early on in development and waste lots of time adding them later. So, let&rsquo;s take some time now to add these features before we start developing any actual RESTful endpoints.</p><p>First, you may have noticed that the <code>bin/www</code> file includes the <a href=https://www.npmjs.com/package/debug rel=external target=_blank>debug</a> utility. This is a very common debugging module that is included in many Node.sj applications, and is modeled after how Node.js itself handles debugging internally. It is a very powerful module, and one that you should make use of anytime you are creating a Node.js library to be published on npm and shared with others.</p><p>Let&rsquo;s quickly look at how we can use the <code>debug</code> utility in our application. Right now, when we start our application, we see very little output on the terminal:</p><div class=tab-panel data-tab-group=373b94519302532a8b31a79d05aad476><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("373b94519302532a8b31a79d05aad476","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm start</span></span></code></pre></div></div></div></div></div><p>That command produces this output:</p><div class=tab-panel data-tab-group=3f4e13dbbd129ad31273047bb3a46b8d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("3f4e13dbbd129ad31273047bb3a46b8d","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>&gt; example-project@0.0.1 start
&gt; node ./bin/www</code></pre></div></div></div></div></div><p>As we access various pages and routes, we may see some additional lines of output appear, like this:</p><div class=tab-panel data-tab-group=4f0001e41a217b4e528af652fa2d77c5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4f0001e41a217b4e528af652fa2d77c5","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>GET / 304 2.569 ms - -
GET /users 200 2.417 ms - 23
GET / 200 1.739 ms - 120</code></pre></div></div></div></div></div><p>These lines come from the <a href=https://www.npmjs.com/package/morgan rel=external target=_blank>morgan</a> request logging middleware, which we&rsquo;ll discuss on the next page of this example.</p><p>To enable the <code>debug</code> library, we simply must set an environment variable in the terminal when we run our application, as shown here:</p><div class=tab-panel data-tab-group=e627f52f0db977b5628d0c6ef371cd24><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e627f52f0db977b5628d0c6ef371cd24","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nv>DEBUG</span><span class=o>=</span>* npm start</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Environment Variables</div><div class=box-content><p>An <a href=https://en.wikipedia.org/wiki/Environment_variable rel=external target=_blank><strong>environment variable</strong></a> is a value that is present in memory in a running instance of an operating system. These generally give running processes information about the system, but may also include data and information provided by the user or system administrator. Environment variables are very common ways to configure applications that run in containers, like our application will when it is finally deployed. We&rsquo;ll cover this in detail later in this course; for now, just understand that we are setting a variable in memory that can be accessed inside of our application.</p></div></div><p>Now, we&rsquo;ll be provided with a lot of debugging output from all throughout our application:</p><div class=tab-panel data-tab-group=d62d88e4e837d4f7210f1ae8e1fa87d2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d62d88e4e837d4f7210f1ae8e1fa87d2","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>&gt; example-project@0.0.1 start
&gt; node ./bin/www

  express:router:route new &#39;/&#39; +0ms
  express:router:layer new &#39;/&#39; +1ms
  express:router:route get &#39;/&#39; +0ms
  express:router:layer new &#39;/&#39; +1ms
  express:router:route new &#39;/&#39; +0ms
  express:router:layer new &#39;/&#39; +0ms
  express:router:route get &#39;/&#39; +0ms
  express:router:layer new &#39;/&#39; +0ms
  express:application set &#34;x-powered-by&#34; to true +1ms
  express:application set &#34;etag&#34; to &#39;weak&#39; +0ms
  express:application set &#34;etag fn&#34; to [Function: generateETag] +0ms
  express:application set &#34;env&#34; to &#39;development&#39; +0ms
  express:application set &#34;query parser&#34; to &#39;extended&#39; +0ms
  express:application set &#34;query parser fn&#34; to [Function: parseExtendedQueryString] +0ms
  express:application set &#34;subdomain offset&#34; to 2 +0ms
  express:application set &#34;trust proxy&#34; to false +0ms
  express:application set &#34;trust proxy fn&#34; to [Function: trustNone] +1ms
  express:application booting in development mode +0ms
  express:application set &#34;view&#34; to [Function: View] +0ms
  express:application set &#34;views&#34; to &#39;/workspaces/example-project/server/views&#39; +0ms
  express:application set &#34;jsonp callback name&#34; to &#39;callback&#39; +0ms
  express:router use &#39;/&#39; query +1ms
  express:router:layer new &#39;/&#39; +0ms
  express:router use &#39;/&#39; expressInit +0ms
  express:router:layer new &#39;/&#39; +0ms
  express:router use &#39;/&#39; logger +0ms
  express:router:layer new &#39;/&#39; +0ms
  express:router use &#39;/&#39; jsonParser +0ms
  express:router:layer new &#39;/&#39; +0ms
  express:router use &#39;/&#39; urlencodedParser +1ms
  express:router:layer new &#39;/&#39; +0ms
  express:router use &#39;/&#39; cookieParser +0ms
  express:router:layer new &#39;/&#39; +0ms
  express:router use &#39;/&#39; serveStatic +0ms
  express:router:layer new &#39;/&#39; +0ms
  express:router use &#39;/&#39; router +0ms
  express:router:layer new &#39;/&#39; +1ms
  express:router use &#39;/users&#39; router +0ms
  express:router:layer new &#39;/users&#39; +0ms
  express:application set &#34;port&#34; to 3000 +2ms
  server:server Listening on port 3000 +0ms</code></pre></div></div></div></div></div><p>Each line of output starts with a package name, such as <code>express:application</code> showing the <em>namespace</em> where the logging message came from (which usually corresponds to the library or module it is contained in), followed by the message itself. The last part of the line looks like <code>+0ms</code>, and is simply a timestamp showing the time elapsed since the last debug message was printed.</p><p>At the very bottom we see the debug line <code>server:server Listening on port 3000 +0ms</code> - this line is what is actually printed in the <code>bin/www</code> file. Let&rsquo;s look at that file and see where that comes from:</p><div class=tab-panel data-tab-group=af85ebb783889c02f14047602b547305><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=binwww class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("af85ebb783889c02f14047602b547305","binwww")'>
<span class=tab-nav-text>bin/www</span></button></div><div class=tab-content-container><div data-tab-item=binwww class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>debugLibrary</span> <span class=nx>from</span> <span class=s1>&#39;debug&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>debug</span> <span class=o>=</span> <span class=nx>debugLibrary</span><span class=p>(</span><span class=s1>&#39;server:server&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>onListening</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>addr</span> <span class=o>=</span> <span class=nx>server</span><span class=p>.</span><span class=nx>address</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>bind</span> <span class=o>=</span> <span class=k>typeof</span> <span class=nx>addr</span> <span class=o>===</span> <span class=s1>&#39;string&#39;</span>
</span></span><span class=line><span class=cl>    <span class=o>?</span> <span class=s1>&#39;pipe &#39;</span> <span class=o>+</span> <span class=nx>addr</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=s1>&#39;port &#39;</span> <span class=o>+</span> <span class=nx>addr</span><span class=p>.</span><span class=nx>port</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>debug</span><span class=p>(</span><span class=s1>&#39;Listening on &#39;</span> <span class=o>+</span> <span class=nx>bind</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>At the top of that file, we import the <code>debug</code> library, and then instantiate it using the name <code>'server:server'</code>. This becomes the <em>namespace</em> for our debug messages printed using this instance of the <code>debug</code> library. Then, inside of the <code>onListening()</code> function, we call the <code>debug</code> function and provide a message to be printed.</p><p>When we run our application, we can change the value of the <code>DEBUG</code> environment variable to match a particular namespace to only see messages from that part of our application:</p><div class=tab-panel data-tab-group=742642bbb53fe3806d8e14cf8644bb8b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("742642bbb53fe3806d8e14cf8644bb8b","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ $ <span class=nv>DEBUG</span><span class=o>=</span>server:* npm start</span></span></code></pre></div></div></div></div></div><p>This will only show output from our <code>server</code> namespace:</p><div class=tab-panel data-tab-group=56359867665065f23f39ac178139d002><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("56359867665065f23f39ac178139d002","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; example-project@0.0.1 start
</span></span><span class=line><span class=cl>&gt; node ./bin/www
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  server:server Listening on port <span class=m>3000</span> +0ms</span></span></code></pre></div></div></div></div></div><p>The <code>debug</code> utility is a very powerful tool for diagnosing issues with a Node.js and Express application. You can learn more about how to use and configure the <code>debug</code> utility in the <a href=https://www.npmjs.com/package/debug rel=external target=_blank>documentation</a>.</p><h2 id=logging-with-winston>Logging with Winston</h2><p>However, since we are focused on creating a web application and not a library, let&rsquo;s replace <code>debug</code> with the more powerful <a href=https://www.npmjs.com/package/winston rel=external target=_blank>winston</a> logger. This allows us to create a robust logging system based on the traditional concept of <a href=https://en.wikipedia.org/wiki/Syslog#Severity_level rel=external target=_blank>severity levels</a> of the logs we want to see.</p><p>To start, let&rsquo;s install <code>winston</code> using the <code>npm</code> command (as always, we should make sure we are working in the <code>server</code> directory of our application):</p><div class=tab-panel data-tab-group=6c06117c9c72a113c8ddf968cbf64f4e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6c06117c9c72a113c8ddf968cbf64f4e","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm install winston</span></span></code></pre></div></div></div></div></div><p>We should see output similar to the following:</p><div class=highlight><pre tabindex=0><code>added 28 packages, and audited 118 packages in 2s

15 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities</code></pre></div><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> Multiple Dependencies</div><div class=box-content><p>Notice how installing a single dependency actually installed 28 individual packages? This is a very useful feature of how Node.js and npm packages are structured, since each package can focus on doing only one task really well while reusing common tools and utilities that other packages may also use (thereby reducing the number of duplicated packages that may need to be installed). Unfortunately, this can also lead to situations where an issue with a single package can cause cascading failures and incompatibilities across the board. So, while it is very helpful to install these dependencies in our application, we always want to do so with caution and make sure are always using dependencies that are well maintained and actually add value to our application.</p></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> The <code>left-pad</code> Incident</div><div class=box-content><p>For a vivid case study of the concerns around using unnecessary dependencies, look at the <a href=https://en.wikipedia.org/wiki/Npm_left-pad_incident rel=external target=_blank>npm left-pad incident</a>. The <code>left-pad</code> library was a simple utility that added padding to the left side of a string. The entire library itself was a single function that contained less than 10 lines of actual code. However, when the developer of that library removed access to it due to a dispute, it ended up nearly breaking the entire npm ecosystem. Core development tools such as Babel, Webpack and more all used that library as a dependency, and with the rise of automated build systems, each tool broke as soon as the next rebuild cycle was initiated. It also caused issues with major online platforms such as Facebook, PayPal, Netflix, and Spotify.</p><p>Even today, nearly 9 years after the incident, the <a href=https://www.npmjs.com/package/left-pad rel=external target=_blank>left-pad</a> library is still present on npm, even though it is listed as deprecated since JavaScript now includes a method <code>String.prototype.padStart()</code> that performs the same action. As of January 2025, there are still 540 libraries on npm that list <code>left-pad</code> as a dependency, and it is downloaded over 1 million times per week!</p></div></div><p>Now that we&rsquo;ve installed <code>winston</code>, we should configure it. We could place all of the code to configure it inside of each file where it is used, but let&rsquo;s instead create a standalone configuration file for <code>winston</code> that we can use throughout our application.</p><p>To do this, let&rsquo;s create a new folder named <code>configs</code> inside of our <code>server</code> folder to house configurations for various dependencies, and then inside of that folder create a new file named <code>logger.js</code> for this configuration. In that file, we can place the following content:</p><div class=tab-panel data-tab-group=54b26273277bfc7376e6994488f3ffc6><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configsloggerjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("54b26273277bfc7376e6994488f3ffc6","configsloggerjs")'>
<span class=tab-nav-text>configs/logger.js</span></button></div><div class=tab-content-container><div data-tab-item=configsloggerjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>winston</span> <span class=nx>from</span> <span class=s1>&#39;winston&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>combine</span><span class=p>,</span> <span class=nx>timestamp</span><span class=p>,</span> <span class=nx>printf</span><span class=p>,</span> <span class=nx>colorize</span><span class=p>,</span> <span class=nx>align</span><span class=p>,</span> <span class=nx>errors</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>winston</span><span class=p>.</span><span class=nx>format</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Log Levels
</span></span></span><span class=line><span class=cl><span class=c1>//   error: 0
</span></span></span><span class=line><span class=cl><span class=c1>//   warn: 1
</span></span></span><span class=line><span class=cl><span class=c1>//   info: 2
</span></span></span><span class=line><span class=cl><span class=c1>//   http: 3
</span></span></span><span class=line><span class=cl><span class=c1>//   verbose: 4
</span></span></span><span class=line><span class=cl><span class=c1>//   debug: 5
</span></span></span><span class=line><span class=cl><span class=c1>//   silly: 6
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>level</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>LOG_LEVEL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>LOG_LEVEL</span> <span class=o>===</span> <span class=s1>&#39;0&#39;</span> <span class=o>||</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>LOG_LEVEL</span> <span class=o>===</span> <span class=s1>&#39;error&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;error&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>LOG_LEVEL</span> <span class=o>===</span> <span class=s1>&#39;1&#39;</span> <span class=o>||</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>LOG_LEVEL</span> <span class=o>===</span> <span class=s1>&#39;warn&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;warn&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>LOG_LEVEL</span> <span class=o>===</span> <span class=s1>&#39;2&#39;</span> <span class=o>||</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>LOG_LEVEL</span> <span class=o>===</span> <span class=s1>&#39;info&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;info&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>LOG_LEVEL</span> <span class=o>===</span> <span class=s1>&#39;3&#39;</span> <span class=o>||</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>LOG_LEVEL</span> <span class=o>===</span> <span class=s1>&#39;http&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;http&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>LOG_LEVEL</span> <span class=o>===</span> <span class=s1>&#39;4&#39;</span> <span class=o>||</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>LOG_LEVEL</span> <span class=o>===</span> <span class=s1>&#39;verbose&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;verbose&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>LOG_LEVEL</span> <span class=o>===</span> <span class=s1>&#39;5&#39;</span> <span class=o>||</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>LOG_LEVEL</span> <span class=o>===</span> <span class=s1>&#39;debug&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;debug&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>LOG_LEVEL</span> <span class=o>===</span> <span class=s1>&#39;6&#39;</span> <span class=o>||</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>LOG_LEVEL</span> <span class=o>===</span> <span class=s1>&#39;silly&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;silly&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;http&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>logger</span> <span class=o>=</span> <span class=nx>winston</span><span class=p>.</span><span class=nx>createLogger</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=c1>// call `level` function to get default log level
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>level</span><span class=o>:</span> <span class=nx>level</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Format configuration
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>format</span><span class=o>:</span> <span class=nx>combine</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>colorize</span><span class=p>({</span> <span class=nx>all</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}),</span>
</span></span><span class=line><span class=cl>        <span class=nx>errors</span><span class=p>({</span> <span class=nx>stack</span><span class=o>:</span> <span class=kc>true</span><span class=p>}),</span>
</span></span><span class=line><span class=cl>        <span class=nx>timestamp</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=nx>format</span><span class=o>:</span> <span class=s1>&#39;YYYY-MM-DD hh:mm:ss.SSS A&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>}),</span>
</span></span><span class=line><span class=cl>        <span class=nx>align</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=nx>printf</span><span class=p>((</span><span class=nx>info</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=sb>`[</span><span class=si>${</span><span class=nx>info</span><span class=p>.</span><span class=nx>timestamp</span><span class=si>}</span><span class=sb>] </span><span class=si>${</span><span class=nx>info</span><span class=p>.</span><span class=nx>level</span><span class=si>}</span><span class=sb>: </span><span class=si>${</span><span class=nx>info</span><span class=p>.</span><span class=nx>stack</span> <span class=o>?</span> <span class=nx>info</span><span class=p>.</span><span class=nx>stack</span> <span class=o>:</span> <span class=nx>info</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Output configuration
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>transports</span><span class=o>:</span> <span class=p>[</span><span class=k>new</span> <span class=nx>winston</span><span class=p>.</span><span class=nx>transports</span><span class=p>.</span><span class=nx>Console</span><span class=p>()]</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>logger</span><span class=p>;</span></span></span></code></pre></div></div></div></div></div><p>At the top, we see a helpful comment just reminding us which log levels are available by default in <code>winston</code>. Then, we have a <code>level</code> function that determines what our desired log level should be based on an environment variable named <code>LOG_LEVEL</code>. We&rsquo;ll set that variable a bit later in this tutorial. Based on that log level, our system will print any logs at that level or lower in severity level. Finally, we create an instance of the <code>winston</code> logger and provide lots of configuration information about our desired output format. All of this is highly configurable. To fully understand this configuration, take some time to review the <a href=https://www.npmjs.com/package/winston rel=external target=_blank>winston documentation</a>.</p><p>Now, let&rsquo;s update our <code>bin/www</code> file to use this logger instead of the <code>debug</code> utility. Lines that have been changed are highlighted:</p><div class=tab-panel data-tab-group=d485324f738b6d887f6ce1b889b2733c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=binwww class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d485324f738b6d887f6ce1b889b2733c","binwww")'>
<span class=tab-nav-text>bin/www</span></button></div><div class=tab-content-container><div data-tab-item=binwww class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// var debug = require(&#39;debug&#39;)(&#39;server:server&#39;);
</span></span></span><span class="line hl"><span class=cl><span class=c1>// import debugLibrary from &#39;debug&#39;;
</span></span></span><span class="line hl"><span class=cl><span class=c1>// const debug = debugLibrary(&#39;server:server&#39;);
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>logger</span> <span class=nx>from</span> <span class=s1>&#39;../configs/logger.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>onError</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>syscall</span> <span class=o>!==</span> <span class=s1>&#39;listen&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>bind</span> <span class=o>=</span> <span class=k>typeof</span> <span class=nx>port</span> <span class=o>===</span> <span class=s1>&#39;string&#39;</span>
</span></span><span class=line><span class=cl>    <span class=o>?</span> <span class=s1>&#39;Pipe &#39;</span> <span class=o>+</span> <span class=nx>port</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=s1>&#39;Port &#39;</span> <span class=o>+</span> <span class=nx>port</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// handle specific listen errors with friendly messages
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>switch</span> <span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>code</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;EACCES&#39;</span><span class=o>:</span>
</span></span><span class="line hl"><span class=cl>      <span class=c1>// console.error(bind + &#39; requires elevated privileges&#39;);
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>      <span class=nx>logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=nx>bind</span> <span class=o>+</span> <span class=s1>&#39; requires elevated privileges&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;EADDRINUSE&#39;</span><span class=o>:</span>
</span></span><span class="line hl"><span class=cl>      <span class=c1>// console.error(bind + &#39; is already in use&#39;);
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>      <span class=nx>logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=nx>bind</span> <span class=o>+</span> <span class=s1>&#39; is already in use&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Event listener for HTTP server &#34;listening&#34; event.
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>onListening</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>addr</span> <span class=o>=</span> <span class=nx>server</span><span class=p>.</span><span class=nx>address</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>bind</span> <span class=o>=</span> <span class=k>typeof</span> <span class=nx>addr</span> <span class=o>===</span> <span class=s1>&#39;string&#39;</span>
</span></span><span class=line><span class=cl>    <span class=o>?</span> <span class=s1>&#39;pipe &#39;</span> <span class=o>+</span> <span class=nx>addr</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=s1>&#39;port &#39;</span> <span class=o>+</span> <span class=nx>addr</span><span class=p>.</span><span class=nx>port</span><span class=p>;</span>
</span></span><span class="line hl"><span class=cl>  <span class=c1>// debug(&#39;Listening on &#39; + bind);
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>  <span class=nx>logger</span><span class=p>.</span><span class=nx>debug</span><span class=p>(</span><span class=s1>&#39;Listening on &#39;</span> <span class=o>+</span> <span class=nx>bind</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Basically, we&rsquo;ve replaced all instances of the <code>debug</code> method with <code>logger.debug</code>. We&rsquo;ve also replaced a couple of uses of <code>console.error</code> to instead use <code>logger.error</code>. They will also create new <code>Error</code> object, which will cause <code>winston</code> to print a stack trace as well.</p><p>With that change in place, we can now remove the <code>debug</code> utility from our list of dependencies:</p><div class=tab-panel data-tab-group=0356f30be0a4a35219168c6fc53a28c9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0356f30be0a4a35219168c6fc53a28c9","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm uninstall debug</span></span></code></pre></div></div></div></div></div><p>Now, let&rsquo;s run our program to see <code>winston</code> in action:</p><div class=tab-panel data-tab-group=0311a3d3f770ace53af1170770254f04><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0311a3d3f770ace53af1170770254f04","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm start</span></span></code></pre></div></div></div></div></div><p>When we run it, we should see this output:</p><div class=tab-panel data-tab-group=4974856ca8fccb8767c8351342f8ce2b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4974856ca8fccb8767c8351342f8ce2b","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>&gt; example-project@0.0.1 start
&gt; node ./bin/www</code></pre></div></div></div></div></div><p>Notice how <code>winston</code> didn&rsquo;t print any debug messages? That is because we haven&rsquo;t set our <code>LOG_LEVEL</code> environment variable. So, let&rsquo;s do that by creating two different scripts in our <code>package.json</code> file - one to run the application with a default log level, and another to run it with the <code>debug</code> log level:</p><div class=tab-panel data-tab-group=2b361a44d43614aed654e1922a0a2bfb><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=packagejson class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2b361a44d43614aed654e1922a0a2bfb","packagejson")'>
<span class=tab-nav-text>package.json</span></button></div><div class=tab-content-container><div data-tab-item=packagejson class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;example-project&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;module&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;private&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>    <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;LOG_LEVEL=http node ./bin/www&#34;</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>    <span class=nt>&#34;dev&#34;</span><span class=p>:</span> <span class=s2>&#34;LOG_LEVEL=debug node ./bin/www&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;cookie-parser&#34;</span><span class=p>:</span> <span class=s2>&#34;~1.4.7&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;express&#34;</span><span class=p>:</span> <span class=s2>&#34;~4.21.2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;morgan&#34;</span><span class=p>:</span> <span class=s2>&#34;~1.10.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;winston&#34;</span><span class=p>:</span> <span class=s2>&#34;^3.17.0&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>The <code>npm run</code> command can be used to run any of the scripts in the <code>scripts</code> section of our <code>package.json</code> file.
So, if we want to run our application so we can see the debug messages, we can use the following command:</p><div class=tab-panel data-tab-group=22c4d1a26b4dd439398181b3cfdf339b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("22c4d1a26b4dd439398181b3cfdf339b","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm run dev</span></span></code></pre></div></div></div></div></div><p>Now we should see some debug messages in the output:</p><div class=tab-panel data-tab-group=682f7c558d9ffefd0a7cc8798452394f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("682f7c558d9ffefd0a7cc8798452394f","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>&gt; example-project@0.0.1 dev
&gt; LOG_LEVEL=debug node ./bin/www

[2025-01-17 06:23:03.622 PM] info:      Listening on port 3000</code></pre></div></div></div></div></div><p>Great! Notice how the logger outputs a timestamp, the log level, and the message, all on the same line? This matches the configuration we used in the <code>configs/logger.js</code> file. On most terminals, each log level will even be a different color!</p><p><a href=#R-image-19bd3db1855c87b37ac6707f4aa008a9 class=lightbox-link><img alt="Debug Logging in Color" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/debug_1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-19bd3db1855c87b37ac6707f4aa008a9><img alt="Debug Logging in Color" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/debug_1.png></a></p><p>Finally, since we really should make sure the message that the application is successfully listening on a port is printed by default, let&rsquo;s change it to the <code>info</code> log level in our <code>bin/www</code> file:</p><div class=tab-panel data-tab-group=ce0c7bc3305e3c35d0bd92167b7e45b0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=binwww class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ce0c7bc3305e3c35d0bd92167b7e45b0","binwww")'>
<span class=tab-nav-text>bin/www</span></button></div><div class=tab-content-container><div data-tab-item=binwww class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>onListening</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>addr</span> <span class=o>=</span> <span class=nx>server</span><span class=p>.</span><span class=nx>address</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>bind</span> <span class=o>=</span> <span class=k>typeof</span> <span class=nx>addr</span> <span class=o>===</span> <span class=s1>&#39;string&#39;</span>
</span></span><span class=line><span class=cl>    <span class=o>?</span> <span class=s1>&#39;pipe &#39;</span> <span class=o>+</span> <span class=nx>addr</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=s1>&#39;port &#39;</span> <span class=o>+</span> <span class=nx>addr</span><span class=p>.</span><span class=nx>port</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>// debug(&#39;Listening on &#39; + bind);
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>  <span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Listening on &#39;</span> <span class=o>+</span> <span class=nx>bind</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Why Not Use NODE_ENV?</div><div class=box-content><p>In many web applications written using Node.js and Express, you may have come across the <code>NODE_ENV</code> environment variable, which is often set to either <code>development</code>, <code>production</code>, or sometimes <code>test</code> to configure the application. While this may have made sense in the past, it is now considered an <em>anti-pattern</em> in Node.js. This is because there no fundamental difference between development and production in Node.js, and it is often very confusing if an application runs differently in different environments. So, it is better to directly configure logging via its own environment variable instead of using an overall variable that configures multiple services. See the <a href=https://nodejs.org/en/learn/getting-started/nodejs-the-difference-between-development-and-production rel=external target=_blank>Node.js Documentation</a> for a deeper discussion of this topic.</p></div></div><p>This is a good point to <strong>commit and push</strong> our work!</p><h2 id=references>References</h2><ul><li><a href=https://betterstack.com/community/guides/logging/how-to-install-setup-and-use-winston-and-morgan-to-log-node-js-applications/ rel=external target=_blank>A Complete Guide to Winston Logging in Node.js</a></li><li><a href=https://levelup.gitconnected.com/better-logs-for-expressjs-using-winston-and-morgan-with-typescript-1c31c1ab9342 rel=external target=_blank>Better logs for ExpressJS using Winston and Morgan with Typescript</a></li></ul><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=request-logging>Request Logging</h1><a href="https://www.youtube.com/watch?v=id">YouTube Video</a><h2 id=logging-requests-with-morgan>Logging Requests with Morgan</h2><p>Now that we have configured a logging utility, let&rsquo;s use it to also log all incoming requests sent to our web application. This will definitely make it much easier to keep track of what is going on in our application and make sure it is working correctly.</p><p>The Express application generator already installs a library for this, called <a href=https://www.npmjs.com/package/morgan rel=external target=_blank>morgan</a>. We have already seen output from <code>morgan</code> before:</p><div class=tab-panel data-tab-group=e8c804a45bca99c9a24c5cb144b901fa><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e8c804a45bca99c9a24c5cb144b901fa","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>GET / 304 2.569 ms - -
GET /users 200 2.417 ms - 23
GET / 200 1.739 ms - 120</code></pre></div></div></div></div></div><p>While this is useful, let&rsquo;s reconfigure <code>morgan</code> to use our new <code>winston</code> logger and add some additional detail to the output.</p><p>Since <code>morgan</code> is technically a <a href=https://expressjs.com/en/guide/using-middleware.html rel=external target=_blank>middleware</a> in our application, let&rsquo;s create a new folder called <code>middlewares</code> to store configuration for our various middlewares, and then we can create a new middleware file named <code>request-logger.js</code> in that folder. Inside of that file, we can place the following configuration:</p><div class=tab-panel data-tab-group=089bc221bc4d9fac15e5928d050e4c3d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=middlewaresrequest-loggerjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("089bc221bc4d9fac15e5928d050e4c3d","middlewaresrequest-loggerjs")'>
<span class=tab-nav-text>middlewares/request-logger.js</span></button></div><div class=tab-content-container><div data-tab-item=middlewaresrequest-loggerjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>morgan</span> <span class=nx>from</span> <span class=s1>&#39;morgan&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>logger</span> <span class=nx>from</span> <span class=s1>&#39;../configs/logger.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Override morgan stream method to use our custom logger
</span></span></span><span class=line><span class=cl><span class=c1>// Log Format
</span></span></span><span class=line><span class=cl><span class=c1>// :method :url :status :response-time ms - :res[content-length]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>stream</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>write</span><span class=o>:</span> <span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// log using the &#39;http&#39; severity
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>logger</span><span class=p>.</span><span class=nx>http</span><span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>trim</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// See https://github.com/expressjs/morgan?tab=readme-ov-file#api
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>requestLogger</span> <span class=o>=</span> <span class=nx>morgan</span><span class=p>(</span><span class=s1>&#39;dev&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>stream</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>requestLogger</span><span class=p>;</span></span></span></code></pre></div></div></div></div></div><p>In effect, this file basically tells <code>morgan</code> to write output through the <code>logger.http()</code> method instead of just directly to the console. We are importing our <code>winston</code> configuration from <code>configs/logger.js</code> to accomplish this. We are also configuring <code>morgan</code> to use the <code>dev</code> logging format; more information on log formats can be found in the <a href=https://www.npmjs.com/package/morgan rel=external target=_blank>documentation</a>.</p><p>Finally, let&rsquo;s update our <code>app.js</code> file to use this new request logger middleware instead of <code>morgan</code>:</p><div class=tab-panel data-tab-group=25f9c107c98f3c38e6f7289ca5f34340><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=appjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("25f9c107c98f3c38e6f7289ca5f34340","appjs")'>
<span class=tab-nav-text>app.js</span></button></div><div class=tab-content-container><div data-tab-item=appjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>express</span> <span class=nx>from</span> <span class=s1>&#39;express&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>path</span> <span class=nx>from</span> <span class=s1>&#39;path&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>cookieParser</span> <span class=nx>from</span> <span class=s1>&#39;cookie-parser&#39;</span><span class=p>;</span>
</span></span><span class="line hl"><span class=cl><span class=c1>// import logger from &#39;morgan&#39;;
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>requestLogger</span> <span class=nx>from</span> <span class=s1>&#39;./middlewares/request-logger.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>indexRouter</span> <span class=nx>from</span> <span class=s1>&#39;./routes/index.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>usersRouter</span> <span class=nx>from</span> <span class=s1>&#39;./routes/users.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=c1>// app.use(logger(&#39;dev&#39;));
</span></span></span><span class="line hl"><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>requestLogger</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>urlencoded</span><span class=p>({</span> <span class=nx>extended</span><span class=o>:</span> <span class=kc>false</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>cookieParser</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=kr>static</span><span class=p>(</span><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=kr>import</span><span class=p>.</span><span class=nx>meta</span><span class=p>.</span><span class=nx>dirname</span><span class=p>,</span> <span class=s1>&#39;public&#39;</span><span class=p>)));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>Now, let&rsquo;s run our application and access a few of the routes via our web browser:</p><div class=tab-panel data-tab-group=60e163ce32a6de3343033e8a7693cd00><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("60e163ce32a6de3343033e8a7693cd00","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm run dev</span></span></code></pre></div></div></div></div></div><p>We should now see output from <code>morgan</code> included as <code>http</code> logs from <code>winston</code>:</p><div class=tab-panel data-tab-group=00d9c6927d8fec14e1dd2218ad0447b3><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("00d9c6927d8fec14e1dd2218ad0447b3","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>&gt; example-project@0.0.1 dev
&gt; LOG_LEVEL=debug node ./bin/www

[2025-01-17 06:39:30.975 PM] info:      Listening on port 3000
[2025-01-17 06:39:37.430 PM] http:      GET / 200 3.851 ms - 120
[2025-01-17 06:39:40.665 PM] http:      GET /users 200 3.184 ms - 23
[2025-01-17 06:39:43.069 PM] http:      GET / 304 0.672 ms - -
[2025-01-17 06:39:45.424 PM] http:      GET /users 304 1.670 ms - -</code></pre></div></div></div></div></div><p>When viewed on a modern terminal, they should even be colorized!</p><p><a href=#R-image-19b0069d5d08e59100c81f3b027ef8dc class=lightbox-link><img alt="Request Logging" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/request_1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-19b0069d5d08e59100c81f3b027ef8dc><img alt="Request Logging" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/request_1.png></a></p><p>Here, we can see each log level is colorized, and also the HTTP status codes in our <code>morgan</code> log output are also colorized. The first time each page is accessed, the browser receives a <code>200</code> status code in green with the content. The second time, our application correctly sends back a <code>304</code> status code in light blue, indicating that the content has not been modified and that the browser can use the cached version instead.</p><p>This is a good point to <strong>commit and push</strong> our work!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=other-libraries>Other Libraries</h1><a href="https://www.youtube.com/watch?v=id">YouTube Video</a><h2 id=other-useful-libraries>Other Useful Libraries</h2><p>Before we move on, let&rsquo;s install a few other useful libraries that perform various tasks in our Express application.</p><h3 id=compression>Compression</h3><p>The <a href=https://www.npmjs.com/package/compression rel=external target=_blank>compression</a> middleware library does exactly what it says it will - it compresses any responses generated by the server and sent through the network. This can be helpful in many situations, but not all. Recall that compression is really just trading more processing time in exchange for less network bandwidth, so we may need to consider which of those we are more concerned about. Thankfully, adding or removing the <code>compression</code> middleware library is simple.</p><p>First, let&rsquo;s install it using <code>npm</code>:</p><div class=tab-panel data-tab-group=8b5d03b150742d7304eff555508fe66b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("8b5d03b150742d7304eff555508fe66b","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm install compression</span></span></code></pre></div></div></div></div></div><p>Then, we can add it to our <code>app.js</code> file, generally early in the chain of middlewares since it will impact all responses after that point in the chain.</p><div class=tab-panel data-tab-group=c85a49f654c056d692f8ecff457173e3><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=appjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c85a49f654c056d692f8ecff457173e3","appjs")'>
<span class=tab-nav-text>app.js</span></button></div><div class=tab-content-container><div data-tab-item=appjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>express</span> <span class=nx>from</span> <span class=s1>&#39;express&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>path</span> <span class=nx>from</span> <span class=s1>&#39;path&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>cookieParser</span> <span class=nx>from</span> <span class=s1>&#39;cookie-parser&#39;</span><span class=p>;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>import</span> <span class=nx>compression</span> <span class=nx>from</span> <span class=s1>&#39;compression&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>requestLogger</span> <span class=nx>from</span> <span class=s1>&#39;./middlewares/request-logger.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>indexRouter</span> <span class=nx>from</span> <span class=s1>&#39;./routes/index.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>usersRouter</span> <span class=nx>from</span> <span class=s1>&#39;./routes/users.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>compression</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>requestLogger</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>urlencoded</span><span class=p>({</span> <span class=nx>extended</span><span class=o>:</span> <span class=kc>false</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>cookieParser</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=kr>static</span><span class=p>(</span><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=kr>import</span><span class=p>.</span><span class=nx>meta</span><span class=p>.</span><span class=nx>dirname</span><span class=p>,</span> <span class=s1>&#39;public&#39;</span><span class=p>)));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=nx>indexRouter</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/users&#39;</span><span class=p>,</span> <span class=nx>usersRouter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>app</span><span class=p>;</span></span></span></code></pre></div></div></div></div></div><p>To test this library, we can run our application with all built-in debugging enabled through the <code>debug</code> library as documented in the <a href=https://expressjs.com/en/guide/debugging.html rel=external target=_blank>Express Documentation</a>:</p><div class=tab-panel data-tab-group=61d9975bb5aa7ffe57cac8810871d4fa><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("61d9975bb5aa7ffe57cac8810871d4fa","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nv>DEBUG</span><span class=o>=</span>* npm run dev</span></span></code></pre></div></div></div></div></div><p>We&rsquo;ll see a bunch of output as our Express application is initialized. Once it is done, we can open the home page in our web browser to send an HTTP GET request to the server. This will produce the following log output:</p><div class=tab-panel data-tab-group=78cea4e3d97e5cbf853e6228222598ea><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("78cea4e3d97e5cbf853e6228222598ea","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>  express:router dispatching GET / +1m
</span></span><span class=line><span class=cl>  express:router query  : / +0ms
</span></span><span class=line><span class=cl>  express:router expressInit  : / +1ms
</span></span><span class=line><span class=cl>  express:router compression  : / +0ms
</span></span><span class=line><span class=cl>  express:router logger  : / +0ms
</span></span><span class=line><span class=cl>  express:router urlencodedParser  : / +0ms
</span></span><span class=line><span class=cl>  body-parser:urlencoded skip empty body +1ms
</span></span><span class=line><span class=cl>  express:router cookieParser  : / +0ms
</span></span><span class=line><span class=cl>  express:router serveStatic  : / +0ms
</span></span><span class=line><span class=cl>  send stat <span class=s2>&#34;/workspaces/example-project/server/public/index.html&#34;</span> +0ms
</span></span><span class=line><span class=cl>  send pipe <span class=s2>&#34;/workspaces/example-project/server/public/index.html&#34;</span> +1ms
</span></span><span class=line><span class=cl>  send accept ranges +0ms
</span></span><span class=line><span class=cl>  send cache-control public, max-age<span class=o>=</span><span class=m>0</span> +0ms
</span></span><span class=line><span class=cl>  send modified Thu, <span class=m>16</span> Jan <span class=m>2025</span> 23:17:14 GMT +0ms
</span></span><span class=line><span class=cl>  send etag W/<span class=s2>&#34;78-1947168173e&#34;</span> +1ms
</span></span><span class=line><span class=cl>  send content-type text/html +0ms
</span></span><span class="line hl"><span class=cl>  compression no compression: size below threshold +1ms
</span></span><span class=line><span class=cl>  morgan log request +2ms
</span></span><span class=line><span class=cl><span class=o>[</span>2025-01-25 07:00:35.013 PM<span class=o>]</span> http:      GET / <span class=m>200</span> 3.166 ms - <span class=m>120</span></span></span></code></pre></div></div></div></div></div><p>We can see in the highlighted line that the <code>compression</code> library did not apply any compression to the response because it was below the minium size threshold. This is set to 1kb by default according to the <a href=https://www.npmjs.com/package/compression rel=external target=_blank>compression</a> documentation.</p><p>So, to really see what it does, let&rsquo;s generate a much larger response by adding some additional text to our <code>public/index.html</code> file (this text was generated using <a href=https://www.lipsum.com/ rel=external target=_blank>Lorem Ipsum</a>):</p><div class=tab-panel data-tab-group=a3aac07be5666c481fe3ac76e2368c35><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=publicindexhtml class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a3aac07be5666c481fe3ac76e2368c35","publicindexhtml")'>
<span class=tab-nav-text>public/index.html</span></button></div><div class=tab-content-container><div data-tab-item=publicindexhtml class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Express<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Express<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>Welcome to Express<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam sed arcu tincidunt, porttitor diam a, porta nibh. Duis pretium tellus euismod, imperdiet elit id, gravida turpis. Fusce vitae pulvinar tellus. Donec cursus pretium justo, sed vehicula erat iaculis lobortis. Mauris dapibus scelerisque aliquet. Nullam posuere, magna vitae viverra lacinia, sapien magna imperdiet erat, ac sagittis ante ante tristique eros. Phasellus eget fermentum mauris. Integer justo lorem, finibus a ullamcorper in, feugiat in nunc. Etiam ut felis a magna aliquam consectetur. Duis eu mauris ut leo vehicula fringilla scelerisque vel mi. Donec placerat quam nulla, at commodo orci maximus sit amet. Curabitur tincidunt euismod enim, non feugiat nulla eleifend sed. Sed finibus metus sit amet metus congue commodo. Cras ullamcorper turpis sed mi scelerisque porta.<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>Sed maximus diam in blandit elementum. Integer diam ante, tincidunt in pulvinar at, luctus in dui. Fusce tincidunt hendrerit dolor in suscipit. Nullam vitae tellus at justo bibendum blandit a vel ligula. Nunc sed augue blandit, finibus nisi nec, posuere orci. Maecenas ut egestas diam. Donec non orci nec ex rhoncus malesuada at eget ante. Proin ultricies cursus nunc eu mollis. Donec vel ligula vel eros luctus pulvinar. Proin vitae dui imperdiet, rutrum risus non, maximus purus. Vivamus fringilla augue tincidunt, venenatis arcu eu, dictum nunc. Mauris eu ullamcorper orci. Cras efficitur egestas ligula. Maecenas a nisl bibendum turpis tristique lobortis.<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span></span></span></code></pre></div></div></div></div></div><p>Now, when we request that file, we should see this line in our debug output:</p><div class=tab-panel data-tab-group=5be225c5a16210f3aee0ebda9a716a74><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("5be225c5a16210f3aee0ebda9a716a74","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>express:router dispatching GET / +24s
</span></span><span class=line><span class=cl>  express:router query  : / +1ms
</span></span><span class=line><span class=cl>  express:router expressInit  : / +0ms
</span></span><span class=line><span class=cl>  express:router compression  : / +0ms
</span></span><span class=line><span class=cl>  express:router logger  : / +0ms
</span></span><span class=line><span class=cl>  express:router urlencodedParser  : / +0ms
</span></span><span class=line><span class=cl>  body-parser:urlencoded skip empty body +0ms
</span></span><span class=line><span class=cl>  express:router cookieParser  : / +1ms
</span></span><span class=line><span class=cl>  express:router serveStatic  : / +0ms
</span></span><span class=line><span class=cl>  send stat <span class=s2>&#34;/workspaces/example-project/server/public/index.html&#34;</span> +0ms
</span></span><span class=line><span class=cl>  send pipe <span class=s2>&#34;/workspaces/example-project/server/public/index.html&#34;</span> +0ms
</span></span><span class=line><span class=cl>  send accept ranges +0ms
</span></span><span class=line><span class=cl>  send cache-control public, max-age<span class=o>=</span><span class=m>0</span> +0ms
</span></span><span class=line><span class=cl>  send modified Sat, <span class=m>25</span> Jan <span class=m>2025</span> 19:05:18 GMT +0ms
</span></span><span class=line><span class=cl>  send etag W/<span class=s2>&#34;678-1949edaaa4c&#34;</span> +0ms
</span></span><span class=line><span class=cl>  send content-type text/html +0ms
</span></span><span class="line hl"><span class=cl>  compression gzip compression +1ms
</span></span><span class=line><span class=cl>  morgan log request +1ms
</span></span><span class=line><span class=cl><span class=o>[</span>2025-01-25 07:05:20.234 PM<span class=o>]</span> http:      GET / <span class=m>200</span> 1.232 ms - -</span></span></code></pre></div></div></div></div></div><p>As we can see, the <code>compression</code> middleware is now compressing the response before it is sent to the server using the <a href=https://en.wikipedia.org/wiki/Gzip rel=external target=_blank>gzip</a> compression algorithm. We can also see this in our web browser&rsquo;s debugging tools - in Google Chrome, we notice that the <code>Content-Encoding</code> header is set to <code>gzip</code> as shown below:</p><p><a href=#R-image-e06a6341977cfa0db96568e0b6e7e663 class=lightbox-link><img alt="Compressed Server Response" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/other_1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e06a6341977cfa0db96568e0b6e7e663><img alt="Compressed Server Response" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/other_1.png></a></p><p>We&rsquo;ll go ahead and integrate the <code>compression</code> middleware into our project for this course, but as discussed above, it is always worth considering whether the tradeoff of additional processing time to save network bandwidth is truly worth it.</p><h3 id=helmet>Helmet</h3><p>Another very useful Express library is <a href=https://www.npmjs.com/package/helmet rel=external target=_blank>helmet</a>. Helmet sets several headers in the HTTP response from an Express application to help improve security. This includes things such as setting an appropriate <a href=https://helmetjs.github.io/#content-security-policy rel=external target=_blank>Content-Security-Policy</a> and removing information about the web server that could be leaked in the <a href=https://helmetjs.github.io/#x-powered-by rel=external target=_blank>X-Powered-By</a> header.</p><p>To install <code>helmet</code> we can simply use <code>npm</code> as always:</p><div class=tab-panel data-tab-group=bd11495de2415c2398a2aecff2d37fb3><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("bd11495de2415c2398a2aecff2d37fb3","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm install helmet</span></span></code></pre></div></div></div></div></div><p>Similar to the <code>compression</code> library above, we can simply add <code>helmet</code> to our Express application&rsquo;s <code>app.js</code> file:</p><div class=tab-panel data-tab-group=7e43787e7f73535d211db178491b7c5f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=appjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("7e43787e7f73535d211db178491b7c5f","appjs")'>
<span class=tab-nav-text>app.js</span></button></div><div class=tab-content-container><div data-tab-item=appjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>express</span> <span class=nx>from</span> <span class=s1>&#39;express&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>path</span> <span class=nx>from</span> <span class=s1>&#39;path&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>cookieParser</span> <span class=nx>from</span> <span class=s1>&#39;cookie-parser&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>compression</span> <span class=nx>from</span> <span class=s1>&#39;compression&#39;</span><span class=p>;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>import</span> <span class=nx>helmet</span> <span class=nx>from</span> <span class=s1>&#39;helmet&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>requestLogger</span> <span class=nx>from</span> <span class=s1>&#39;./middlewares/request-logger.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>indexRouter</span> <span class=nx>from</span> <span class=s1>&#39;./routes/index.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>usersRouter</span> <span class=nx>from</span> <span class=s1>&#39;./routes/users.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>helmet</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>compression</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>requestLogger</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>urlencoded</span><span class=p>({</span> <span class=nx>extended</span><span class=o>:</span> <span class=kc>false</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>cookieParser</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=kr>static</span><span class=p>(</span><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=kr>import</span><span class=p>.</span><span class=nx>meta</span><span class=p>.</span><span class=nx>dirname</span><span class=p>,</span> <span class=s1>&#39;public&#39;</span><span class=p>)));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=nx>indexRouter</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/users&#39;</span><span class=p>,</span> <span class=nx>usersRouter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>app</span><span class=p>;</span></span></span></code></pre></div></div></div></div></div><p>To really see what the <code>helmet</code> library does, we can examine the headers sent by the server with and without <code>helmet</code> enabled.</p><p>First, here are the headers sent by the server without <code>helmet</code> enabled:</p><p><a href=#R-image-e612e39fa57e3b15fee0b5d276fb03c9 class=lightbox-link><img alt="Insecure Headers" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/other_2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e612e39fa57e3b15fee0b5d276fb03c9><img alt="Insecure Headers" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/other_2.png></a></p><p>When <code>helmet</code> is enabled, we see an entirely different set of headers:</p><p><a href=#R-image-e4678b1aa09481bd7fa72b095877b074 class=lightbox-link><img alt="Secure Headers" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/other_3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e4678b1aa09481bd7fa72b095877b074><img alt="Secure Headers" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/other_3.png></a></p><p>In the second screenshot, notice that the <code>Content-Security-Policy</code> header is now present, but the <code>X-Powered-By</code> header is not? Those changes, along with many others, are provided by the <code>helmet</code> library.</p><p>In general, it is always a good idea to review the security of the headers sent by our application. Installing <code>helmet</code> is a good start, but as we continue to develop applications we may learn additional ways we can configure <code>helmet</code> to provide even more security for our applications.</p><h3 id=nodemon>Nodemon</h3><p>Finally, let&rsquo;s also install the <a href=https://www.npmjs.com/package/nodemon rel=external target=_blank>nodemon</a> package to make developing our application a bit easier. At its core, <code>nodemon</code> is a simple tool that will auotmatically restart our application anytime it detects that a file has changed. In this way, we can just leave our application running in the background, and any changes we make to the code will immediately be availbale for us to test without having to manually restart the server.</p><p>To begin, let&rsquo;s install <code>nodemon</code> as a development dependency using <code>npm</code> with the <code>--save-dev</code> flag:</p><div class=tab-panel data-tab-group=8942fef8e7919c40aaebe858bb6acd85><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("8942fef8e7919c40aaebe858bb6acd85","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm install nodemon --save-dev</span></span></code></pre></div></div></div></div></div><p>Notice that this will cause that library to be installed in a new section of our <code>package.json</code> file called <code>devDependencies</code>:</p><div class=tab-panel data-tab-group=62b1489f7eee30028b96039e1b60a32f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=packagejson class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("62b1489f7eee30028b96039e1b60a32f","packagejson")'>
<span class=tab-nav-text>package.json</span></button></div><div class=tab-content-container><div data-tab-item=packagejson class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>...</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;compression&#34;</span><span class=p>:</span> <span class=s2>&#34;^1.7.5&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;cookie-parser&#34;</span><span class=p>:</span> <span class=s2>&#34;~1.4.7&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;express&#34;</span><span class=p>:</span> <span class=s2>&#34;~4.21.2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;helmet&#34;</span><span class=p>:</span> <span class=s2>&#34;^8.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;morgan&#34;</span><span class=p>:</span> <span class=s2>&#34;~1.10.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;winston&#34;</span><span class=p>:</span> <span class=s2>&#34;^3.17.0&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;devDependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;nodemon&#34;</span><span class=p>:</span> <span class=s2>&#34;^3.1.9&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>These dependencies are only installed by <code>npm</code> when we are developing our application. The default <code>npm install</code> command will install all dependencies, including development dependencies. However, we can instead either use <code>npm install --omit=dev</code> or set the <code>NODE_ENV</code> environment variable to <code>production</code> to avoid installing development dependencies.</p><p>Next, we can simply update our <code>package.json</code> file to use the <code>nodemon</code> command instead of <code>node</code> in the <code>dev</code> script:</p><div class=tab-panel data-tab-group=3c1908cc4169d43a7daf8d667686654c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=packagejson class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("3c1908cc4169d43a7daf8d667686654c","packagejson")'>
<span class=tab-nav-text>package.json</span></button></div><div class=tab-content-container><div data-tab-item=packagejson class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;example-project&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;module&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;private&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;LOG_LEVEL=http node ./bin/www&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;dev&#34;</span><span class=p>:</span> <span class=s2>&#34;LOG_LEVEL=debug nodemon ./bin/www&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=err>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Now, when we execute our application:</p><div class=tab-panel data-tab-group=edacc501d43cfe330bdbbb329485368e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("edacc501d43cfe330bdbbb329485368e","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm run dev</span></span></code></pre></div></div></div></div></div><p>We should see additional output from <code>nodemon</code> to see that it is working:</p><div class=tab-panel data-tab-group=428dd04c316cec0af4cb5a57c6ec3db9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("428dd04c316cec0af4cb5a57c6ec3db9","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>&gt; example-project@0.0.1 dev
&gt; LOG_LEVEL=debug nodemon ./bin/www

[nodemon] 3.1.9
[nodemon] to restart at any time, enter `rs`
[nodemon] watching path(s): *.*
[nodemon] watching extensions: js,mjs,cjs,json
[nodemon] starting `node ./bin/www`
[2025-01-25 09:37:24.734 PM] info:      Listening on port 3000</code></pre></div></div></div></div></div><p>Now, with our application running, we can make any change to a file in our application, such as <code>app.js</code>, and it will automatically restart our application:</p><div class=tab-panel data-tab-group=bc0bc89dd870dee83fdda94b470242a8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("bc0bc89dd870dee83fdda94b470242a8","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>[nodemon] restarting due to changes...
[nodemon] starting `node ./bin/www`
[2025-01-25 09:39:02.858 PM] info:      Listening on port 3000</code></pre></div></div></div></div></div><p>We can also always manually type <code>rs</code> in the terminal to restart the application when it is running inside of <code>nodemon</code>.</p><p>In general, using <code>nodemon</code> to develop a Node.js application is recommended, but we don&rsquo;t want to use that in a production environment. So, we are careful to install <code>nodemon</code> as a development dependency only.</p><p>This is a good point to <strong>commit and push</strong> our work!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=environment>Environment</h1><a href="https://www.youtube.com/watch?v=id">YouTube Video</a><h2 id=environment-variables>Environment Variables</h2><p>As discussed earlier, an <a href=https://en.wikipedia.org/wiki/Environment_variable rel=external target=_blank><strong>environment variable</strong></a> is a value present in memory in the operating system environment where a process is running. They contain important information about the system where the application is running, but they can also be configured by the user or system administrator to provide information and configuration to any processes running in that environment. This is especially used when working with <strong>containers</strong> like the dev container we built for this project.</p><p>To explore this, we can use the <code>printenv</code> command in any Linux terminal:</p><div class=tab-panel data-tab-group=692bc2da866bb3d31029e5488e80b5dd><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("692bc2da866bb3d31029e5488e80b5dd","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ printenv</span></span></code></pre></div></div></div></div></div><p>When we run that command in our GitHub codespace, we&rsquo;ll see output containing lines similar to this (many lines have been omitted as they contain secure information):</p><div class=tab-panel data-tab-group=6471b32d6fa7227f46f91e0e20b7b1ee><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6471b32d6fa7227f46f91e0e20b7b1ee","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>SHELL=/bin/bash
GITHUB_USER=russfeld
CODESPACE_NAME=laughing-computing-machine-jj5j9p97vx435jqj
HOSTNAME=codespaces-f1a983
RepositoryName=example-project
CODESPACES=true
YARN_VERSION=1.22.22
PWD=/workspaces/example-project/server
ContainerVersion=13
GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN=app.github.dev
USER=node
NODE_VERSION=22.12.0
OLDPWD=/workspaces/example-project
TERM_PROGRAM=vscode</code></pre></div></div></div></div></div><p>As we can see, the environment contains many useful variables, including a <code>CODESPACES</code> variable showing that the application is running in GitHub Codespaces. We can also find our <code>GITHUB_USER</code>, <code>CODESPACE_NAME</code> and even the <code>NODE_VERSION</code> all in the environment.</p><h2 id=configuring-the-environment>Configuring the Environment</h2><p>Because many web applications eventually run in a containerized environment anyway, it is very common practice to configure those applications through the use of environment variables. Thankfully, we can more easily control and configure our application through the use of a special library <a href=https://dotenvx.com/ rel=external target=_blank>dotenvx</a> that allows us to load a set of environment variables from a file named <code>.env</code>.</p><div class="box notices cstyle note"><div class=box-label><i class="fa-fw fas fa-exclamation-circle"></i> dotenv</div><div class=box-content><p>The <code>dotenvx</code> library is a newer version of the <a href=https://www.npmjs.com/package/dotenv rel=external target=_blank>dotenv</a> library that has been used for this purpose for many years. <code>dotenvx</code> was developed by the same developer, and is often recommended as a new, modern replacement to <code>dotenv</code> for most users. It includes features that allow us to create multiple environments and even encrypt values. So, for this project we&rsquo;ll use the newer library to take advantage of some of those features.</p></div></div><p>To begin, let&rsquo;s install <code>dotenvx</code> using <code>npm</code>:</p><div class=tab-panel data-tab-group=e62e4cb6cf914a3b40c0b1e70f64bf30><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e62e4cb6cf914a3b40c0b1e70f64bf30","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm install @dotenvx/dotenvx</span></span></code></pre></div></div></div></div></div><p>Next, we&rsquo;ll need to import that library as early as possible in our application, since we want to make sure that the environment is properly loaded before any other configuration files are referenced, since they may require environment variables to work properly. In this case, we want to do that as the very first thing in <code>app.js</code>:</p><div class=tab-panel data-tab-group=497e67255b7e7c7b304881a304f91de5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=appjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("497e67255b7e7c7b304881a304f91de5","appjs")'>
<span class=tab-nav-text>app.js</span></button></div><div class=tab-content-container><div data-tab-item=appjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class="line hl"><span class=cl><span class=kr>import</span> <span class=s1>&#39;@dotenvx/dotenvx/config&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>express</span> <span class=nx>from</span> <span class=s1>&#39;express&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>path</span> <span class=nx>from</span> <span class=s1>&#39;path&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>cookieParser</span> <span class=nx>from</span> <span class=s1>&#39;cookie-parser&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>compression</span> <span class=nx>from</span> <span class=s1>&#39;compression&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>helmet</span> <span class=nx>from</span> <span class=s1>&#39;helmet&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>requestLogger</span> <span class=nx>from</span> <span class=s1>&#39;./middlewares/request-logger.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>Now, when we run our application, we should get a helpful message letting us know that our environment file is missing:</p><div class=tab-panel data-tab-group=2baff10a2d6829aeb5c0447f38b93094><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2baff10a2d6829aeb5c0447f38b93094","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>&gt; example-project@0.0.1 dev
&gt; LOG_LEVEL=debug nodemon ./bin/www

[nodemon] 3.1.9
[nodemon] to restart at any time, enter `rs`
[nodemon] watching path(s): *.*
[nodemon] watching extensions: js,mjs,cjs,json
[nodemon] starting `node ./bin/www`
[MISSING_ENV_FILE] missing .env file (/workspaces/example-project/server/.env)
[MISSING_ENV_FILE] https://github.com/dotenvx/dotenvx/issues/484
[dotenvx@1.34.0] injecting env (0)
[2025-01-25 08:15:56.135 PM] info:      Listening on port 3000</code></pre></div></div></div></div></div><p>This is one of the many benefits that comes from using the newer <code>dotenvx</code> library - it will helpfully remind us when we are running without an environment file, just in case we forgot to create one.</p><p>So, now let&rsquo;s create the <code>.env</code> file in the <code>server</code> folder of our application, and add an environment variable to that file:</p><div class=tab-panel data-tab-group=0f9ba591a3ca2a49f956fad78e21efe2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=env class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0f9ba591a3ca2a49f956fad78e21efe2","env")'>
<span class=tab-nav-text>.env</span></button></div><div class=tab-content-container><div data-tab-item=env class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=nv>LOG_LEVEL</span><span class=o>=</span>error</span></span></code></pre></div></div></div></div></div><p>This should set the logging level of our application to <strong>error</strong>, meaning that only errors will be logged to the terminal. So, let&rsquo;s run our application and see what it does:</p><div class=tab-panel data-tab-group=322eccb2b13a82517ae9c71101b8453e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("322eccb2b13a82517ae9c71101b8453e","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm run dev</span></span></code></pre></div></div></div></div></div><p>However, when we do, we notice that we are still getting <strong>http</strong> logging in the output:</p><div class=tab-panel data-tab-group=ac88b5448378c74ab3b2dc584f714641><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ac88b5448378c74ab3b2dc584f714641","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>&gt; example-project@0.0.1 dev
&gt; LOG_LEVEL=debug nodemon ./bin/www

[nodemon] 3.1.9
[nodemon] to restart at any time, enter `rs`
[nodemon] watching path(s): *.*
[nodemon] watching extensions: js,mjs,cjs,json
[nodemon] starting `node ./bin/www`
[dotenvx@1.34.0] injecting env (0) from .env
[2025-01-25 08:20:17.438 PM] info:      Listening on port 3000
[2025-01-25 08:23:56.896 PM] http:      GET / 304 3.405 ms -</code></pre></div></div></div></div></div><p>This is because we are already setting the <code>LOG_LEVEL</code> environment variable directly in our <code>package.json</code> file:</p><div class=tab-panel data-tab-group=c9ae3cafd551491668cb9afcd64dc552><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=packagejson class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c9ae3cafd551491668cb9afcd64dc552","packagejson")'>
<span class=tab-nav-text>package.json</span></button></div><div class=tab-content-container><div data-tab-item=packagejson class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;example-project&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;module&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;private&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>    <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;LOG_LEVEL=http node ./bin/www&#34;</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>    <span class=nt>&#34;dev&#34;</span><span class=p>:</span> <span class=s2>&#34;LOG_LEVEL=debug nodemon ./bin/www&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=err>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>This is actually a great feature! The <code>dotenvx</code> library will not override any existing environment variables - so, if the environment is already configured, or we want to override anything that may be present in our <code>.env</code> file, we can just set it in the environment before running our application, and those values will take precedence!</p><p>For now, let&rsquo;s go ahead and remove that variable from the <code>dev</code> script in our <code>package.json</code> file:</p><div class=tab-panel data-tab-group=eca8e1f78c9097832f3e2bbbcffeaec5><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=packagejson class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("eca8e1f78c9097832f3e2bbbcffeaec5","packagejson")'>
<span class=tab-nav-text>package.json</span></button></div><div class=tab-content-container><div data-tab-item=packagejson class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;example-project&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;module&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;private&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;LOG_LEVEL=http node ./bin/www&#34;</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>    <span class=nt>&#34;dev&#34;</span><span class=p>:</span> <span class=s2>&#34;nodemon ./bin/www&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=err>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Now, when we run our program, we should not see any logging output (unless we can somehow cause the server to raise an error, which is unlikely right now):</p><div class=tab-panel data-tab-group=6f1975ad686f2ed5e35d11b9beda60fd><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6f1975ad686f2ed5e35d11b9beda60fd","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>&gt; example-project@0.0.1 dev
&gt; nodemon ./bin/www

[nodemon] 3.1.9
[nodemon] to restart at any time, enter `rs`
[nodemon] watching path(s): *.*
[nodemon] watching extensions: js,mjs,cjs,json
[nodemon] starting `node ./bin/www`
[dotenvx@1.34.0] injecting env (1) from .env</code></pre></div></div></div></div></div><p>Finally, let&rsquo;s go ahead and set the value in our <code>.env</code> file back to the <code>debug</code> setting:</p><div class=tab-panel data-tab-group=76734e8428e278262e4723cb76cf115b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=env class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("76734e8428e278262e4723cb76cf115b","env")'>
<span class=tab-nav-text>.env</span></button></div><div class=tab-content-container><div data-tab-item=env class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=nv>LOG_LEVEL</span><span class=o>=</span>debug</span></span></code></pre></div></div></div></div></div><p>Now, when we run our application, we can see that it is following that configuration:</p><div class=tab-panel data-tab-group=59700072c181a4aa82d5f6b161db4f47><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("59700072c181a4aa82d5f6b161db4f47","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>&gt; example-project@0.0.1 dev
&gt; nodemon ./bin/www

[nodemon] 3.1.9
[nodemon] to restart at any time, enter `rs`
[nodemon] watching path(s): *.*
[nodemon] watching extensions: js,mjs,cjs,json
[nodemon] starting `node ./bin/www`
[dotenvx@1.34.0] injecting env (1) from .env
[2025-01-25 08:28:54.587 PM] info:      Listening on port 3000
[2025-01-25 08:28:58.625 PM] http:      GET / 200 3.475 ms - -</code></pre></div></div></div></div></div><p>Great! We now have a powerful way to configure our application using a <code>.env</code> file.</p><h2 id=other-environment-variables>Other Environment Variables</h2><p>Right now, our program only uses one other environment variable, which can be found in the <code>bin/www</code> file:</p><div class=tab-panel data-tab-group=ca3f813b2ae7559faa4ef5a39b8f12df><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=binwww class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ca3f813b2ae7559faa4ef5a39b8f12df","binwww")'>
<span class=tab-nav-text>bin/www</span></button></div><div class=tab-content-container><div data-tab-item=binwww class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=ch>#!/usr/bin/env node
</span></span></span><span class=line><span class=cl><span class=ch></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>app</span> <span class=nx>from</span> <span class=s1>&#39;../app.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>logger</span> <span class=nx>from</span> <span class=s1>&#39;../configs/logger.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>http</span> <span class=nx>from</span> <span class=s1>&#39;http&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Get port from environment and store in Express.
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class="line hl"><span class=cl><span class=kd>var</span> <span class=nx>port</span> <span class=o>=</span> <span class=nx>normalizePort</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span> <span class=o>||</span> <span class=s1>&#39;3000&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s1>&#39;port&#39;</span><span class=p>,</span> <span class=nx>port</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>The code <code>process.env.PORT || '3000'</code> is a commonly used shorthand in JavaScript to check for the presence of a variable. Basically, if <code>process.env.PORT</code> is set, then that code will resolve to that value. If not, then the or operator <code>||</code> will use the second option, which is the value <code>'3000'</code> that is just hard-coded into our application.</p><p>So, we can set that value explicitly in our <code>.env</code> file:</p><div class=tab-panel data-tab-group=f06585c9c42faf81433fe1fc7d3989c8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=env class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("f06585c9c42faf81433fe1fc7d3989c8","env")'>
<span class=tab-nav-text>.env</span></button></div><div class=tab-content-container><div data-tab-item=env class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=nv>LOG_LEVEL</span><span class=o>=</span>debug
</span></span><span class=line><span class=cl><span class=nv>PORT</span><span class=o>=</span><span class=m>3000</span></span></span></code></pre></div></div></div></div></div><p>In general, it is always good practice to explicitly list all configurable values in the <code>.env</code> file when developing an application, since it helps us keep track of them.</p><p>However, each value should also have a <strong>logical default value</strong> if no configuration is provided. Ideally, our application should be able to run correctly with minimal configuration, or it should at least provide clear errors to the user when a configuration value is not provided. For example, we can look back at the <code>level()</code> function in <code>configs/logger.js</code> to see that it will set the logging level to <code>http</code> if it cannot find an appropriate <code>LOG_LEVEL</code> environment variable.</p><h2 id=environment-variable-security>Environment Variable Security</h2><p>Storing the configuration for our application in a <code>.env</code> file is a great option, and it is even included as item 3 of the <a href=https://12factor.net/config rel=external target=_blank>twelve-factor methodology</a> for developing modern web applications.</p><p>Unfortunately, this can present one <strong>major security flaw</strong> - often, the information stored in the <code>.env</code> file is very sensitive, since it may include database passwords, encryption keys, and more. So, we want to make absolutely sure that our <code>.env</code> file is never committed to git or GitHub, and it should never be shared between developers.</p><p>We can enforce this by ensuring that our <code>.gitignore</code> file inside of our <code>server</code> folder includes a line that prevents us from accidentally committing the <code>.env</code> file. Thankfully, both the <code>.gitignore</code> produced by the Express application generator, as well as the one in the GitHub <a href=https://github.com/github/gitignore/blob/main/Node.gitignore rel=external target=_blank>gitignore</a> repository both already include that line.</p><p>Instead, it is common practice to create a second file called <code>.env.example</code> (or similar) that contains a list of all configurable environment variables, along with safe default values for each. So, for this application, we might create a <code>.env.example</code> file that looks like this:</p><div class=tab-panel data-tab-group=e8603500ede8eebc67bb33b3b609fa58><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=envexample class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("e8603500ede8eebc67bb33b3b609fa58","envexample")'>
<span class=tab-nav-text>.env.example</span></button></div><div class=tab-content-container><div data-tab-item=envexample class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=nv>LOG_LEVEL</span><span class=o>=</span>http
</span></span><span class=line><span class=cl><span class=nv>PORT</span><span class=o>=</span><span class=m>3000</span></span></span></code></pre></div></div></div></div></div><p>This file can safely be committed to git and stored in GitHub. When a new developer or user clones our project, they can easily copy the <code>.env.example</code> file to <code>.env</code> and update it to match their desired configuration.</p><p>As we continue to add environment variables to our <code>.env</code> file, we should also make sure the <code>.env.example</code> file is kept up to date.</p><p>This is a good point to <strong>commit and push</strong> our work, but be extra sure that our <code>.env</code> file <strong>DOES NOT</strong> get committed to git!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=openapi-documentation>OpenAPI Documentation</h1><a href="https://www.youtube.com/watch?v=id">YouTube Video</a><h2 id=openapi-documentation>OpenAPI Documentation</h2><p>There are many different ways to document the features of a RESTful web application. One of the most commonly used methods is the <a href=https://www.openapis.org/ rel=external target=_blank>OpenAPI Specification (OAS)</a>. OpenAPI was originally based on the Swagger specification, so we&rsquo;ll sometimes still see references to the name Swagger in online resources.</p><p>At its core, the OpenAPI Specification defines a way to describe the functionality of a RESTful web application in a simple document format, typically structured as a JSON or YAML file. For example, we can find an example YAML file for a <a href=https://github.com/swagger-api/swagger-petstore/blob/master/src/main/resources/openapi.yaml rel=external target=_blank>Petstore API</a> that is commonly cited as an example project for understanding the OpenAPI Specification format.</p><p>That file can then be parsed and rendered as an interactive documentation website for developers and users of the API itself. So, we can find a current version of the <a href=https://petstore3.swagger.io/ rel=external target=_blank>Petstore API Documentation</a> online and compare it to the YAML document to see how it works.</p><p>For more information on the OpenAPI Specification, consult their <a href=https://learn.openapis.org/ rel=external target=_blank>Getting Started</a> page.</p><h2 id=configuration-openapi>Configuration OpenAPI</h2><p>For our project, we are going to take advantage of two helpful libraries to automatically generate and serve OpenAPI documentation for our code using documentation comments:</p><ul><li><a href=https://www.npmjs.com/package/swagger-jsdoc rel=external target=_blank>swagger-jsdoc</a> - generates OpenAPI Specification based on JSDoc comments.</li><li><a href=https://www.npmjs.com/package/swagger-ui-express rel=external target=_blank>swagger-ui-express</a> - serves an OpenAPI Documentation page based on the specification generated by other tools.</li></ul><p>First, let&rsquo;s install both of those libraries into our project:</p><div class=tab-panel data-tab-group=8a5fa7ad9763159ea58d24a3f992ec1c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("8a5fa7ad9763159ea58d24a3f992ec1c","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm install swagger-jsdoc swagger-ui-express</span></span></code></pre></div></div></div></div></div><p>Next, we should create a configuration file for the <code>swagger-jsdoc</code> library that contains some basic information about our API. We can store that in the <code>configs/openapi.js</code> file with the following content:</p><div class=tab-panel data-tab-group=cf24c6d69c9f8d12d425fbb6f4d90635><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=configsopenapijs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("cf24c6d69c9f8d12d425fbb6f4d90635","configsopenapijs")'>
<span class=tab-nav-text>configs/openapi.js</span></button></div><div class=tab-content-container><div data-tab-item=configsopenapijs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>swaggerJSDoc</span> <span class=nx>from</span> <span class=s1>&#39;swagger-jsdoc&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>url</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>OPENAPI_HOST</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>OPENAPI_HOST</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>port</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span> <span class=o>||</span> <span class=s1>&#39;3000&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=sb>`http://localhost:</span><span class=si>${</span><span class=nx>port</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>options</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>definition</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>openapi</span><span class=o>:</span> <span class=s1>&#39;3.1.0&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>info</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;Example Project&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>version</span><span class=o>:</span> <span class=s1>&#39;0.0.1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>description</span><span class=o>:</span> <span class=s1>&#39;Example Project&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>servers</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>url</span><span class=o>:</span> <span class=nx>url</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>apis</span><span class=o>:</span> <span class=p>[</span><span class=s1>&#39;./routes/*.js&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>swaggerJSDoc</span><span class=p>(</span><span class=nx>options</span><span class=p>)</span></span></span></code></pre></div></div></div></div></div><p>Let&rsquo;s look at a few items in this file to see what it does:</p><ul><li><code>url()</code> - this function checks for the <code>OPENAPI_HOST</code> environment variable. If that is set, then it will use that value. Otherwise, it uses a sensible default value of <code>http://localhost:3000</code> or whatever port is set in the environment.</li><li><code>options</code> - the <code>options</code> object is used to configure the <code>swagger-jsdoc</code> library. We can read more about how to configure that library in the <a href=https://www.npmjs.com/package/swagger-jsdoc rel=external target=_blank>documentation</a>. At a minimum, it provides some basic information about the API, as well as the URL where the API is located, and a list of source files to read information from. For now, we only want to read from the routes stored in the <code>routes</code> folder, so we include that path along with a wildcard filename.</li></ul><p>We should also take a minute to add the <code>OPENAPI_HOST</code> environment variable to our <code>.env</code> and <code>.env.example</code> files. If we are running our application locally, we can figure out what this value should be pretty easily (usually it will look similar to <code>http://localhost:3000</code> or similar). However, when we are running in GitHub Codespaces, our URL changes each time. Thankfully, we can find all the information we need in the environment variables provided by GitHub Codespaces (see the previous page for a full list).</p><p>So, the item we need to add to our <code>.env</code> file will look something like this:</p><div class=tab-panel data-tab-group=c62ef2e8eafd5b1d92fe1fc4dd12688e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=env class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c62ef2e8eafd5b1d92fe1fc4dd12688e","env")'>
<span class=tab-nav-text>.env</span></button></div><div class=tab-content-container><div data-tab-item=env class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=nv>LOG_LEVEL</span><span class=o>=</span>debug
</span></span><span class=line><span class=cl><span class=nv>PORT</span><span class=o>=</span><span class=m>3000</span>
</span></span><span class=line><span class=cl><span class=nv>OPENAPI_HOST</span><span class=o>=</span>https://<span class=nv>$CODESPACE_NAME</span>-<span class=nv>$PORT</span>.<span class=nv>$GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN</span></span></span></code></pre></div></div></div></div></div><p>This is one of the key features of the <code>dotenvx</code> library we are using - it will <strong>expand</strong> environment variables based on the existing environment. So, we are using the values stored in the <code>CODESPACE_NAME</code>, <code>PORT</code>, and <code>GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN</code> environment variables to construct the appropriate URL for our application.</p><p>In our <code>.env.example</code> file, we might want to make a note of this in a comment, just to be helpful for future developers. Comments in the <code>.env</code> file format are prefixed with hashes <code>#</code>.</p><div class=tab-panel data-tab-group=a6e6364d888b700a3e446efba327274c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=envexample class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("a6e6364d888b700a3e446efba327274c","envexample")'>
<span class=tab-nav-text>.env.example</span></button></div><div class=tab-content-container><div data-tab-item=envexample class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=nv>LOG_LEVEL</span><span class=o>=</span>debug
</span></span><span class=line><span class=cl><span class=nv>PORT</span><span class=o>=</span><span class=m>3000</span>
</span></span><span class=line><span class=cl><span class=nv>OPENAPI_HOST</span><span class=o>=</span>http://localhost:3000
</span></span><span class=line><span class=cl><span class=c1># For GitHub Codespaces</span>
</span></span><span class=line><span class=cl><span class=c1># OPENAPI_HOST=https://$CODESPACE_NAME-$PORT.$GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN</span></span></span></code></pre></div></div></div></div></div><p>Once that configuration is created, we can add it to our <code>app.js</code> file, along with a few lines to actually make the documentation visible:</p><div class=tab-panel data-tab-group=4df2b8303bbe7b5fd60d8a46fc3ff796><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=appjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4df2b8303bbe7b5fd60d8a46fc3ff796","appjs")'>
<span class=tab-nav-text>app.js</span></button></div><div class=tab-content-container><div data-tab-item=appjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=s1>&#39;@dotenvx/dotenvx/config&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>express</span> <span class=nx>from</span> <span class=s1>&#39;express&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>path</span> <span class=nx>from</span> <span class=s1>&#39;path&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>cookieParser</span> <span class=nx>from</span> <span class=s1>&#39;cookie-parser&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>compression</span> <span class=nx>from</span> <span class=s1>&#39;compression&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>helmet</span> <span class=nx>from</span> <span class=s1>&#39;helmet&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>requestLogger</span> <span class=nx>from</span> <span class=s1>&#39;./middlewares/request-logger.js&#39;</span><span class=p>;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>import</span> <span class=nx>logger</span> <span class=nx>from</span> <span class=s1>&#39;./configs/logger.js&#39;</span><span class=p>;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>import</span> <span class=nx>openapi</span> <span class=nx>from</span> <span class=s1>&#39;./configs/openapi.js&#39;</span>
</span></span><span class="line hl"><span class=cl><span class=kr>import</span> <span class=nx>swaggerUi</span> <span class=nx>from</span> <span class=s1>&#39;swagger-ui-express&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>indexRouter</span> <span class=nx>from</span> <span class=s1>&#39;./routes/index.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>usersRouter</span> <span class=nx>from</span> <span class=s1>&#39;./routes/users.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>helmet</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>compression</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>requestLogger</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>urlencoded</span><span class=p>({</span> <span class=nx>extended</span><span class=o>:</span> <span class=kc>false</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>cookieParser</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=kr>static</span><span class=p>(</span><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=kr>import</span><span class=p>.</span><span class=nx>meta</span><span class=p>.</span><span class=nx>dirname</span><span class=p>,</span> <span class=s1>&#39;public&#39;</span><span class=p>)));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=nx>indexRouter</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/users&#39;</span><span class=p>,</span> <span class=nx>usersRouter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>OPENAPI_VISIBLE</span> <span class=o>===</span> <span class=s1>&#39;true&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>    <span class=nx>logger</span><span class=p>.</span><span class=nx>warn</span><span class=p>(</span><span class=s1>&#39;OpenAPI documentation visible!&#39;</span><span class=p>);</span>
</span></span><span class="line hl"><span class=cl>    <span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/docs&#39;</span><span class=p>,</span> <span class=nx>swaggerUi</span><span class=p>.</span><span class=nx>serve</span><span class=p>,</span> <span class=nx>swaggerUi</span><span class=p>.</span><span class=nx>setup</span><span class=p>(</span><span class=nx>openapi</span><span class=p>,</span> <span class=p>{</span><span class=nx>explorer</span><span class=o>:</span> <span class=kc>true</span><span class=p>}));</span>
</span></span><span class="line hl"><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>app</span><span class=p>;</span></span></span></code></pre></div></div></div></div></div><p>Notice that we are using the <code>OPENAPI_VISIBLE</code> environment variable to control whether the documentation is visible or not, and we print a warning to the terminal if it is enabled. This is because it is often considered very insecure to make the details of our API visible to users unless that is the explicit intent, so it is better to be cautious.</p><p>Of course, to make the documentation appear, we&rsquo;ll have to set the <code>OPENAPI_VISIBLE</code> value to <code>true</code> in our <code>.env</code> file, and also add a default entry to the <code>.env.example</code> file as well:</p><div class=tab-panel data-tab-group=3d5cb4f7ce967eb5a0b318b61cbbfd1d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=env class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("3d5cb4f7ce967eb5a0b318b61cbbfd1d","env")'>
<span class=tab-nav-text>.env</span></button></div><div class=tab-content-container><div data-tab-item=env class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=nv>LOG_LEVEL</span><span class=o>=</span>debug
</span></span><span class=line><span class=cl><span class=nv>PORT</span><span class=o>=</span><span class=m>3000</span>
</span></span><span class=line><span class=cl><span class=nv>OPENAPI_HOST</span><span class=o>=</span>https://<span class=nv>$CODESPACE_NAME</span>-<span class=nv>$PORT</span>.<span class=nv>$GITHUB_CODESPACES_PORT_FORWARDING_DOMAIN</span>
</span></span><span class=line><span class=cl><span class=nv>OPENAPI_VISIBLE</span><span class=o>=</span>true</span></span></code></pre></div></div></div></div></div><p>Now, let&rsquo;s run our application and see what happens:</p><div class=tab-panel data-tab-group=9cd72351a2918fe0335d3ff3bd1c7ad0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9cd72351a2918fe0335d3ff3bd1c7ad0","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm run dev</span></span></code></pre></div></div></div></div></div><p>We should see the following output when our application initializes:</p><div class=tab-panel data-tab-group=4a943ba75ca21958a91d311b3977e95a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4a943ba75ca21958a91d311b3977e95a","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>&gt; example-project@0.0.1 dev
&gt; nodemon ./bin/www

[nodemon] 3.1.9
[nodemon] to restart at any time, enter `rs`
[nodemon] watching path(s): *.*
[nodemon] watching extensions: js,mjs,cjs,json
[nodemon] starting `node ./bin/www`
[dotenvx@1.34.0] injecting env (4) from .env
[2025-01-25 09:10:37.646 PM] warn:      OpenAPI documentation visible!
[2025-01-25 09:10:37.649 PM] info:      Listening on port 3000</code></pre></div></div></div></div></div><p>Now, let&rsquo;s load our application in a web browser, and go to the <code>/docs</code> path. We should see our OpenAPI Documentation website!</p><p><a href=#R-image-0a519facf5d5ab8875ba73d7c2544119 class=lightbox-link><img alt="OpenAPI Documentation Example" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/openapi_1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0a519facf5d5ab8875ba73d7c2544119><img alt="OpenAPI Documentation Example" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/openapi_1.png></a></p><p>Notice that the <strong>Servers</strong> URL matches the URL at the top of the page! That means our complex <code>OPENAPI_HOST</code> environment variable is working correctly.</p><p>However, we notice that our server does not have any operations defined yet, so we need to add those before we can really make use of this documentation website.</p><h2 id=documenting-routes>Documenting Routes</h2><p>To document our routes using the OpenAPI Specification, we can add a simple JSDoc comment above each route function with some basic information, prefixed by the <code>@swagger</code> tag.</p><div class=tab-panel data-tab-group=ba435453444e1be80edfc90938a0b94a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=routesindexjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ba435453444e1be80edfc90938a0b94a","routesindexjs")'>
<span class=tab-nav-text>routes/index.js</span></button></div><div class=tab-content-container><div data-tab-item=routesindexjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class="line hl"><span class=cl><span class=cm>/**
</span></span></span><span class="line hl"><span class=cl><span class=cm> * @swagger
</span></span></span><span class="line hl"><span class=cl><span class=cm> * tags:
</span></span></span><span class="line hl"><span class=cl><span class=cm> *   name: index
</span></span></span><span class="line hl"><span class=cl><span class=cm> *   description: Index Routes
</span></span></span><span class="line hl"><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>express</span> <span class=nx>from</span> <span class=s1>&#39;express&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>express</span><span class=p>.</span><span class=nx>Router</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=cm>/**
</span></span></span><span class="line hl"><span class=cl><span class=cm> * @swagger
</span></span></span><span class="line hl"><span class=cl><span class=cm> * /:
</span></span></span><span class="line hl"><span class=cl><span class=cm> *   get: 
</span></span></span><span class="line hl"><span class=cl><span class=cm> *     summary: index page
</span></span></span><span class="line hl"><span class=cl><span class=cm> *     description: Gets the index page for the application
</span></span></span><span class="line hl"><span class=cl><span class=cm> *     tags: [index]
</span></span></span><span class="line hl"><span class=cl><span class=cm> *     responses:
</span></span></span><span class="line hl"><span class=cl><span class=cm> *       200: 
</span></span></span><span class="line hl"><span class=cl><span class=cm> *         description: success
</span></span></span><span class="line hl"><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>render</span><span class=p>(</span><span class=s1>&#39;index&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;Express&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>router</span><span class=p>;</span></span></span></code></pre></div></div></div></div></div><div class=tab-panel data-tab-group=9f1510cd3ce52800baa309f4f0949da4><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=routesusersjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9f1510cd3ce52800baa309f4f0949da4","routesusersjs")'>
<span class=tab-nav-text>routes/users.js</span></button></div><div class=tab-content-container><div data-tab-item=routesusersjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class="line hl"><span class=cl><span class=cm>/**
</span></span></span><span class="line hl"><span class=cl><span class=cm> * @swagger
</span></span></span><span class="line hl"><span class=cl><span class=cm> * tags:
</span></span></span><span class="line hl"><span class=cl><span class=cm> *   name: users
</span></span></span><span class="line hl"><span class=cl><span class=cm> *   description: Users Routes
</span></span></span><span class="line hl"><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>express</span> <span class=nx>from</span> <span class=s1>&#39;express&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>express</span><span class=p>.</span><span class=nx>Router</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl><span class=cm>/**
</span></span></span><span class="line hl"><span class=cl><span class=cm> * @swagger
</span></span></span><span class="line hl"><span class=cl><span class=cm> * /users:
</span></span></span><span class="line hl"><span class=cl><span class=cm> *   get: 
</span></span></span><span class="line hl"><span class=cl><span class=cm> *     summary: users list page
</span></span></span><span class="line hl"><span class=cl><span class=cm> *     description: Gets the list of all users in the application
</span></span></span><span class="line hl"><span class=cl><span class=cm> *     tags: [users]
</span></span></span><span class="line hl"><span class=cl><span class=cm> *     responses:
</span></span></span><span class="line hl"><span class=cl><span class=cm> *       200: 
</span></span></span><span class="line hl"><span class=cl><span class=cm> *         description: a resource            
</span></span></span><span class="line hl"><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;respond with a resource&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>router</span><span class=p>;</span></span></span></code></pre></div></div></div></div></div><p>Now, when we run our application and view the documentation, we see two operations:</p><p><a href=#R-image-e613338d0be914a5b1abcac381a8232a class=lightbox-link><img alt="OpenAPI Documentation With Operations" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/openapi_2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-e613338d0be914a5b1abcac381a8232a><img alt="OpenAPI Documentation With Operations" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/openapi_2.png></a></p><p>We can expand the operation to learn more about it, and even test it on a running server if our URL is set correctly:</p><p><a href=#R-image-a6e5b9b152735107e8713a1b55a7d725 class=lightbox-link><img alt="OpenAPI Documentation Operation Example" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/examples/01/openapi_3.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-a6e5b9b152735107e8713a1b55a7d725><img alt="OpenAPI Documentation Operation Example" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/examples/01/openapi_3.png></a></p><p>As we develop our RESTful API, this documentation tool will be a very powerful way for us to understand our own API&rsquo;s design, and it will help us communicate easily with other developers who wish to use our API as well.</p><p>This is a good point to <strong>commit and push</strong> our work!</p><h2 id=references>References</h2><ul><li><a href=https://dev.to/qbentil/swagger-express-documenting-your-nodejs-rest-api-4lj7 rel=external target=_blank>Swagger & Express: Documenting Your Node.js REST API</a></li></ul><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=jsdoc-documentation>JSDoc Documentation</h1><a href="https://www.youtube.com/watch?v=id">YouTube Video</a><h2 id=jsdoc-documentation>JSDoc Documentation</h2><p>It is also considered good practice to add additional documentation to all of the source files we create for this application. One common standard is <a href=https://jsdoc.app/ rel=external target=_blank>JSDoc</a>, which is somewhat similar to the JavaDoc comments we may have seen in previous courses. JSDoc can be used to generate documentation, but we won&rsquo;t be using that directly in this project. However, we will be loosely following the JSDoc documentation standard to give our code comments some consistency. We can find a full list of the tags in the <a href=https://jsdoc.app/ rel=external target=_blank>JSDoc Documentation</a>.</p><p>For example, we can add a file header to the top of each source file with a few important tags. We may also want to organize our import statements and add notes for each group. We can also document individual functions, such as the <code>normalizePort</code> function in the <code>bin/www</code> file. Here&rsquo;s a fully documented and commented version of that file:</p><div class=tab-panel data-tab-group=81cd8f2a5c998f5684bb7a2d97cc2561><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=binwww class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("81cd8f2a5c998f5684bb7a2d97cc2561","binwww")'>
<span class=tab-nav-text>bin/www</span></button></div><div class=tab-content-container><div data-tab-item=binwww class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @file Executable entrypoint for the web application
</span></span></span><span class=line><span class=cl><span class=cm> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>http</span> <span class=nx>from</span> <span class=s1>&#39;http&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import Express application
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>app</span> <span class=nx>from</span> <span class=s1>&#39;../app.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import logging configuration
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>logger</span> <span class=nx>from</span> <span class=s1>&#39;../configs/logger.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Get port from environment and store in Express
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>port</span> <span class=o>=</span> <span class=nx>normalizePort</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span> <span class=o>||</span> <span class=s1>&#39;3000&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s1>&#39;port&#39;</span><span class=p>,</span> <span class=nx>port</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create HTTP server
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>server</span> <span class=o>=</span> <span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>(</span><span class=nx>app</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Listen on provided port, on all network interfaces
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>server</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>port</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Attach event handlers
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>server</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>,</span> <span class=nx>onError</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>server</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;listening&#39;</span><span class=p>,</span> <span class=nx>onListening</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Normalize a port into a number, string, or false.
</span></span></span><span class=line><span class=cl><span class=cm> * 
</span></span></span><span class=line><span class=cl><span class=cm> * @param {(string|number)} val - a value representing a port to connect to
</span></span></span><span class=line><span class=cl><span class=cm> * @returns {(number|string|boolean)} the port or `false`
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>normalizePort</span><span class=p>(</span><span class=nx>val</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>port</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nx>val</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nb>isNaN</span><span class=p>(</span><span class=nx>port</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// named pipe
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>port</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// port number
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nx>port</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Event listener for HTTP server &#34;error&#34; event.
</span></span></span><span class=line><span class=cl><span class=cm> * 
</span></span></span><span class=line><span class=cl><span class=cm> * @param {error} error - the HTTP error event
</span></span></span><span class=line><span class=cl><span class=cm> * @throws error if the error cannot be determined
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>onError</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>syscall</span> <span class=o>!==</span> <span class=s1>&#39;listen&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>bind</span> <span class=o>=</span> <span class=k>typeof</span> <span class=nx>port</span> <span class=o>===</span> <span class=s1>&#39;string&#39;</span>
</span></span><span class=line><span class=cl>    <span class=o>?</span> <span class=s1>&#39;Pipe &#39;</span> <span class=o>+</span> <span class=nx>port</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=s1>&#39;Port &#39;</span> <span class=o>+</span> <span class=nx>port</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// handle specific listen errors with friendly messages
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>switch</span> <span class=p>(</span><span class=nx>error</span><span class=p>.</span><span class=nx>code</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;EACCES&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=nx>bind</span> <span class=o>+</span> <span class=s1>&#39; requires elevated privileges&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s1>&#39;EADDRINUSE&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=nx>bind</span> <span class=o>+</span> <span class=s1>&#39; is already in use&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=nx>process</span><span class=p>.</span><span class=nx>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=nx>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Event listener for HTTP server &#34;listening&#34; event.
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>onListening</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>addr</span> <span class=o>=</span> <span class=nx>server</span><span class=p>.</span><span class=nx>address</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>bind</span> <span class=o>=</span> <span class=k>typeof</span> <span class=nx>addr</span> <span class=o>===</span> <span class=s1>&#39;string&#39;</span>
</span></span><span class=line><span class=cl>    <span class=o>?</span> <span class=s1>&#39;pipe &#39;</span> <span class=o>+</span> <span class=nx>addr</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=s1>&#39;port &#39;</span> <span class=o>+</span> <span class=nx>addr</span><span class=p>.</span><span class=nx>port</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>logger</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;Listening on &#39;</span> <span class=o>+</span> <span class=nx>bind</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Here is another example of a cleaned up, reorganized, and documented version of the <code>app.js</code> file. Notice that it also includes an <code>@export</code> tag at the top to denote the type of object that is exported from this file.</p><div class=tab-panel data-tab-group=647da744df02e12e5a4e9d3e6b821838><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=appjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("647da744df02e12e5a4e9d3e6b821838","appjs")'>
<span class=tab-nav-text>app.js</span></button></div><div class=tab-content-container><div data-tab-item=appjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @file Main Express application
</span></span></span><span class=line><span class=cl><span class=cm> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span class=line><span class=cl><span class=cm> * @exports app Express application
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Load environment (must be first)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=s1>&#39;@dotenvx/dotenvx/config&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>compression</span> <span class=nx>from</span> <span class=s1>&#39;compression&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>cookieParser</span> <span class=nx>from</span> <span class=s1>&#39;cookie-parser&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>express</span> <span class=nx>from</span> <span class=s1>&#39;express&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>helmet</span> <span class=nx>from</span> <span class=s1>&#39;helmet&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>path</span> <span class=nx>from</span> <span class=s1>&#39;path&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>swaggerUi</span> <span class=nx>from</span> <span class=s1>&#39;swagger-ui-express&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import configurations
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>logger</span> <span class=nx>from</span> <span class=s1>&#39;./configs/logger.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>openapi</span> <span class=nx>from</span> <span class=s1>&#39;./configs/openapi.js&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import middlewares
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>requestLogger</span> <span class=nx>from</span> <span class=s1>&#39;./middlewares/request-logger.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import routers
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>indexRouter</span> <span class=nx>from</span> <span class=s1>&#39;./routes/index.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>usersRouter</span> <span class=nx>from</span> <span class=s1>&#39;./routes/users.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create Express application
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Use libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>helmet</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>compression</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>urlencoded</span><span class=p>({</span> <span class=nx>extended</span><span class=o>:</span> <span class=kc>false</span> <span class=p>}));</span> 
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>cookieParser</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Use middlewares
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>requestLogger</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Use static files
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=kr>static</span><span class=p>(</span><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=kr>import</span><span class=p>.</span><span class=nx>meta</span><span class=p>.</span><span class=nx>dirname</span><span class=p>,</span> <span class=s1>&#39;public&#39;</span><span class=p>)));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Use routers
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=nx>indexRouter</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/users&#39;</span><span class=p>,</span> <span class=nx>usersRouter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Use SwaggerJSDoc router if enabled
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>OPENAPI_VISIBLE</span> <span class=o>===</span> <span class=s1>&#39;true&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>logger</span><span class=p>.</span><span class=nx>warn</span><span class=p>(</span><span class=s1>&#39;OpenAPI documentation visible!&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s1>&#39;/docs&#39;</span><span class=p>,</span> <span class=nx>swaggerUi</span><span class=p>.</span><span class=nx>serve</span><span class=p>,</span> <span class=nx>swaggerUi</span><span class=p>.</span><span class=nx>setup</span><span class=p>(</span><span class=nx>openapi</span><span class=p>,</span> <span class=p>{</span><span class=nx>explorer</span><span class=o>:</span> <span class=kc>true</span><span class=p>}));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>app</span><span class=p>;</span></span></span></code></pre></div></div></div></div></div><p>Finally, here is a fully documented <code>routes/index.js</code> file, showing how routes can be documented both with JSDoc tags as well as OpenAPI Specification items:</p><div class=tab-panel data-tab-group=b8c539a15c58ffb05b16d3da0bcb7763><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=routesindexjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("b8c539a15c58ffb05b16d3da0bcb7763","routesindexjs")'>
<span class=tab-nav-text>routes/index.js</span></button></div><div class=tab-content-container><div data-tab-item=routesindexjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @file Index router
</span></span></span><span class=line><span class=cl><span class=cm> * @author Russell Feldhausen &lt;russfeld@ksu.edu&gt;
</span></span></span><span class=line><span class=cl><span class=cm> * @exports router an Express router
</span></span></span><span class=line><span class=cl><span class=cm> * 
</span></span></span><span class=line><span class=cl><span class=cm> * @swagger
</span></span></span><span class=line><span class=cl><span class=cm> * tags:
</span></span></span><span class=line><span class=cl><span class=cm> *   name: index
</span></span></span><span class=line><span class=cl><span class=cm> *   description: Index Routes
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Import libraries
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>express</span> <span class=nx>from</span> <span class=s2>&#34;express&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create Express router
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>express</span><span class=p>.</span><span class=nx>Router</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Gets the index page for the application
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @param {Object} req - Express request object
</span></span></span><span class=line><span class=cl><span class=cm> * @param {Object} res - Express response object
</span></span></span><span class=line><span class=cl><span class=cm> * @param {Function} next - Express next middleware function
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * @swagger
</span></span></span><span class=line><span class=cl><span class=cm> * /:
</span></span></span><span class=line><span class=cl><span class=cm> *   get: 
</span></span></span><span class=line><span class=cl><span class=cm> *     summary: index page
</span></span></span><span class=line><span class=cl><span class=cm> *     description: Gets the index page for the application
</span></span></span><span class=line><span class=cl><span class=cm> *     tags: [index]
</span></span></span><span class=line><span class=cl><span class=cm> *     responses:
</span></span></span><span class=line><span class=cl><span class=cm> *       200: 
</span></span></span><span class=line><span class=cl><span class=cm> *         description: success
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>render</span><span class=p>(</span><span class=s1>&#39;index&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;Express&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>router</span><span class=p>;</span></span></span></code></pre></div></div></div></div></div><p>Now is a great time to document all of the JavaScript files in our application following the <a href=https://jsdoc.app/ rel=external target=_blank>JSDoc</a> standard.</p><p>This is a good point to <strong>commit and push</strong> our work!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=linting--formatting>Linting & Formatting</h1><a href="https://www.youtube.com/watch?v=id">YouTube Video</a><h2 id=linting>Linting</h2><p>Finally, let&rsquo;s look at two other tools that will help us write clean and maintainable JavaScript code. The first tool is <a href=https://www.npmjs.com/package/eslint rel=external target=_blank>eslint</a>, which is a <a href=https://en.wikipedia.org/wiki/Lint_(software) rel=external target=_blank>linting</a> tool to find bugs and issues in JavaScript code by performing some static analysis on it. This helps us avoid any major issues in our code that can be easily detected just by looking at the overall style and structure of our code.</p><p>To begin, we can install <code>eslint</code> following the recommended process in their documentation:</p><div class=tab-panel data-tab-group=ab935338809762cdf53042daf86a6c69><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ab935338809762cdf53042daf86a6c69","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm init @eslint/config@latest</span></span></code></pre></div></div></div></div></div><p>It will install the package and ask several configuration questions along the way. We can follow along with the answers shown in the output below:</p><div class=tab-panel data-tab-group=068015e165867a1ab4ce350cb7b76070><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("068015e165867a1ab4ce350cb7b76070","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>Need to install the following packages:
@eslint/create-config@1.4.0
Ok to proceed? (y) y

@eslint/create-config: v1.4.0

✔ How would you like to use ESLint? · problems
✔ What type of modules does your project use? · esm
✔ Which framework does your project use? · none
✔ Does your project use TypeScript? · javascript
✔ Where does your code run? · node
The config that you&#39;ve selected requires the following dependencies:

eslint, globals, @eslint/js
✔ Would you like to install them now? · No / Yes
✔ Which package manager do you want to use? · npm
☕️Installing...

added 70 packages, and audited 273 packages in 5s

52 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
Successfully created /workspaces/example-project/server/eslint.config.js file.</code></pre></div></div></div></div></div><p>Once it is installed, we can run <code>eslint</code> using the following command:</p><div class=tab-panel data-tab-group=9c24726bf3c24354514e462f90880ecf><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("9c24726bf3c24354514e462f90880ecf","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npx eslint --fix .</span></span></code></pre></div></div></div></div></div><p>When we do, we&rsquo;ll probably get a couple of errors:</p><div class=tab-panel data-tab-group=0f982ff43dfaac10ef5f5a87cf02ce31><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("0f982ff43dfaac10ef5f5a87cf02ce31","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>/workspaces/example-project/server/routes/index.js
  35:36  error  &#39;next&#39; is defined but never used  no-unused-vars

/workspaces/example-project/server/routes/users.js
  35:36  error  &#39;next&#39; is defined but never used  no-unused-vars

✖ 2 problems (2 errors, 0 warnings)</code></pre></div></div></div></div></div><p>In both of our routes files, we have included the <code>next</code> parameter, but it is unused. We could remove it, but it is often considered good practice to include that parameter in case we need to explicitly use it. So, in our <code>eslint.config.js</code> we can add an option to ignore that parameter (pay careful attention to the formatting; for some reason the file by default does not have much spacing between the curly braces):</p><div class=tab-panel data-tab-group=84d8b9198a5fd30e27b6eda167998f44><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=eslintconfigjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("84d8b9198a5fd30e27b6eda167998f44","eslintconfigjs")'>
<span class=tab-nav-text>eslint.config.js</span></button></div><div class=tab-content-container><div data-tab-item=eslintconfigjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>globals</span> <span class=nx>from</span> <span class=s2>&#34;globals&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>pluginJs</span> <span class=nx>from</span> <span class=s2>&#34;@eslint/js&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/** @type {import(&#39;eslint&#39;).Linter.Config[]} */</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>languageOptions</span><span class=o>:</span> <span class=p>{</span> <span class=nx>globals</span><span class=o>:</span> <span class=nx>globals</span><span class=p>.</span><span class=nx>node</span> <span class=p>},</span>
</span></span><span class="line hl"><span class=cl>    <span class=nx>rules</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>      <span class=s1>&#39;no-unused-vars&#39;</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class="line hl"><span class=cl>        <span class=s1>&#39;error&#39;</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>        <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>          <span class=nx>argsIgnorePattern</span><span class=o>:</span> <span class=s1>&#39;next&#39;</span>
</span></span><span class="line hl"><span class=cl>        <span class=p>}</span>
</span></span><span class="line hl"><span class=cl>      <span class=p>]</span>
</span></span><span class="line hl"><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>pluginJs</span><span class=p>.</span><span class=nx>configs</span><span class=p>.</span><span class=nx>recommended</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>];</span></span></span></code></pre></div></div></div></div></div><p>Now, when we run that command, we should not get any output!</p><div class=tab-panel data-tab-group=98a3e4da08c2d2faf275bb3074d77ec1><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("98a3e4da08c2d2faf275bb3074d77ec1","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npx eslint --fix .</span></span></code></pre></div></div></div></div></div><p>To make this even easier, let&rsquo;s add a new script to the <code>scripts</code> section of our <code>package.json</code> file for this tool:</p><div class=tab-panel data-tab-group=86bdd77580c5d624c1354ef9cfc46f4e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=packagejson class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("86bdd77580c5d624c1354ef9cfc46f4e","packagejson")'>
<span class=tab-nav-text>package.json</span></button></div><div class=tab-content-container><div data-tab-item=packagejson class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>...</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;LOG_LEVEL=http node ./bin/www&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;dev&#34;</span><span class=p>:</span> <span class=s2>&#34;LOG_LEVEL=debug nodemon ./bin/www&#34;</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>    <span class=nt>&#34;lint&#34;</span><span class=p>:</span> <span class=s2>&#34;npx eslint --fix .&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=err>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>Now we can just run this command to check our project for errors:</p><div class=tab-panel data-tab-group=93e98583dd39fffd0b045a9c4e5da54c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("93e98583dd39fffd0b045a9c4e5da54c","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm run lint</span></span></code></pre></div></div></div></div></div><h2 id=formatting>Formatting</h2><p>Another commonly used tool for JavaScript developers is <a href=https://www.npmjs.com/package/prettier rel=external target=_blank>prettier</a>. Prettier will reformat our JavaScript code to match a defined coding style, making it much easier to read and maintain.</p><p>First, let&rsquo;s install <code>prettier</code> using <code>npm</code> as a development dependency:</p><div class=tab-panel data-tab-group=c7722439a70bf836d10f5b1e65b5eb77><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("c7722439a70bf836d10f5b1e65b5eb77","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm install prettier --save-dev</span></span></code></pre></div></div></div></div></div><p>We also need to create a <code>.prettierrc</code> configuration file that just contains an empty JavaScript object for now:</p><div class=tab-panel data-tab-group=eae7d72d98eaa8dd30c4bc2648bcd86e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=prettierrc class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("eae7d72d98eaa8dd30c4bc2648bcd86e","prettierrc")'>
<span class=tab-nav-text>.prettierrc</span></button></div><div class=tab-content-container><div data-tab-item=prettierrc class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>{}</span></span></span></code></pre></div></div></div></div></div><p>There are many options that can be placed in that configuration file - see the <a href=https://prettier.io/docs/en/options rel=external target=_blank>Prettier Documentation</a> for details. For now, we&rsquo;ll just leave it blank.</p><p>We can now run the <code>prettier</code> command on our code:</p><div class=tab-panel data-tab-group=69a8ab8768a96770790aa20b2e2c6d97><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("69a8ab8768a96770790aa20b2e2c6d97","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npx prettier . --write</span></span></code></pre></div></div></div></div></div><p>When we do, we&rsquo;ll see output listing all of the files that have been changed:</p><div class=tab-panel data-tab-group=45640a71cf04b1201b01fc391c5709e8><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("45640a71cf04b1201b01fc391c5709e8","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0><code>.prettierrc 34ms
app.js 34ms
configs/logger.js 19ms
configs/openapi.js 7ms
eslint.config.js 5ms
middlewares/request-logger.js 5ms
package-lock.json 111ms (unchanged)
package.json 2ms (unchanged)
public/index.html 29ms
routes/index.js 4ms
routes/users.js 3ms</code></pre></div></div></div></div></div><p>Notice that nearly all of the files have been updated in some way. Many times it simply aligns code and removes extra spaces, but other times it will rewrite long lines.</p><p>Just like with <code>eslint</code>, let&rsquo;s add a new script to <code>package.json</code> to make this process simpler as well:</p><div class=tab-panel data-tab-group=2c89afb939b360222bfa7374a8f098ad><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=packagejson class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("2c89afb939b360222bfa7374a8f098ad","packagejson")'>
<span class=tab-nav-text>package.json</span></button></div><div class=tab-content-container><div data-tab-item=packagejson class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>...</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;LOG_LEVEL=http node ./bin/www&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;dev&#34;</span><span class=p>:</span> <span class=s2>&#34;LOG_LEVEL=debug nodemon ./bin/www&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;lint&#34;</span><span class=p>:</span> <span class=s2>&#34;npx eslint --fix .&#34;</span><span class=p>,</span>
</span></span><span class="line hl"><span class=cl>    <span class=nt>&#34;format&#34;</span><span class=p>:</span> <span class=s2>&#34;npx prettier . --write&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=err>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></div></div><p>With that script in place, we can clean up our code anytime using this command:</p><div class=tab-panel data-tab-group=4e7e3b3ac726970d9c53a9ae32586cd2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("4e7e3b3ac726970d9c53a9ae32586cd2","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm run format</span></span></code></pre></div></div></div></div></div><div class="box notices cstyle tip"><div class=box-label><i class="fa-fw fas fa-lightbulb"></i> Best Practice</div><div class=box-content><p>Now that we have installed both <code>eslint</code> and <code>prettier</code>, it is always a good practice to run both tools before committing any code to git and pushing to GitHub. This ensures that your codebase is always clean, well formatted, and free of errors or bugs that could be easily spotted by these tools.</p></div></div><p>This is a good point to <strong>commit and push</strong> our work!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=summary>Summary</h1><a href="https://www.youtube.com/watch?v=id">YouTube Video</a><h2 id=summary>Summary</h2><p>In this example project, we created an Express application with the following features:</p><ol><li>GitHub Codespaces</li><li>A sample Express application</li><li>Updated to ES Modules</li><li>Application logs with Winston and Morgan</li><li>Other useful libraries such as Compression and Helmet</li><li>A better development server using Nodemon</li><li>Environment variables through Dotenvx</li><li>Code documentation with JSDoc and OpenAPI comments</li><li>Linting and Formatting with ESLint and Prettier</li></ol><p>This example project makes a great basis for building robust RESTful web APIs and other Express applications.</p><p>As you work on projects built from this framework, we welcome any feedback or additions to be made. Feel free to submit requests to the course instructor for updates to this project.</p><footer class=footline></footer></article></section></div></main><div class=git-footer><p class=theme-version-footer>6.0.0</p><p>Last modified by:
<i class='fas fa-user'></i> Russell Feldhausen
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cis526/commit/920ac46e708a41d979faf79a776f65a32286c34d>Jan 25, 2025</a></p></div></div><script src=/cis526/js/clipboard.min.js?1741029263 defer></script><script src=/cis526/js/perfect-scrollbar.min.js?1741029263 defer></script><script src=/cis526/js/theme.js?1741029263 defer></script></body></html>