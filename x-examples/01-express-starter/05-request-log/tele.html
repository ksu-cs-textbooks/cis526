<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.148.1"><meta name=generator content="Relearn 8.0.0"><meta name=description content="YouTube Video Logging Requests with Morgan Now that we have configured a logging utility, let’s use it to also log all incoming requests sent to our web application. This will definitely make it much easier to keep track of what is going on in our application and make sure it is working correctly.
The Express application generator already installs a library for this, called morgan. We have already seen output from morgan before:"><meta name=author content="Nathan Bean & Russell Feldhausen"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta name=twitter:title content="Request Logging :: CIS 526 Textbook"><meta name=twitter:description content="YouTube Video Logging Requests with Morgan Now that we have configured a logging utility, let’s use it to also log all incoming requests sent to our web application. This will definitely make it much easier to keep track of what is going on in our application and make sure it is working correctly.
The Express application generator already installs a library for this, called morgan. We have already seen output from morgan before:"><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/x-examples/01-express-starter/05-request-log/index.html"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Request Logging :: CIS 526 Textbook"><meta property="og:description" content="YouTube Video Logging Requests with Morgan Now that we have configured a logging utility, let’s use it to also log all incoming requests sent to our web application. This will definitely make it much easier to keep track of what is going on in our application and make sure it is working correctly.
The Express application generator already installs a library for this, called morgan. We have already seen output from morgan before:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="Example Projects"><meta property="article:modified_time" content="2025-03-06T15:49:16-06:00"><meta property="og:image" content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><meta itemprop=name content="Request Logging :: CIS 526 Textbook"><meta itemprop=description content="YouTube Video Logging Requests with Morgan Now that we have configured a logging utility, let’s use it to also log all incoming requests sent to our web application. This will definitely make it much easier to keep track of what is going on in our application and make sure it is working correctly.
The Express application generator already installs a library for this, called morgan. We have already seen output from morgan before:"><meta itemprop=dateModified content="2025-03-06T15:49:16-06:00"><meta itemprop=wordCount content="541"><meta itemprop=image content="https://textbooks.cs.ksu.edu/cis526/images/hero.png"><title>Request Logging :: CIS 526 Textbook</title><link href=https://textbooks.cs.ksu.edu/cis526/x-examples/01-express-starter/05-request-log/index.html rel=canonical type=text/html title="Request Logging :: CIS 526 Textbook"><link href=/cis526/x-examples/01-express-starter/05-request-log/index.xml rel=alternate type=application/rss+xml title="Request Logging :: CIS 526 Textbook"><link href=/cis526/x-examples/01-express-starter/05-request-log/index.print.html rel=alternate type=text/html title="Request Logging :: CIS 526 Textbook"><link href=/cis526/x-examples/01-express-starter/05-request-log/embed.html rel=alternate type=text/html title="Request Logging :: CIS 526 Textbook"><link href=/cis526/css/auto-complete/auto-complete.min.css?1769118339 rel=stylesheet><script src=/cis526/js/auto-complete/auto-complete.min.js?1769118339 defer></script><script src=/cis526/js/search-lunr.min.js?1769118339 defer></script><script src=/cis526/js/search.min.js?1769118339 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/cis526/searchindex.en.js?1769118339"</script><script src=/cis526/js/lunr/lunr.min.js?1769118339 defer></script><script src=/cis526/js/lunr/lunr.stemmer.support.min.js?1769118339 defer></script><script src=/cis526/js/lunr/lunr.multi.min.js?1769118339 defer></script><script src=/cis526/js/lunr/lunr.en.min.js?1769118339 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1769118339 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/fonts/fontawesome/css/fontawesome-all.min.css?1769118339 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar/perfect-scrollbar.min.css?1769118339 rel=stylesheet><link href=/cis526/css/theme.min.css?1769118339 rel=stylesheet><link href=/cis526/css/format-html.min.css?1769118339 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/x-examples/01-express-starter/05-request-log/index.html",window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!1,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["light-theme"],window.relearn.customvariantname="my-custom-variant",window.relearn.writeVariant=!1,window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.writeVariant&&window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><link href=/cis526/css/custom.css?1769118339 rel=stylesheet></head><body class="mobile-support html" data-url=/cis526/x-examples/01-express-starter/05-request-log/index.html><div id=tele class="tele mirror"><div id=R-body class=default-animation><div id=R-body-overlay></div><div id=R-main-overlay></div><main id=R-body-inner class="highlightable x-examples" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=request-logging>Request Logging</h1><a href="https://www.youtube.com/watch?v=0d9YbadZ3Mk">YouTube Video</a><h2 id=logging-requests-with-morgan>Logging Requests with Morgan</h2><p>Now that we have configured a logging utility, let&rsquo;s use it to also log all incoming requests sent to our web application. This will definitely make it much easier to keep track of what is going on in our application and make sure it is working correctly.</p><p>The Express application generator already installs a library for this, called <a href=https://www.npmjs.com/package/morgan rel=external target=_blank>morgan</a>. We have already seen output from <code>morgan</code> before:</p><div class=tab-panel data-tab-group=ab3feb62121a9980c4b3ef52d24be1dc><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("ab3feb62121a9980c4b3ef52d24be1dc","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0><code>GET / 304 2.569 ms - -
GET /users 200 2.417 ms - 23
GET / 200 1.739 ms - 120</code></pre></div></div></div></div></div><p>While this is useful, let&rsquo;s reconfigure <code>morgan</code> to use our new <code>winston</code> logger and add some additional detail to the output.</p><p>Since <code>morgan</code> is technically a <a href=https://expressjs.com/en/guide/using-middleware.html rel=external target=_blank>middleware</a> in our application, let&rsquo;s create a new folder called <code>middlewares</code> to store configuration for our various middlewares, and then we can create a new middleware file named <code>request-logger.js</code> in that folder. Inside of that file, we can place the following configuration:</p><div class=tab-panel data-tab-group=67901cb946416f7b0df3495a6790d3fd><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=middlewaresrequest-loggerjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("67901cb946416f7b0df3495a6790d3fd","middlewaresrequest-loggerjs")'>
<span class=tab-nav-text>middlewares/request-logger.js</span></button></div><div class=tab-content-container><div data-tab-item=middlewaresrequest-loggerjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>morgan</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;morgan&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>logger</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;../configs/logger.js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Override morgan stream method to use our custom logger
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Log Format
</span></span></span><span style=display:flex><span><span style=color:#75715e>// :method :url :status :response-time ms - :res[content-length]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>stream</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>write</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>message</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// log using the &#39;http&#39; severity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>http</span>(<span style=color:#a6e22e>message</span>.<span style=color:#a6e22e>trim</span>())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// See https://github.com/expressjs/morgan?tab=readme-ov-file#api
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>requestLogger</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>morgan</span>(<span style=color:#e6db74>&#39;dev&#39;</span>, { <span style=color:#a6e22e>stream</span> });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>requestLogger</span>;</span></span></code></pre></div></div></div></div></div><p>In effect, this file basically tells <code>morgan</code> to write output through the <code>logger.http()</code> method instead of just directly to the console. We are importing our <code>winston</code> configuration from <code>configs/logger.js</code> to accomplish this. We are also configuring <code>morgan</code> to use the <code>dev</code> logging format; more information on log formats can be found in the <a href=https://www.npmjs.com/package/morgan rel=external target=_blank>documentation</a>.</p><p>Finally, let&rsquo;s update our <code>app.js</code> file to use this new request logger middleware instead of <code>morgan</code>:</p><div class=tab-panel data-tab-group=d4473fd072494e5bbf5f7612b6f8420f><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=appjs class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("d4473fd072494e5bbf5f7612b6f8420f","appjs")'>
<span class=tab-nav-text>app.js</span></button></div><div class=tab-content-container><div data-tab-item=appjs class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>express</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;express&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>path</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;path&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>cookieParser</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;cookie-parser&#39;</span>;
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// import logger from &#39;morgan&#39;;
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>requestLogger</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./middlewares/request-logger.js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>indexRouter</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./routes/index.js&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>usersRouter</span> <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./routes/users.js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>express</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e>// app.use(logger(&#39;dev&#39;));
</span></span></span><span style=display:flex;background-color:#3c3d38><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>requestLogger</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>express</span>.<span style=color:#a6e22e>json</span>());
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>express</span>.<span style=color:#a6e22e>urlencoded</span>({ <span style=color:#a6e22e>extended</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span> }));
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>cookieParser</span>());
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#a6e22e>express</span>.<span style=color:#66d9ef>static</span>(<span style=color:#a6e22e>path</span>.<span style=color:#a6e22e>join</span>(<span style=color:#66d9ef>import</span>.<span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>dirname</span>, <span style=color:#e6db74>&#39;public&#39;</span>)));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// -=-=- other code omitted here -=-=-
</span></span></span></code></pre></div></div></div></div></div><p>Now, let&rsquo;s run our application and access a few of the routes via our web browser:</p><div class=tab-panel data-tab-group=60d9e2448e223fa5672e6e3e823e3fc0><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=terminal class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("60d9e2448e223fa5672e6e3e823e3fc0","terminal")'>
<span class=tab-nav-text>terminal</span></button></div><div class=tab-content-container><div data-tab-item=terminal class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ npm run dev</span></span></code></pre></div></div></div></div></div><p>We should now see output from <code>morgan</code> included as <code>http</code> logs from <code>winston</code>:</p><div class=tab-panel data-tab-group=6242f05c8114b52d2e72dd58ea1e3c8a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button data-tab-item=output class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("6242f05c8114b52d2e72dd58ea1e3c8a","output")'>
<span class=tab-nav-text>output</span></button></div><div class=tab-content-container><div data-tab-item=output class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class=highlight dir=auto><pre tabindex=0><code>&gt; example-project@0.0.1 dev
&gt; LOG_LEVEL=debug node ./bin/www

[2025-01-17 06:39:30.975 PM] info:      Listening on port 3000
[2025-01-17 06:39:37.430 PM] http:      GET / 200 3.851 ms - 120
[2025-01-17 06:39:40.665 PM] http:      GET /users 200 3.184 ms - 23
[2025-01-17 06:39:43.069 PM] http:      GET / 304 0.672 ms - -
[2025-01-17 06:39:45.424 PM] http:      GET /users 304 1.670 ms - -</code></pre></div></div></div></div></div><p>When viewed on a modern terminal, they should even be colorized!</p><p><a href=#R-image-d2dd32bae901e6e61b6984b363ed27cf class=lightbox-link><img alt="Request Logging" class="border lazy lightbox figure-image" loading=lazy src=/cis526/images/examples/01/request_1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-d2dd32bae901e6e61b6984b363ed27cf><img alt="Request Logging" class="border lazy lightbox lightbox-image" loading=lazy src=/cis526/images/examples/01/request_1.png></a></p><p>Here, we can see each log level is colorized, and also the HTTP status codes in our <code>morgan</code> log output are also colorized. The first time each page is accessed, the browser receives a <code>200</code> status code in green with the content. The second time, our application correctly sends back a <code>304</code> status code in light blue, indicating that the content has not been modified and that the browser can use the cached version instead.</p><p>This is a good point to <strong>commit and push</strong> our work!</p><footer class=footline></footer></article></div></main></div><script src=/cis526/js/clipboard/clipboard.min.js?1769118339 defer></script><script src=/cis526/js/perfect-scrollbar/perfect-scrollbar.min.js?1769118339 defer></script><script src=/cis526/js/theme.min.js?1769118339 defer></script></div><script src=/cis526/js/tele-scroll.min.js?1769118339 defer></script></body></html>