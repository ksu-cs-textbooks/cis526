<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 6.0.0"><meta name=description content="JavaScript on the Server"><meta name=author content="Nathan Bean"><meta name=twitter:card content="summary"><meta name=twitter:title content="Introduction to Node :: CIS 526 Textbook"><meta name=twitter:description content="JavaScript on the Server"><meta property="og:url" content="https://textbooks.cs.ksu.edu/cis526/04-node/"><meta property="og:site_name" content="CIS 526 Textbook"><meta property="og:title" content="Introduction to Node :: CIS 526 Textbook"><meta property="og:description" content="JavaScript on the Server"><meta property="og:locale" content="en-us"><meta property="og:type" content="website"><meta itemprop=name content="Introduction to Node :: CIS 526 Textbook"><meta itemprop=description content="JavaScript on the Server"><meta itemprop=datePublished content="2018-08-24T10:53:05-05:00"><meta itemprop=dateModified content="2023-08-10T16:48:12-05:00"><meta itemprop=wordCount content="4"><title>Introduction to Node :: CIS 526 Textbook</title>
<link href=https://textbooks.cs.ksu.edu/cis526/04-node/ rel=canonical type=text/html title="Introduction to Node :: CIS 526 Textbook"><link href=/cis526/04-node/index.xml rel=alternate type=application/rss+xml title="Introduction to Node :: CIS 526 Textbook"><link href=/cis526/04-node/tele.html rel=alternate type=text/html title="Introduction to Node :: CIS 526 Textbook"><link href=/cis526/04-node/embed.html rel=alternate type=text/html title="Introduction to Node :: CIS 526 Textbook"><link href=/cis526/css/fontawesome-all.min.css?1742522008 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fontawesome-all.min.css?1742522008 rel=stylesheet></noscript><link href=/cis526/css/nucleus.css?1742522008 rel=stylesheet><link href=/cis526/css/auto-complete.css?1742522008 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/auto-complete.css?1742522008 rel=stylesheet></noscript><link href=/cis526/css/perfect-scrollbar.min.css?1742522008 rel=stylesheet><link href=/cis526/css/fonts.css?1742522008 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/cis526/css/fonts.css?1742522008 rel=stylesheet></noscript><link href=/cis526/css/theme.css?1742522008 rel=stylesheet><link href=/cis526/css/theme-auto.css?1742522008 rel=stylesheet id=R-variant-style><link href=/cis526/css/chroma-auto.css?1742522008 rel=stylesheet id=R-variant-chroma-style><link href=/cis526/css/variant.css?1742522008 rel=stylesheet><link href=/cis526/css/print.css?1742522008 rel=stylesheet media=print><link href=/cis526/css/format-print.css?1742522008 rel=stylesheet><script src=/cis526/js/variant.js?1742522008></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="https://textbooks.cs.ksu.edu/cis526",window.index_js_url="/cis526/index.search.js",window.variants&&variants.init(["auto","light-theme","dark-theme"]),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`</script><link href=/cis526/css/custom.css?1742522008 rel=stylesheet></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=/cis526/04-node/><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Introduction to Node</span><meta itemprop=position content="1"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/03-asynchronous-js/09-summary/ title="Summary (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/cis526/04-node/01-introduction/ title="Introduction (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable chapter narrow" tabindex=-1><div class=flex-block-wrapper><article class=chapter><header class=headline></header><div class=article-subheading>Chapter 4</div><h1 id=introduction-to-node>Introduction to Node</h1><p>JavaScript on the Server</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Introduction to Node</h1><article class=default><header class=headline></header><h1 id=introduction>Introduction</h1><p>Node is an open-source, cross-platform JavaScript runtime environment build on Google&rsquo;s V8 engine. It was created by Ryan Dahl in 2009 to allow for server-side scripting in JavaScript.</p><p><a href=#R-image-896aa00ffcca9749aad56a8afe10f4cc class=lightbox-link><img alt="Ryan Dahl" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/Ryan_Dahl.jpg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-896aa00ffcca9749aad56a8afe10f4cc><img alt="Ryan Dahl" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/Ryan_Dahl.jpg></a></p><h2 id=ecmascript-support>ECMAScript Support</h2><p>Node supports most of the features of ECMAScript 2015 (ES6), with the notable exception of ES6 modules (as Node adopted the CommonJS module approach before the ES6 proposal, and the two approaches are not interchangeable). You can learn more about Node&rsquo;s ES6 support <a href=https://nodejs.org/en/docs/es6/ rel=external target=_blank>here</a>.</p><h2 id=differences-between-browser-javascript-and-node>Differences between Browser JavaScript and Node</h2><p>While JavaScript in the browser has been deliberately sandboxed and is only allowed to interact with the current document and the Internet, Node can interact with the file system and operating system of the hosting computer. Also, because Node is not hosted in a browser, it has no Document Object Model (DOM), and no <code>document</code> or <code>window</code> global variables. To reflect this, the global namespace for Node is <code>global</code> instead of <code>window</code>.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p>Node can be downloaded for Windows, Linux, and MacOS at <a href=https://nodejs.org/en/ rel=external target=_blank>https://nodejs.org/en/</a>. Documentation for Node is found at <a href=https://nodejs.org/en/docs/ rel=external target=_blank>https://nodejs.org/en/docs/</a>. On many Linux and Mac systems, multiple versions of Node can be installed and managed using <a href=https://github.com/nvm-sh/nvm rel=external target=_blank>Node Version Manager (nvm)</a>. Using nvm may be preferred on those systems since most package repositories include older and outdated versions of Node.</p></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=event-loop--console>Event Loop & Console</h1><p>Node adopts an asynchronous event-driven approach to computing, much like JavaScript does in the browser. For example, when we set up a HTTP server in Node, we define a function to call when a HTTP request (an event) is received. As requests come in, they are added to a queue which is processed in a FIFO (first-in, first-out) manner.</p><p><a href=#R-image-5c150d44f95ce4a56ec460a9d11bc2e2 class=lightbox-link><img alt="JavaScript Event Loop" class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/4.2.1.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-5c150d44f95ce4a56ec460a9d11bc2e2><img alt="JavaScript Event Loop" class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/4.2.1.png></a></p><p>In addition to events, Node implements many asynchronous functions for potentially blocking operations. For example, consider file I/O. If you write a program that needs to read a file, but when it attempts to do so the file is already open in another program, your program must wait for it to become available. In the meantime, your program is <em>blocked</em>, and its execution pauses. A real-world analogue would be a checkout line at a store. If the cashier is ringing up a customer and finds an item without a price tag, they may leave their station to go find the item on the shelves. While they are away, the line is <em>blocked</em>, everyone in line must wait for the cashier to return.</p><p>There are two basic strategies to deal with potentially blocking operations - <strong>multi-threading</strong> and <strong>asynchronous processing</strong>. A multi-threading strategy involves parallelizing the task; in our store example, we&rsquo;d have additional cash registers, cashiers, and lines. Even if one line is blocked, the others continue to ring up customers. In contrast, asynchronous processing moves the potentially blocking task into another process, and continues with the task at hand. When the asynchronous process finishes, it queues its results for the main process to resume. In our store example, this would be the cashier sending another employee to find the price, suspending the sale on the register, and continuing to check out other customers while the first customer waits. When the other employee returns with a price, the cashier finishes checking out the current customer, then resumes the first customer&rsquo;s transactions.</p><p>Node uses this asynchronous model to handle most potentially blocking operations (and often provides a synchronous approach as well). When possible, the asynchronous process is handled by the operating system, but the Node runtime also maintains a pool of threads to farm tasks out to.</p><p>The Node event loop is divided into a series of phases - each queues the associated kinds of events and processes them in a round-robin fashion. This helps ensure that one kind of event can&rsquo;t overwhelm the system:</p><p><a href=#R-image-ed035b46fef321aefbf8b197c9f35d58 class=lightbox-link><img alt="JavaScript " class="border lazy lightbox noshadow figure-image" loading=lazy src=/cis526/images/4.2.2.png style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ed035b46fef321aefbf8b197c9f35d58><img alt="JavaScript " class="border lazy lightbox noshadow lightbox-image" loading=lazy src=/cis526/images/4.2.2.png></a></p><p>For a more detailed breakdown of the Node event loop, check out <a href=https://medium.com/the-node-js-collection/what-you-should-know-to-really-understand-the-node-js-event-loop-and-its-metrics-c4907b19da4c rel=external target=_blank>this blog post</a> by Daniel Khan or the <a href=https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/ rel=external target=_blank>Node Event Loop Documentation</a>.</p><h2 id=console>Console</h2><p>To produce output on the terminal, Node provides a global instance of a <a href=https://nodejs.org/api/console.html rel=external target=_blank>Console</a> called <code>console</code> that is accessible throughout the code. The typical way to produce text output on the terminal in Node is using the <code>console.log()</code> method.</p><p>Node actually defines multiple log functions corresponding to different <em>log levels</em>, indicating the importance of the message. These are (in order of severity, least to most):</p><ol><li><code>console.debug()</code></li><li><code>console.info()</code></li><li><code>console.warn()</code></li><li><code>console.error()</code></li></ol><p>These are all aliases for <code>console.log()</code> (<code>console.debug()</code> and <code>console.info()</code>) or <code>console.error()</code> (<code>console.warn()</code> and <code>console.error()</code>). They don&rsquo;t really do anything different, which might lead you to wonder why they exist&mldr;</p><p>But remember, JavaScript is a <em>dynamic</em> language, so we can re-define the <code>console</code> object with our own custom implementation that <em>does</em> do something unique with these various versions. But because they exist, they can <em>also</em> be used with the built-in console. This way our code can be compatible with both approaches!</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=asynchronous-functions>Asynchronous Functions</h1><p>The benefit of the asynchronous approach is that all user-written code runs in a single-threaded environment while avoiding blocking. This means for the most part, we can write code the way we are used to, with a few tweaks for asynchronous functions.</p><p>Consider the two approaches for reading and printing the contents of a file, below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Synchronous approach
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>data</span> <span class=o>=</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>readFileSync</span><span class=p>(</span><span class=s1>&#39;file.txt&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Asynchronous approach
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fs</span><span class=p>.</span><span class=nx>readFile</span><span class=p>(</span><span class=s1>&#39;file.txt&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>data</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>In the synchronous function, the contents of the file are <em>returned</em>, and assigned to the variable <code>data</code>. Conversely, in the asynchronous approach the file contents are passed into a <em>callback</em> function that is invoked when the asynchronous process finishes (and when the callback phase of the Node event loop is reached). The function itself returns nothing (<code>undefined</code> in Node). The important difference between the two is in the first approach, the program waits for the file to be read. In the second, the program keeps executing lines of code after the asynchronous call, even though the file hasn&rsquo;t been read yet.</p><h2 id=asynchronous-callback-structure>Asynchronous Callback Structure</h2><p>In most Node libraries, the callback function provided to the asynchronous function follows the same format - the first parameter is an error value, which will be populated with text or object if an error occurred, and otherwise will be a <strong>falsy</strong> value (a value that evaluates to false, like <code>false</code>, <code>null</code>, <code>undefined</code>, or <code>0</code>). Successive arguments are the data the function was intended to retrieve - i.e. the contents of the file in the above example. Of course, if an error <em>was</em> encountered, the later values may be wrong. Thus, most programmers follow the pattern of checking for an error at the start of the callback, and halting execution if one is encountered. Rewriting the example above, we would see:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>fs</span><span class=p>.</span><span class=nx>readFile</span><span class=p>(</span><span class=s2>&#34;file.txt&#34;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>data</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=k>return</span> <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>If <code>err</code> is a <strong>truthy</strong> value (any non-falsy value, in this case an Exception object or a string), we log the error to the console and return, halting execution of the rest of the function.</p><h2 id=common-asynchronous-misconceptions>Common Asynchronous Misconceptions</h2><p>It is very important to understand that the callback is <em>executed at a future point in time</em>, and execution continues to further lines of code. Consider this example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>contents</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>fs</span><span class=p>.</span><span class=nx>readFile</span><span class=p>(</span><span class=s2>&#34;example.txt&#34;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>contents</span> <span class=o>=</span> <span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>contents</span><span class=p>);</span></span></span></code></pre></div><p>Assuming the file <em>example.txt</em> contains only the line <code>"hello world"</code>, what do you think is printed?</p><p>You might think that it would be <code>"hello world"</code>, but the <code>console.log(data)</code> happens <em>before</em> the callback function is executed, so it will be <code>undefined</code>. If you wanted to print the file contents, you would have to instead do something like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>contents</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>fs</span><span class=p>.</span><span class=nx>readFile</span><span class=p>(</span><span class=s2>&#34;example.txt&#34;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>contents</span> <span class=o>=</span> <span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>contents</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div><p>Because the logging now happens <em>inside</em> the callback value, it will only occur <em>after</em> the file has been read, and the results added to the event queue, which is where the <code>contents</code> variable is initialized.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><p><a href=https://textbooks.cs.ksu.edu/cis526/03-asynchronous-js/07-promises/ rel=external target=_blank>Promises</a> and the <a href=https://textbooks.cs.ksu.edu/cis526/03-asynchronous-js/08-async-await/ rel=external target=_blank>async/await</a> keywords covered in the previous chapter are both attempts to sidestep these misconceptions by introducing new objects and syntax that provide more familiar abstractions to programmers.</p></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=modules>Modules</h1><p>One major feature Node introduced to JavaScript was the ability to encapsulate code into separate files using <em>modules</em>. The approach adopted by Node is the <strong>CommonJS</strong> module pattern.</p><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div><div class=box-content><p>Node&rsquo;s use of modules predates ECMA6&rsquo;s adoption of modules, and the CommonJS approach Node adopted is fundamentally different than the ECMA6 version. For Node 16 (installed on your Codio Box), ECMA6 modules are an optional feature that has to be enabled with a flag when invoking the node command, i.e.:</p><div class=highlight><pre tabindex=0><code>$ node --input-type=module &lt;file&gt;</code></pre></div><p>We can also enable ECMA6 module support by using the <code>.mjs</code> file extension, or by setting an option in the <code>package.json</code> file present in our project. See the <a href=https://nodejs.org/dist./v16.15.0/docs/api/esm.html#modules-ecmascript-modules rel=external target=_blank>NodeJS Documentation</a> for more information.</p></div></div><h2 id=writing-a-module>Writing a Module</h2><p>A module is simply a JavaScript file (typically saved with a <em>js</em> extension). Code within the module is locally scoped to the module; code intended to be accessed outside of the module must be explicitly <em>exported</em> by assigning it to the <code>module.exports</code> parameter. This example exports a function to print &ldquo;Hello World&rdquo;:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/* hello.js */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>helloWorld</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Hello World&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>helloWorld</span><span class=p>;</span></span></span></code></pre></div><p>You can export a value, function, or object from a module. If you don&rsquo;t specify an export, a module exports <code>undefined</code>.</p><h2 id=loading-a-module>Loading a Module</h2><p>CommonJS Modules are loaded using the <code>require()</code> function, which loads the JavaScript in the module and returns any exports from the module. Objects, functions, or even values can be exported, i.e. this example loads our earlier module, assigns the result to the variable greet, and invokes it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>greet</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./hello&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>greet</span><span class=p>();</span></span></span></code></pre></div><p>This example will print &ldquo;Hello World&rdquo; to the console.</p><p>There are three kinds of modules you can load in Node: 1) core libraries, 2) npm packages, and 3) user-authored modules.</p><p>Core libraries are part of Node. Examples are the <em>fs</em> (file system) library, the <em>http</em> library, and the <em>crypto</em> library. A full list of libraries can be found in the <a href=https://nodejs.org/api/ rel=external target=_blank>Node documentation</a>. Node libraries are required using their name as as the argument, i.e. <code>require('fs')</code> will require the filesystem library.</p><p>Npm packages are typically open-source libraries created by the community and are downloaded using the Node Package Manager (npm). These are installed either globally, or within a <em>node_modules</em> folder created by npm within your project. Npm modules are required by their package name, i.e. <code>require('webpack')</code> will load the webpack package.</p><p>User-written modules are loaded from the filesystem, and are typically located in your project directory or subdirectories within it. They are required using the filepath to their file, i.e. <code>require('./hello.js</code>). It is important to use the period-slash (<code>./</code>) indicating current directory to distinguish files from npm packages.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=packages>Packages</h1><p>The Node Package Manager allows you to create a <em>package</em> representing your project. This is similar to Visual Studio&rsquo;s idea of a <em>project</em> - a package is a complete Node program.</p><p>Just as Visual Studio adds solution and project files, a Node package adds a file named <em>package.json</em> and a directory named <em>node_modules</em>.</p><h2 id=the-package-file>The Package File</h2><p>Every node package has in its top-level directory a file named <em>package.json</em>. This JSON file provides important information about the project, including:</p><ul><li>The name of the project</li><li>The version of the project</li><li>The author of the project</li><li>The entry point (the file that should be processed first, much like a C# <em>Program.cs</em> file or C++ <em>main.cpp</em> file). Owing to its roots as a language for developing webservers, the default is <em>index.js</em>, though it can be anything you want (many projects use <em>server.js</em> or <em>main.js</em>).</li><li>Any scripts associated with the project (often we&rsquo;ll have scripts to run and test the project)</li><li>Any dependencies of the project (these are additional packages that are copied into the <em>node_modules</em> file)</li><li>The home repository of the project (often a GitHub repository, though other options are possible)</li><li>The license under which this package is released</li></ul><p>Most of the properties of the <em>package.json</em> are optional, and there are options I have listed above are not comprehensive. The <em>package.json</em> object format is described in great detail in the <a href=https://docs.npmjs.com/files/package.json rel=external target=_blank>npm documentation</a>.</p><h2 id=semantic-versioning>Semantic Versioning</h2><p>Node packages use <a href=https://semver.org/ rel=external target=_blank>semantic versioning</a>, a numbering scheme that uses three numbers separated by periods in the pattern <code>MAJOR.MINOR.PATCH</code>. For example, your Codio Box is likely running <strong>Ubuntu 18.04.3</strong> - that is Ubuntu, major release 18, minor release 4, patch 3. If its developers found a bug or security vulnerability and fixed it, they would release a new patch version, i.e. <strong>Ubuntu 18.04.4</strong>. If they made some improvements that don&rsquo;t change the way you work with the operating system, those might be a minor release, i.e. <strong>Ubuntu 18.05.0</strong> (note that the patch release number starts over at 0). And if a major change in the way the software works was made, that would be a major release, i.e. <strong>Ubuntu 19.0.0</strong>. Additionally, you probably have seen the program listed as <strong>Ubuntu 18.04.4 LTS</strong>. The LTS is not part of semantic versioning, but indicates this is a <em>long term support</em> release, i.e. one the developers have committed to fixing problems with for a specific duration of time.</p><p>When releasing your own Node packages, you should strive to practice using semantic versioning. That way you get into the habit, and it will be easier when you become a professional developer. Another good practice is to have a <em>changelog</em> - a text or markdown file that lists the changes made in each successive version of the program, usually as a bulleted list.</p><h2 id=initializing-the-package>Initializing the Package</h2><p>You can manually create the <em>package.json</em> file, but npm also provides a wizard to make this process easier. From the terminal, while at the root directory of your project, enter the command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm init</span></span></code></pre></div><p>This will launch the wizard, asking you a series of questions used to create the project. It will also offer default options for many of the values; you can simply press the space bar to accept these. Moreover, if your directory contains an already-initialized git repository, it will use that repository&rsquo;s origin as the basis for the repository option. The wizard will create the <em>package.json</em> file in the project&rsquo;s root directory.</p><p>Next we&rsquo;ll look at some aspects of the package in more detail.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=dependencies>Dependencies</h1><p>A second great benefit of creating your project as a Node package is that dependencies can be managed using the Node Package Manager (npm). You can install any Node package with the command <code>$npm install [package name]</code>. This command looks for the corresponding package in an online repository, and if it is found, downloads it and saves it to the subdirectory <em>node_modules</em> in your package directory.</p><p>It also creates an entry in the <em>package.json</em> file corresponding to the package you installed, and also an entry in the <em>package.lock.json</em> file. The entry in your <em>package.json</em> file may specify a specific version, i.e.:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;example-package&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;dependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;foo&#34;</span><span class=p>:</span> <span class=s2>&#34;2.1.3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;bar&#34;</span><span class=p>:</span> <span class=s2>&#34;^1.1.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;doh&#34;</span><span class=p>:</span> <span class=s2>&#34;~4.3.2&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>The <code>^</code> before the <code>"bar"</code> dependency indicates that npm can use any <em>minor release</em> after this version, i.e. we could use <strong>bar 1.2.1</strong> but not bar <strong>2.1.1</strong>. The <code>~</code> before the <code>"doh"</code> dependency indicates that npm can use any <em>patch release</em> after this version, i.e. <strong>doh 4.3.4</strong> but not <strong>doh 4.4.0</strong>. Because we specified the <em>exact</em> version for <code>"foo"</code>, it will always install <strong>foo 2.1.3</strong>. We could also indicate we will accept <em>any</em> major version with an <code>*</code>, but this is rarely used. Additionally, we can specify a git repo or a location on our hard drive, though these approaches are also not commonly used.</p><p>The reason we want the dependency information specified this way is that when we commit our package to source control, we typically <em>exclude</em> the dependencies found in <strong>node_modules</strong>. As this folder can get quite large, this saves us significant space in our repository. When you clone your package to a new location, you can re-install the dependencies with the command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ npm install </span></span></code></pre></div><p>This will pull the latest version of each dependency package allowable. Additionally, some modules may have their own dependencies, in which case npm will strive to find a version that works for all requirements.</p><p>Finally, the <em>package.lock.json</em> contains the <em>exact</em> version of the dependencies installed. It <em>is</em> intended to be committed to your repository, and if it exists it will make the <code>npm install</code> command install the exact same packages. This can help avoid problems where two versions of a package are slightly different.</p><h2 id=development-dependency>Development Dependency</h2><p>In addition to regular dependencies, we can specify dependencies we only need during development. Adding the <code>--save-dev</code> flag to the command will add the package to a <em>development</em> dependency list in your <em>package.json</em> file. Development dependencies are only installed in the development environment; they are left out in a production environment.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Info</div><div class=box-content><h2 id=the-npm-registry>The NPM Registry</h2><p>There are many ways to connect with dependencies, but one of the easiest and most popular is to use the <a href=https://www.npmjs.com/ rel=external target=_blank>NPM Registry</a>, a searchable, online directory of npm packages maintained by npm, Inc. You can search for keywords and (hopefully) find a project that fits your needs.</p></div></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=git>Git</h1><p>Most Node packages are made available as <a href=https://git-scm.com rel=external target=_blank>git</a> repositories, and npm has built-in support for using git.</p><h2 id=the-repository-property>The Repository Property</h2><p>In your <em>package.json</em> file, you can specify a <code>"repository"</code> property, which specifies where the repository for this project exists. Consider the following example of the npm command-line interface package:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;repository&#34;</span><span class=err>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;type&#34;</span> <span class=p>:</span> <span class=s2>&#34;git&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;url&#34;</span> <span class=p>:</span> <span class=s2>&#34;https://github.com/npm/cli.git&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>For many open-source projects, the repository is located on Github, a GitHub gist, BitBucket, or a GitLab instance. These can be specified with a shorthand, which matches the corresponding <code>npm install</code> argument:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;repository&#34;</span><span class=err>:</span> <span class=s2>&#34;npm/npm&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s2>&#34;repository&#34;</span><span class=err>:</span> <span class=s2>&#34;github:user/repo&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s2>&#34;repository&#34;</span><span class=err>:</span> <span class=s2>&#34;gist:11081aaa281&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s2>&#34;repository&#34;</span><span class=err>:</span> <span class=s2>&#34;bitbucket:user/repo&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s2>&#34;repository&#34;</span><span class=err>:</span> <span class=s2>&#34;gitlab:user/repo&#34;</span></span></span></code></pre></div><p>If your project folder already is set up as a git repo <em>before</em> you run <code>$npm init</code>, then the wizard will suggest using the existing repository.</p><h2 id=the-gitignore-file>The .gitignore File</h2><p>Like any git repo, there are some files you will want to exclude from version control. The most important of these is the <em>node_modules</em> folder, which we exclude for two reasons:</p><ol><li>The folder&rsquo;s contents are large, and are available from the original sources specified in your package&rsquo;s dependencies - therefore they represent significant and unnecessary glut in a repository.</li><li>Some portions of your dependencies may be compiled from C code as they are installed. Since C code is compiled into binaries for a specific target machine&rsquo;s architecture, you will encounter errors if your development and production machines are different. Re-installing packages in the production machine with <code>$npm install</code> avoids this.</li></ol><p>Therefore, you should include <em>at least</em> this line in your <em>.gitignore</em> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>node_modules/</span></span></code></pre></div><p>It&rsquo;s also a good idea to leave out any logging files:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>logs
</span></span><span class=line><span class=cl>*.log</span></span></code></pre></div><p>You may also want to look at GitHub&rsquo;s boilerplate <a href=https://github.com/github/gitignore/blob/master/Node.gitignore rel=external target=_blank>Node .gitignore template</a>, which adds additional rules based on many popular Node frameworks (adding an ignore for a file or directory that doesn&rsquo;t exist in your project is harmless).</p><p>The <em>.gitignore</em> file should ideally be added before the repository has been created, as files already under version control override <em>.gitignore</em> rules.</p><h2 id=initializing-the-repository>Initializing the Repository</h2><p>Now we can initialize our repository with the <code>$git init</code> command in the terminal:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ git init </span></span></code></pre></div><p>Note how a <em>.git</em> directory is added to our project? This is where git stores the <strong>diff</strong> information that allows it to track versions of our code.</p><p>The <code>init</code> command adds the current directory structure (less that specified in the <em>.gitignore</em> file) to the staging list. Otherwise, we&rsquo;d need to stage these files ourselves for version tracking with the git command, <code>add .</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$git add .</span></span></code></pre></div><p>Once staged, we can commit the initial version of our package with a git <code>commit</code> command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ git commit -a -m &#34;Initial commit&#34;</span></span></code></pre></div><p>The <code>-a</code> flag indicates we are committing <em>all currently staged files</em>, alternatively you can commit files one-at-a-time, if you only want to commit one or a few files. The <code>-m</code> file indicates we are also adding a commit message, which follows in quotes (""). If we don&rsquo;t use this flag, then git will open a text editor to write the commit message in. For the Linux platform, the default is <em>vi</em>, a powerful command line text editor that has a bit of a learning curve. If you find vi has launched on you and you are uncertain how to proceed, follow these steps:</p><ol><li>Type your commit message</li><li>Hit the [ESC] key - this moves you from <em>edit</em> mode to <em>command mode</em></li><li>Type the command <code>:wq</code>. Vi commands always start with a colon (:), and can be grouped. The <code>w</code> indicates the file should be written (saved), and the <code>q</code> indicates we want to quit the editor.</li></ol><h2 id=adding-remote-repositories>Adding Remote Repositories</h2><p>If you want to host your repository on GitHub or another hosting tool (such as BitBucket or GitLab), you will need to add that repository&rsquo;s url as a <em>remote origin</em> for your local repository. You can do so with the command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ git remote add origin [repo url]</span></span></code></pre></div><p>Where <code>[repo url]</code> is the url of the remote repo. If you want to use GitHub, create an empty repository, and copy the created repository&rsquo;s link.</p><p>If you clone a repository from GitHub or another tool, the remote origin is automatically set to that parent repository. If you ever need to change the remote origin, it&rsquo;s a two-step process:</p><ol><li>Delete the current origin with the git command:<code>$git remote rm origin</code></li><li>Add your new origin with the git command: <code>$git remote add origin</code></li></ol><p>You can also add other targets than <em>origin</em> (origin is a generic target meaning the originating repository). To see all remote repositories, use the command <code>$git remote -v</code>, which lists all registered remote repositories (the <code>-v</code> flag is for <em>verbose</em>).</p><h2 id=pushing-and-pulling>Pushing and Pulling</h2><p>The <code>$git push</code> and <code>$git pull</code> commands are shorthand for pushing and pulling the master branch to and from the origin repository. The full commands can be used to push an alternate branch or to reach an alternate remote repository: <code>$git push [remote repo name] [branch name]</code>, <code>$git pull [remote repo name] [branch name]</code></p><h2 id=git-and-codio>Git and Codio</h2><p>Pushing your code to a remote repository is a good way to move it between Codio boxes. You can clone such a repository after you create it with the command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ git clone [git clone url]</span></span></code></pre></div><p>Where the <code>[git clone url]</code> is the URL of your remote repository. Cloning a repository automatically sets its remote origin repo to the repository it was cloned from.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=summary>Summary</h1><p>Node, and its package manager, npm, are powerful tools for developing server-side applications in JavaScript. In the past chapter, we&rsquo;ve discussed the event loop that drives Node&rsquo;s asynchronous, event-driven approach, and the asynchronous function pattern employed by many node libraries. We&rsquo;ve also talked about how Node.js code can be organized into modules, how those modules can be imported with a <code>require()</code> call, and how the node package manager (npm) can be used to download and install open-source packages locally. Finally, we&rsquo;ve discussed how to create our own local packages from our projects.</p><h2 id=resources>Resources</h2><p>Node can be downloaded from <a href=https://nodejs.org rel=external target=_blank>nodejs.org</a> or installed using <a href=https://github.com/nvm-sh/nvm rel=external target=_blank>Node Version Manager (nvm)</a>.</p><p>The latest Node documentation can be found at <a href=https://nodejs.org/en/docs/ rel=external target=_blank>https://nodejs.org/en/docs/</a></p><footer class=footline></footer></article></section></div></main><div class=git-footer><p class=theme-version-footer>6.0.0</p><p>Last modified by:
<i class='fas fa-user'></i> Russell Feldhausen
<i class='fas fa-calendar'></i> <a href=https://github.com/ksu-cs-textbooks/cis526/commit/41163dc548a00400a9f1d4962b4227b9a8ee4d20>Aug 10, 2023</a></p></div></div><script src=/cis526/js/clipboard.min.js?1742522008 defer></script><script src=/cis526/js/perfect-scrollbar.min.js?1742522008 defer></script><script src=/cis526/js/theme.js?1742522008 defer></script></body></html>